window.Laya=function(t,e){var i={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function(t,e){return 1==arguments.length?i.__presubstr.call(this,t):i.__presubstr.call(this,t,e>0?e:this.length+e)},__init:function(t){t.forEach(function(t){t.__init$&&t.__init$()})},__parseInt:function(t){return t?parseInt(t):0},__isClass:function(t){return t&&(t.__isclass||t==Object||t==String||t==Array)},__newvec:function(t,e){var i,n=[];n.length=t;for(i=0;i<t;i++)n[i]=e;return n},__extend:function(t,e){function n(){i.un(this,"constructor",t)}var s,r,o;for(s in e)if(e.hasOwnProperty(s)){r=e.__lookupGetter__(s),o=e.__lookupSetter__(s);if(r||o){r&&t.__defineGetter__(s,r);o&&t.__defineSetter__(s,o)}else t[s]=e[s]}n.prototype=e.prototype;t.prototype=new n;i.un(t.prototype,"__imps",i.__copy({},e.prototype.__imps))},__copy:function(t,e){if(!e)return null;t=t||{};for(var i in e)t[i]=e[i];return t},__package:function(e,n){var s,r,o,a,h;if(!i.__packages[e]){i.__packages[e]=!0;s=t,r=e.split(".");if(r.length>1)for(o=0,a=r.length-1;o<a;o++){h=s[r[o]];s=h?h:s[r[o]]={}}s[r[r.length-1]]||(s[r[r.length-1]]=n||{})}},__hasOwnProperty:function(t,e){function i(t,e){if(Object.hasOwnProperty.call(e.prototype,t))return!0;var n=e.prototype.__super;return null==n?null:i(t,n)}e=e||this;return Object.hasOwnProperty.call(e,t)||i(t,e.__class)},__typeof:function(t,e){if(!t||!e)return!1;if(e==String)return"string"==typeof t;if(e==Number)return"number"==typeof t;if(e.__interface__)e=e.__interface__;else if("string"!=typeof e)return t instanceof e;return t.__imps&&t.__imps[e]||t.__class==e},__as:function(t,e){return this.__typeof(t,e)?t:null},"interface":function(e,n){var s,r,o,a,h;i.__package(e,{});s=i.__internals;r=s[e]=s[e]||{};r.self=e;n&&(r.extend=s[n]=s[n]||{});o=t,a=e.split(".");for(h=0;h<a.length-1;h++)o=o[a[h]];o[a[a.length-1]]={__interface__:e}},"class":function(e,n,s,r){var o,a,h;s&&i.__extend(e,s);if(n){i.__package(n,e);i.__classmap[n]=e;if(n.indexOf(".")>0){if(0==n.indexOf("laya.")){o=n.split(".");r=r||o[o.length-1];i[r]&&console.log("warning:class name redefinition,"+n+"/"+i[r]);i[r]=e}}else if("Main"==n)t.Main=e;else{i[n]&&console.log("warning:class name redefinition,"+n+"/"+i[n]);i[n]=e}}a=i.un,h=e.prototype;a(h,"hasOwnProperty",i.__hasOwnProperty);a(h,"__class",e);a(h,"__super",s);a(h,"__className",n);a(e,"__super",s);a(e,"__className",n);a(e,"__isclass",!0);a(e,"super",function(t){this.__super.call(t)})},imps:function(t,e){var n,s,r;if(!e)return null;n=t.__imps||i.un(t,"__imps",{});for(s in e){n[s]=e[s];r=s;for(;(r=this.__internals[r])&&(r=r.extend);){r=r.self;n[r]=!0}}},getset:function(t,e,n,s,r){if(t){s&&(e["_$GET_"+n]=s);r&&(e["_$SET_"+n]=r)}else{s&&i.un(e,"_$get_"+n,s);r&&i.un(e,"_$set_"+n,r)}if(s&&r)Object.defineProperty(e,n,{get:s,set:r,enumerable:!1});else{s&&Object.defineProperty(e,n,{get:s,enumerable:!1});r&&Object.defineProperty(e,n,{set:r,enumerable:!1})}},"static":function(t,e){function i(){var i=e[n],s=e[n+1];Object.defineProperty(t,i,{get:function(){delete this[i];return this[i]=s.call(this)},set:function(t){delete this[i];this[i]=t},enumerable:!0,configurable:!0})}for(var n=0,s=e.length;n<s;n+=2)"length"==e[n]?t.length=e[n+1].call(t):i()},un:function(t,e,n){arguments.length<3&&(n=t[e]);i.__propun.value=n;Object.defineProperty(t,e,i.__propun);return n},uns:function(t,e){e.forEach(function(e){i.un(t,e)})}};t.console=t.console||{log:function(){}};t.trace=t.console.log;Error.prototype.throwError=function(){throw arguments};String.prototype.substr=i.__substr;Object.defineProperty(Array.prototype,"fixed",{enumerable:!1});return i}(window,document);!function(t,e,i){i.un,i.uns,i["static"],i["class"],i.getset,i.__newvec}(window,document,Laya);!function(window,document,Laya){var sleep,wait,load,await,___Laya,Config,Asyn,Deferred,EventDispatcher,Handler,BitmapFont,Style,Font,Graphics,Event,Keyboard,KeyBoardManager,MouseManager,Filter,ColorFilterAction,Arith,Bezier,GrahamScan,MathUtil,Matrix,Point,Rectangle,SoundManager,LocalStorage,URL,Render,RenderContext,RenderSprite,Context,ResourceManager,System,Browser,Byte,ClassUtils,Color,Dictionary,Dragging,Ease,HTMLChar,LaterEvent,Log,Pool,Stat,StringKey,Timer,Tween,Utils,Node,CSSStyle,AudioSound,SoundChannel,Sound,ColorFilter,WebAudioSound,HttpRequest,Loader,LoaderManager,Socket,Resource,Texture,TimeLine,Sprite,AudioSoundChannel,WebAudioSoundChannel,Bitmap,Animation,Text,Stage,FileBitmap,HTMLCanvas,HTMLSubImage,Input,HTMLImage,__un=Laya.un,__uns=Laya.uns,__static=Laya["static"],__class=Laya["class"],__getset=Laya.getset,__newvec=Laya.__newvec;Laya["interface"]("laya.resource.IDispose");Laya["interface"]("laya.filters.IFilterAction");Laya["interface"]("laya.filters.IFilter");Laya["interface"]("laya.display.ILayout");sleep=Laya.sleep=function(t){Asyn.sleep(t)};wait=Laya.wait=function(t){return Asyn.wait(t)};load=Laya.load=function(t,e){return Asyn.load(t,e)};await=Laya.await=function(t,e,i){Asyn._caller_=t;Asyn._callback_=e;Asyn._nextLine_=i};___Laya=function(){__getset(1,Laya,"alertGlobalError",null,function(t){var e=0;t?Browser.window.onerror=function(t,i,n,s,r){e++<5&&r&&alert("出错啦，请把此信息截图给研发商\n"+t+"\n"+r.stack)}:Browser.window.onerror=null});Laya.init=function(t,e,i){var n,s,r,o,a=[];for(n=2,s=arguments.length;n<s;n++)a.push(arguments[n]);for(n=0,r=a.length;n<r;n++)a[n].enable&&a[n].enable();Font.__init__();Style.__init__();ResourceManager.__init__();Laya.stage=new Stage;o=Browser.window.location;URL.rootPath=URL.basePath=URL.getPath("file:"==o.protocal?o.pathname:o.href);Laya.initAsyn();Laya.render=new Render(t,e);Laya.stage.size(t,e);RenderSprite.__init__();KeyBoardManager.__init__();MouseManager.instance.__init__()};Laya.initAsyn=function(){Asyn.loadDo=function(t,e,i){var n=new Loader;if(i){n.once("complete",null,function(t){i.callback(t)});n.once("error",null,function(t){})}n.load(t,e);return i};Asyn.onceTimer=function(t,e){Laya.timer.once(t,e,e.callback)};Asyn.onceEvent=function(t,e){Laya.stage.once(t,null,e)};Laya.timer.frameLoop(1,null,Asyn._loop_)};Laya.stage=null;Laya.render=null;Laya.version="0.9.8";Laya.is3DMode=!1;__static(Laya,["timer",function(){return this.timer=new Timer},"loader",function(){return this.loader=new LoaderManager}]);return Laya}();Config=function(){function t(){}__class(t,"Config");t.showLog=!1;t.atlasEnable=!1;t.showCanvasMark=!1;t.CPUMemoryLimit=125829120;t.GPUMemoryLimit=167772160;t.animationInterval=30;return t}();Asyn=function(){function t(){}__class(t,"laya.asyn.Asyn");t.wait=function(e){var i=new Deferred;if(0==e.indexOf("event:")){t.onceEvent(e.substr(8),function(){i.callback()});return null}i.loopIndex=t._loopCount;return t._Deferreds[e]=i};t.callLater=function(e){t._callLater.push(e)};t.notify=function(e,i){var n=t._Deferreds[e];if(n){t._Deferreds[e]=null;n.callback(i)}};t.load=function(e,i){return t.loadDo(e,i,new Deferred)};t.sleep=function(e){if(e<1)if(t._loopsCount>=t.loops[t._loopsIndex].length){t._loopsCount++;t.loops[t._loopsIndex].push(new Deferred)}else{var i=t.loops[t._loopsIndex][t._loopsCount];i._reset();t._loopsCount++}else t.onceTimer(e,new Deferred)};t._loop_=function(){var e,i,n,s,r;Deferred._TIMECOUNT_++;t._loopCount++;e=0;if((e=t._loopsCount)>0){i=t.loops[t._loopsIndex];t._loopsCount=0;t._loopsIndex=(t._loopsIndex+1)%2;for(n=0;n<e;n++)i[n].callback()}if((e=t._callLater.length)>0){s=t._callLater;t._callLater=[];for(n=0,e=s.length;n<e;n++){r=s[n];r.callback()}}};t._Deferreds={};t.loops=[[],[]];t._loopsIndex=0;t._loopCount=0;t._loopsCount=0;t._callLater=[];t._waitFunctionId=0;t.loadDo=null;t.onceEvent=null;t.onceTimer=null;t._caller_=null;t._callback_=null;t._nextLine_=0;return t}();Deferred=function(){function t(){this._caller=null;this._callback=null;this._nextLine=0;this._value=null;this._createTime=0;this._reset()}__class(t,"laya.asyn.Deferred");var e=t.prototype;e.setValue=function(t){this._value=t};e.getValue=function(){return this._value};e._reset=function(){this._caller=Asyn._caller_;this._callback=Asyn._callback_;this._nextLine=Asyn._nextLine_;this._createTime=t._TIMECOUNT_};e.callback=function(e){arguments.length>0&&(this._value=e);this._createTime==t._TIMECOUNT_?Asyn.callLater(this):this._callback&&this._callback.call(this._caller,this._nextLine)};e.errback=function(t){arguments.length>0&&(this._value=t);this._callback&&this._callback.call(this._caller,this._nextLine)};t._TIMECOUNT_=0;return t}();EventDispatcher=function(){function t(){this._events=null}var e,i;__class(t,"laya.events.EventDispatcher");i=t.prototype;i.hasListener=function(t){var e=this._events&&this._events[t];return!!e};i.event=function(t,e){var i,n,s,r;if(!this._events||!this._events[t])return!1;i=this._events[t];if(i.run){i.once&&delete this._events[t];null!=e?i.runWith(e):i.run()}else{for(n=0,s=i.length;n<s;n++){r=i[n];r&&(null!=e?r.runWith(e):r.run());if(!r||r.once){i.splice(n,1);n--;s--}}0===i.length&&delete this._events[t]}return!0};i.on=function(t,e,i,n){return this._createListener(t,e,i,n,!1)};i.once=function(t,e,i,n){return this._createListener(t,e,i,n,!0)};i._createListener=function(t,i,n,s,r){var o,a;this.off(t,i,n,r);o=e.create(i||this,n,s,r);this._events||(this._events={});a=this._events;a[t]?a[t].run?a[t]=[a[t],o]:a[t].push(o):a[t]=o;return this};i.off=function(t,e,i,n){var s,r,o,a,h;void 0===n&&(n=!1);if(!this._events||!this._events[t])return this;s=this._events[t];if(null!=i)if(s.run){if((!e||s.caller===e)&&s.method===i&&(!n||s.once)){delete this._events[t];s.recover()}}else{r=0;for(o=0,a=s.length;o<a;o++){h=s[o];if(h&&(!e||h.caller===e)&&h.method===i&&(!n||h.once)){r++;s[o]=null;h.recover()}}r===a&&delete this._events[t]}return this};i.offAll=function(t){var e,i=this._events;if(!i)return this;if(t){this._recoverHandlers(i[t]);delete i[t]}else{for(e in i)this._recoverHandlers(i[e]);this._events=null}return this};i._recoverHandlers=function(t){if(t.run)t.recover();else for(var e=t.length-1;e>-1;e--)if(t[e]){t[e].recover();t[e]=null}};i.isMouseEvent=function(e){return t.MOUSE_EVENTS[e]};t.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0};t.__init$=function(){e=function(t){function e(t,i,n,s){e.__super.call(this,t,i,n,s)}__class(e,"",t);var i=e.prototype;i.recover=function(){if(this._id>0){this._id=0;e._pool.push(this.clear())}};e.create=function(t,i,n,s){void 0===s&&(s=!0);return e._pool.length?e._pool.pop().setTo(t,i,n,s):new e(t,i,n,s)};e._pool=[];return e}(Handler)};return t}();Handler=function(){function t(t,e,i,n){this.once=!1;this._id=0;void 0===n&&(n=!1);this.setTo(t,e,i,n)}__class(t,"laya.utils.Handler");var e=t.prototype;e.setTo=function(e,i,n,s){this._id=t._gid++;this.caller=e;this.method=i;this.args=n;this.once=s;return this};e.run=function(){if(null!=this.method){var t=this._id;this.method.apply(this.caller,this.args);this._id===t&&this.once&&this.recover()}};e.runWith=function(t){if(null!=this.method){var e=this._id;null==t?this.method.apply(this.caller,this.args):this.args||t.unshift?this.args?this.method.apply(this.caller,this.args?this.args.concat(t):t):this.method.apply(this.caller,t):this.method.call(this.caller,t);this._id===e&&this.once&&this.recover()}};e.clear=function(){this.caller=null;this.method=null;this.args=null;return this};e.recover=function(){if(this._id>0){this._id=0;t._pool.push(this.clear())}};t.create=function(e,i,n,s){void 0===s&&(s=!0);return t._pool.length?t._pool.pop().setTo(e,i,n,s):new t(e,i,n,s)};t._pool=[];t._gid=1;return t}();BitmapFont=function(){function t(){this.fontSize=12;this.autoScaleSize=!1;this._texture=null;this._fontCharDic={};this._complete=null;this._path=null;this._maxHeight=0;this._maxWidth=0;this._spaceWidth=10;this._leftPadding=0;this._rightPadding=0}__class(t,"laya.display.BitmapFont");var e=t.prototype;e.loadFont=function(t,e){this._path=t;this._complete=e;Laya.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],Handler.create(this,this.onLoaded))};e.onLoaded=function(){this.parseFont(Loader.getRes(this._path),Loader.getRes(this._path.replace(".fnt",".png")));this._complete&&this._complete.run()};e.parseFont=function(t,e){var i,n,s,r,o,a,h,l,u,c,_,f,d,p,g,m;if(null!=t&&null!=e){this._texture=e;i=0;n=1;s=t.getElementsByTagName("info");this.fontSize=Laya.__parseInt(s[0].attributes["size"].nodeValue);r=s[0].attributes["padding"].nodeValue;o=r.split(",");a=Laya.__parseInt(o[0]);h=Laya.__parseInt(o[2]);this._leftPadding=Laya.__parseInt(o[3]);this._rightPadding=Laya.__parseInt(o[1]);l=t.getElementsByTagName("char");u=0;for(u=0;u<l.length;u++){c=l[u].attributes;_=Laya.__parseInt(c["id"].nodeValue);f=Laya.__parseInt(c["xoffset"].nodeValue)/n;d=Laya.__parseInt(c["yoffset"].nodeValue)/n;p=Laya.__parseInt(c["xadvance"].nodeValue)/n;g=new Rectangle;g.x=Laya.__parseInt(c["x"].nodeValue);g.y=Laya.__parseInt(c["y"].nodeValue);g.width=Laya.__parseInt(c["width"].nodeValue);g.height=Laya.__parseInt(c["height"].nodeValue);m=Texture.create(e,g.x,g.y,g.width,g.height,f,d);this._maxHeight=Math.max(this._maxHeight,a+h+m.height);this._maxWidth=Math.max(this._maxWidth,m.width);this._fontCharDic[_]=m}this.getCharTexture(" ")&&this.setSpaceWidth(this.getCharWidth(" "))}};e.getCharTexture=function(t){return this._fontCharDic[t.charCodeAt(0)]};e.destory=function(){var t,e=null;for(t in this._fontCharDic){e=this._fontCharDic[t];e&&e.destroy();delete this._fontCharDic[t]}this._texture.destroy()};e.setSpaceWidth=function(t){this._spaceWidth=t};e.getCharWidth=function(t){if(" "==t)return this._spaceWidth;var e=this.getCharTexture(t);return e?e.width+2*e.offsetX:0};e.getTextWidth=function(t){var e,i,n=0;for(e=0,i=t.length;e<i;e++)n+=this.getCharWidth(t[e]);return n};e.getMaxWidth=function(){return this._maxWidth};e.getMaxHeight=function(){return this._maxHeight};e.drawText=function(t,e,i,n,s,r){var o,a,h,l,u,c=0;for(a=0,h=t.length;a<h;a++)c+=this.getCharWidth(t[a]);l=this._leftPadding;"center"===s&&(l=(r-c)/2);"right"===s&&(l=r-c-this._rightPadding);u=0;for(a=0,h=t.length;a<h;a++){o=this.getCharTexture(t[a]);o&&e.graphics.drawTexture(o,i+u+l,n,o.width,o.height);u+=this.getCharWidth(t[a])}};return t}();Style=function(){function t(){this.alpha=1;this.visible=!0;this.scrollRect=null;this.blendMode=null;this._type=0;this._tf=t._TF_EMPTY}__class(t,"laya.display.css.Style");var e=t.prototype;e.destroy=function(){this.scrollRect=null};e.render=function(t,e,i,n){};e.getCSSStyle=function(){return CSSStyle.EMPTY};e._enableLayout=function(){return!1};__getset(0,e,"block",function(){return 0!=(1&this._type)});__getset(0,e,"paddingTop",function(){return 0});__getset(0,e,"scaleX",function(){return this._tf.scaleX},function(e){this._tf===t._TF_EMPTY&&(this._tf=t._createTransform());this._tf.scaleX=e});__getset(0,e,"scaleY",function(){return this._tf.scaleY},function(e){this._tf===t._TF_EMPTY&&(this._tf=t._createTransform());this._tf.scaleY=e});__getset(0,e,"transform",function(){return this._tf},function(e){this._tf="none"!==e&&e?e:t._TF_EMPTY});__getset(0,e,"translateX",function(){return this._tf.translateX},function(e){this._tf===t._TF_EMPTY&&(this._tf=t._createTransform());this._tf.translateX=e});__getset(0,e,"translateY",function(){return this._tf.translateY},function(e){this._tf===t._TF_EMPTY&&(this._tf=t._createTransform());this._tf.translateY=e});__getset(0,e,"rotate",function(){return this._tf.rotate},function(e){this._tf===t._TF_EMPTY&&(this._tf=t._createTransform());this._tf.rotate=e});__getset(0,e,"skewX",function(){return this._tf.skewX},function(e){this._tf===t._TF_EMPTY&&(this._tf=t._createTransform());this._tf.skewX=e});__getset(0,e,"skewY",function(){return this._tf.skewY},function(e){this._tf===t._TF_EMPTY&&(this._tf=t._createTransform());this._tf.skewY=e});__getset(0,e,"absolute",function(){return!0});__getset(0,e,"paddingLeft",function(){return 0});t.__init__=function(){t._TF_EMPTY=t._createTransform();t.EMPTY=new t};t._createTransform=function(){return{translateX:0,translateY:0,scaleX:1,scaleY:1,rotate:0,skewX:0,skewY:0}};t.EMPTY=null;t._TF_EMPTY=null;return t}();Font=function(){function t(e){this._type=0;this._weight=0;this._decoration=null;this._text=null;this.indent=0;this._color=Color.create(t.defaultColor);this.family=t.defaultFamily;this.stroke=t._STROKE;this.size=t.defaultSize;e&&e!==t.EMPTY&&e.copyTo(this)}__class(t,"laya.display.css.Font");var e=t.prototype;e.set=function(t){var e,i,n,s;this._text=null;e=t.split(" ");for(i=0,n=e.length;i<n;i++){s=e[i];switch(s){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}if(s.indexOf("px")>0){this.size=Laya.__parseInt(s);this.family=e[i+1];i++}else;}};e.toString=function(){this._text="";this.italic&&(this._text+="italic ");this.bold&&(this._text+="bold ");return this._text+=this.size+"px "+this.family};e.copyTo=function(e){e._type=this._type;e._text=this._text;e._weight=this._weight;e._color=this._color;e.family=this.family;e.stroke=this.stroke!=t._STROKE?this.stroke.slice():t._STROKE;e.indent=this.indent;e.size=this.size};__getset(0,e,"color",function(){return this._color.strColor},function(t){this._color=Color.create(t)});__getset(0,e,"decoration",function(){return this._decoration?this._decoration.value:"none"},function(t){var e=t.split(" ");this._decoration||(this._decoration={});switch(e[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=e[0]}e[1]&&(this._decoration.color=Color.create(e));this._decoration.value=t});__getset(0,e,"italic",function(){return 0!==(512&this._type)},function(t){t?this._type|=512:this._type&=-513});__getset(0,e,"bold",function(){return 0!==(2048&this._type)},function(t){t?this._type|=2048:this._type&=-2049});__getset(0,e,"password",function(){return 0!==(1024&this._type)},function(t){t?this._type|=1024:this._type&=-1025});__getset(0,e,"weight",function(){return""+this._weight},function(t){var e=0;switch(t){case"normal":break;case"bold":this.bold=!0;e=700;break;case"bolder":e=800;break;case"lighter":e=100;break;default:e=Laya.__parseInt(t)}this._weight=e;this._text=null});t.__init__=function(){t.EMPTY=new t(null)};t.EMPTY=null;t.defaultColor="#000000";t.defaultSize=12;t.defaultFamily="Arial";t.defaultFont="12px Arial";t._STROKE=[0,"#000000"];t._ITALIC=512;t._PASSWORD=1024;t._BOLD=2048;return t}();Graphics=function(){function t(){this._one=null;this._cmds=null;this._render=this._renderEmpty;this._render=this._renderEmpty}__class(t,"laya.display.Graphics");var e=t.prototype;e.destroy=function(){this.clear();this._temp=null;this._bounds=null;this._rstBoundPoints=null;this._sp&&(this._sp._renderType=0);this._sp=null};e.clear=function(){this._one=null;this._render=this._renderEmpty;this._cmds=null;this._temp&&(this._temp.length=0);this._sp&&(this._sp._renderType&=-2);this._sp&&(this._sp._renderType&=-257);this._repaint()};e.empty=function(){return null===this._one&&(!this._cmds||0===this._cmds.length)};e._repaint=function(){this._temp&&(this._temp.length=0);this._sp&&this._sp.repaint()};e._isOnlyOne=function(){return!this._cmds||0===this._cmds.length};e.getBounds=function(){(!this._bounds||!this._temp||this._temp.length<1)&&(this._bounds=Rectangle._getWrapRec(this.getBoundPoints(),this._bounds));return this._bounds};e.getBoundPoints=function(){(!this._temp||this._temp.length<1)&&(this._temp=this._getCmdPoints());return this._rstBoundPoints=Utils.setValueArr(this._rstBoundPoints,this._temp)};e._getCmdPoints=function(){var e,i,n,s,r,o,a,h=Render.context,l=this._cmds,u=this._temp||(this._temp=[]);u.length=0;l||null==this._one||(l=[this._one]);if(!l)return[];e=[];i=new Matrix;n=t._tempMatrix;for(r=0,o=l.length;r<o;r++){s=l[r];switch(s.callee){case h.save:e.push(i);i=i.clone();break;case h.restore:i=e.pop();break;case h._scale:n.identity();n.translate(-s[2],-s[3]);n.scale(s[0],s[1]);n.translate(s[2],s[3]);this._switchMatrix(i,n);break;case h._rotate:n.identity();n.translate(-s[1],-s[2]);n.rotate(s[0]);n.translate(s[1],s[2]);this._switchMatrix(i,n);break;case h._translate:n.identity();n.translate(s[0],s[1]);this._switchMatrix(i,n);break;case h._transform:n.identity();n.translate(-s[1],-s[2]);n.concat(s[0]);n.translate(s[1],s[2]);this._switchMatrix(i,n);break;case h._drawTexture:if(s[3]&&s[4])t._addPointArrToRst(u,Rectangle._getBoundPointS(s[1],s[2],s[3],s[4]),i);else{a=s[0];t._addPointArrToRst(u,Rectangle._getBoundPointS(s[1],s[2],a.width,a.height),i)}break;case h._drawRect:case h._fillRect:t._addPointArrToRst(u,Rectangle._getBoundPointS(s[0],s[1],s[2],s[3]),i);break;case h._drawCircle:case h._fillCircle:t._addPointArrToRst(u,Rectangle._getBoundPointS(s[0]-s[2],s[1]-s[2],s[2]+s[2],s[2]+s[2]),i);break;case h._drawLine:t._addPointArrToRst(u,[s[0],s[1],s[2],s[3]],i);break;case h.drawCurves:t._addPointArrToRst(u,Bezier.I.getBezierPoints(s[2]),i,s[0],s[1]);break;case h._drawPoly:t._addPointArrToRst(u,s[2],i,s[0],s[1]);break;case h._drawPath:t._addPointArrToRst(u,this._getPathPoints(s[2]),i,s[0],s[1]);break;case h._drawPie:case h._drawPieWebGL:t._addPointArrToRst(u,this._getPiePoints(s[0],s[1],s[2],s[3],s[4]),i)}}u.length>200?u=Utils.setValueArr(u,Rectangle._getWrapRec(u)._getBoundPoints()):u.length>8&&(u=GrahamScan.scanPList(u));return u};e._switchMatrix=function(t,e){e.concat(t);e.copy(t)};e.drawTexture=function(t,e,i,n,s,r){void 0===n&&(n=0);void 0===s&&(s=0);this._sp&&(this._sp._renderType|=256);n||(n=t.width);s||(s=t.height);var o=[t,e,i,n,s,r];if(null==this._one){this._one=o;this._render=this._renderOneImg}else{this._render=this._renderAll;0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one);this._cmds.push(o)}o.callee=r?Render.context._drawTextureWithTransform:Render.context._drawTexture;this._repaint()};e._textureLoaded=function(t,e){t.off("loaded",this,this._textureLoaded);e[3]=t.width;e[4]=t.height;this._repaint()};e.drawRenderTarget=function(t,e,i,n,s){var r=new Matrix(1,0,0,-1,0,s);this.drawTexture(t,e,i,n,s,r)};e._saveToCmd=function(t,e){this._sp&&(this._sp._renderType|=256);if(null==this._one){this._one=e;this._render=this._renderOne}else{this._sp&&(this._sp._renderType&=-2);this._render=this._renderAll;0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one);this._cmds.push(e)}e.callee=t;this._temp&&(this._temp.length=0);this._repaint();return e};e.clipRect=function(t,e,i,n){this._saveToCmd(Render.context._clipRect,arguments)};e.fillText=function(t,e,i,n,s,r){this._saveToCmd(Render.context._fillText,[t,e,i,n||Font.defaultFont,s,r])};e.fillBorderText=function(t,e,i,n,s,r,o,a){this._saveToCmd(Render.context._fillBorderText,[t,e,i,n||Font.defaultFont,s,r,o,a])};e.strokeText=function(t,e,i,n,s,r,o){this._saveToCmd(Render.context._strokeText,[t,e,i,n||Font.defaultFont,s,r,o])};e.alpha=function(t){this._saveToCmd(Render.context._alpha,arguments)};e.blendMode=function(t){this._saveToCmd(Render.context._blendMode,arguments)};e.transform=function(t,e,i){void 0===e&&(e=0);void 0===i&&(i=0);this._saveToCmd(Render.context._transform,[t,e,i])};e.rotate=function(t,e,i){void 0===e&&(e=0);void 0===i&&(i=0);this._saveToCmd(Render.context._rotate,[t,e,i])};e.scale=function(t,e,i,n){void 0===i&&(i=0);void 0===n&&(n=0);this._saveToCmd(Render.context._scale,[t,e,i,n])};e.translate=function(t,e){this._saveToCmd(Render.context._translate,[t,e])};e.save=function(){this._saveToCmd(Render.context.save,arguments)};e.restore=function(){this._saveToCmd(Render.context.restore,arguments)};e.replaceText=function(t){var e,i;this._repaint();e=this._cmds;if(!e)return this._one&&this._one.callee===Render.context._fillText&&(this._one[0]=t,!0);for(i=e.length-1;i>-1;i--)if(e[i].callee===Render.context._fillText){e[i][0]=t;return!0}return!1};e.replaceTextColor=function(t){var e,i;this._repaint();e=this._cmds;if(!e)return this._one&&(this._one.callee===Render.context._fillBorderText||this._one.callee===Render.context._fillText)&&(this._one[4]=t,!0);for(i=e.length-1;i>-1;i--)if(e[i].callee===Render.context._fillText){e[i][4]=t;return!0}return!1};e.loadImage=function(t,e,i,n,s,r){function o(t){if(t){h.drawTexture(t,e,i,n,s);null!=r&&r.call(h._sp,t)}}var a,h=this;void 0===e&&(e=0);void 0===i&&(i=0);void 0===n&&(n=0);void 0===s&&(s=0);a=Loader.getRes(t);a?o(a):Laya.loader.load(t,Handler.create(null,o),null,"image")};e._renderEmpty=function(t,e,i,n){};e._renderAll=function(t,e,i,n){var s,r,o,a=this._cmds;for(r=0,o=a.length;r<o;r++)(s=a[r]).callee.call(e,i,n,s)};e._renderOne=function(t,e,i,n){this._one.callee.call(e,i,n,this._one)};e._renderOneImg=function(t,e,i,n){this._one.callee.call(e,i,n,this._one);2305!==t._renderType&&(t._renderType|=1)};e.drawLine=function(t,e,i,n,s,r){void 0===r&&(r=1);var o=[t+.5,e+.5,i+.5,n+.5,s,r];this._saveToCmd(Render.context._drawLine,o)};e.drawLines=function(t,e,i,n,s){void 0===s&&(s=1);var r=[t+.5,e+.5,i,n,s];Render.isWebGl&&(r[3]=Color.create(n).numColor);this._saveToCmd(Render.isWebGl?Render.context.drawLinesWebGL:Render.context.drawLines,r)};e.drawCurves=function(t,e,i,n,s){void 0===s&&(s=1);var r=[t+.5,e+.5,i,n,s];Render.isWebGl&&(r[3]=Color.create(n).numColor);this._saveToCmd(Render.isWebGl?Render.context.drawCurvesGL:Render.context.drawCurves,r)};e.drawRect=function(t,e,i,n,s,r,o){var a,h;void 0===o&&(o=1);a=r?.5:0;h=[t+a,e+a,i,n,s,r,o];this._saveToCmd(Render.context._drawRect,h)};e.drawCircle=function(t,e,i,n,s,r){var o,a;void 0===r&&(r=1);o=s?.5:0;a=[t+o,e+o,i,n,s,r];if(Render.isWebGl){a[3]=n?Color.create(n).numColor:n;a[4]=s?Color.create(s).numColor:s}this._saveToCmd(Render.isWebGl?Render.context._drawCircleWebGL:Render.context._drawCircle,a)};e.drawPie=function(t,e,i,n,s,r,o,a){var h,l;void 0===a&&(a=1);h=o?.5:0;l=[t+h,e+h,i,n,s,r,o,a];if(Render.isWebGl){n=90-n;s=90-s;l[5]=r?Color.create(r).numColor:r;l[6]=o?Color.create(o).numColor:o}l[3]=Utils.toRadian(n);l[4]=Utils.toRadian(s);this._saveToCmd(Render.isWebGl?Render.context._drawPieWebGL:Render.context._drawPie,l)};e._getPiePoints=function(t,e,i,n,s){var r=[t,e],o=Math.PI/10,a=NaN;for(a=n;a<s;a+=o)r.push(t+i*Math.cos(a),e+i*Math.sin(a));s!=a&&r.push(t+i*Math.cos(s),e+i*Math.sin(s));return r};e.drawPoly=function(t,e,i,n,s,r){var o,a;void 0===r&&(r=1);o=s?.5:0;a=[t+o,e+o,i,n,s,r];if(Render.isWebGl){null!=n&&(a[3]=Color.create(n).numColor);null!=s&&(a[4]=Color.create(s).numColor)}this._saveToCmd(Render.isWebGl?Render.context._drawPolyGL:Render.context._drawPoly,a)};e._getPathPoints=function(t){var e,i=0,n=0,s=[];n=t.length;for(i=0;i<n;i++){e=t[i];if(e.length>1){s.push(e[1],e[2]);e.length>3&&s.push(e[3],e[4])}}return s};e.drawPath=function(t,e,i,n,s){var r=[t+.5,e+.5,i,n,s];this._saveToCmd(Render.context._drawPath,r)};__getset(0,e,"cmds",function(){return this._cmds},function(t){this._sp&&(this._sp._renderType|=256);this._cmds=t;this._render=this._renderAll;this._repaint()});t._addPointArrToRst=function(e,i,n,s,r){void 0===s&&(s=0);void 0===r&&(r=0);var o=0,a=0;a=i.length;for(o=0;o<a;o+=2)t._addPointToRst(e,i[o]+s,i[o+1]+r,n)};t._addPointToRst=function(t,e,i,n){var s=Point.TEMP;e=e?e:0;i=i?i:0;s.setTo(e,i);n.transformPoint(e,i,s);t.push(s.x,s.y)};__static(t,["_tempMatrix",function(){return this._tempMatrix=new Matrix}]);return t}();Event=function(){function t(){}__class(t,"laya.events.Event");var e=t.prototype;e.setTo=function(t,e,i){this.type=t;this.currentTarget=e;this.target=i;return this};e.stopPropagation=function(){this._stoped=!0};__getset(0,e,"shiftKey",function(){return this.nativeEvent.shiftKey});__getset(0,e,"touches",function(){var t,e,i,n,s=this.nativeEvent.touches;if(s)for(t=0,e=s.length;t<e;t++){i=s[t];n=Point.TEMP;n.setTo(i.clientX,i.clientY);Laya.stage._canvasTransform.invertTransformPoint(n);i.stageX=n.x;i.stageY=n.y}return s});__getset(0,e,"altKey",function(){return this.nativeEvent.altKey});__getset(0,e,"ctrlKey",function(){return this.nativeEvent.ctrlKey});t.EMPTY=new t;t.MOUSE_DOWN="mousedown";t.MOUSE_UP="mouseup";t.CLICK="click";t.RIGHT_MOUSE_DOWN="rightmousedown";t.RIGHT_MOUSE_UP="rightmouseup";t.RIGHT_CLICK="rightclick";t.MOUSE_MOVE="mousemove";t.MOUSE_OVER="mouseover";t.MOUSE_OUT="mouseout";t.MOUSE_WHEEL="mousewheel";t.ROLL_OVER="mouseover";t.ROLL_OUT="mouseout";t.DOUBLE_CLICK="doubleclick";t.CHANGE="change";t.CHANGED="changed";t.RESIZE="resize";t.ADDED="added";t.REMOVED="removed";t.DISPLAY="display";t.UNDISPLAY="undisplay";t.ERROR="error";t.COMPLETE="complete";t.LOADED="loaded";t.PROGRESS="progress";t.INPUT="input";t.RENDER="render";t.OPEN="open";t.MESSAGE="message";t.CLOSE="close";t.KEY_DOWN="keydown";t.KEY_PRESS="keypress";t.KEY_UP="keyup";t.ENTER_FRAME="enterframe";t.DRAG_START="dragstart";t.DRAG_MOVE="dragmove";t.DRAG_END="dragend";t.ENTER="enter";t.SELECT="select";t.BLUR="blur";t.FOCUS="focus";t.PLAYED="played";t.PAUSED="paused";t.STOPPED="stopped";t.START="start";t.END="end";t.ENABLED_CHANGED="enabledchanged";t.COMPONENT_ADDED="componentadded";t.COMPONENT_REMOVED="componentremoved";t.ACTIVE_CHANGED="activechanged";t.LAYER_CHANGED="layerchanged";t.HIERARCHY_LOADED="hierarchyloaded";t.MEMORY_CHANGED="memorychanged";t.RECOVERING="recovering";t.RECOVERED="recovered";t.RELEASED="released";t.LINK="link";t.LABEL="label";return t}();Keyboard=function(){function t(){}__class(t,"laya.events.Keyboard");t.NUMBER_0=48;t.NUMBER_1=49;t.NUMBER_2=50;t.NUMBER_3=51;t.NUMBER_4=52;t.NUMBER_5=53;t.NUMBER_6=54;t.NUMBER_7=55;t.NUMBER_8=56;t.NUMBER_9=57;t.A=65;t.B=66;t.C=67;t.D=68;t.E=69;t.F=70;t.G=71;t.H=72;t.I=73;t.J=74;t.K=75;t.L=76;t.M=77;t.N=78;t.O=79;t.P=80;t.Q=81;t.R=82;t.S=83;t.T=84;t.U=85;t.V=86;t.W=87;t.X=88;t.Y=89;t.Z=90;t.F1=112;t.F2=113;t.F3=114;t.F4=115;t.F5=116;t.F6=117;t.F7=118;t.F8=119;t.F9=120;t.F10=121;t.F11=122;t.F12=123;t.F13=124;t.F14=125;t.F15=126;t.NUMPAD=21;t.NUMPAD_0=96;t.NUMPAD_1=97;t.NUMPAD_2=98;t.NUMPAD_3=99;t.NUMPAD_4=100;t.NUMPAD_5=101;t.NUMPAD_6=102;t.NUMPAD_7=103;t.NUMPAD_8=104;t.NUMPAD_9=105;t.NUMPAD_ADD=107;t.NUMPAD_DECIMAL=110;t.NUMPAD_DIVIDE=111;t.NUMPAD_ENTER=108;t.NUMPAD_MULTIPLY=106;t.NUMPAD_SUBTRACT=109;t.SEMICOLON=186;t.EQUAL=187;t.COMMA=188;t.MINUS=189;t.PERIOD=190;t.SLASH=191;t.BACKQUOTE=192;t.LEFTBRACKET=219;t.BACKSLASH=220;t.RIGHTBRACKET=221;t.QUOTE=222;t.ALTERNATE=18;t.BACKSPACE=8;t.CAPS_LOCK=20;t.COMMAND=15;t.CONTROL=17;t.DELETE=46;t.ENTER=13;t.ESCAPE=27;t.PAGE_UP=33;t.PAGE_DOWN=34;t.END=35;t.HOME=36;t.LEFT=37;t.UP=38;t.RIGHT=39;t.DOWN=40;t.SHIFT=16;t.SPACE=32;t.TAB=9;t.INSERT=45;return t}();KeyBoardManager=function(){function t(){}__class(t,"laya.events.KeyBoardManager");t.__init__=function(){t._addEvent("keydown");t._addEvent("keypress");t._addEvent("keyup")};t._addEvent=function(t){Browser.document.addEventListener(t,function(e){laya.events.KeyBoardManager._dispatch(e,t)},!0)};t._dispatch=function(e,i){e.keyCode=e.keyCode||e.which||e.charCode;"keydown"===i?t._pressKeys[e.keyCode]=!0:"keyup"===i&&(t._pressKeys[e.keyCode]=null);for(var n=Laya.stage.focus&&null!=Laya.stage.focus.event?Laya.stage.focus:Laya.stage;n;){n.event(i,e);n=n.parent}};t.hasKeyDown=function(e){return t._pressKeys[e]};t._pressKeys={};return t}();MouseManager=function(){function t(){this.mouseX=0;this.mouseY=0;this.disableMouseEvent=!1;this.mouseDownTime=0;this._stage=null;this._target=null;this._lastOvers=[];this._currOvers=[];this._lastClickTimer=0;this._lastMoveTimer=0;this._isDoubleClick=!1;this._isLeftMouse=!1;this._eventList=[];this._event=new Event;this._matrix=new Matrix;this._point=new Point;this._rect=new Rectangle}__class(t,"laya.events.MouseManager");var e=t.prototype;e.__init__=function(){var e,i,n;this._stage=Laya.stage;e=this;i=Render.canvas.source;n=this._eventList;Browser.document.oncontextmenu=function(e){return t.enabled?!1:void 0};i.addEventListener("mousedown",function(i){if(t.enabled){i.preventDefault();n.push(i);e.mouseDownTime=Browser.now()}});i.addEventListener("mouseup",function(i){if(t.enabled){i.preventDefault();n.push(i);e.mouseDownTime=-Browser.now()}},!0);Browser.document.addEventListener("mousemove",function(i){
if(t.enabled){var s=Browser.now();if(s-e._lastMoveTimer<10)return;e._lastMoveTimer=s;n.push(i)}},!0);i.addEventListener("mouseout",function(e){t.enabled&&n.push(e)});i.addEventListener("mouseover",function(e){t.enabled&&n.push(e)});i.addEventListener("touchstart",function(i){if(t.enabled){i.preventDefault();n.push(i);e.mouseDownTime=Browser.now()}});i.addEventListener("touchend",function(i){if(t.enabled){i.preventDefault();n.push(i);e.mouseDownTime=-Browser.now()}},!0);i.addEventListener("touchmove",function(e){if(t.enabled){e.preventDefault();n.push(e)}},!0);i.addEventListener("mousewheel",function(e){t.enabled&&n.push(e)});i.addEventListener("DOMMouseScroll",function(e){t.enabled&&n.push(e)})};e.initEvent=function(t,e){var i=laya.events.MouseManager.instance;i._event._stoped=!1;i._event.nativeEvent=e||t;i._target=null;this._point.setTo(t.clientX,t.clientY);this._stage._canvasTransform.invertTransformPoint(this._point);t.stageX=i.mouseX=this._point.x;t.stageY=i.mouseY=this._point.y;i._event.touchId=t.identifier};e.checkMouseWheel=function(t){var e,i,n;this._event.delta=t.wheelDelta?.025*t.wheelDelta:-t.detail;for(e=0,i=this._lastOvers.length;e<i;e++){n=this._lastOvers[e];n.event("mousewheel",this._event.setTo("mousewheel",n,this._target))}};e.checkMouseOut=function(){var t,e,i,n;if(!this.disableMouseEvent){for(t=0,e=this._lastOvers.length;t<e;t++){i=this._lastOvers[t];if(this._currOvers.indexOf(i)<0){i.$_MOUSEOVER=!1;i.event("mouseout",this._event.setTo("mouseout",i,this._target))}}n=this._lastOvers;this._lastOvers=this._currOvers;this._currOvers=n;this._currOvers.length=0}};e.onMouseMove=function(t){this.sendMouseMove(t);this._event._stoped=!1;this.sendMouseOver(this._target)};e.sendMouseMove=function(t){t.event("mousemove",this._event.setTo("mousemove",t,this._target));!this._event._stoped&&t.parent&&this.sendMouseMove(t.parent)};e.sendMouseOver=function(t){if(t.parent){if(!t.$_MOUSEOVER){t.$_MOUSEOVER=!0;t.event("mouseover",this._event.setTo("mouseover",t,this._target))}this._currOvers.push(t)}!this._event._stoped&&t.parent&&this.sendMouseOver(t.parent)};e.onMouseDown=function(t){if(this._isLeftMouse){t.$_MOUSEDOWN=!0;t.event("mousedown",this._event.setTo("mousedown",t,this._target))}else{t.$_RIGHTMOUSEDOWN=!0;t.event("rightmousedown",this._event.setTo("rightmousedown",t,this._target))}!this._event._stoped&&t.parent&&this.onMouseDown(t.parent)};e.onMouseUp=function(t){var e=this._isLeftMouse?"mouseup":"rightmouseup";this.sendMouseUp(t,e);this._event._stoped=!1;this.sendClick(this._target,e)};e.sendMouseUp=function(t,e){t.event(e,this._event.setTo(e,t,this._target));!this._event._stoped&&t.parent&&this.sendMouseUp(t.parent,e)};e.sendClick=function(t,e){if("mouseup"===e&&t.$_MOUSEDOWN){t.$_MOUSEDOWN=!1;t.event("click",this._event.setTo("click",t,this._target));this._isDoubleClick&&t.event("doubleclick",this._event.setTo("doubleclick",t,this._target))}else if("rightmouseup"===e&&t.$_RIGHTMOUSEDOWN){t.$_RIGHTMOUSEDOWN=!1;t.event("rightclick",this._event.setTo("rightclick",t,this._target))}!this._event._stoped&&t.parent&&this.sendClick(t.parent,e)};e.check=function(t,e,i,n){var s,r,o,a,h,l,u,c,_,f=t.transform||this._matrix,d=t.pivotX,p=t.pivotY;if(0===d&&0===p)f.setTranslate(t.x,t.y);else if(f===this._matrix)f.setTranslate(t.x-d,t.y-p);else{s=f.cos;r=f.sin;f.setTranslate(t.x-(d*s-p*r)*t.scaleX,t.y-(d*r+p*s)*t.scaleY)}f.invertTransformPoint(this._point.setTo(e,i));f.setTranslate(0,0);e=this._point.x;i=this._point.y;o=t.scrollRect;if(o){this._rect.setTo(0,0,o.width,o.height);a=this._rect.contains(e,i);if(!a)return!1}if(!this.disableMouseEvent){h=!1;for(l=t._childs.length-1;l>-1;l--){u=t._childs[l];if(u.mouseEnabled&&u.visible){h=this.check(u,e+(o?o.x:0),i+(o?o.y:0),n);if(h)return!0}}}if(t.width>0&&t.height>0){c=!1;_=this._rect;if(t.mouseThrough)a=t.getGraphicBounds().contains(e,i);else{t.hitArea?_=t.hitArea:_.setTo(0,0,t.width,t.height);a=_.contains(e,i)}if(a){this._target=t;n.call(this,t)}}return a};e.runEvent=function(){var t,e,i,n,s,r,o,a,h,l=this._eventList.length;if(l){t=this;e=0;for(;e<l;){i=this._eventList[e];switch(i.type){case"mousedown":t._isLeftMouse=0===i.button;t.initEvent(i);t.check(t._stage,t.mouseX,t.mouseY,t.onMouseDown);break;case"mouseup":t._isLeftMouse=0===i.button;n=Browser.now();t._isDoubleClick=n-t._lastClickTimer<300;t._lastClickTimer=n;t.initEvent(i);t.check(t._stage,t.mouseX,t.mouseY,t.onMouseUp);break;case"mousemove":t.initEvent(i);t.check(t._stage,t.mouseX,t.mouseY,t.onMouseMove);t.checkMouseOut();break;case"touchstart":t._isLeftMouse=!0;s=i.changedTouches;for(r=0,o=s.length;r<o;r++){t.initEvent(s[r],i);t.check(t._stage,t.mouseX,t.mouseY,t.onMouseDown)}break;case"touchend":t._isLeftMouse=!0;a=i.changedTouches;for(r=0,o=a.length;r<o;r++){t.initEvent(a[r],i);t.check(t._stage,t.mouseX,t.mouseY,t.onMouseUp)}break;case"touchmove":h=i.changedTouches;for(r=0,o=h.length;r<o;r++){t.initEvent(h[r],i);t.check(t._stage,t.mouseX,t.mouseY,t.onMouseMove)}t.checkMouseOut();break;case"wheel":case"mousewheel":case"DOMMouseScroll":t.checkMouseWheel(i);break;case"mouseout":t._stage.event("mouseout",t._event.setTo("mouseout",t._stage,t._stage));break;case"mouseover":t._stage.event("mouseover",t._event.setTo("mouseover",t._stage,t._stage))}e++}this._eventList.length=0}};t.enabled=!0;__static(t,["instance",function(){return this.instance=new t}]);return t}();Filter=function(){function t(){this._action=null}__class(t,"laya.filters.Filter");var e=t.prototype;Laya.imps(e,{"laya.filters.IFilter":!0});__getset(0,e,"type",function(){return-1});__getset(0,e,"action",function(){return this._action});t.BLUR=16;t.COLOR=32;t.GLOW=8;t._filterStart=null;t._filterEnd=null;t._EndTarget=null;t._recycleScope=null;t._filter=null;t._useSrc=null;t._endSrc=null;t._useOut=null;t._endOut=null;return t}();ColorFilterAction=function(){function t(){this.data=null}__class(t,"laya.filters.ColorFilterAction");var e=t.prototype;Laya.imps(e,{"laya.filters.IFilterAction":!0});e.apply=function(t){var e,i,n,s,r,o=t.ctx.ctx,a=t.ctx.ctx.canvas;if(0==a.width||0==a.height)return a;e=o.getImageData(0,0,a.width,a.height);i=e.data;for(s=0,r=i.length;s<r;s+=4){n=this.getColor(i[s],i[s+1],i[s+2],i[s+3]);if(0!=i[s+3]){i[s]=n[0];i[s+1]=n[1];i[s+2]=n[2];i[s+3]=n[3]}}o.putImageData(e,0,0);return t};e.getColor=function(t,e,i,n){var s,r=[];if(this.data._elements){s=this.data._elements;r[0]=s[0]*t+s[1]*e+s[2]*i+s[3]*n+s[4];r[1]=s[5]*t+s[6]*e+s[7]*i+s[8]*n+s[9];r[2]=s[10]*t+s[11]*e+s[12]*i+s[13]*n+s[14];r[3]=s[15]*t+s[16]*e+s[17]*i+s[18]*n+s[19]}return r};return t}();Arith=function(){function t(){}__class(t,"laya.maths.Arith");t.formatR=function(t){t>Math.PI&&(t-=2*Math.PI);t<-Math.PI&&(t+=2*Math.PI);return t};t.isPOT=function(t,e){return t>0&&0===(t&t-1)&&e>0&&0===(e&e-1)};t.setMatToArray=function(t,e){t.a,t.b,t.c,t.d,t.tx+20,t.ty+20,1;e[0]=t.a;e[1]=t.b;e[4]=t.c;e[5]=t.d;e[12]=t.tx;e[13]=t.ty};return t}();Bezier=function(){function t(){this.controlPoints=[new Point,new Point,new Point];this._calFun=this.getPoint2}__class(t,"laya.maths.Bezier");var e=t.prototype;e._switchPoint=function(t,e){var i=this.controlPoints.shift();i.setTo(t,e);this.controlPoints.push(i)};e.getPoint2=function(t,e){var i=this.controlPoints[0],n=this.controlPoints[1],s=this.controlPoints[2],r=Math.pow(1-t,2)*i.x+2*t*(1-t)*n.x+Math.pow(t,2)*s.x,o=Math.pow(1-t,2)*i.y+2*t*(1-t)*n.y+Math.pow(t,2)*s.y;e.push(r,o)};e.getPoint3=function(t,e){var i=this.controlPoints[0],n=this.controlPoints[1],s=this.controlPoints[2],r=this.controlPoints[3],o=Math.pow(1-t,3)*i.x+3*n.x*t*(1-t)*(1-t)+3*s.x*t*t*(1-t)+r.x*Math.pow(t,3),a=Math.pow(1-t,3)*i.y+3*n.y*t*(1-t)*(1-t)+3*s.y*t*t*(1-t)+r.y*Math.pow(t,3);e.push(o,a)};e.insertPoints=function(t,e){var i,n=0,s=0;t=t>0?t:5;s=t;i=NaN;i=1/t;for(n=0;n<=1;n+=i)this._calFun(n,e)};e.getBezierPoints=function(t,e,i){var n,s,r;void 0===e&&(e=5);void 0===i&&(i=2);n=0,s=0;s=t.length;if(s<2*(i+1))return[];r=[];switch(i){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(n=0;n<2*i;n+=2)this._switchPoint(t[n],t[n+1]);for(n=2*i;n<s;n+=2){this._switchPoint(t[n],t[n+1]);n/2%i==0&&this.insertPoints(e,r)}return r};__static(t,["I",function(){return this.I=new t}]);return t}();GrahamScan=function(){function t(){}__class(t,"laya.maths.GrahamScan");t.multiply=function(t,e,i){return(t.x-i.x)*(e.y-i.y)-(e.x-i.x)*(t.y-i.y)};t.dis=function(t,e){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)};t._getPoints=function(e,i,n){void 0===i&&(i=!1);t._mPointList||(t._mPointList=[]);for(;t._mPointList.length<e;)t._mPointList.push(new Point);n||(n=[]);n.length=0;i?Utils.getFrom(n,t._mPointList,e):Utils.getFromR(n,t._mPointList,e);return n};t.pListToPointList=function(e,i){void 0===i&&(i=!1);var n=0,s=e.length/2,r=t._getPoints(s,i,t._tempPointList);for(n=0;n<s;n++)r[n].setTo(e[n+n],e[n+n+1]);return r};t.pointListToPlist=function(e){var i,n=0,s=e.length,r=t._temPList;r.length=0;for(n=0;n<s;n++){i=e[n];r.push(i.x,i.y)}return r};t.scanPList=function(e){return Utils.setValueArr(e,t.pointListToPlist(t.scan(t.pListToPointList(e,!0))))};t.scan=function(e){var i,n,s=0,r=0,o=0,a=e.length,h={},l=t._temArr;l.length=0;a=e.length;for(s=a-1;s>=0;s--){i=e[s];n=i.x+"_"+i.y;if(!h.hasOwnProperty(n)){h[n]=!0;l.push(i)}}a=l.length;Utils.setValueArr(e,l);for(s=1;s<a;s++)(e[s].y<e[o].y||e[s].y==e[o].y&&e[s].x<e[o].x)&&(o=s);i=e[0];e[0]=e[o];e[o]=i;for(s=1;s<a-1;s++){o=s;for(r=s+1;r<a;r++)(t.multiply(e[r],e[o],e[0])>0||0==t.multiply(e[r],e[o],e[0])&&t.dis(e[0],e[r])<t.dis(e[0],e[o]))&&(o=r);i=e[s];e[s]=e[o];e[o]=i}l=t._temArr;l.length=0;if(e.length<3)return Utils.setValueArr(l,e);l.push(e[0],e[1],e[2]);for(s=3;s<a;s++){for(;l.length>=2&&t.multiply(e[s],l[l.length-1],l[l.length-2])>=0;)l.pop();e[s]&&l.push(e[s])}return l};t._mPointList=null;t._tempPointList=[];t._temPList=[];t._temArr=[];return t}();MathUtil=function(){function t(){}__class(t,"laya.maths.MathUtil");t.subtractVector3=function(t,e,i){i[0]=t[0]-e[0];i[1]=t[1]-e[1];i[2]=t[2]-e[2]};t.lerp=function(t,e,i){return t*(1-i)+e*i};t.scaleVector3=function(t,e,i){i[0]=t[0]*e;i[1]=t[1]*e;i[2]=t[2]*e};t.lerpVector3=function(t,e,i,n){var s=t[0],r=t[1],o=t[2];n[0]=s+i*(e[0]-s);n[1]=r+i*(e[1]-r);n[2]=o+i*(e[2]-o)};t.lerpVector4=function(t,e,i,n){var s=t[0],r=t[1],o=t[2],a=t[3];n[0]=s+i*(e[0]-s);n[1]=r+i*(e[1]-r);n[2]=o+i*(e[2]-o);n[3]=a+i*(e[3]-a)};t.slerpQuaternionArray=function(t,e,i,n,s,r,o){var a,h,l,u,c=t[e+0],_=t[e+1],f=t[e+2],d=t[e+3],p=i[n+0],g=i[n+1],m=i[n+2],y=i[n+3],v=c*p+_*g+f*m+d*y;if(v<0){v=-v;p=-p;g=-g;m=-m;y=-y}if(1-v>1e-6){a=Math.acos(v);h=Math.sin(a);l=Math.sin((1-s)*a)/h;u=Math.sin(s*a)/h}else{l=1-s;u=s}r[o+0]=l*c+u*p;r[o+1]=l*_+u*g;r[o+2]=l*f+u*m;r[o+3]=l*d+u*y;return r};t.getRotation=function(t,e,i,n){return Math.atan2(i-t,n-e)/Math.PI*180};t.SortBigFirst=function(t,e){return t==e?0:e>t?1:-1};t.SortSmallFirst=function(t,e){return t==e?0:e>t?-1:1};t.SortNumBigFirst=function(t,e){return parseFloat(e)-parseFloat(t)};t.SortNumSmallFirst=function(t,e){return parseFloat(t)-parseFloat(e)};t.SortByKey=function(e,i,n){void 0===i&&(i=!1);void 0===n&&(n=!0);var s;s=i?n?t.SortNumBigFirst:t.SortBigFirst:n?t.SortNumSmallFirst:t.SortSmallFirst;return function(t,i){return s(t[e],i[e])}};return t}();Matrix=function(){function t(t,e,i,n,s,r){this.cos=1;this.sin=0;this.bTransform=!1;this.inPool=!1;void 0===t&&(t=1);void 0===e&&(e=0);void 0===i&&(i=0);void 0===n&&(n=1);void 0===s&&(s=0);void 0===r&&(r=0);this.a=t;this.b=e;this.c=i;this.d=n;this.tx=s;this.ty=r;this._checkTransform()}__class(t,"laya.maths.Matrix");var e=t.prototype;e.identity=function(){this.a=this.d=1;this.b=this.tx=this.ty=this.c=0;this.bTransform=!1;return this};e._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d};e.setTranslate=function(t,e){this.tx=t;this.ty=e};e.translate=function(t,e){this.tx+=t;this.ty+=e;return this};e.scale=function(t,e){this.a*=t;this.d*=e;this.c*=t;this.b*=e;this.tx*=t;this.ty*=e;this.bTransform=!0};e.rotate=function(t){var e=this.cos=Math.cos(t),i=this.sin=Math.sin(t),n=this.a,s=this.c,r=this.tx;this.a=n*e-this.b*i;this.b=n*i+this.b*e;this.c=s*e-this.d*i;this.d=s*i+this.d*e;this.tx=r*e-this.ty*i;this.ty=r*i+this.ty*e;this.bTransform=!0};e.skew=function(t,e){var i=Math.tan(t),n=Math.tan(e),s=this.a,r=this.b;this.a+=n*this.c;this.b+=n*this.d;this.c+=i*s;this.d+=i*r;return this};e.invertTransformPoint=function(t){var e=this.a,i=this.b,n=this.c,s=this.d,r=this.tx,o=e*s-i*n,a=s/o,h=-i/o,l=-n/o,u=e/o,c=(n*this.ty-s*r)/o,_=-(e*this.ty-i*r)/o;t.setTo(a*t.x+l*t.y+c,h*t.x+u*t.y+_)};e.transformPoint=function(t,e,i){i.setTo(this.a*t+this.c*e+this.tx,this.b*t+this.d*e+this.ty)};e.transformPointArray=function(t,e){var i,n,s,r=t.length;for(i=0;i<r;i+=2){n=t[i],s=t[i+1];e[i]=this.a*n+this.c*s+this.tx;e[i+1]=this.b*n+this.d*s+this.ty}};e.transformPointArrayScale=function(t,e){var i,n,s,r=t.length;for(i=0;i<r;i+=2){n=t[i],s=t[i+1];e[i]=this.a*n+this.c*s;e[i+1]=this.b*n+this.d*s}};e.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)};e.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)};e.invert=function(){var t=this.a,e=this.b,i=this.c,n=this.d,s=this.tx,r=t*n-e*i;this.a=n/r;this.b=-e/r;this.c=-i/r;this.d=t/r;this.tx=(i*this.ty-n*s)/r;this.ty=-(t*this.ty-e*s)/r;return this};e.setTo=function(t,e,i,n,s,r){this.a=t,this.b=e,this.c=i,this.d=n,this.tx=s,this.ty=r;return this};e.concat=function(t){var e=this.a,i=this.c,n=this.tx;this.a=e*t.a+this.b*t.c;this.b=e*t.b+this.b*t.d;this.c=i*t.a+this.d*t.c;this.d=i*t.b+this.d*t.d;this.tx=n*t.a+this.ty*t.c+t.tx;this.ty=n*t.b+this.ty*t.d+t.ty;return this};e.clone=function(){var e=t._cache,i=e._length?e[--e._length]:new t;i.a=this.a;i.b=this.b;i.c=this.c;i.d=this.d;i.tx=this.tx;i.ty=this.ty;i.bTransform=this.bTransform;return i};e.copy=function(t){t.a=this.a;t.b=this.b;t.c=this.c;t.d=this.d;t.tx=this.tx;t.ty=this.ty;t.bTransform=this.bTransform;return t};e.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty};e.destroy=function(){if(!this.inPool){var e=t._cache;this.inPool=!0;e._length||(e._length=0);e[e._length++]=this;this.a=this.d=1;this.b=this.c=this.tx=this.ty=0;this.bTransform=!1}};t.mul=function(t,e,i){var n=t.a,s=t.b,r=t.c,o=t.d,a=t.tx,h=t.ty,l=e.a,u=e.b,c=e.c,_=e.d,f=e.tx,d=e.ty;if(0!==u||0!==c){i.a=n*l+s*c;i.b=n*u+s*_;i.c=r*l+o*c;i.d=r*u+o*_;i.tx=l*a+c*h+f;i.ty=u*a+_*h+d}else{i.a=n*l;i.b=s*_;i.c=r*l;i.d=o*_;i.tx=l*a+f;i.ty=_*h+d}return i};t.mulPre=function(t,e,i,n,s,r,o,a){var h=t.a,l=t.b,u=t.c,c=t.d,_=t.tx,f=t.ty;if(0!==i||0!==n){a.a=h*e+l*n;a.b=h*i+l*s;a.c=u*e+c*n;a.d=u*i+c*s;a.tx=e*_+n*f+r;a.ty=i*_+s*f+o}else{a.a=h*e;a.b=l*s;a.c=u*e;a.d=c*s;a.tx=e*_+r;a.ty=s*f+o}return a};t.mulPos=function(t,e,i,n,s,r,o,a){var h=t.a,l=t.b,u=t.c,c=t.d,_=t.tx,f=t.ty;if(0!==l||0!==u){a.a=e*h+i*u;a.b=e*l+i*c;a.c=n*h+s*u;a.d=n*l+s*c;a.tx=h*r+u*o+_;a.ty=l*r+c*o+f}else{a.a=e*h;a.b=i*c;a.c=n*h;a.d=s*c;a.tx=h*r+_;a.ty=c*o+f}return a};t.preMul=function(t,e,i){var n=t.a,s=t.b,r=t.c,o=t.d,a=e.a,h=e.b,l=e.c,u=e.d,c=e.tx,_=e.ty;i.a=a*n;i.b=i.c=0;i.d=u*o;i.tx=c*n+t.tx;i.ty=_*o+t.ty;if(0!==h||0!==l||0!==s||0!==r){i.a+=h*r;i.d+=l*s;i.b+=a*s+h*o;i.c+=l*n+u*r;i.tx+=_*r;i.ty+=c*s}return i};t.preMulXY=function(t,e,i,n){var s=t.a,r=t.b,o=t.c,a=t.d;n.a=s;n.b=r;n.c=o;n.d=a;n.tx=e*s+t.tx+i*o;n.ty=i*a+t.ty+e*r;return n};t.create=function(){var e=t._cache,i=e._length?e[--e._length]:new t;i.inPool=!1;return i};t.EMPTY=new t;t.TEMP=new t;t._cache=[];return t}();Point=function(){function t(t,e){void 0===t&&(t=0);void 0===e&&(e=0);this.x=t;this.y=e}__class(t,"laya.maths.Point");var e=t.prototype;e.setTo=function(t,e){this.x=t;this.y=e;return this};t.TEMP=new t;t.EMPTY=new t;return t}();Rectangle=function(){function t(t,e,i,n){void 0===t&&(t=0);void 0===e&&(e=0);void 0===i&&(i=0);void 0===n&&(n=0);this.x=t;this.y=e;this.width=i;this.height=n}__class(t,"laya.maths.Rectangle");var e=t.prototype;e.setTo=function(t,e,i,n){this.x=t;this.y=e;this.width=i;this.height=n;return this};e.copyFrom=function(t){this.x=t.x;this.y=t.y;this.width=t.width;this.height=t.height;return this};e.contains=function(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.right&&e>=this.y&&e<this.bottom};e.intersects=function(t){return!(t.x>this.right||t.right<this.x||t.y>this.bottom||t.bottom<this.y)};e.intersection=function(e,i){if(!this.intersects(e))return null;i||(i=new t);i.x=Math.max(this.x,e.x);i.y=Math.max(this.y,e.y);i.width=Math.min(this.right,e.right)-i.x;i.height=Math.min(this.bottom,e.bottom)-i.y;return i};e.union=function(e,i){i||(i=new t);this.clone(i);if(e.width<=0||e.height<=0)return i;i.addPoint(e.x,e.y);i.addPoint(e.right,e.bottom);return this};e.clone=function(e){e||(e=new t);e.x=this.x;e.y=this.y;e.width=this.width;e.height=this.height;return e};e.toString=function(){return this.x+","+this.y+","+this.width+","+this.height};e.equal=function(t){return!(!t||t.x!==this.x||t.y!==this.y||t.width!==this.width||t.height!==this.height)};e.addPoint=function(t,e){this.x>t&&(this.width+=this.x-t,this.x=t);this.y>e&&(this.height+=this.y-e,this.y=e);this.width<t-this.x&&(this.width=t-this.x);this.height<e-this.y&&(this.height=e-this.y);return this};e._getBoundPoints=function(){var e=t._temB;e.length=0;if(0==this.width||0==this.height)return e;e.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height);return e};__getset(0,e,"right",function(){return this.x+this.width});__getset(0,e,"bottom",function(){return this.y+this.height});t._getBoundPointS=function(e,i,n,s){var r=t._temA;r.length=0;if(0==n||0==s)return r;r.push(e,i,e+n,i,e,i+s,e+n,i+s);return r};t._getWrapRec=function(e,i){if(!e||e.length<1)return i?i.setTo(0,0,0,0):t.EMPTY;i=i?i:new t;var n,s,r,o,a,h=e.length,l=Point.TEMP;s=o=99999;r=a=-s;for(n=0;n<h;n+=2){l.x=e[n];l.y=e[n+1];s=s<l.x?s:l.x;o=o<l.y?o:l.y;r=r>l.x?r:l.x;a=a>l.y?a:l.y}return i.setTo(s,o,r-s,a-o)};t.EMPTY=new t;t.TEMP=new t;t._temB=[];t._temA=[];return t}();SoundManager=function(){function t(){}__class(t,"laya.media.SoundManager");__getset(1,t,"autoStopMusic",function(){return t._autoStopMusic},function(e){Laya.stage.off("blur",null,t._stageOnBlur);Laya.stage.off("focus",null,t._stageOnFocus);t._autoStopMusic=e;if(e){Laya.stage.on("blur",null,t._stageOnBlur);Laya.stage.on("focus",null,t._stageOnFocus)}});__getset(1,t,"muted",function(){return t._muted},function(e){e&&t._tMusic&&t.stopSound(t._tMusic);t._muted=e});__getset(1,t,"soundMuted",function(){return t._soundMuted},function(e){t._soundMuted=e});__getset(1,t,"musicMuted",function(){return t._musicMuted},function(e){if(e){t._tMusic&&t.stopSound(t._tMusic);t._musicMuted=e}else{t._musicMuted=e;t._tMusic&&t.playMusic(t._tMusic)}});t.addChannel=function(e){t._channels.indexOf(e)>=0||t._channels.push(e)};t.removeChannel=function(e){var i=0;for(i=t._channels.length-1;i>=0;i--)t._channels[i]==e&&t._channels.splice(i,1)};t._stageOnBlur=function(){if(t._musicChannel&&!t._musicChannel.isStopped){t._blurPaused=!0;t._musicChannel.stop()}};t._stageOnFocus=function(){if(t._blurPaused){t.playMusic(t._tMusic);t._blurPaused=!1}};t.playSound=function(e,i,n,s){var r,o;void 0===i&&(i=1);if(t._muted)return null;if(e==t._tMusic){if(t._musicMuted)return null}else if(t._soundMuted)return null;r=Laya.loader.getRes(e);s||(s=Sound);if(!r){r=new s;r.load(e);Loader.cacheRes(e,r)}o=r.play(0,i);o.volume=e==t._tMusic?t.musicVolume:t.soundVolume;o.completeHandler=n;return o};t.destroySound=function(t){var e=Laya.loader.getRes(t);if(e){Loader.clearRes(t);e.dispose()}};t.playMusic=function(e,i,n){void 0===i&&(i=0);t._tMusic=e;t._musicChannel&&t._musicChannel.stop();return t._musicChannel=t.playSound(e,i,n,AudioSound)};t.stopSound=function(e){var i,n=0;for(n=t._channels.length-1;n>=0;n--){i=t._channels[n];i.url==e&&i.stop()}};t.stopMusic=function(){t._musicChannel&&t._musicChannel.stop()};t.setSoundVolume=function(e,i){i?t._setVolume(i,e):t.soundVolume=e};t.setMusicVolume=function(e){t.musicVolume=e;t._setVolume(t._tMusic,e)};t._setVolume=function(e,i){var n,s=0;for(s=t._channels.length-1;s>=0;s--){n=t._channels[s];n.url==e&&(n.volume=i)}};t.musicVolume=1;t.soundVolume=1;t._muted=!1;t._soundMuted=!1;t._musicMuted=!1;t._tMusic=null;t._musicChannel=null;t._channels=[];t._autoStopMusic=!1;t._blurPaused=!1;return t}();LocalStorage=function(){function t(){}__class(t,"laya.net.LocalStorage");t.setItem=function(e,i){t.support&&t.items.setItem(e,i)};t.getItem=function(e){return t.support?t.items.getItem(e):null};t.setJSON=function(e,i){t.support&&t.items.setItem(e,JSON.stringify(i))};t.getJSON=function(e){return JSON.parse(t.support?t.items.getItem(e):null)};t.removeItem=function(e){t.support&&t.items.removeItem(e)};t.clear=function(){t.support&&t.items.clear()};t.items=null;t.support=!1;t.__init$=function(){if(window.localStorage){t.items=window.localStorage;try{localStorage.setItem("laya","1");localStorage.removeItem("laya");t.support=!0}catch(e){}}t.support||console.log("LocalStorage is not supprot or browser is private mode.")};return t}();URL=function(){function t(e){this._url=null;this._path=null;this._url=t.formatURL(e);this._path=t.getPath(e)}__class(t,"laya.net.URL");var e=t.prototype;__getset(0,e,"url",function(){return this._url});__getset(0,e,"path",function(){return this._path});t.formatURL=function(e,i){null!=t.customFormat&&(e=t.customFormat(e,i));if(!e)return"null path";t.version[e]&&(e+="?v="+t.version[e]);return Browser.httpProtocol||"/"!=e[0]?t.isAbsolute(e)?e:(i||t.basePath)+e:t.rootPath+e};t.isAbsolute=function(t){return t.indexOf(":")>0||"/"==t.charAt(0)};t.getPath=function(t){var e=t.lastIndexOf("/");return e>0?t.substr(0,e+1):""};t.getName=function(t){var e=t.lastIndexOf("/");return e>0?t.substr(e+1):t};t.version={};t.basePath="";t.rootPath="";t.customFormat=null;return t}();Render=function(){function t(e,i){function n(){Laya.stage._loop();Browser.window.requestAnimationFrame(n)}var s,r;t._mainCanvas=new HTMLCanvas("2D");s=t._mainCanvas.source.style;s.position="absolute";s.top=s.left="0px";s.background="#000000";t._mainCanvas.source.id="layaCanvas";r=null!=t.WebGL;r&&t.WebGL.init(t.canvas,e,i);Browser.document.body.appendChild(t._mainCanvas.source);t._context=new RenderContext(e,i,r?null:t._mainCanvas);Browser.window.requestAnimationFrame(n)}__class(t,"laya.renders.Render");__getset(1,t,"context",function(){return t._context});__getset(1,t,"isWebGl",function(){return null!=t.WebGL});__getset(1,t,"canvas",function(){return t._mainCanvas});t._context=null;t._mainCanvas=null;t.WebGL=null;t.clear=function(e){t._context.ctx.clear()};t.clearAtlas=function(t){};t.finish=function(){};return t}();RenderContext=function(){function t(t,e,i){this.x=0;this.y=0;if(i)this.ctx=i.getContext("2d");else{i=new HTMLCanvas("3D");this.ctx=System.createWebGLContext2D(i);i._setContext(this.ctx)}i.size(t,e);this.canvas=i}__class(t,"laya.renders.RenderContext");var e=t.prototype;e.destroy=function(){if(this.canvas){this.canvas.destroy();this.canvas=null}if(this.ctx){this.ctx.destroy();this.ctx=null}};e.drawTexture=function(t,e,i,n,s){t.loaded?this.ctx.drawTexture(t,e,i,n,s,this.x,this.y):this.ctx._repaint=!0};e._drawTexture=function(t,e,i){i[0].loaded?this.ctx.drawTexture(i[0],i[1],i[2],i[3],i[4],t,e):this.ctx._repaint=!0};e.drawTextureWithTransform=function(t,e,i,n,s,r){t.loaded?this.ctx.drawTextureWithTransform(t,e,i,n,s,r,this.x,this.y):this.ctx._repaint=!0};e._drawTextureWithTransform=function(t,e,i){i[0].loaded?this.ctx.drawTextureWithTransform(i[0],i[1],i[2],i[3],i[4],i[5],t,e):this.ctx._repaint=!0};e.fillQuadrangle=function(t,e,i,n,s){this.ctx.fillQuadrangle(t,e,i,n,s)};e._fillQuadrangle=function(t,e,i){this.ctx.fillQuadrangle(i[0],i[1],i[2],i[3],i[4])};e.drawCanvas=function(t,e,i,n,s){this.ctx.drawCanvas(t,e+this.x,i+this.y,n,s)};e.drawRect=function(t,e,i,n,s,r){void 0===r&&(r=1);var o=this.ctx;o.strokeStyle=s;o.lineWidth=r;o.strokeRect(t+this.x,e+this.y,i,n,r)};e._drawRect=function(t,e,i){var n=this.ctx;if(null!=i[4]){n.fillStyle=i[4];n.fillRect(t+i[0],e+i[1],i[2],i[3])}if(null!=i[5]){n.strokeStyle=i[5];n.lineWidth=i[6];n.strokeRect(t+i[0],e+i[1],i[2],i[3],i[6])}};e._drawPoly=function(t,e,i){var n,s,r,o=this.ctx;o.beginPath();n=i[2];t+=i[0],e+=i[1];o.moveTo(t+n[0],e+n[1]);s=2,r=n.length;for(;s<r;)o.lineTo(t+n[s++],e+n[s++]);o.closePath();this.fillAndStroke(i[3],i[4],i[5])};e._drawPolyGL=function(t,e,i){var n=i[2];t+=i[0],e+=i[1];this.ctx.drawPoly(t,e,n,i[3],i[5],i[4])};e._drawPath=function(t,e,i){var n,s,r,o,a,h,l=this.ctx;l.beginPath();t+=i[0],e+=i[1];n=i[2];for(s=0,r=n.length;s<r;s++){o=n[s];switch(o[0]){case"moveTo":l.moveTo(t+o[1],e+o[2]);break;case"lineTo":l.lineTo(t+o[1],e+o[2]);break;case"arcTo":l.arcTo(t+o[1],e+o[2],t+o[3],e+o[4],o[5]);break;case"closePath":l.closePath()}}a=i[3];if(null!=a){l.fillStyle=a.fillStyle;l.fill()}h=i[4];if(null!=h){l.strokeStyle=h.strokeStyle;l.lineWidth=h.lineWidth||1;l.lineJoin=h.lineJoin;l.lineCap=h.lineCap;l.miterLimit=h.miterLimit;l.stroke()}};e.fillAndStroke=function(t,e,i){if(null!=t){this.ctx.fillStyle=t;this.ctx.fill()}if(null!=e){this.ctx.strokeStyle=e;this.ctx.lineWidth=i;this.ctx.stroke()}};e._drawPie=function(t,e,i){var n=this.ctx;n.translate(t+i[0],e+i[1]);n.beginPath();n.moveTo(0,0);n.arc(0,0,i[2],i[3],i[4]);n.closePath();this.fillAndStroke(i[5],i[6],i[7]);n.translate(-t-i[0],-e-i[1])};e._drawPieWebGL=function(t,e,i){var n=this.ctx;n.lineWidth=i[7];n.fan(t+this.x+i[0],e+this.y+i[1],i[2],i[3],i[4],i[5],i[6])};e.clipRect=function(t,e,i,n){this.ctx.clipRect(t+this.x,e+this.y,i,n)};e._clipRect=function(t,e,i){this.ctx.clipRect(t+i[0],e+i[1],i[2],i[3])};e.fillRect=function(t,e,i,n,s){this.ctx.fillRect(t+this.x,e+this.y,i,n,s)};e._fillRect=function(t,e,i){this.ctx.fillRect(t+i[0],e+i[1],i[2],i[3],i[4])};e.drawCircle=function(e,i,n,s,r){void 0===r&&(r=1);var o=this.ctx;o.beginPath();o.strokeStyle=s;o.lineWidth=r;o.arc(e+this.x,i+this.y,n,0,t.PI2);o.stroke()};e._drawCircle=function(e,i,n){var s=this.ctx;s.beginPath();s.arc(n[0]+e,n[1]+i,n[2],0,t.PI2);this.fillAndStroke(n[3],n[4],n[5])};e._drawCircleWebGL=function(t,e,i){this.ctx.drawCircle(t+this.x+i[0],e+this.y+i[1],i[2],40,i[4],i[5],i[3])};e.fillCircle=function(e,i,n,s){var r=this.ctx;r.beginPath();r.fillStyle=s;r.arc(e+this.x,i+this.y,n,0,t.PI2);r.fill()};e._fillCircle=function(e,i,n){var s=this.ctx;s.beginPath();s.fillStyle=n[3];s.arc(n[0]+e,n[1]+i,n[2],0,t.PI2);s.fill()};e.setShader=function(t){this.ctx.setShader(t)};e._setShader=function(t,e,i){this.ctx.setShader(i[0])};e.drawLine=function(t,e,i,n,s,r){void 0===r&&(r=1);var o=this.ctx;o.beginPath();o.strokeStyle=s;o.lineWidth=r;o.moveTo(this.x+t,this.y+e);o.lineTo(this.x+i,this.y+n);o.stroke()};e._drawLine=function(t,e,i){var n=this.ctx;n.beginPath();n.strokeStyle=i[4];n.lineWidth=i[5];n.moveTo(t+i[0],e+i[1]);n.lineTo(t+i[2],e+i[3]);n.stroke()};e.drawLines=function(t,e,i){var n,s,r,o=this.ctx;o.beginPath();o.strokeStyle=i[3];o.lineWidth=i[4];n=i[2];t+=i[0],e+=i[1];o.moveTo(t+n[0],e+n[1]);s=2,r=n.length;for(;s<r;)o.lineTo(t+n[s++],e+n[s++]);o.stroke()};e.drawLinesWebGL=function(t,e,i){this.ctx.drawLines(t+this.x+i[0],e+this.y+i[1],i[2],i[3],i[4])};e.drawCurves=function(t,e,i){var n,s,r,o=this.ctx;o.beginPath();o.strokeStyle=i[3];o.lineWidth=i[4];n=i[2];t+=i[0],e+=i[1];o.moveTo(t+n[0],e+n[1]);s=2,r=n.length;for(;s<r;)o.quadraticCurveTo(t+n[s++],e+n[s++],t+n[s++],e+n[s++]);o.stroke()};e.drawCurvesGL=function(t,e,i){var n,s,r,o,a,h=i[2];t+=i[0],e+=i[1];n=Bezier.I;s=0;r=h.length;o=[];for(;s<r;){a=n.getBezierPoints([h[s++],h[s++],h[s++],h[s++],h[s++],h[s++]],30,2);o=o.concat(a);s<r&&(s-=2)}this.ctx.drawLines(t,e,o,i[3],i[4])};e.draw=function(t,e,i){i[0].call(null,this,t,e)};e.clear=function(){this.ctx.clear()};e.transform=function(t,e,i,n,s,r){this.ctx.transform(t,e,i,n,s,r)};e.transformByMatrix=function(t){this.ctx.transformByMatrix(t)};e._transformByMatrix=function(t,e,i){this.ctx.transformByMatrix(i[0])};e.setTransform=function(t,e,i,n,s,r){this.ctx.setTransform(t,e,i,n,s,r)};e._setTransform=function(t,e,i){this.ctx.setTransform(i[0],i[1],i[2],i[3],i[4],i[5])};e.setTransformByMatrix=function(t){this.ctx.setTransformByMatrix(t)};e._setTransformByMatrix=function(t,e,i){this.ctx.setTransformByMatrix(i[0])};e.save=function(){this.ctx.save()};e.restore=function(){this.ctx.restore()};e.translate=function(t,e){this.ctx.translate(t,e)};e._translate=function(t,e,i){this.ctx.translate(i[0],i[1])};e.rotate=function(t){this.ctx.rotate(t)};e._transform=function(t,e,i){this.ctx.translate(i[1]+t,i[2]+e);var n=i[0];this.ctx.transform(n.a,n.b,n.c,n.d,n.tx,n.ty);this.ctx.translate(-t-i[1],-e-i[2])};e._rotate=function(t,e,i){this.ctx.translate(i[1]+t,i[2]+e);this.ctx.rotate(i[0]);this.ctx.translate(-t-i[1],-e-i[2])};e._scale=function(t,e,i){this.ctx.translate(i[2]+t,i[3]+e);this.ctx.scale(i[0],i[1]);this.ctx.translate(-t-i[2],-e-i[3])};e.scale=function(t,e){this.ctx.scale(t,e)};e.alpha=function(t){this.ctx.globalAlpha=t};e._alpha=function(t,e,i){this.ctx.globalAlpha=i[0]};e.setAlpha=function(t){this.ctx.globalAlpha=t};e._setAlpha=function(t,e,i){this.ctx.globalAlpha=i[0]};e.fillWords=function(t,e,i,n,s){this.ctx.fillWords(t,e,i,n,s)};e.fillText=function(t,e,i,n,s,r){this.ctx.fillText(t,e+this.x,i+this.y,n,s,r)};e._fillText=function(t,e,i){this.ctx.fillText(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5])};e.strokeText=function(t,e,i,n,s,r,o){this.ctx.strokeText(t,e+this.x,i+this.y,n,s,r,o)};e._strokeText=function(t,e,i){this.ctx.strokeText(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5],i[6])};e._fillBorderText=function(t,e,i){this.ctx.fillBorderText(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5],i[6],i[7])};e.blendMode=function(t){this.ctx.globalCompositeOperation=t};e._blendMode=function(t,e,i){this.ctx.globalCompositeOperation=i[0]};e.flush=function(){this.ctx.flush&&this.ctx.flush()};e.addRenderObject=function(t){this.ctx.addRenderObject(t)};e.beginClip=function(t,e,i,n){this.ctx.beginClip&&this.ctx.beginClip(t,e,i,n)};e._beginClip=function(t,e,i){this.ctx.beginClip&&this.ctx.beginClip(t+i[0],e+i[1],i[2],i[3])};e.endClip=function(){this.ctx.endClip&&this.ctx.endClip()};e._setIBVB=function(t,e,i){this.ctx.setIBVB(i[0]+t,i[1]+e,i[2],i[3],i[4],i[5],i[6],i[7])};e.fillTrangles=function(t,e,i){this.ctx.fillTrangles(i[0],i[1],i[2],i[3],i.length>4?i[4]:null)};e._fillTrangles=function(t,e,i){this.ctx.fillTrangles(i[0],i[1]+t,i[2]+e,i[3],i[4])};e.drawPath=function(t,e,i){this.ctx.drawPath(t+this.x+i[0],e+this.y+i[1],i[2],i[3],i[4])};e.drawPoly=function(t,e,i){this.ctx.drawPoly(t+this.x+i[0],e+this.y+i[1],i[2],i[3],i[4],i[5],i[6])};e.drawParticle=function(t,e,i){this.ctx.drawParticle(t+this.x,e+this.y,i[0])};__getset(0,e,"enableMerge",null,function(t){this.ctx.enableMerge=t});t.PI2=2*Math.PI;return t}();RenderSprite=function(){function t(e,i){this._next=i||t.NORENDER;switch(e){case 0:this._fun=this._no;return;case 1:this._fun=this._image;return;case 4:this._fun=this._alpha;return;case 8:this._fun=this._transform;return;case 32:this._fun=this._blend;return;case 16:this._fun=this._canvas;return;case 64:this._fun=this._clip;return;case 128:this._fun=this._style;return;case 256:this._fun=this._graphics;return;case 1024:this._fun=this._enableRenderMerge;return;case 2048:this._fun=this._childs;return;case 512:this._fun=this._custom;return;case 257:this._fun=this._image2;return;case 265:this._fun=this._image2;return;case 2:this._fun=Filter._filter;return;case 69905:this._fun=t._initRenderFun;return}this.onCreate(e)}__class(t,"laya.renders.RenderSprite");var e=t.prototype;e.onCreate=function(t){};e._style=function(t,e,i,n){t._style.render(t,e,i,n);var s=this._next;s._fun.call(s,t,e,i,n)};e._no=function(t,e,i,n){};e._custom=function(t,e,i,n){t.customRender(e,i,n);var s=t._style;this._next._fun.call(this._next,t,e,i-s.translateX,n-s.translateY)};e._clip=function(e,i,n,s){var r,o=this._next;if(o!=t.NORENDER){r=e._style.scrollRect;i.ctx.save();i.ctx.clipRect(n,s,r.width,r.height);o._fun.call(o,e,i,n-r.x,s-r.y);i.ctx.restore()}};e._enableRenderMerge=function(e,i,n,s){var r=this._next;if(r!=t.NORENDER){i.ctx.save();i.ctx.enableMerge=!0;
r._fun.call(r,e,i,n,s);i.ctx.restore()}};e._blend=function(t,e,i,n){var s,r,o=t._style;o.blendMode&&(e.ctx.globalCompositeOperation=o.blendMode);s=this._next;s._fun.call(s,t,e,i,n);r=t.mask;if(r){e.ctx.globalCompositeOperation="destination-in";(r.numChildren>0||!r.graphics._isOnlyOne())&&(r.cacheAsBitmap=!0);r.render(e,i,n)}e.ctx.globalCompositeOperation="source-over"};e._graphics=function(t,e,i,n){var s,r=t._style;t._graphics&&t._graphics._render(t,e,i-r.translateX,n-r.translateY);s=this._next;s._fun.call(s,t,e,i,n)};e._image=function(t,e,i,n){var s=t._style;e.ctx.drawTexture2(i,n,s.translateX,s.translateY,t.transform,s.alpha,s.blendMode,t._graphics._one)};e._image2=function(t,e,i,n){var s=t._style;e.ctx.drawTexture2(i,n,s.translateX,s.translateY,t.transform,1,null,t._graphics._one)};e._alpha=function(t,e,i,n){var s,r,o,a=t._style;if((s=a.alpha)>.01){r=e.ctx.globalAlpha;e.ctx.globalAlpha*=s;o=this._next;o._fun.call(o,t,e,i,n);e.ctx.globalAlpha=r}};e._transform=function(e,i,n,s){var r=e.transform,o=this._next;if(r&&o!=t.NORENDER){i.save();i.transform(r.a,r.b,r.c,r.d,r.tx+n,r.ty+s);o._fun.call(o,e,i,0,0);i.restore()}else o._fun.call(o,e,i,n,s)};e._childs=function(t,e,i,n){var s,r,o,a,h,l,u=t._style;i+=-u.translateX+u.paddingLeft;n+=-u.translateY+u.paddingTop;s=t._getWords();s&&e.fillWords(s,i,n,u.font,u.color);r=t._childs,o=r.length;if(t.optimizeFloat&&null!=t.scrollRect){l=t.scrollRect;for(h=0;h<o;++h){a=r[h];a._style.visible&&l.intersects(Rectangle.TEMP.setTo(a.x,a.y,a.width,a.height))&&a.render(e,i,n)}}else for(h=0;h<o;++h)(a=r[h])._style.visible&&a.render(e,i,n)};e._canvas=function(t,e,i,n){var s,r,o,a,h,l,u,c,_=t._$P.cacheCanvas,f=this._next;if(_){s=_.ctx;r=t.isRepaint()||!s||s.ctx._repaint;"bitmap"===_.type?Stat.canvasBitmap++:Stat.canvasNormal++;if(r){_._cacheRec||(_._cacheRec=new Rectangle);l=t.getSelfBounds();if("bitmap"===_.type&&(l.width>2048||l.height>2048))throw new Error("cache bitmap size larger than 2048");l.x-=t.pivotX;l.y-=t.pivotY;l.x-=10;l.y-=10;l.width+=20;l.height+=20;_._cacheRec.copyFrom(l);l=_._cacheRec;u=l.width;c=l.height;a=l.x;h=l.y;if(!s){s=_.ctx=new RenderContext(u,c,new HTMLCanvas("AUTO"));s.ctx.sprite=t}o=s.canvas;"bitmap"===_.type&&(o.asBitmap=!0);o.clear();(o.width!=u||o.height!=c)&&o.size(u,c);f._fun.call(f,t,s,-a,-h);t.applyFilters();t._$P.isStatic&&(_.reCache=!1);Stat.canvasReCache++}else{l=_._cacheRec;a=l.x;h=l.y;o=s.canvas}e.drawCanvas(o,i+a,n+h,o.width,o.height)}else f._fun.call(f,t,s,i,n)};t.__init__=function(){function e(e,i){var n,s=0;for(n=0;n<e.length;n++){s|=e[n];t.renders[s]=i}}var i=0,n=0,s=System.createRenderSprite(69905,null);n=t.renders.length=4096;for(i=0;i<n;i++)t.renders[i]=s;t.renders[0]=System.createRenderSprite(0,null);e([1,256,8,4],new t(1,null));t.renders[257]=System.createRenderSprite(257,null);t.renders[265]=new t(265,null)};t._initRenderFun=function(e,i,n,s){var r=e._renderType,o=t.renders[r]=t._getTypeRender(r);o._fun(e,i,n,s)};t._getTypeRender=function(t){for(var e=null,i=2048;i>1;){i&t&&(e=System.createRenderSprite(i,e));i>>=1}return e};t.IMAGE=1;t.FILTERS=2;t.ALPHA=4;t.TRANSFORM=8;t.CANVAS=16;t.BLEND=32;t.CLIP=64;t.STYLE=128;t.GRAPHICS=256;t.CUSTOM=512;t.ENABLERENDERMERGE=1024;t.CHILDS=2048;t.INIT=69905;t.renders=[];t.NORENDER=new t(0,null);return t}();Context=function(){function t(){this._repaint=!1}__class(t,"laya.resource.Context");var e=t.prototype;e.drawCanvas=function(t,e,i,n,s){Stat.drawCall++;this.drawImage(t.source,e,i,n,s)};e.fillRect=function(t,e,i,n,s){Stat.drawCall++;s&&(this.fillStyle=s);this.__fillRect(t,e,i,n)};e.fillText=function(t,e,i,n,s,r){Stat.drawCall++;if(arguments.length>3&&null!=n){this.font=n;this.fillStyle=s;this.textAlign=r;this.textBaseline="top"}this.__fillText(t,e,i)};e.fillBorderText=function(t,e,i,n,s,r,o,a){Stat.drawCall++;this.font=n;this.fillStyle=s;this.textBaseline="top";this.strokeStyle=r;this.lineWidth=o;this.textAlign=a;this.__strokeText(t,e,i);this.__fillText(t,e,i)};e.strokeText=function(t,e,i,n,s,r,o){Stat.drawCall++;if(arguments.length>3&&null!=n){this.font=n;this.strokeStyle=s;this.lineWidth=r;this.textAlign=o;this.textBaseline="top"}this.__strokeText(t,e,i)};e.transformByMatrix=function(t){this.transform(t.a,t.b,t.c,t.d,t.tx,t.ty)};e.setTransformByMatrix=function(t){this.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty)};e.clipRect=function(t,e,i,n){Stat.drawCall++;this.beginPath();this.rect(t,e,i,n);this.clip()};e.drawTexture=function(t,e,i,n,s,r,o){Stat.drawCall++;var a=t.uv,h=t.bitmap.width,l=t.bitmap.height;this.drawImage(t.bitmap.source,a[0]*h,a[1]*l,(a[2]-a[0])*h,(a[5]-a[3])*l,e+t.offsetX+r,i+t.offsetY+o,n,s)};e.drawTextureWithTransform=function(t,e,i,n,s,r,o,a){Stat.drawCall++;var h=t.uv,l=t.bitmap.width,u=t.bitmap.height;this.save();this.transform(r.a,r.b,r.c,r.d,r.tx+o,r.ty+a);this.drawImage(t.bitmap.source,h[0]*l,h[1]*u,(h[2]-h[0])*l,(h[5]-h[3])*u,e+t.offsetX,i+t.offsetY,n,s);this.restore()};e.drawTexture2=function(t,e,i,n,s,r,o,a){"use strict";var h,l,u,c,_,f;Stat.drawCall++;h=1!==r;if(h){l=this.globalAlpha;this.globalAlpha*=r}u=a[0];c=u.uv,_=u.bitmap.width,f=u.bitmap.height;if(s){this.save();this.transform(s.a,s.b,s.c,s.d,s.tx+t,s.ty+e);this.drawImage(u.bitmap.source,c[0]*_,c[1]*f,(c[2]-c[0])*_,(c[5]-c[3])*f,a[1]-i+u.offsetX,a[2]-n+u.offsetY,a[3],a[4]);this.restore()}else this.drawImage(u.bitmap.source,c[0]*_,c[1]*f,(c[2]-c[0])*_,(c[5]-c[3])*f,a[1]-i+t+u.offsetX,a[2]-n+e+u.offsetY,a[3],a[4]);h&&(this.globalAlpha=l)};e.flush=function(){return 0};e.fillWords=function(t,e,i,n,s){var r,o,a,h;n&&(this.font=n);s&&(this.fillStyle=s);r=this;this.textBaseline="top";this.textAlign="left";for(o=0,a=t.length;o<a;o++){h=t[o];this.__fillText(h["char"],h.x+e,h.y+i)}};e.destroy=function(){this.canvas.width=this.canvas.height=0};e.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height);this._repaint=!1};__getset(0,e,"enableMerge",function(){return!1},function(t){});t._init=function(e,i){i.__fillText=i.fillText;i.__fillRect=i.fillRect;i.__strokeText=i.strokeText;var n=["fillWords","fillRect","strokeText","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText"];n.forEach(function(e){i[e]=t._default[e]})};t._default=new t;return t}();ResourceManager=function(){function t(){this._id=0;this._name=null;this._resources=null;this._memorySize=0;this._garbageCollectionRate=NaN;this._isOverflow=!1;this.autoRelease=!1;this.autoReleaseMaxSize=0;this._id=++t._uniqueIDCounter;this._name="Content Manager";t._isResourceManagersSorted=!1;this._memorySize=0;this._isOverflow=!1;this.autoRelease=!1;this.autoReleaseMaxSize=536870912;this._garbageCollectionRate=.2;t._resourceManagers.push(this);this._resources=[]}__class(t,"laya.resource.ResourceManager");var e=t.prototype;Laya.imps(e,{"laya.resource.IDispose":!0});e.getResourceByIndex=function(t){return this._resources[t]};e.getResourcesLength=function(){return this._resources.length};e.addResource=function(t){t.resourceManager&&t.resourceManager.removeResource(t);var e=this._resources.indexOf(t);if(-1===e){t._resourceManager=this;this._resources.push(t);this.addSize(t.memorySize);t.on("memorychanged",this,this.addSize);return!0}return!1};e.removeResource=function(t){var e=this._resources.indexOf(t);if(-1!==e){this._resources.splice(e,1);t._resourceManager=null;this._memorySize-=t.memorySize;t.off("memorychanged",this,this.addSize);return!0}return!1};e.unload=function(){var e,i,n;if(this===t._systemResourceManager)throw new Error("systemResourceManager不能被释放！");e=this._resources.slice(0,this._resources.length);for(i=0;i<e.length;i++){n=e[i];n.resourceManager.removeResource(n);n.dispose()}e.length=0};e.setUniqueName=function(e){var i,n=!0;for(i=0;i<t._resourceManagers.length;i++)if(t._resourceManagers[i]._name===e&&t._resourceManagers[i]!==this){n=!1;return}if(n){if(this.name!=e){this.name=e;t._isResourceManagersSorted=!1}}else this.setUniqueName(e.concat("-copy"))};e.dispose=function(){var e,i,n;if(this===t._systemResourceManager)throw new Error("systemResourceManager不能被释放！");t._resourceManagers.splice(t._resourceManagers.indexOf(this),1);t._isResourceManagersSorted=!1;e=this._resources.slice(0,this._resources.length);for(i=0;i<e.length;i++){n=e[i];n.resourceManager.removeResource(n);n.dispose()}e.length=0};e.addSize=function(t){if(t){this.autoRelease&&t>0&&this._memorySize+t>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize);this._memorySize+=t}};e.garbageCollection=function(t){var e,i,n,s,r=this._resources;r=r.slice();r.sort(function(t,e){if(!t||!e)throw new Error("a或b不能为空！");return t.released&&e.released?0:t.released?1:e.released?-1:t.lastUseFrameCount-e.lastUseFrameCount});e=Stat.loopCount;for(i=0,n=r.length;i<n;i++){s=r[i];if(!(e-s.lastUseFrameCount>1)){this._memorySize>=t&&(this._isOverflow=!0);return}s.releaseResource();if(this._memorySize<t){this._isOverflow=!1;return}}};__getset(0,e,"id",function(){return this._id});__getset(0,e,"name",function(){return this._name},function(e){if((e||""!==e)&&this._name!==e){this._name=e;t._isResourceManagersSorted=!1}});__getset(0,e,"memorySize",function(){return this._memorySize});__getset(1,t,"sortedResourceManagersByName",function(){if(!t._isResourceManagersSorted){t._isResourceManagersSorted=!0;t._resourceManagers.sort(t.compareResourceManagersByName)}return t._resourceManagers});__getset(1,t,"systemResourceManager",function(){null===t._systemResourceManager&&(t._systemResourceManager=new t,t._systemResourceManager._name="System Resource Manager");return t._systemResourceManager});t.__init__=function(){t.currentResourceManager=t.systemResourceManager};t.getLoadedResourceManagerByIndex=function(e){return t._resourceManagers[e]};t.getLoadedResourceManagersCount=function(){return t._resourceManagers.length};t.recreateContentManagers=function(e){var i,n,s;void 0===e&&(e=!1);i=t.currentResourceManager;for(n=0;n<t._resourceManagers.length;n++){t.currentResourceManager=t._resourceManagers[n];for(s=0;s<t.currentResourceManager._resources.length;s++){t.currentResourceManager._resources[s].releaseResource(e);t.currentResourceManager._resources[s].activeResource(e)}}t.currentResourceManager=i};t.releaseContentManagers=function(e){var i,n,s,r;void 0===e&&(e=!1);i=t.currentResourceManager;for(n=0;n<t._resourceManagers.length;n++){t.currentResourceManager=t._resourceManagers[n];for(s=0;s<t.currentResourceManager._resources.length;s++){r=t.currentResourceManager._resources[s];!r.released&&r.releaseResource(e)}}t.currentResourceManager=i};t.compareResourceManagersByName=function(t,e){var i,n,s;if(t==e)return 0;i=t._name;n=e._name;if(null==i)return null==n?0:-1;if(null==n)return 1;s=i.localeCompare(n);if(0!=s)return s;e.setUniqueName(n);n=e._name;return i.localeCompare(n)};t._uniqueIDCounter=0;t._systemResourceManager=null;t._isResourceManagersSorted=!1;t._resourceManagers=[];t.currentResourceManager=null;return t}();System=function(){function System(){}__class(System,"laya.system.System");System.changeDefinition=function(name,classObj){Laya[name]=classObj;var str=name+"=classObj";eval(str)};System.__init__=function(){System.isConchApp=!!window.conch;if(System.isConchApp){conch.disableConchResManager();conch.disableConchAutoRestoreLostedDevice()}};System.isConchApp=!1;System.FILTER_ACTIONS=[];System.createRenderSprite=function(t,e){return new RenderSprite(t,e)};System.createGLTextur=null;System.createWebGLContext2D=null;System.changeWebGLSize=function(t,e){};System.createGraphics=function(){return new Graphics};System.createFilterAction=function(t){return new ColorFilterAction};System.drawToCanvas=function(t,e,i,n,s,r){var o=new HTMLCanvas("2D"),a=new RenderContext(i,n,o);RenderSprite.renders[e]._fun(t,a,s,r);return o};System.addToAtlas=null;System.createParticleTemplate2D=null;return System}();Browser=function(){function t(){}__class(t,"laya.utils.Browser");__getset(1,t,"clientWidth",function(){return t.document.body.clientWidth});__getset(1,t,"clientHeight",function(){return t.document.body.clientHeight||t.document.documentElement.clientHeight});__getset(1,t,"pixelRatio",function(){var e,i;if(t._pixelRatio<0){e=laya.utils.Browser.ctx;i=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;t._pixelRatio=(laya.utils.Browser.window.devicePixelRatio||1)/i}return t._pixelRatio});__getset(1,t,"width",function(){return(Laya.stage&&Laya.stage.canvasRotation?t.clientHeight:t.clientWidth)*t.pixelRatio});__getset(1,t,"height",function(){return(Laya.stage&&Laya.stage.canvasRotation?t.clientWidth:t.clientHeight)*t.pixelRatio});t.createElement=function(e){return t.document.__createElement(e)};t.getElementById=function(e){return t.document.getElementById(e)};t.removeElement=function(t){t&&t.parentNode&&t.parentNode.removeChild(t)};t.now=function(){return Date.now()};t.window=null;t.document=null;t.userAgent=navigator.userAgent;t.u=t.userAgent;t.onIOS=!!t.u.match(/\(i[^;]+;(U;)? CPU.+Mac OS X/);t.onMobile=!!t.u.match(/AppleWebKit.*Mobile.*/);t.onIPhone=t.u.indexOf("iPhone")>-1;t.onIPad=t.u.indexOf("iPad")>-1;t.onAndriod=t.u.indexOf("Android")>-1||t.u.indexOf("Adr")>-1;t.onWP=t.u.indexOf("Windows Phone")>-1;t.onQQBrowser=t.u.indexOf("QQBrowser")>-1;t.onMQQBrowser=t.u.indexOf("MQQBrowser")>-1;t.onWeiXin=t.u.indexOf("MicroMessenger")>-1;t.onPC=!t.onMobile;t.httpProtocol="http:"==window.location.protocol;t.webAudioOK=!1;t.soundType=null;t._pixelRatio=-1;__static(t,["canvas",function(){return this.canvas=new HTMLCanvas("2D")},"ctx",function(){return this.ctx=t.canvas.getContext("2d")}]);t.__init$=function(){var e,i,n,s,r,o;t.window=window;t.document=window.document;t.document.__createElement=t.document.createElement;window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)}}();e=window.document.body.style;e.margin=0;e.overflow="hidden";i=window.document.getElementsByTagName("meta");if(i){n=0,s=!1,r="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no";for(;n<i.length;){o=i[n];if("viewport"==o.name){o.content=r;s=!0;break}n++}if(!s){o=document.createElement("meta");o.name="viewport",o.content=r;document.getElementsByTagName("head")[0].appendChild(o)}}t.webAudioOK=!!(t.window["AudioContext"]||t.window["webkitAudioContext"]||t.window["mozAudioContext"]);t.soundType=t.webAudioOK?"WEBAUDIOSOUND":"AUDIOSOUND";Sound=t.webAudioOK?WebAudioSound:AudioSound};return t}();Byte=function(){function t(t){this._xd_=!0;this._allocated_=8;this._pos_=0;this._length=0;if(t){this._u8d_=new Uint8Array(t);this._d_=new DataView(this._u8d_.buffer);this._length=this._d_.byteLength}else this.___resizeBuffer(this._allocated_)}__class(t,"laya.utils.Byte");var e=t.prototype;e.___resizeBuffer=function(t){try{var e=new Uint8Array(t);null!=this._u8d_&&(this._u8d_.length<=t?e.set(this._u8d_):e.set(this._u8d_.subarray(0,t)));this._u8d_=e;this._d_=new DataView(e.buffer)}catch(i){throw"___resizeBuffer err:"+t}};e.getString=function(){return this.rUTF(this.getUint16())};e.getFloat32Array=function(t,e){var i=new Float32Array(this._d_.buffer.slice(t,t+e));this._pos_+=e;return i};e.getUint8Array=function(t,e){var i=new Uint8Array(this._d_.buffer.slice(t,t+e));this._pos_+=e;return i};e.getInt16Array=function(t,e){var i=new Int16Array(this._d_.buffer.slice(t,t+e));this._pos_+=e;return i};e.getFloat32=function(){var t=this._d_.getFloat32(this._pos_,this._xd_);this._pos_+=4;return t};e.writeFloat32=function(t){this.ensureWrite(this._pos_+4);this._d_.setFloat32(this._pos_,t,this._xd_);this._pos_+=4};e.getInt32=function(){var t=this._d_.getInt32(this._pos_,this._xd_);this._pos_+=4;return t};e.getUint32=function(){var t=this._d_.getUint32(this._pos_,this._xd_);this._pos_+=4;return t};e.writeInt32=function(t){this.ensureWrite(this._pos_+4);this._d_.setInt32(this._pos_,t,this._xd_);this._pos_+=4};e.writeUint32=function(t){this.ensureWrite(this._pos_+4);this._d_.setUint32(this._pos_,t,this._xd_);this._pos_+=4};e.getInt16=function(){var t=this._d_.getInt16(this._pos_,this._xd_);this._pos_+=2;return t};e.getUint16=function(){var t=this._d_.getUint16(this._pos_,this._xd_);this._pos_+=2;return t};e.writeUint16=function(t){this.ensureWrite(this._pos_+2);this._d_.setUint16(this._pos_,t,this._xd_);this._pos_+=2};e.writeInt16=function(t){this.ensureWrite(this._pos_+2);this._d_.setInt16(this._pos_,t,this._xd_);this._pos_+=2};e.getUint8=function(){return this._d_.getUint8(this._pos_++)};e.writeUint8=function(t){this.ensureWrite(this._pos_+1);this._d_.setUint8(this._pos_,t,this._xd_);this._pos_++};e._getUInt8=function(t){return this._d_.getUint8(t)};e._getUint16=function(t){return this._d_.getUint16(t,this._xd_)};e._getMatrix=function(){var t=new Matrix(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32());return t};e.rUTF=function(t){for(var e="",i=this._pos_+t,n=0,s=0,r=0,o=String.fromCharCode,a=this._u8d_,h=0;this._pos_<i;){n=a[this._pos_++];if(n<128)0!=n&&(e+=o(n));else if(n<224)e+=o((63&n)<<6|127&a[this._pos_++]);else if(n<240){s=a[this._pos_++];e+=o((31&n)<<12|(127&s)<<6|127&a[this._pos_++])}else{s=a[this._pos_++];r=a[this._pos_++];e+=o((15&n)<<18|(127&s)<<12|r<<6&127|127&a[this._pos_++])}h++}return e};e.getCustomString=function(t){for(var e="",i=0,n=0,s=0,r=String.fromCharCode,o=this._u8d_;t>0;){n=o[this._pos_];if(n<128){e+=r(n);this._pos_++;t--}else{i=n-128;this._pos_++;t-=i;for(;i>0;){n=o[this._pos_++];s=o[this._pos_++];e+=r(s<<8|n);i--}}}return e};e.clear=function(){this._pos_=0;this.length=0};e.__getBuffer=function(){return this._d_.buffer};e.writeUTFBytes=function(t){var e,i,n;t+="";for(e=0,i=t.length;e<i;e++){n=t.charCodeAt(e);if(n<=127)this.writeByte(n);else if(n<=2047){this.writeByte(192|n>>6);this.writeByte(128|63&n)}else if(n<=65535){this.writeByte(224|n>>12);this.writeByte(128|n>>6&63);this.writeByte(128|63&n)}else{this.writeByte(240|n>>18);this.writeByte(128|n>>12&63);this.writeByte(128|n>>6&63);this.writeByte(128|63&n)}}};e.writeUTFString=function(t){var e,i=0;i=this.pos;this.writeInt16(1);this.writeUTFBytes(t);e=0;e=this.pos-i-2;this._d_.setInt16(i,e,this._xd_)};e.readUTFString=function(){var t,e=0;e=this.pos;t=0;t=this.getInt16();return this.readUTFBytes(t)};e.readUTFBytes=function(t){void 0===t&&(t=-1);t=t>0?t:this.bytesAvailable;return this.rUTF(t)};e.writeByte=function(t){this.ensureWrite(this._pos_+1);this._d_.setInt8(this._pos_,t);this._pos_+=1};e.ensureWrite=function(t){this._length<t&&(this.length=t)};e.writeArrayBuffer=function(t,e,i){void 0===e&&(e=0);void 0===i&&(i=0);if(e<0||i<0)throw"writeArrayBuffer error - Out of bounds";0==i&&(i=t.byteLength-e);this.ensureWrite(this._pos_+i);var n=new Uint8Array(t);this._u8d_.set(n.subarray(e,e+i),this._pos_);this._pos_+=i};__getset(0,e,"buffer",function(){return this._u8d_.buffer});__getset(0,e,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function(t){this._xd_="littleEndian"==t});__getset(0,e,"bytesAvailable",function(){return this.length-this._pos_});__getset(0,e,"length",function(){return this._length},function(t){this._allocated_<t?this.___resizeBuffer(this._allocated_=Math.floor(Math.max(t,2*this._allocated_))):this._allocated_>t&&this.___resizeBuffer(this._allocated_=t);this._length=t});__getset(0,e,"pos",function(){return this._pos_},function(t){this._pos_=t;this._d_.byteOffset=t});t.getSystemEndian=function(){if(!t._sysEndian){var e=new ArrayBuffer(2);new DataView(e).setInt16(0,256,!0);t._sysEndian=256===new Int16Array(e)[0]?"littleEndian":"bigEndian"}return t._sysEndian};t.BIG_ENDIAN="bigEndian";t.LITTLE_ENDIAN="littleEndian";t._sysEndian=null;return t}();ClassUtils=function(){function t(){}__class(t,"laya.utils.ClassUtils");t.regClass=function(e,i){t._classMap[e]=i};t.getRegClass=function(e){return t._classMap[e]};t.getClass=function(e){var i=t._classMap[e]||e;return"string"==typeof i?Laya["__classmap"][i]:i};t.getInstance=function(e){var i=t.getClass(e);if(i)return new i;console.log("[error] Undefined class:",e);return null};t.createByJson=function(e,i,n){var s,r,o,a,h,l,u;"string"==typeof e&&(e=JSON.parse(e));s=e.props;if(!i){i=t.getInstance(s.runtime||e.type);if(!i)return null}r=e.child;if(r)for(o=0,a=r.length;o<a;o++){h=r[o];"render"===h.props.name&&i["_$set_itemRender"]?i.itemRender=h:i.addChild(t.createByJson(h,null,n))}for(l in s){u=s[l];"var"===l&&n?n[u]=i:i["_$set_"+l]?i[l]=u:i[l]&&(u instanceof Array?i[l].apply(i,u):i[l].call(i,u))}i["created"]&&i.created();return i};t._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",div:"laya.html.dom.HTMLDivElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",Sprite3D:"laya.d3.core.Sprite3D",Mesh:"laya.d3.core.mesh.Mesh",Sky:"laya.d3.core.sky.Sky"};return t}();Color=function(){function t(e){var i,n;this._color=[];if("string"==typeof e){this.strColor=e;null===e&&(e="#000000");"#"==e.charAt(0)&&(e=e.substr(1));i=this.numColor=parseInt(e,16);n=8==e.length;if(n){this._color=[parseInt(e.substr(0,2),16)/255,((16711680&i)>>16)/255,((65280&i)>>8)/255,(255&i)/255];return}}else{i=this.numColor=e;this.strColor=Utils.toHexColor(i)}this._color=[((16711680&i)>>16)/255,((65280&i)>>8)/255,(255&i)/255,1];this._color.__id=++t._COLODID}__class(t,"laya.utils.Color");t._initDefault=function(){t._DEFAULT={};for(var e in t._COLOR_MAP)t._SAVE[e]=t._DEFAULT[e]=new t(t._COLOR_MAP[e]);return t._DEFAULT};t._initSaveMap=function(){t._SAVE_SIZE=0;t._SAVE={};for(var e in t._DEFAULT)t._SAVE[e]=t._DEFAULT[e]};t.create=function(e){var i=t._SAVE[e+""];if(null!=i)return i;t._SAVE_SIZE<1e3||t._initSaveMap();return t._SAVE[e+""]=new t(e)};t._SAVE={};t._SAVE_SIZE=0;t._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"};t._DEFAULT=t._initDefault();t._COLODID=1;return t}();Dictionary=function(){function t(){this._elements=[];this._keys=[]}__class(t,"laya.utils.Dictionary");var e=t.prototype;e.set=function(t,e){var i=this.indexOf(t);if(i>=0)this._elements[i]=e;else{this._keys.push(t);this._elements.push(e)}};e.indexOf=function(t){var e=this._keys.indexOf(t);if(e>=0)return e;t="string"==typeof t?Number(t):"number"==typeof t?t.toString():t;return this._keys.indexOf(t)};e.get=function(t){var e=this.indexOf(t);return e<0?null:this._elements[e]};e.remove=function(t){var e=this.indexOf(t);if(e>=0){this._keys.splice(e,1);this._elements.splice(e,1);return!0}return!1};e.clear=function(){this._elements.length=0;this._keys.length=0};__getset(0,e,"elements",function(){return this._elements});__getset(0,e,"keys",function(){return this._keys});return t}();Dragging=function(){function t(){this.ratio=.92;this.maxOffset=60;this._dragging=!1;this._clickOnly=!0}__class(t,"laya.utils.Dragging");var e=t.prototype;e.start=function(t,e,i,n,s,r,o){this.clearTimer();this.target=t;this.area=e;this.hasInertia=i;this.elasticDistance=n;this.elasticBackTime=s;this.data=r;this._disableMouseEvent=o;this._clickOnly=!0;this._dragging=!0;this._elasticRateX=this._elasticRateY=1;this._lastX=Laya.stage.mouseX;this._lastY=Laya.stage.mouseY;Laya.stage.on("mouseup",this,this.onStageMouseUp);Laya.stage.on("mouseout",this,this.onStageMouseUp);Laya.timer.frameLoop(1,this,this.loop)};e.clearTimer=function(){Laya.timer.clear(this,this.loop);Laya.timer.clear(this,this.tweenMove);if(this._tween){this._tween.recover();this._tween=null}};e.stop=function(){if(this._dragging){MouseManager.instance.disableMouseEvent=!1;Laya.stage.off("mouseup",this,this.onStageMouseUp);Laya.stage.off("mouseout",this,this.onStageMouseUp);this._dragging=!1;this.target&&this.area&&this.backToArea();this.clear()}};e.loop=function(){var t=Laya.stage.mouseX,e=Laya.stage.mouseY,i=t-this._lastX,n=e-this._lastY;if(this._clickOnly){if(!(Math.abs(i*Laya.stage._canvasTransform.getScaleX())>1||Math.abs(n*Laya.stage._canvasTransform.getScaleY())>1))return;this._clickOnly=!1;this._offsets||(this._offsets=[]);this._offsets.length=0;this.target.event("dragstart",this.data);MouseManager.instance.disableMouseEvent=this._disableMouseEvent;this.target["$_MOUSEDOWN"]=!1}else{this._offsets.push(i,n);this._lastX=t;this._lastY=e}if(0!==i||0!==n){this.target.x+=i*this._elasticRateX;this.target.y+=n*this._elasticRateY;this.area&&this.checkArea();this.target.event("dragmove",this.data)}};e.checkArea=function(){var t,e;if(this.elasticDistance<=0)this.backToArea();else{t=this.target.x<this.area.x?this.area.x-this.target.x:this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;this._elasticRateX=Math.max(0,1-t/this.elasticDistance);e=this.target.y<this.area.y?this.area.y-this.target.y:this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-e/this.elasticDistance)}};e.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width);this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)};e.onStageMouseUp=function(t){var e,i,n,s;MouseManager.instance.disableMouseEvent=!1;Laya.stage.off("mouseup",this,this.onStageMouseUp);Laya.stage.off("mouseout",this,this.onStageMouseUp);Laya.timer.clear(this,this.loop);if(!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(Laya.stage.mouseX-this._lastX,Laya.stage.mouseY-this._lastY);this._offsetX=this._offsetY=0;e=this._offsets.length;i=Math.min(e,6);n=this._offsets.length-i;for(s=e-1;s>n;s--){this._offsetY+=this._offsets[s--];this._offsetX+=this._offsets[s]}this._offsetX=this._offsetX/i*2;this._offsetY=this._offsetY/i*2;Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=this._offsetX>0?this.maxOffset:-this.maxOffset);Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=this._offsetY>0?this.maxOffset:-this.maxOffset);Laya.timer.frameLoop(1,this,this.tweenMove)}else this.elasticDistance>0?this.checkElastic():this.clear()};e.checkElastic=function(){var t,e=NaN,i=NaN;this.target.x<this.area.x?e=this.area.x:this.target.x>this.area.x+this.area.width&&(e=this.area.x+this.area.width);this.target.y<this.area.y?i=this.area.y:this.target.y>this.area.y+this.area.height&&(i=this.area.y+this.area.height);if(isNaN(e)&&isNaN(i))this.clear();else{t={};isNaN(e)||(t.x=e);isNaN(i)||(t.y=i);this._tween=Tween.to(this.target,t,this.elasticBackTime,Ease.sineOut,Handler.create(this,this.clear),0,!1,!1)}};e.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX;this._offsetY*=this.ratio*this._elasticRateY;this.target.x+=this._offsetX;this.target.y+=this._offsetY;this.area&&this.checkArea();this.target.event("dragmove",this.data);if(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5){Laya.timer.clear(this,this.tweenMove);this.elasticDistance>0?this.checkElastic():this.clear()}};e.clear=function(){if(this.target){this.clearTimer();var t=this.target;this.target=null;t.event("dragend",this.data)}};return t}();Ease=function(){function t(){}__class(t,"laya.utils.Ease");t.linearNone=function(t,e,i,n){return i*t/n+e};t.linearIn=function(t,e,i,n){return i*t/n+e};t.linearInOut=function(t,e,i,n){return i*t/n+e};t.linearOut=function(t,e,i,n){return i*t/n+e};t.bounceIn=function(e,i,n,s){return n-t.bounceOut(s-e,0,n,s)+i};t.bounceInOut=function(e,i,n,s){return e<.5*s?.5*t.bounceIn(2*e,0,n,s)+i:.5*t.bounceOut(2*e-s,0,n,s)+.5*n+i};t.bounceOut=function(t,e,i,n){return(t/=n)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e};t.backIn=function(t,e,i,n,s){void 0===s&&(s=1.70158);return i*(t/=n)*t*((s+1)*t-s)+e};t.backInOut=function(t,e,i,n,s){void 0===s&&(s=1.70158);return(t/=.5*n)<1?.5*i*(t*t*(((s*=1.525)+1)*t-s))+e:i/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+e};t.backOut=function(t,e,i,n,s){void 0===s&&(s=1.70158);return i*((t=t/n-1)*t*((s+1)*t+s)+1)+e};t.elasticIn=function(e,i,n,s,r,o){void 0===r&&(r=0);void 0===o&&(o=0);var a;if(0==e)return i;if(1==(e/=s))return i+n;o||(o=.3*s);if(!r||n>0&&r<n||n<0&&r<-n){r=n;a=o/4}else a=o/t.PI2*Math.asin(n/r);return-(r*Math.pow(2,10*(e-=1))*Math.sin((e*s-a)*t.PI2/o))+i};t.elasticInOut=function(e,i,n,s,r,o){void 0===r&&(r=0);void 0===o&&(o=0);var a;if(0==e)return i;if(2==(e/=.5*s))return i+n;o||(o=s*(.3*1.5));if(!r||n>0&&r<n||n<0&&r<-n){r=n;a=o/4}else a=o/t.PI2*Math.asin(n/r);return e<1?-.5*(r*Math.pow(2,10*(e-=1))*Math.sin((e*s-a)*t.PI2/o))+i:r*Math.pow(2,-10*(e-=1))*Math.sin((e*s-a)*t.PI2/o)*.5+n+i};t.elasticOut=function(e,i,n,s,r,o){void 0===r&&(r=0);void 0===o&&(o=0);var a;if(0==e)return i;if(1==(e/=s))return i+n;o||(o=.3*s);if(!r||n>0&&r<n||n<0&&r<-n){r=n;a=o/4}else a=o/t.PI2*Math.asin(n/r);return r*Math.pow(2,-10*e)*Math.sin((e*s-a)*t.PI2/o)+n+i};t.strongIn=function(t,e,i,n){return i*(t/=n)*t*t*t*t+e};t.strongInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t*t*t+e:.5*i*((t-=2)*t*t*t*t+2)+e};t.strongOut=function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e};t.sineInOut=function(t,e,i,n){return.5*-i*(Math.cos(Math.PI*t/n)-1)+e};t.sineIn=function(e,i,n,s){return-n*Math.cos(e/s*t.HALF_PI)+n+i};t.sineOut=function(e,i,n,s){return n*Math.sin(e/s*t.HALF_PI)+i};t.quintIn=function(t,e,i,n){return i*(t/=n)*t*t*t*t+e};t.quintInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t*t*t+e:.5*i*((t-=2)*t*t*t*t+2)+e};t.quintOut=function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e};t.quartIn=function(t,e,i,n){return i*(t/=n)*t*t*t+e};t.quartInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t*t+e:.5*-i*((t-=2)*t*t*t-2)+e};t.quartOut=function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e};t.cubicIn=function(t,e,i,n){return i*(t/=n)*t*t+e};t.cubicInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t+e:.5*i*((t-=2)*t*t+2)+e};t.cubicOut=function(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e};t.QuadIn=function(t,e,i,n){return i*(t/=n)*t+e};t.QuadInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t+e:.5*-i*(--t*(t-2)-1)+e};t.QuadOut=function(t,e,i,n){return-i*(t/=n)*(t-2)+e};t.expoIn=function(t,e,i,n){return 0==t?e:i*Math.pow(2,10*(t/n-1))+e-.001*i};t.expoInOut=function(t,e,i,n){return 0==t?e:t==n?e+i:(t/=.5*n)<1?.5*i*Math.pow(2,10*(t-1))+e:.5*i*(-Math.pow(2,-10*--t)+2)+e};t.expoOut=function(t,e,i,n){return t==n?e+i:i*(-Math.pow(2,-10*t/n)+1)+e};t.circIn=function(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e};t.circInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*-i*(Math.sqrt(1-t*t)-1)+e:.5*i*(Math.sqrt(1-(t-=2)*t)+1)+e};t.circOut=function(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e};t.HALF_PI=.5*Math.PI;t.PI2=2*Math.PI;return t}();HTMLChar=function(){function t(e,i,n,s){this["char"]=e;this.charNum=e.charCodeAt(0);this._x=this._y=0;this.width=i;this.height=n;this.style=s;this.isWord=!t._isWordRegExp.test(e)}__class(t,"laya.utils.HTMLChar");var e=t.prototype;Laya.imps(e,{"laya.display.ILayout":!0});e.setSprite=function(t){this._sprite=t};e.getSprite=function(){return this._sprite};e._isChar=function(){return!0};e._getCSSStyle=function(){return this.style};__getset(0,e,"x",function(){return this._x},function(t){this._sprite&&(this._sprite.x=t);this._x=t});__getset(0,e,"y",function(){return this._y},function(t){this._sprite&&(this._sprite.y=t);this._y=t});__getset(0,e,"width",function(){return this._w},function(t){this._w=t});__getset(0,e,"height",function(){return this._h},function(t){this._h=t});t._isWordRegExp=new RegExp("[\\w.]","");return t}();LaterEvent=function(){function t(){}var e;__class(t,"laya.utils.LaterEvent");t.add=function(i,n,s,r){var o=t._cache._length?t._cache[--t._cache._length]:new e;o.caller=i;o.fun=n;o.args=s;o.msg=r;t._events[t._events._length++]=o};t.update=function(){var e,i,n,s;if(!(t._events.length<1)){e=t._events._length;i=Browser.now();for(n=0;n<e;n++){
s=t._events[n];s.fun.call(s.caller,s.args);t._cache[t._cache._length++]=s;if(Browser.now()-i>t.maxTimeOut){console.log("LaterEvent use long time:"+(Browser.now()-i)+")"+e+" "+s.msg);t._events.splice(0,n+1);t._events._length-=n+1;return}}if(e!=t._events._length){t._events.splice(0,e);t._events._length-=e}else t._events._length=0}};t._cache=(t._cache=[],t._cache._length=0,t._cache);t._events=(t._events=[],t._events._length=0,t._events);t.maxTimeOut=30;t.__init$=function(){e=function(){function t(){this.caller=null;this.fun=null;this.args=null;this.msg=null}__class(t,"");return t}()};return t}();Log=function(){function t(){}__class(t,"laya.utils.Log");t.start=function(){t._logdiv=Browser.window.document.createElement("div");Browser.window.document.body.appendChild(t._logdiv);t._logdiv.style.cssText="border:white;overflow:scroll;z-index:1000000;background:rgba(100,100,100,0.7);color:white;position: absolute;left:0px;top:0px;width:100%;height:50%";t._logdiv.onclick=function(){if(30==Laya.__parseInt(this.style.width)){this.style.width="100%";this.style.height="50%";this.style.overflow="scroll";this.style.background="rgba(100,100,100,0.7)"}else{this.style.width=this.style.height="30px";this.style.overflow="hidden";this.style.background="white"}}};t.print=function(e){t._logdiv&&(t._logdiv.innerText+=e+"\n")};t.enable=function(){return null!=t._logdiv};t._logdiv=null;return t}();Pool=function(){function t(){}__class(t,"laya.utils.Pool");t.getPoolBySign=function(e){return t._poolDic[e]||(t._poolDic[e]=[])};t.recover=function(e,i){if(!i["__InPool"]){i["__InPool"]=!0;t.getPoolBySign(e).push(i)}};t.getItemByClass=function(e,i){var n=t.getPoolBySign(e),s=n.length?n.pop():new i;s["__InPool"]=!1;return s};t.getItemByCreateFun=function(e,i){var n=t.getPoolBySign(e),s=n.length?n.pop():i();s["__InPool"]=!1;return s};t.getItem=function(e){var i=t.getPoolBySign(e),n=i.length?i.pop():null;n&&(n["__InPool"]=!1);return n};t._poolDic={};t.InPoolSign="__InPool";return t}();Stat=function(){function t(){}__class(t,"laya.utils.Stat");__getset(1,t,"onclick",null,function(e){t._canvas.source.onclick=e;t._canvas.source.style.pointerEvents=""});t.show=function(e,i){var n,s;void 0===e&&(e=0);void 0===i&&(i=0);t.preFrameTime=t._timer=Browser.now()-1e3;t._view[0]={title:"FPS(3D)",value:"_fpsStr",color:"yellow",units:"int"};t._view[1]={title:"Sprite",value:"spriteDraw",color:"white",units:"int"};t._view[2]={title:"DrawCall",value:"drawCall",color:"white",units:"int"};t._view[3]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};t._view[4]={title:"Shader",value:"shaderCall",color:"white",units:"int"};if(!Render.isWebGl){t._view[0].title="FPS(2D)";t._view.length=4}for(n=0;n<t._view.length;n++){t._view[n].x=4;t._view[n].y=12*n+2}t._height=12*t._view.length+4;if(!t._canvas){t._canvas=new HTMLCanvas("2D");t._canvas.size(t._width,t._height);t._ctx=t._canvas.getContext("2d");t._ctx.textBaseline="top";s=t._canvas.source;s.style.cssText="pointer-events:none;z-index:100000;position: absolute;left:"+e+"px;top:"+i+"px;width:"+t._width+"px;height:"+t._height+"px;"}Laya.timer.frameLoop(1,t,t.loop);Browser.document.body.appendChild(t._canvas.source)};t.hide=function(){var e=t._canvas.source;Browser.removeElement(e);Laya.timer.clear(t,t.loop)};t.clear=function(){t.trianglesFaces=0;t.drawCall=-6;t.shaderCall=0;t.spriteDraw=-1;t.bufferLen=0;t.canvasNormal=0;t.canvasBitmap=0;t.canvasReCache=0};t.loop=function(){var e,i,n,s,r,o;t._count++;e=Browser.now();t.interval=Browser.now()-t.preFrameTime;t.preFrameTime=e;if(e-t._timer<1e3)t.clear();else{t._count=Math.round(1e3*t._count/(e-t._timer));t.maxMemorySize=ResourceManager.systemResourceManager.autoReleaseMaxSize;t.currentMemorySize=ResourceManager.systemResourceManager.memorySize;t.texturesMemSize=0;t.buffersMemSize=0;for(i=0;i<Resource.getLoadedResourcesCount();i++){n=Resource.getLoadedResourceByIndex(i);n instanceof laya.resource.Bitmap&&(t.texturesMemSize+=n.memorySize)}t.FPS=t._count;t._fpsStr=t._count+(t.renderSlow?" slow":"");t._canvasStr=t.canvasReCache+"/"+t.canvasNormal+"/"+t.canvasBitmap;s=t._ctx;s.clearRect(0,0,t._width,t._height);s.fillStyle="rgba(50,50,60,0.8)";s.fillRect(0,0,t._width,t._height);for(i=0;i<t._view.length;i++){r=t._view[i];s.fillStyle="white";s.fillText(r.title,r.x,r.y);s.fillStyle=r.color;o=t[r.value];"M"==r.units&&(o=Math.floor(o/1048576*100)/100+" M");s.fillText(o+"",r.x+60,r.y)}t._count=0;t._timer=e;t.clear()}};t.loopCount=0;t.maxMemorySize=0;t.currentMemorySize=0;t.texturesMemSize=0;t.buffersMemSize=0;t.shaderCall=0;t.drawCall=-6;t.trianglesFaces=0;t.spriteDraw=0;t.FPS=0;t.canvasNormal=0;t.canvasBitmap=0;t.canvasReCache=0;t.interval=0;t.preFrameTime=0;t.bufferLen=0;t.renderSlow=!1;t._fpsStr=null;t._canvasStr=null;t._canvas=null;t._ctx=null;t._timer=NaN;t._count=0;t._width=120;t._height=100;t._view=[];return t}();StringKey=function(){function t(){this._strs={};this._length=0}__class(t,"laya.utils.StringKey");var e=t.prototype;e.add=function(t){var e=this._strs[t];return null!=e?e:this._strs[t]=this._length++};e.get=function(t){var e=this._strs[t];return null==e?-1:e};return t}();Timer=function(){function t(){this.scale=1;this.currFrame=0;this._mid=1;this._map=[];this._laters=[];this._handlers=[];this._temp=[];this._pool=[];this._count=0;this.currTimer=Browser.now();this._lastTimer=Browser.now();Laya.timer&&Laya.timer.frameLoop(1,this,this._update)}var e,i;__class(t,"laya.utils.Timer");i=t.prototype;i._update=function(){var e,i,n,s,r,o,a,h,l;if(this.scale<=0)this._lastTimer=Browser.now();else{e=this.currFrame=this.currFrame+this.scale;i=Browser.now();t.DELTA=i-this._lastTimer;n=this.currTimer=this.currTimer+t.DELTA*this.scale;this._lastTimer=i;s=this._handlers;this._count=0;for(a=0,h=s.length;a<h;a++){l=s[a];if(null!==l.method){r=l.userFrame?e:n;if(r>=l.exeTime)if(l.repeat){if(r>l.exeTime){l.exeTime+=l.delay;l.run(!1);r>=l.exeTime&&(l.exeTime+=Math.ceil((r-l.exeTime)/l.delay)*l.delay)}}else l.run(!0)}else this._count++}(this._count>30||e%200===0)&&this._clearHandlers();o=this._laters;for(a=0,h=o.length-1;a<=h;a++){l=o[a];null!==l.method&&l.run(!1);this._recoverHandler(l);a===h&&(h=o.length-1)}o.length=0}};i._clearHandlers=function(){var t,e,i,n=this._handlers;for(t=0,e=n.length;t<e;t++){i=n[t];null!==i.method?this._temp.push(i):this._recoverHandler(i)}this._handlers=this._temp;this._temp=n;this._temp.length=0};i._recoverHandler=function(t){t.clear();this._map[t.key]=null;this._pool.push(t)};i._create=function(t,i,n,s,r,o,a){if(n){if(a){var h=this._getHandler(s,r);if(h){h.repeat=i;h.userFrame=t;h.delay=n;h.caller=s;h.method=r;h.args=o;h.exeTime=n+(t?this.currFrame:this.currTimer);return}}h=this._pool.length>0?this._pool.pop():new e;h.repeat=i;h.userFrame=t;h.delay=n;h.caller=s;h.method=r;h.args=o;h.exeTime=n+(t?this.currFrame:this.currTimer);this._indexHandler(h);this._handlers.push(h)}else r.apply(s,o)};i._indexHandler=function(t){var e=t.caller,i=t.method,n=e?e.$_GID||(e.$_GID=Utils.getGID()):0,s=i.$_TID||(i.$_TID=1e5*this._mid++);t.key=n+s;this._map[t.key]=t};i.once=function(t,e,i,n,s){void 0===s&&(s=!0);this._create(!1,!1,t,e,i,n,s)};i.loop=function(t,e,i,n,s){void 0===s&&(s=!0);this._create(!1,!0,t,e,i,n,s)};i.frameOnce=function(t,e,i,n,s){void 0===s&&(s=!0);this._create(!0,!1,t,e,i,n,s)};i.frameLoop=function(t,e,i,n,s){void 0===s&&(s=!0);this._create(!0,!0,t,e,i,n,s)};i.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+this._pool.length};i.clear=function(t,e){var i=this._getHandler(t,e);if(i){this._map[i.key]=null;i.key=0;i.clear()}};i.clearAll=function(t){var e,i,n;for(e=0,i=this._handlers.length;e<i;e++){n=this._handlers[e];if(n.caller===t){this._map[n.key]=null;n.key=0;n.clear()}}};i._getHandler=function(t,e){var i=t?t.$_GID||(t.$_GID=Utils.getGID()):0,n=e.$_TID||(e.$_TID=1e5*this._mid++);return this._map[i+n]};i.callLater=function(t,i,n){if(null==this._getHandler(t,i)){if(this._pool.length)var s=this._pool.pop();else s=new e;s.caller=t;s.method=i;s.args=n;this._indexHandler(s);this._laters.push(s)}};i.runCallLater=function(t,e){var i=this._getHandler(t,e);if(i&&null!=i.method){i.run(!0);this._map[i.key]=null}};t.DELTA=0;t.__init$=function(){e=function(){function t(){this.key=0;this.repeat=!1;this.delay=0;this.userFrame=!1;this.exeTime=0;this.caller=null;this.method=null;this.args=null}__class(t,"");var e=t.prototype;e.clear=function(){this.caller=null;this.method=null;this.args=null};e.run=function(t){var e,i,n=this.caller;if(n&&n.destroyed)return this.clear();e=this.method;i=this.args;t&&this.clear();null!=e&&(i?e.apply(n,i):e.call(n))};return t}()};return t}();Tween=function(){function t(){this.gid=0}__class(t,"laya.utils.Tween");var e=t.prototype;e.to=function(t,e,i,n,s,r,o){void 0===r&&(r=0);void 0===o&&(o=!1);return this._create(t,e,i,n,s,r,o,!0,!1,!0)};e.from=function(t,e,i,n,s,r,o){void 0===r&&(r=0);void 0===o&&(o=!1);return this._create(t,e,i,n,s,r,o,!1,!1,!0)};e._create=function(e,i,n,s,r,o,a,h,l,u){if(!e)throw new Error("Tween:target is null");this._target=e;this._duration=n;this._ease=s||t.easeNone;this._complete=r;this._delay=o;this._props=[];this._usedTimer=0;this._startTimer=Browser.now();this._usedPool=l;var c=e.$_GID||(e.$_GID=Utils.getGID());if(t.tweenMap[c]){a&&t.clearTween(e);t.tweenMap[c].push(this)}else t.tweenMap[c]=[this];u?o<=0?this.firstStart(e,i,h):Laya.timer.once(o,this,this.firstStart,[e,i,h]):this._initProps(e,i,h);return this};e.firstStart=function(t,e,i){this._initProps(t,e,i);this._beginLoop()};e._initProps=function(t,e,i){var n,s,r;for(n in e)if("number"==typeof t[n]){s=i?t[n]:e[n];r=i?e[n]:t[n];this._props.push([n,s,r-s])}};e._beginLoop=function(){Laya.timer.frameLoop(1,this,this._doEase)};e._doEase=function(){this.updateEase(Browser.now())};e.updateEase=function(e){var i,n,s,r,o,a,h=this._target;if(h.destroyed)return t.clearTween(h);i=this._usedTimer=e-this._startTimer-this._delay;if(!(i<0)){if(i>=this._duration)return this.complete();n=i>0?this._ease(i,0,1,this._duration):0;s=this._props;for(r=0,o=s.length;r<o;r++){a=s[r];h[a[0]]=a[1]+n*a[2]}}};e.complete=function(){var t,e,i,n,s,r;if(this._target){t=this._target;e=this._props;i=this._complete;this.clear();for(n=0,s=e.length;n<s;n++){r=e[n];t[r[0]]=r[1]+r[2]}i&&i.run()}};e.pause=function(){Laya.timer.clear(this,this._beginLoop);Laya.timer.clear(this,this._doEase)};e.setStartTime=function(t){this._startTimer=t};e.clear=function(){if(this._target){this._remove();this._clear()}};e._clear=function(){this.pause();Laya.timer.clear(this,this.firstStart);this._complete=null;this._target=null;this._ease=null;this._props=null;this._usedPool&&Pool.recover("tween",this)};e.recover=function(){this._usedPool=!0;this._clear()};e._remove=function(){var e,i,n=t.tweenMap[this._target.$_GID];if(n)for(e=0,i=n.length;e<i;e++)if(n[e]===this){n.splice(e,1);break}};e.restart=function(){var t,e,i,n;this.pause();this._usedTimer=0;this._startTimer=Browser.now();t=this._props;for(e=0,i=t.length;e<i;e++){n=t[e];this._target[n[0]]=n[1]}Laya.timer.once(this._delay,this,this._beginLoop)};e.resume=function(){if(!(this._usedTimer>=this._duration)){this._startTimer=Browser.now()-this._usedTimer-this._delay;this._beginLoop()}};t.to=function(e,i,n,s,r,o,a,h){void 0===o&&(o=0);void 0===a&&(a=!1);void 0===h&&(h=!0);return Pool.getItemByClass("tween",t)._create(e,i,n,s,r,o,a,!0,h,!0)};t.from=function(e,i,n,s,r,o,a,h){void 0===o&&(o=0);void 0===a&&(a=!1);void 0===h&&(h=!0);return Pool.getItemByClass("tween",t)._create(e,i,n,s,r,o,a,!1,h,!0)};t.clearAll=function(e){var i,n,s;if(e&&e.$_GID){i=t.tweenMap[e.$_GID];if(i){for(n=0,s=i.length;n<s;n++)i[n]._clear();i.length=0}}};t.clear=function(t){t.clear()};t.clearTween=function(e){t.clearAll(e)};t.easeNone=function(t,e,i,n){return i*t/n+e};t.tweenMap={};return t}();Utils=function(){function t(){}__class(t,"laya.utils.Utils");t.toRadian=function(e){return e*t._pi2};t.toAngle=function(e){return e*t._pi};t.toHexColor=function(t){if(t<0||isNaN(t))return null;for(var e=t.toString(16);e.length<6;)e="0"+e;return"#"+e};t.getGID=function(){return t._gid++};t.parseXMLFromString=function(t){var e;e=(new DOMParser).parseFromString(t,"text/xml");return e};t.preFixNumber=function(t,e){return("0000000000"+t).slice(-e)};t.concatArr=function(t,e){if(!e)return t;if(!t)return e;var i=0,n=e.length;for(i=0;i<n;i++)t.push(e[i]);return t};t.clearArr=function(t){if(!t)return t;t.length=0;return t};t.setValueArr=function(e,i){e||(e=[]);e.length=0;return t.concatArr(e,i)};t.getFrom=function(t,e,i){var n=0;for(n=0;n<i;n++)t.push(e[n]);return t};t.getFromR=function(t,e,i){var n=0;for(n=0;n<i;n++)t.push(e.pop());return t};t.getGlobalRec=function(e){return t.getGlobalRecByPoints(e,0,0,e.width,e.height)};t.getGlobalRecByPoints=function(t,e,i,n,s){var r,o,a=new Point(e,i);a=t.localToGlobal(a);r=new Point(n,s);r=t.localToGlobal(r);o=Rectangle._getWrapRec([a.x,a.y,r.x,r.y]);return o};t.getGlobalPosAndScale=function(e){return t.getGlobalRecByPoints(e,0,0,1,1)};t.enableDisplayTree=function(t){for(;t;){t.mouseEnabled=!0;t=t.parent}};t.bind=function(t,e){var i;i=t.bind(e);return i};t.copyFunction=function(t,e,i){for(var n in t)!i&&e[n]||(e[n]=t[n])};t.measureText=function(e,i){if(null==t._charSizeTestDiv){t._charSizeTestDiv=Browser.createElement("div");t._charSizeTestDiv.style.cssText="z-index:10000000;padding:0px;position: absolute;left:0px;visibility:hidden;top:0px;background:white";Browser.document.body.appendChild(t._charSizeTestDiv)}t._charSizeTestDiv.style.font=i;t._charSizeTestDiv.innerText=" "==e?"i":e;var n={width:t._charSizeTestDiv.offsetWidth,height:t._charSizeTestDiv.offsetHeight};return n};t.regClass=function(e,i){t._systemClass[e]=i};t.New=function(e){e=t._systemClass[e]||e;return new Laya.__classmap[e]};t.updateOrder=function(t){var e,i,n,s,r,o,a,h,l;if(t.length<2)return!1;e=t[0];i=1,n=t.length;s=e._zOrder,r=NaN,o=NaN,a=NaN,h=NaN;l=!1;for(i=1;i<n;i++){e=t[i];if(e){(s=e._zOrder)<0&&(s=e._zOrder);if(s<t[i-1]._zOrder){a=r=0;o=i-1;for(;r<=o;){a=r+o>>>1;if(!t[a])break;h=t[a]._zOrder;h<0&&(h=t[a]._zOrder);if(h<s)r=a+1;else{if(!(h>s))break;o=a-1}}s>t[a]._zOrder&&a++;t.splice(i,1);t.splice(a,0,e);l=!0}}}return l};t.attachAllClassTimeDelay=function(e,i){var n,s,r,o,a;t._attachAllClassTimeDelay=e;n=Laya["__classmap"];s=((i?i.join("%"):"")+"%Laya%laya.ui.%laya.utils.Log%laya2.display%laya.utils2%laya.asyn%laya.display.css%laya.maths%laya.utils").split("%");r=0,o=s.length;for(a in n)if(!(a.indexOf(".")<0)){for(r=0;r<o;r++)if(0==a.indexOf(s[r])){r=-1;break}r>0&&t.attachClassTimeDelay(n[a],a,e)}};t.transPointList=function(t,e,i){var n=0,s=t.length;for(n=0;n<s;n+=2){t[n]+=e;t[n+1]+=i}};t.attachClassTimeDelay=function(t,e,i){var n,s,r;for(n in t)if(null==t["_$GET_"+n]&&"_"!=n.charAt(0)){s=t[n];"function"==typeof s&&(t[n]=function(t,e,i,n,s){return function(){var r=Browser.now(),o=n.apply(t,arguments);Browser.now()-r>s&&Log.print("static prototype delay: "+e+"."+i+" "+(Browser.now()-r));return o}}(t,e,n,s,i))}r=t.prototype;for(n in r)if(null==r["_$get_"+n]&&"_"!=n.charAt(0)){s=r[n];if("function"==typeof s&&!s.__ISCHECK){s.__ISCHECK=!0;r[n]=function(t,e,i,n,s){return function(){var t=Browser.now(),r=n.apply(this,arguments);Browser.now()-t>s&&Log.print("prototype delay:"+e+"."+i+" "+(Browser.now()-t));return r}}(t,e,n,s,i);r[n].__ISCHECK=!0}}};t._gid=1;t._pi=180/Math.PI;t._pi2=Math.PI/180;t._charSizeTestDiv=null;t._systemClass={Sprite:"laya.display.Sprite",Sprite3D:"laya.d3.display.Sprite3D",Mesh:"laya.d3.display.Mesh",Sky:"laya.d3.display.Sky",div:"laya.html.dom.HTMLDivElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"};t._attachAllClassTimeDelay=-1;return t}();Node=function(t){function e(){this.name="";this.destroyed=!1;this._displayInStage=!1;this._parent=null;this._privates=null;e.__super.call(this);this._childs=e.ARRAY_EMPTY;this.timer=Laya.timer}__class(e,"laya.display.Node",t);var i=e.prototype;i.destroy=function(t){void 0===t&&(t=!0);this.destroyed=!0;this._parent&&this._parent.removeChild(this);this._childs&&(t?this.destroyChildren():this.removeChildren());this._childs=null;this._privates&&(this._privates=null);this.offAll()};i.destroyChildren=function(){if(this._childs)for(var t=this._childs.length-1;t>-1;t--)this._childs[t].destroy(!0)};i.addChild=function(t){if(t===this)return t;if(t._parent===this){this._childs.splice(this.getChildIndex(t),1);this._childs.push(t);this.childChanged()}else{t.parent&&t.parent.removeChild(t);this._childs===e.ARRAY_EMPTY&&(this._childs=[]);this._childs.push(t);t.parent=this}return t};i.addChildren=function(t){for(var e=arguments,i=0,n=e.length;i<n;)this.addChild(e[i++])};i.addChildAt=function(t,i){if(t===this)return t;if(i>=0&&i<=this._childs.length){if(t._parent===this){this._childs.splice(this.getChildIndex(t),1);this._childs.splice(i,0,t);this.childChanged()}else{t.parent&&t.parent.removeChild(t);this._childs===e.ARRAY_EMPTY&&(this._childs=[]);this._childs.splice(i,0,t);t.parent=this}return t}throw new Error("appendChildAt:The index is out of bounds")};i.getChildIndex=function(t){return this._childs.indexOf(t)};i.getChildByName=function(t){var e,i,n,s=this._childs;for(e=0,i=s.length;e<i;e++){n=s[e];if(n.name===t)return n}return null};i.getPrivates=function(){return this._privates};i.getChildAt=function(t){return this._childs[t]};i.setChildIndex=function(t,e){var i,n=this._childs;if(e<0||e>=n.length)throw new Error("setChildIndex:The index is out of bounds.");i=this.getChildIndex(t);n.splice(i,1);n.splice(e,0,t);this.childChanged();return t};i.childChanged=function(t){};i.removeChild=function(t){if(!this._childs)return t;var e=this._childs.indexOf(t);return this.removeChildAt(e)};i.removeSelf=function(){this._parent&&this._parent.removeChild(this);return this};i.removeChildByName=function(t){var e=this.getChildByName(t);e&&this.removeChild(e);return e};i.removeChildAt=function(t){var e=this.getChildAt(t);if(e){this._childs.splice(t,1);e.parent=null}return e};i.removeChildren=function(t,i){var n,s,r,o;void 0===t&&(t=0);void 0===i&&(i=2147483647);if(this._childs.length>0){n=this._childs;if(0===t&&i>=o){s=n;this._childs=e.ARRAY_EMPTY}else s=n.splice(t,i-t);for(r=0,o=s.length;r<o;r++)s[r].parent=null}return this};i.replaceChild=function(t,e){var i=this._childs.indexOf(e);if(i>-1){this._childs.splice(i,1,t);e.parent=null;t.parent=this;return t}return null};i._setDisplay=function(t){if(this._displayInStage!==t){this._displayInStage=t;t?this.event("display"):this.event("undisplay")}};i._displayChild=function(t,e){var i,n,s;t._setDisplay(e);i=t._childs;if(i)for(n=i.length-1;n>-1;n--){s=i[n];s._setDisplay(e);s.numChildren&&this._displayChild(s,e)}};i.ask=function(t,e){return 1==t?1==e:!1};i.contains=function(t){if(t===this)return!0;for(;t;){if(t.parent===this.parent)return!0;t=t.parent}return!1};i.timerLoop=function(t,e,i,n,s){void 0===s&&(s=!1);this.timer._create(!1,!0,t,e,i,n,s)};i.timerOnce=function(t,e,i,n,s){void 0===s&&(s=!1);this.timer._create(!1,!1,t,e,i,n,s)};i.frameLoop=function(t,e,i,n,s){void 0===s&&(s=!1);this.timer._create(!0,!0,t,e,i,n,s)};i.frameOnce=function(t,e,i,n,s){void 0===s&&(s=!1);this.timer._create(!0,!1,t,e,i,n,s)};i.clearTimer=function(t,e){this.timer.clear(t,e)};__getset(0,i,"numChildren",function(){return this._childs.length});__getset(0,i,"parent",function(){return this._parent},function(t){if(this._parent!==t)if(t){this._parent=t;this.event("added");t.displayInStage&&this._displayChild(this,!0);t.childChanged(this)}else{this.event("removed");this._parent.childChanged();this._displayChild(this,!1);this._parent=t}});__getset(0,i,"displayInStage",function(){return this._displayInStage});e.ASK_CLASS=1;e.ASK_VALUE_NODE=1;e.ASK_VALUE_SPRITE=2;e.ASK_VALUE_HTMLELEMENT=3;e.ASK_VALUE_SPRITE3D=100;e.ARRAY_EMPTY=[];return e}(EventDispatcher);CSSStyle=function(t){function e(t){this._bgground=null;this._border=null;this._rect=null;this.lineHeight=0;e.__super.call(this);this._padding=e._PADDING;this._spacing=e._SPACING;this._aligns=e._ALIGNS;this._font=Font.EMPTY;this._ower=t}__class(e,"laya.display.css.CSSStyle",t);var i=e.prototype;i.destroy=function(){this._ower=null;this._font=null;this._rect=null};i.inherit=function(t){this._font=t._font;this._spacing=t._spacing===e._SPACING?e._SPACING:t._spacing.slice();this.lineHeight=t.lineHeight};i._widthAuto=function(){return 0!==(262144&this._type)};i.widthed=function(t){return 0!=(8&this._type)};i._calculation=function(t,e){function i(t,e,i){return t*i[0]+e*i[1]+i[2]}function n(t){var e=r.width,n=s.width;o.width&&(s.width=i(e,n,o.width));o.height&&(s.height=i(e,n,o.height));o.left&&(s.x=i(e,n,o.left));o.top&&(s.y=i(e,n,o.top))}var s,r,o,a;if(e.indexOf("%")<0)return!1;s=this._ower;r=s.parent;o=this._rect;if(null===o){r._getCSSStyle()._type|=524288;r.on("resize",this,n);this._rect=o={input:{}}}a=e.split(" ");a[0]=parseFloat(a[0])/100;if(1==a.length)a[1]=a[2]=0;else{a[1]=parseFloat(a[1])/100;a[2]=parseFloat(a[2])}o[t]=a;o.input[t]=e;n(t);return!0};i.heighted=function(t){return 0!=(8192&this._type)};i.size=function(t,e){var i=this._ower,n=!1;if(-1!==t&&t!=this._ower.width){this._type|=8;this._ower.width=t;n=!0}if(-1!==e&&e!=this._ower.height){this._type|=8192;this._ower.height=e;n=!0}if(n){i.layoutLater();524288&this._type&&i.event("resize",this)}};i._getAlign=function(){return this._aligns[0]};i._getValign=function(){return this._aligns[1]};i._getCssFloat=function(){return 0!=(32768&this._type)?32768:0};i._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new Font(this._font))};i.render=function(t,e,i,n){var s=t.width,r=t.height;this._bgground&&null!=this._bgground.color&&e.ctx.fillRect(i,n,s,r,this._bgground.color);this._border&&this._border.color&&e.drawRect(i,n,s,r,this._border.color.strColor,this._border.size)};i.getCSSStyle=function(){return this};i.cssText=function(t){this.attrs(e.parseOneCSS(t,";"))};i.attrs=function(t){var e,i,n;if(t)for(e=0,i=t.length;e<i;e++){n=t[e];this[n[0]]=n[1]}};i.translate=function(t,e){this._tf===Style._TF_EMPTY&&(this._tf=Style._createTransform());this._tf.translateX=t;this._tf.translateY=e};i.scale=function(t,e){this._tf===Style._TF_EMPTY&&(this._tf=Style._createTransform());this._tf.scaleX=t;this._tf.scaleY=e};i._enableLayout=function(){return 0===(2&this._type)&&0===(4&this._type)};__getset(0,i,"align",function(){return e._aligndef[this._aligns[0]]},function(t){this._aligns===e._ALIGNS&&(this._aligns=[0,0,0]);this._aligns[0]=e._aligndef[t]});__getset(0,i,"paddingTop",function(){return this.padding[0]});__getset(0,i,"block",t.prototype._$get_block,function(t){t?this._type|=1:this._type&=-2});__getset(0,i,"padding",function(){return this._padding},function(t){this._padding=t});__getset(0,i,"width",null,function(t){this._type|=8;if("string"==typeof t){var e=t.indexOf("auto");if(e>=0){this._type|=262144;t=t.substr(0,e)}if(this._calculation("width",t))return;t=Laya.__parseInt(t)}this.size(t,-1)});__getset(0,i,"height",null,function(t){this._type|=8192;if("string"==typeof t){if(this._calculation("height",t))return;t=Laya.__parseInt(t)}this.size(-1,t)});__getset(0,i,"_scale",null,function(t){this._ower.scale(t[0],t[1])});__getset(0,i,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left"},function(t){this.lineElement=!1;"right"===t?this._type|=32768:this._type&=-32769});__getset(0,i,"font",function(){return this._font.toString()},function(t){this._createFont().set(t)});__getset(0,i,"lineElement",function(){return 0!=(65536&this._type)},function(t){t?this._type|=65536:this._type&=-65537});__getset(0,i,"valign",function(){return e._valigndef[this._aligns[1]]},function(t){this._aligns===e._ALIGNS&&(this._aligns=[0,0,0]);this._aligns[1]=e._valigndef[t]});__getset(0,i,"border",function(){return this._border?this._border.value:""},function(t){var e,i;if("none"!=t){this._border||(this._border={});this._border.value=t;e=t.split(" ");this._border.color=Color.create(e[e.length-1]);if(1!=e.length){i=0;if(e[0].indexOf("px")>0){this._border.size=Laya.__parseInt(e[0]);i++}else this._border.size=1;this._border.type=e[i];this._ower._renderType|=128}else{this._border.size=1;this._border.type="solid"}}else this._border=null});__getset(0,i,"leading",function(){return this._spacing[1]},function(t){"string"==typeof t&&(t=Laya.__parseInt(t+""));this._spacing===e._SPACING&&(this._spacing=[0,0]);this._spacing[1]=t});__getset(0,i,"left",null,function(t){var e=this._ower;if("string"==typeof t){"center"===t?t="50% -50% 0":"right"===t&&(t="100% -100% 0");if(this._calculation("left",t))return;t=Laya.__parseInt(t)}e.x=t});__getset(0,i,"position",function(){return 4&this._type?"absolute":""},function(t){"absolute"==t?this._type|=4:this._type&=-5});__getset(0,i,"top",null,function(t){var e=this._ower;if("string"==typeof t){"middle"===t?t="50% -50% 0":"bottom"===t&&(t="100% -100% 0");if(this._calculation("top",t))return;t=Laya.__parseInt(t)}e.y=t});__getset(0,i,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function(t){"nowrap"===t&&(this._type|=131072);"none"===t&&(this._type&=-131073)});__getset(0,i,"wordWrap",function(){return 0===(131072&this._type)},function(t){t?this._type&=-131073:this._type|=131072});__getset(0,i,"bold",function(){return this._font.bold},function(t){this._createFont().bold=t});__getset(0,i,"password",function(){return this._font.password},function(t){this._createFont().password=t});__getset(0,i,"weight",null,function(t){this._createFont().weight=t});__getset(0,i,"letterSpacing",function(){return this._spacing[0]},function(t){"string"==typeof t&&(t=Laya.__parseInt(t+""));this._spacing===e._SPACING&&(this._spacing=[0,0]);this._spacing[0]=t});__getset(0,i,"fontSize",function(){return this._font.size},function(t){this._createFont().size=t});__getset(0,i,"italic",function(){return this._font.italic},function(t){this._createFont().italic=t});__getset(0,i,"fontFamily",function(){return this._font.family},function(t){this._createFont().family=t});__getset(0,i,"fontWeight",function(){return this._font.weight},function(t){this._createFont().weight=t});__getset(0,i,"textDecoration",function(){return this._font.decoration},function(t){this._createFont().decoration=t});__getset(0,i,"color",function(){return this._font.color},function(t){this._createFont().color=t});__getset(0,i,"strokeColor",function(){return this._font.stroke[1]},function(t){this._createFont().stroke===Font._STROKE&&(this._font.stroke=[0,"#000000"]);this._font.stroke[1]=t});__getset(0,i,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null},function(t){this._border||(this._border={size:1,type:"solid"});this._border.color=null==t?null:Color.create(t);this._ower._renderType|=128});__getset(0,i,"stroke",function(){return this._font.stroke[0]},function(t){this._createFont().stroke===Font._STROKE&&(this._font.stroke=[0,"#000000"]);this._font.stroke[0]=t});__getset(0,i,"backgroundColor",function(){return this._bgground?this._bgground.color:""},function(t){"none"===t?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=t);this._ower._renderType|=128});__getset(0,i,"absolute",function(){return 0!==(4&this._type)});__getset(0,i,"background",null,function(t){this._bgground||(this._bgground={});this._bgground.color=t;this._type|=16384;this._ower._renderType|=128});__getset(0,i,"paddingLeft",function(){return this.padding[3]});__getset(0,i,"display",null,function(t){switch(t){case"":this._type&=-3;this.visible=!0;break;case"none":this._type|=2;this.visible=!1;this._ower.layoutLater()}});__getset(0,i,"transform",t.prototype._$get_transform,function(t){"none"===t?this._tf=Style._TF_EMPTY:this.attrs(e.parseOneCSS(t,","))});__getset(0,i,"_translate",null,function(t){this.translate(t[0],t[1])});__getset(0,i,"_rotate",null,function(t){this._ower.rotation=t});e.parseOneCSS=function(t,i){var n,s,r,o,a,h,l,u,c=[],_=t.split(i);for(s=0,r=_.length;s<r;s++){o=_[s];a=o.indexOf(":");h=o.substr(0,a).replace(/^\s+|\s+$/g,"");l=o.substr(a+1).replace(/^\s+|\s+$/g,"");u=[h,l];switch(h){case"italic":case"bold":u[1]="true"==l;break;case"line-height":u[0]="lineHeight";u[1]=Laya.__parseInt(l);break;case"font-size":u[0]="fontSize";u[1]=Laya.__parseInt(l);break;case"padding":n=l.split(" ");n.length>1||(n[1]=n[2]=n[3]=n[0]);u[1]=[Laya.__parseInt(n[0]),Laya.__parseInt(n[1]),Laya.__parseInt(n[2]),Laya.__parseInt(n[3])];break;case"rotate":u[0]="_rotate";u[1]=parseFloat(l);break;case"scale":n=l.split(" ");u[0]="_scale";u[1]=[parseFloat(n[0]),parseFloat(n[1])];break;case"translate":n=l.split(" ");u[0]="_translate";u[1]=[Laya.__parseInt(n[0]),Laya.__parseInt(n[1])];break;default:(u[0]=e._CSSTOVALUE[h])||(u[0]=h)}c.push(u)}return c};e.parseCSS=function(t,i){for(var n;null!=(n=e._parseCSSRegExp.exec(t));)e.styleSheets[n[1]]=e.parseOneCSS(n[2],";")};e.EMPTY=new e(null);e._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor","float":"cssFloat"};e._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g");e._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"};e._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"};e.styleSheets={};e.ALIGN_CENTER=1;e.ALIGN_RIGHT=2;e.VALIGN_MIDDLE=1;e.VALIGN_BOTTOM=2;e._CSS_BLOCK=1;e._DISPLAY_NONE=2;e._ABSOLUTE=4;e._WIDTH_SET=8;e._PADDING=[0,0,0,0];e._RECT=[-1,-1,-1,-1];e._SPACING=[0,0];e._ALIGNS=[0,0,0];e.ADDLAYOUTED=512;e._NEWFONT=4096;e._HEIGHT_SET=8192;e._BACKGROUND_SET=16384;e._FLOAT_RIGHT=32768;e._LINE_ELEMENT=65536;e._NOWARP=131072;e._WIDTHAUTO=262144;e._LISTERRESZIE=524288;return e}(Style);AudioSound=function(t){function e(){this.url=null;this.audio=null;this.loaded=!1;e.__super.call(this)}__class(e,"laya.media.h5audio.AudioSound",t);var i=e.prototype;i.dispose=function(){var t=e._audioCache[this.url];if(t){t.src="";delete e._audioCache[this.url]}};i.load=function(t){function i(){s();o.loaded=!0;o.event("complete")}function n(){s();o.event("error")}function s(){r.removeEventListener("canplaythrough",i);r.removeEventListener("error",n)}var r,o;this.url=t;r=e._audioCache[t];if(r&&r.readyState>=2)this.event("complete");else{if(!r){r=Browser.createElement("audio");r.src=t;e._audioCache[t]=r}r.addEventListener("canplaythrough",i);r.addEventListener("error",n);o=this;this.audio=r;r.load()}};i.play=function(t,i){var n,s,r;void 0===t&&(t=0);void 0===i&&(i=0);if(!this.url)return null;n=e._audioCache[this.url];if(!n)return null;n.autoplay=!0;s=Pool.getItem("audio:"+this.url);s=s?s:n.cloneNode(!0);r=new AudioSoundChannel(s);r.url=this.url;r.loops=i;r.startTime=t;r.play();SoundManager.addChannel(r);return r};e._audioCache={};return e}(EventDispatcher);SoundChannel=function(t){function e(){this.url=null;this.loops=0;this.startTime=NaN;this.isStopped=!1;this.completeHandler=null;e.__super.call(this)}__class(e,"laya.media.SoundChannel",t);var i=e.prototype;i.play=function(){};i.stop=function(){};__getset(0,i,"volume",function(){return 1},function(t){});__getset(0,i,"position",function(){return 0});return e}(EventDispatcher);Sound=function(t){function e(){e.__super.call(this)}__class(e,"laya.media.Sound",t);var i=e.prototype;i.load=function(t){};i.play=function(t,e){void 0===t&&(t=0);void 0===e&&(e=0);return null};i.dispose=function(){};return e}(EventDispatcher);ColorFilter=function(t){function e(t){e.__super.call(this);if(t){this._elements=new Float32Array(20);for(var i=0;i<20;i++)this._elements[i]=t[i];this._action=System.createFilterAction(32);this._action.data=this}else this._elements=e.DEFAULT._elements}__class(e,"laya.filters.ColorFilter",t);var i=e.prototype;Laya.imps(i,{"laya.filters.IFilter":!0
});__getset(0,i,"type",function(){return 32});__getset(0,i,"action",function(){return this._action});__static(e,["DEFAULT",function(){return this.DEFAULT=new e([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])},"GRAY",function(){return this.GRAY=new e([.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0])}]);return e}(Filter);WebAudioSound=function(t){function e(){this.url=null;this.loaded=!1;this.data=null;this.audioBuffer=null;e.__super.call(this)}__class(e,"laya.media.webaudio.WebAudioSound",t);var i=e.prototype;i.load=function(t){function i(){e._dataCache[t]=r.audioBuffer;r.loaded=!0;r.event("complete")}function n(){r.event("error")}var s,r=this;this.url=t;this.audioBuffer=e._dataCache[t];if(this.audioBuffer)i();else{s=new Browser.window.XMLHttpRequest;s.open("GET",t,!0);s.responseType="arraybuffer";s.onload=function(){r.data=s.response;e.buffs.push({buffer:r.data,loaded:i,err:n,me:r,url:r.url});e.decode()};s.send()}};i.play=function(t,e,i){void 0===t&&(t=0);void 0===e&&(e=0);i=i?i:new WebAudioSoundChannel;if(!this.audioBuffer&&this.url){this.once("complete",this,this.play,[t,e,i]);this.load(this.url)}i.url=this.url;i.loops=e;i["audioBuffer"]=this.audioBuffer;i.startTime=t;i.play();SoundManager.addChannel(i);return i};i.dispose=function(){delete e._dataCache[this.url]};e.decode=function(){if(!(e.buffs.length<=0||e.isDecoding)){e.isDecoding=!0;e.tInfo=e.buffs.shift();e.ctx.decodeAudioData(e.tInfo["buffer"],e._done,e._fail)}};e._done=function(t){e.tInfo["me"].audioBuffer=t;e.tInfo["loaded"]&&e.tInfo["loaded"]();e.isDecoding=!1;e.decode()};e._fail=function(){e.tInfo["err"]&&e.tInfo["err"]();e.isDecoding=!1;e.decode()};e._dataCache={};e.buffs=[];e.isDecoding=!1;e.tInfo=null;__static(e,["window",function(){return this.window=Browser.window},"webAudioOK",function(){return this.webAudioOK=e.window["AudioContext"]||e.window["webkitAudioContext"]||e.window["mozAudioContext"]},"ctx",function(){return this.ctx=e.webAudioOK?new(e.window["AudioContext"]||e.window["webkitAudioContext"]||e.window["mozAudioContext"]):void 0}]);return e}(EventDispatcher);HttpRequest=function(t){function e(){this._responseType=null;this._data=null;e.__super.call(this);this._http=new Browser.window.XMLHttpRequest}__class(e,"laya.net.HttpRequest",t);var i=e.prototype;i.send=function(t,e,i,n,s){var r,o,a;void 0===i&&(i="get");void 0===n&&(n="text");this._responseType=n;this._data=null;r=this;o=this._http;o.open(i,t,!0);if(s)for(a=0;a<s.length;a++)o.setRequestHeader(s[a++],s[a]);else e&&"string"!=typeof e?o.setRequestHeader("Content-Type","application/json"):o.setRequestHeader("Content-Type","application/x-www-form-urlencoded");o.responseType="arraybuffer"!==n?"text":"arraybuffer";o.onerror=function(t){r.onError(t)};o.onabort=function(t){r.onAbort(t)};o.onprogress=function(t){r.onProgress(t)};o.onload=function(t){r.onLoad(t)};o.send(e)};i.onProgress=function(t){t&&t.lengthComputable&&this.event("progress",t.loaded/t.total)};i.onAbort=function(t){this.error("Request was aborted by user")};i.onError=function(t){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)};i.onLoad=function(t){var e=this._http,i=void 0!==e.status?e.status:200;200===i||204===i||0===i?this.complete():this.error("["+e.status+"]"+e.statusText+":"+e.responseURL)};i.error=function(t){this.clear();this.event("error",t)};i.complete=function(){this.clear();if("json"===this._responseType)this._data=JSON.parse(this._http.responseText);else if("xml"===this._responseType){var t=new Browser.window.DOMParser;this._data=t.parseFromString(this._http.responseText,"text/xml")}else this._data=this._http.response||this._http.responseText;this.event("complete",this._data instanceof Array?[this._data]:this._data)};i.clear=function(){var t=this._http;t.onerror=t.onabort=t.onprogress=t.onload=null};__getset(0,i,"data",function(){return this._data});__getset(0,i,"url",function(){return this._http.responseURL});return e}(EventDispatcher);Loader=function(t){function e(){this._data=null;this._url=null;this._type=null;this._cache=!1;this._http=null;e.__super.call(this)}__class(e,"laya.net.Loader",t);var i=e.prototype;i.load=function(t,i,n){void 0===n&&(n=!0);t=URL.formatURL(t);this._url=t;this._type=i||(i=this.getTypeFromUrl(t));this._cache=n;this._data=null;if(e.loadedMap[t]){this._data=e.loadedMap[t];this.event("progress",1);this.event("complete",this._data)}else{if("image"===i)return this._loadImage(t);if("sound"===i)return this._loadSound(t);if(!this._http){this._http=new HttpRequest;this._http.on("progress",this,this.onProgress);this._http.on("error",this,this.onError);this._http.on("complete",this,this.onLoaded)}this._http.send(t,null,"get","atlas"!==i?i:"json")}};i.getTypeFromUrl=function(t){e._extReg.lastIndex=t.lastIndexOf(".");var i=e._extReg.exec(t);if(i&&i.length>1)return e.typeMap[i[1].toLowerCase()];console.log("Not recognize the resources suffix",t);return"text"};i._loadImage=function(t){function e(){i.onload=null;i.onerror=null}var i=new HTMLImage,n=this;i.onload=function(){e();n.onLoaded(i)};i.onerror=function(){e();n.event("error","Load image filed")};i.src=t};i._loadSound=function(t){function e(){n();o.onLoaded(r)}function i(){n();o.event("error","Load sound filed")}function n(){r.off("complete",s,e);r.off("error",s,i)}var s=this,r=new Sound,o=this;r.on("complete",this,e);r.on("error",this,i);r.load(t)};i.onProgress=function(t){this.event("progress",t)};i.onError=function(t){this.event("error",t)};i.onLoaded=function(t){var i,n,s,r,o,a,h,l,u,c,_,f,d,p,g,m=this._type;if("image"===m)this.complete(new Texture(t));else if("sound"===m)this.complete(t);else if("texture"===m)this.complete(new Texture(t));else if("atlas"===m){if(!t.src){if(!this._data){this._data=t;if(t.meta&&t.meta.image){i=t.meta.image.split(",");s=this._url.indexOf("/")>=0?"/":"\\";r=0;r=this._url.lastIndexOf(s);n=r>=0?this._url.substr(0,r+1):"";o=0,a=0;a=i.length;for(o=0;o<a;o++)i[o]=n+i[o]}else i=[this._url.replace(".json",".png")];i.reverse();t.toLoads=i;t.pics=[]}return this._loadImage(URL.formatURL(i.pop()))}this._data.pics.push(t);if(this._data.toLoads.length>0)return this._loadImage(URL.formatURL(this._data.toLoads.pop()));h=this._data.frames;l=this._data.meta&&this._data.meta.prefix?URL.basePath+this._data.meta.prefix:this._url.substring(0,this._url.lastIndexOf("."))+"/";u=this._data.pics;_=e.atlasMap[this._url]||(e.atlasMap[this._url]=[]);f=Config.atlasEnable&&Render.isWebGl;for(d in h){p=h[d];c=u[p.frame.idx?p.frame.idx:0];g=l+d;e.loadedMap[g]=Texture.create(c,p.frame.x,p.frame.y,p.frame.w,p.frame.h,p.spriteSourceSize.x,p.spriteSourceSize.y);_.push(e.loadedMap[g])}this.complete(this._data)}else this.complete(t)};i.complete=function(t){this._data=t;e._loaders.push(this);e._isWorking||e.checkNext()};i._endLoad=function(){this._cache&&(e.loadedMap[this._url]=this._data);this.event("progress",1);this.event("complete",this.data instanceof Array?[this.data]:this.data)};__getset(0,i,"cache",function(){return this._cache});__getset(0,i,"data",function(){return this._data});__getset(0,i,"url",function(){return this._url});__getset(0,i,"type",function(){return this._type});e.checkNext=function(){var t,i;e._isWorking=!0;t=Browser.now();i=t;for(;e._startIndex<e._loaders.length;){i=Browser.now();e._loaders[e._startIndex]._endLoad();e._startIndex++;if(Browser.now()-t>e.maxTimeOut){console.log("loader callback cost a long time:"+(Browser.now()-t)+") url="+e._loaders[e._startIndex-1].url);Laya.timer.frameOnce(1,null,e.checkNext);return}}e._loaders.length=0;e._startIndex=0;e._isWorking=!1};e.clearRes=function(t){var i,n,s,r;t=URL.formatURL(t);i=e.atlasMap[t];if(i){for(n=0,s=i.length;n<s;n++){r=i[n];r&&r.destroy()}i.length=0;delete e.atlasMap[t]}delete e.loadedMap[t]};e.getRes=function(t){return e.loadedMap[URL.formatURL(t)]};e.getAtlas=function(t){return e.atlasMap[URL.formatURL(t)]};e.cacheRes=function(t,i){e.loadedMap[URL.formatURL(t)]=i};e.basePath="";e.TEXT="text";e.JSOn="json";e.XML="xml";e.BUFFER="arraybuffer";e.IMAGE="image";e.SOUND="sound";e.TEXTURE="texture";e.ATLAS="atlas";e.typeMap={png:"image",jpg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",mp3:"sound",ogg:"sound",wav:"sound"};e.loadedMap={};e.atlasMap={};e._loaders=[];e._isWorking=!1;e._startIndex=0;e.maxTimeOut=100;e._extReg=/\.(\w+)\??/g;return e}(EventDispatcher);LoaderManager=function(t){function e(){this.retryNum=1;this.maxLoader=5;this._loaders=[];this._loaderCount=0;this._resInfos=[];this._resMap={};this._infoPool=[];this._maxPriority=5;this._failRes={};e.__super.call(this);for(var t=0;t<this._maxPriority;t++)this._resInfos[t]=[]}var i,n;__class(e,"laya.net.LoaderManager",t);n=e.prototype;n.load=function(t,e,n,s,r,o){var a,h;void 0===r&&(r=1);void 0===o&&(o=!0);if(t instanceof Array)return this._loadAssets(t,e,n,o);a=Loader.getRes(t);if(null!=a){e&&e.runWith(a);this._loaderCount||this.event("complete")}else{h=this._resMap[t];if(h){e&&h.on("complete",e.caller,e.method,e.args);n&&h.on("progress",n.caller,n.method,n.args)}else{h=this._infoPool.length?this._infoPool.pop():new i;h.url=t;h.type=s;h.cache=o;e&&h.on("complete",e.caller,e.method,e.args);n&&h.on("progress",n.caller,n.method,n.args);this._resMap[t]=h;r=r<this._maxPriority?r:this._maxPriority-1;this._resInfos[r].push(h);this._next()}}return this};n._next=function(){var t,e;if(!(this._loaderCount>=this.maxLoader)){for(t=0;t<this._maxPriority;t++){e=this._resInfos[t];if(e.length>0)return this._doLoad(e.shift())}this._loaderCount||this.event("complete")}};n._doLoad=function(t){function e(e){i.offAll();n._loaders.push(i);n._endLoad(t,e);n._loaderCount--;n._next()}var i,n;this._loaderCount++;i=this._loaders.length?this._loaders.pop():new Loader;i.on("complete",null,e);i.on("progress",null,function(e){t.event("progress",e)});i.on("error",null,function(t){e(null)});n=this;i.load(t.url,t.type,t.cache)};n._endLoad=function(t,e){if(null===e){var i=this._failRes[t.url]||0;if(i<this.retryNum){console.log("[warn]Retry to load:",t.url);this._failRes[t.url]=i+1;this._resInfos[this._maxPriority-1].push(t);return}console.log("[error]Failed to load:",t.url);this.event("error",t.url)}delete this._resMap[t.url];t.event("complete",e);t.offAll();this._infoPool.push(t)};n.clearRes=function(t){Loader.clearRes(t)};n.getRes=function(t){return Loader.getRes(t)};n.clearUnLoaded=function(){this._resInfos.length=0;this._loaderCount=0;this._resMap={}};n._loadAssets=function(t,e,i,n){function s(t,i){a++;t.progress=1;a===o&&e&&e.run()}function r(t,e){var n,s,r,a;if(null!=i){t.progress=e;n=0;for(s=0;s<o;s++){r=l[s];n+=r.size*r.progress}a=n/h;i.runWith(a)}}var o,a,h,l,u,c,_;void 0===n&&(n=!0);o=t.length;a=0;h=0;l=[];for(u=0;u<o;u++){c=t[u];"string"==typeof c&&(c={url:c,type:"image",size:1,priority:1});c.size||(c.size=1);c.progress=0;h+=c.size;l.push(c);_=i?Handler.create(this,r,[c]):null;this.load(c.url,Handler.create(c,s,[c]),_,c.type,c.priority||1,n)}return this};e.cacheRes=function(t,e){Loader.cacheRes(t,e)};e.__init$=function(){i=function(t){function e(){this.url=null;this.type=null;this.cache=!1;e.__super.call(this)}__class(e,"",t);return e}(EventDispatcher)};return e}(EventDispatcher);Socket=function(t){function e(t,i,n){this._endian=null;this._stamp=NaN;this._socket=null;this._connected=!1;this._host=null;this._port=0;this._addInputPosition=0;this._input=null;this._output=null;this._bytes=null;this.timeout=0;this.objectEncoding=0;this._byteClass=null;void 0===i&&(i=0);e.__super.call(this);this._byteClass=n;this._byteClass=this._byteClass?this._byteClass:Byte;this.endian="bigEndian";this.timeout=2e4;this._addInputPosition=0;i>0&&i<65535&&this.connect(t,i)}__class(e,"laya.net.Socket",t);var i=e.prototype;i.connect=function(t,e){var i,n=this;null!=this._socket&&this.close();i="ws://"+t+":"+e;this._host=t;this._port=e;this._socket&&this._cleanSocket();this._socket=new WebSocket(i);this._socket.binaryType="arraybuffer";this._output=new this._byteClass;this._output.endian=this.endian;this._input=new this._byteClass;this._input.endian=this.endian;this._socket.onopen=function(t){var e=arguments;n.onOpenHandler(e)};this._socket.onmessage=function(t){n.onMessageHandler(t)};this._socket.onclose=function(t){var e=arguments;n.onCloseHandler(e)};this._socket.onerror=function(t){var e=arguments;n.onErrorHandler(e)};this._socket.binaryType="arraybuffer"};i._cleanSocket=function(){try{this._socket.close()}catch(t){}this._socket.onopen=null;this._socket.onmessage=null;this._socket.onclose=null;this._socket.onerror=null;this._socket=null};i.close=function(){null!=this._socket&&this._cleanSocket()};i.onOpenHandler=function(t){this._connected=!0;this.event("open")};i.onMessageHandler=function(t){var e,i;if(this._input.length>0&&this._input.bytesAvailable<1){this._input.clear();this._addInputPosition=0}e=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0);this._input.pos=this._addInputPosition;if(t&&t.data){i=t.data;if(i){"string"==typeof i?this._input.writeUTFBytes(i):this._input.writeArrayBuffer(i);this._addInputPosition=this._input.pos;this._input.pos=e}this.event("message",i)}};i.onCloseHandler=function(t){this.event("close")};i.onErrorHandler=function(t){this.event("error")};i.sendString=function(t){this._socket.send(t)};i.flush=function(){if(this._output&&this._output.length>0)try{this._socket&&this._socket.send(this._output.__getBuffer());this._output.endian=this.endian;this._output.clear()}catch(t){}};__getset(0,i,"input",function(){return this._input});__getset(0,i,"output",function(){return this._output});__getset(0,i,"connected",function(){return this._connected});__getset(0,i,"endian",function(){return this._endian},function(t){this._endian=t;null!=this._input&&(this._input.endian=t);null!=this._output&&(this._output.endian=t)});e.LITTLE_ENDIAN="littleEndian";e.BIG_ENDIAN="bigEndian";return e}(EventDispatcher);Resource=function(t){function e(){this._id=0;this._lastUseFrameCount=0;this._memorySize=0;this._name=null;this._released=!1;this._resourceManager=null;this.lock=!1;e.__super.call(this);this._$1__id=++e._uniqueIDCounter;e._loadedResources.push(this);e._isLoadedResourcesSorted=!1;this._released=!0;this.lock=!1;this._memorySize=0;this._lastUseFrameCount=-1;ResourceManager.currentResourceManager&&ResourceManager.currentResourceManager.addResource(this)}__class(e,"laya.resource.Resource",t);var i=e.prototype;Laya.imps(i,{"laya.resource.IDispose":!0});i.recreateResource=function(){this.startCreate();this.compoleteCreate()};i.detoryResource=function(){};i.activeResource=function(t){void 0===t&&(t=!1);this._lastUseFrameCount=Stat.loopCount;(this._released||t)&&this.recreateResource()};i.releaseResource=function(t){void 0===t&&(t=!1);if(!t&&this.lock)return!1;if(!this._released||t){this.detoryResource();this._released=!0;this._lastUseFrameCount=-1;this.event("released",this);return!0}return!1};i.setUniqueName=function(t){var i,n=!0;for(i=0;i<e._loadedResources.length;i++)if(e._loadedResources[i]._name===t&&e._loadedResources[i]!==this){n=!1;return}if(n){if(this.name!=t){this.name=t;e._isLoadedResourcesSorted=!1}}else this.setUniqueName(t.concat("-copy"))};i.dispose=function(){if(null!==this._resourceManager)throw new Error("附属于resourceManager的资源不能独立释放！");this.lock=!1;this.releaseResource();var t=e._loadedResources.indexOf(this);if(-1!==t){e._loadedResources.splice(t,1);e._isLoadedResourcesSorted=!1}};i.startCreate=function(){this.event("recovering",this)};i.compoleteCreate=function(){this._released=!1;this.event("recovered",this)};__getset(0,i,"id",function(){return this._$1__id});__getset(0,i,"lastUseFrameCount",function(){return this._lastUseFrameCount});__getset(0,i,"name",function(){return this._name},function(t){if((t||""!==t)&&this.name!==t){this._name=t;e._isLoadedResourcesSorted=!1}});__getset(0,i,"resourceManager",function(){return this._resourceManager});__getset(0,i,"memorySize",function(){return this._memorySize},function(t){var e=t-this._memorySize;this._memorySize=t;this.event("memorychanged",e)});__getset(0,i,"released",function(){return this._released});__getset(1,e,"sortedLoadedResourcesByName",function(){if(!e._isLoadedResourcesSorted){e._isLoadedResourcesSorted=!0;e._loadedResources.sort(e.compareResourcesByName)}return e._loadedResources},laya.events.EventDispatcher._$SET_sortedLoadedResourcesByName);e.getLoadedResourceByIndex=function(t){return e._loadedResources[t]};e.getLoadedResourcesCount=function(){return e._loadedResources.length};e.compareResourcesByName=function(t,e){var i,n,s;if(t===e)return 0;i=t.name;n=e.name;if(null===i)return null===n?0:-1;if(null==n)return 1;s=i.localeCompare(n);if(0!=s)return s;e.setUniqueName(n);n=e.name;return i.localeCompare(n)};e.animationCache={};e.meshCache={};e._uniqueIDCounter=0;e._loadedResources=[];e._isLoadedResourcesSorted=!1;return e}(EventDispatcher);Texture=function(t){function e(t,i){this._w=0;this._h=0;this.offsetX=0;this.offsetY=0;e.__super.call(this);this.set(t,i)}__class(e,"laya.resource.Texture",t);var i=e.prototype;i.set=function(t,i){var n,s;this.bitmap=t;this.uv=i||e.DEF_UV;if(t){this._w=t.width;this._h=t.height;this._loaded=this._w>0;n=this;if(this._loaded)System.addToAtlas&&System.addToAtlas(n);else{s=t;s instanceof laya.resource.HTMLImage&&s.image&&s.image.addEventListener("load",function(t){System.addToAtlas&&System.addToAtlas(n)},!1)}}};i.active=function(){this.bitmap.activeResource()};i.destroy=function(){this.bitmap=null};i.load=function(t){var e,i,n=this;this._loaded=!1;e=this.bitmap||(this.bitmap=new HTMLImage);i=this;e.onload=function(){e.onload=null;i._loaded=!0;n._w=e.width;n._h=e.height;i.event("loaded",this);System.addToAtlas&&System.addToAtlas(i)};e.src=URL.formatURL(t)};__getset(0,i,"height",function(){return this._h?this._h:this.uv&&this.uv!==e.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height},function(t){this._h=t});__getset(0,i,"loaded",function(){return this._loaded});__getset(0,i,"released",function(){return this.bitmap.released});__getset(0,i,"source",function(){this.bitmap.activeResource();return this.bitmap.source});__getset(0,i,"width",function(){return this._w?this._w:this.uv&&this.uv!==e.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width},function(t){this._w=t});e.moveUV=function(t,e,i){for(var n=0;n<8;n+=2){i[n]+=t;i[n+1]+=e}return i};e.create=function(t,i,n,s,r,o,a){var h,l,u,c,_,f,d,p,g,m,y,v;void 0===o&&(o=0);void 0===a&&(a=0);h=t.uv||e.DEF_UV;l=t.bitmap||t;u=new e(l,null);u.width=s;u.height=r;u.offsetX=o;u.offsetY=a;c=1/l.width;_=1/l.height;i*=c;n*=_;s*=c;r*=_;f=u.uv[0],d=u.uv[1],p=u.uv[4],g=u.uv[5];m=p-f,y=g-d;v=e.moveUV(h[0],h[1],[i,n,i+s,n,i+s,n+r,i,n+r]);u.uv=[f+v[0]*m,d+v[1]*y,p-(1-v[2])*m,d+v[3]*y,p-(1-v[4])*m,g-(1-v[5])*y,f+v[6]*m,g-(1-v[7])*y];return u};e.TEXTURE2D=1;e.TEXTURE3D=2;e.DEF_UV=[0,0,1,0,1,1,0,1];e.INV_UV=[0,1,1,1,1,0,0,0];return e}(EventDispatcher);TimeLine=function(t){function e(){this._labelDic=null;this._tweenDic={};this._tweenDataList=[];this._endTweenDataList=null;this._currTime=0;this._lastTime=0;this._startTime=0;this._index=0;this._gidIndex=0;this._firstTweenDic={};this._startTimeSort=!1;this._endTimeSort=!1;this._loopKey=!1;this.scale=1;e.__super.call(this)}var i,n;__class(e,"laya.utils.TimeLine",t);n=e.prototype;n.to=function(t,e,i,n,s){void 0===s&&(s=0);this._create(t,e,i,n,s,!0)};n.from=function(t,e,i,n,s){void 0===s&&(s=0);this._create(t,e,i,n,s,!1)};n._create=function(t,e,n,s,r,o){var a=new i;a.isTo=o;a.type=0;a.target=t;a.duration=n;a.data=e;a.startTime=this._startTime+r;a.endTime=a.startTime+a.duration;a.ease=s;this._startTime=Math.max(a.endTime,this._startTime);this._tweenDataList.push(a);this._startTimeSort=!0;this._endTimeSort=!0};n.add=function(t,e){var n=new i;n.type=1;n.data=t;n.endTime=n.startTime=this._startTime+e;this._labelDic||(this._labelDic={});this._labelDic[t]=n;this._tweenDataList.push(n)};n.gotoTime=function(t){function e(t,e){return t.endTime>e.endTime?1:t.endTime<e.endTime?-1:0}var i,n,s,r,o,a,h,l,u,c;if(null!=this._tweenDataList&&0!=this._tweenDataList.length){for(s in this._firstTweenDic){n=this._firstTweenDic[s];if(n)for(r in n)n.diyTarget[r]=n[r]}for(s in this._tweenDic){i=this._tweenDic[s];i.clear();delete this._tweenDic[s]}this._index=0;this._gidIndex=0;this._currTime=t;this._lastTime=Browser.now();if(null==this._endTweenDataList||this._endTimeSort){this._endTimeSort=!1;this._endTweenDataList=o=this._tweenDataList.concat();o.sort(e)}else o=this._endTweenDataList;for(h=0,l=o.length;h<l;h++){a=o[h];if(0==a.type){if(!(t>=a.endTime))break;this._index=Math.max(this._index,h+1);u=a.data;for(c in u)a.isTo&&(a.target[c]=u[c])}}for(h=0,l=this._tweenDataList.length;h<l;h++){a=this._tweenDataList[h];if(0==a.type&&t>=a.startTime&&t<a.endTime){this._index=Math.max(this._index,h+1);this._gidIndex++;i=Pool.getItemByClass("tween",Tween);i._create(a.target,a.data,a.duration,a.ease,Handler.create(this,this._animComplete,[this._gidIndex]),0,!1,a.isTo,!0,!1);i.setStartTime(this._currTime-(t-a.startTime));i.updateEase(this._currTime);i.gid=this._gidIndex;this._tweenDic[this._gidIndex]=i}}}};n.gotoLabel=function(t){var e,i;if(null!=this._labelDic){e=this._labelDic[t];if(e){i=e.startTime;this.gotoTime(i)}}};n.pause=function(){Laya.timer.clear(this,this._update)};n.resume=function(){this.play(this._currTime,this._loopKey)};n.play=function(t,e){function i(t,e){return t.startTime>e.startTime?1:t.startTime<e.startTime?-1:0}var n,s,r,o,a,h,l;void 0===t&&(t=0);void 0===e&&(e=!1);if(this._startTimeSort){this._startTimeSort=!1;this._tweenDataList.sort(i);for(n=0,s=this._tweenDataList.length;n<s;n++){r=this._tweenDataList[n];if(null!=r&&0==r.type){o=r.target;a=o.$_GID||(o.$_GID=Utils.getGID());h=null;if(null==this._firstTweenDic[a]){h={};h.diyTarget=o;this._firstTweenDic[a]=h}else h=this._firstTweenDic[a];for(l in r.data)null==h[l]&&(h[l]=o[l])}}}"string"==typeof t?this.gotoLabel(t):this.gotoTime(t);this._loopKey=e;this._lastTime=Browser.now();Laya.timer.frameLoop(1,this,this._update)};n._update=function(){var t,e,i,n,s,r;if(this._currTime>=this._startTime){if(!this._loopKey){this._complete();return}this._complete();this.gotoTime(0)}t=Browser.now();e=t-this._lastTime;i=this._currTime+=e*this.scale;this._lastTime=t;if(0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){s=this._tweenDataList[this._index];if(i>=s.startTime){this._index++;if(0==s.type){this._gidIndex++;n=new Tween;n._create(s.target,s.data,s.duration,s.ease,new Handler(this,this._animComplete,[this._gidIndex]),0,!1,s.isTo,!0,!1);n.setStartTime(i);n.gid=this._gidIndex;this._tweenDic[this._gidIndex]=n}else this.event("label",s.data)}}for(r in this._tweenDic){n=this._tweenDic[r];n.updateEase(i)}};n._animComplete=function(t){var e=this._tweenDic[t];e&&delete this._tweenDic[t]};n._complete=function(){this.event("complete")};n.reset=function(){var t,e;if(this._labelDic)for(t in this._labelDic)delete this._labelDic[t];for(t in this._tweenDic){e=this._tweenDic[t];e.clear();delete this._tweenDic[t]}for(t in this._firstTweenDic)delete this._firstTweenDic[t];this._endTweenDataList=null;this._tweenDataList.length=0;this._currTime=0;this._lastTime=0;this._startTime=0;this._index=0;this._gidIndex=0;this.scale=1;Laya.timer.clear(this,this._update)};n.destory=function(){this.reset();this._labelDic=null;this._tweenDic=null;this._tweenDataList=null;this._firstTweenDic=null};e.__init$=function(){i=function(){function t(){this.type=0;this.isTo=!0;this.startTime=NaN;this.endTime=NaN;this.target=null;this.duration=NaN;this.ease=null;this.data=null}__class(t,"");return t}()};return e}(EventDispatcher);Sprite=function(t){function e(){this.mouseThrough=!1;this._transform=null;this._tfChanged=!1;this._x=0;this._y=0;this._width=0;this._height=0;this._repaint=1;this._mouseEnableState=0;this._enableRenderMerge=!1;this._zOrder=0;this._graphics=null;this._renderType=0;this.autoSize=!1;this.optimizeFloat=!1;e.__super.call(this);this._style=Style.EMPTY;this._$P=e.PropEmpty}__class(e,"laya.display.Sprite",t);var i=e.prototype;Laya.imps(i,{"laya.display.ILayout":!0});i.destroy=function(e){void 0===e&&(e=!0);t.prototype.destroy.call(this,e);this._style&&this._style.destroy();this._transform=null;this._style=null;this._graphics=null;this._$P=null};i.updateOrder=function(){Utils.updateOrder(this._childs)&&this.repaint()};i.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0)};i.setBounds=function(t){this.get$P().uBounds=t};i.getBounds=function(){return Rectangle._getWrapRec(this.boundPointsToParent(),Rectangle.TEMP)};i.getSelfBounds=function(){return Rectangle._getWrapRec(this._getBoundPointsM(!1),Rectangle.TEMP)};i.boundPointsToParent=function(t){var e,i,n,s,r,o,a;void 0===t&&(t=!1);e=0,i=0;if(this._style){e=this._style.translateX;i=this._style.translateY;t=t||0!==this._style.rotate;if(this._style.scrollRect){e+=this._style.scrollRect.x;i+=this._style.scrollRect.y}}n=this._getBoundPointsM(t);if(!n||n.length<1)return n;8!=n.length&&(n=t?GrahamScan.scanPList(n):Rectangle._getWrapRec(n,Rectangle.TEMP)._getBoundPoints());if(!this.transform){Utils.transPointList(n,this.x-e,this.y-i);return n}s=Point.TEMP;r=[];o=0,a=n.length;for(o=0;o<a;o+=2){s.x=n[o];s.y=n[o+1];this.toParentPoint(s);r.push(s.x,s.y)}return r};i.getGraphicBounds=function(){return this._graphics?this._graphics.getBounds():Rectangle.EMPTY};i._getBoundPointsM=function(t){var e,i,n,s,r;void 0===t&&(t=!1);if(this._$P.uBounds)return this._$P.uBounds._getBoundPoints();this._$P.temBM||(this.get$P().temBM=[]);e=this._graphics?this._graphics.getBoundPoints():Utils.clearArr(this._$P.temBM);for(s=0,r=this.numChildren;s<r;s++){i=this.getChildAt(s);if(i instanceof laya.display.Sprite&&1==i.visible){n=i.boundPointsToParent(t);n&&(e=e?Utils.concatArr(e,n):n)}}return e};i.getStyle=function(){this._style===Style.EMPTY&&(this._style=new Style);return this._style};i.get$P=function(){this._$P===e.PropEmpty&&(this._$P={});return this._$P};i.setStyle=function(t){this._style=t};i._adjustTransform=function(){"use strict";var t,e,i,n,s,r,o;this._tfChanged=!1;t=this._style;e=t.scaleX,i=t.scaleY;if(t.rotate||1!==e||1!==i||t.skewX||t.skewY){n=this._transform||(this._transform=Matrix.create());n.bTransform=!0;if(t.rotate){s=.0174532922222222*t.rotate;r=n.cos=Math.cos(s);o=n.sin=Math.sin(s);n.a=e*r;n.b=e*o;n.c=-i*o;n.d=i*r;n.tx=n.ty=0;return n}n.a=e;n.d=i;n.c=n.b=n.tx=n.ty=0;return t.skewX||t.skewY?n.skew(.0174532922222222*t.skewX,.0174532922222222*t.skewY):n}this._transform&&this._transform.destroy();this._transform=null;this._renderType&=-9;return n};i.pos=function(t,e){if(this._x!==t||this._y!==e){this.x=t;this.y=e}return this};i.pivot=function(t,e){this.pivotX=t;this.pivotY=e;return this};i.size=function(t,e){this.width=t;this.height=e;return this};i.scale=function(t,e){this.scaleX=t;this.scaleY=e;return this};i.skew=function(t,e){this.skewX=t;this.skewY=e;return this};i.render=function(t,e,i){Stat.spriteDraw++;RenderSprite.renders[this._renderType]._fun(this,t,e+this._x,i+this._y);this._repaint=0};i.drawToCanvas=function(t,e,i,n){return System.drawToCanvas(this,this._renderType,t,e,i,n)};i.customRender=function(t,e,i){};i.applyFilters=function(){var t,e,i;if(!Render.isWebGl){t=this._$P.filters;if(t&&!(t.length<1))for(e=0,i=t.length;e<i;e++)t[e].action.apply(this._$P.cacheCanvas)}};i.isHaveGlowFilter=function(){var t=0,e=0;for(t=0;t<this.filters.length;t++)if(8==this.filters[t].type)return!0;for(t=0,e=this._childs.length;t<e;t++)if(this._childs[t].isHaveGlowFilter())return!0;return!1};i.ask=function(t,e){return 1==t?2==e:!1};i.localToGlobal=function(t,e){void 0===e&&(e=!1);if(!this._displayInStage||!t)return t;e===!0&&(t=new Point(t.x,t.y));for(var i=this;i&&i!=Laya.stage;){t=i.toParentPoint(t);i=i.parent}return t};i.globalToLocal=function(t,e){var i,n,s;void 0===e&&(e=!1);if(!this._displayInStage||!t)return t;e===!0&&(t=new Point(t.x,t.y));i=this;n=[];for(;i&&i!=Laya.stage;){n.push(i);i=i.parent}s=n.length-1;for(;s>=0;){i=n[s];t=i.fromParentPoint(t);s--}return t};i.toParentPoint=function(t){if(!t)return t;t.x-=this.pivotX;t.y-=this.pivotY;this.transform&&this._transform.transformPoint(t.x,t.y,t);t.x+=this._x;t.y+=this._y;var e=this._style.scrollRect;if(e){t.x-=e.x;t.y-=e.y}return t};i.fromParentPoint=function(t){if(!t)return t;t.x-=this._x;t.y-=this._y;var e=this._style.scrollRect;if(e){t.x+=e.x;t.y+=e.y}this.transform&&this._transform.invertTransformPoint(t);t.x+=this.pivotX;t.y+=this.pivotY;return t};i.on=function(t,e,i,n){1!==this._mouseEnableState&&this.isMouseEvent(t)&&(this._displayInStage?this._$2__onDisplay():laya.events.EventDispatcher.prototype.once.call(this,"display",this,this._$2__onDisplay));return laya.events.EventDispatcher.prototype.on.call(this,t,e,i,n)};i.once=function(t,e,i,n){1!==this._mouseEnableState&&this.isMouseEvent(t)&&(this._displayInStage?this._$2__onDisplay():laya.events.EventDispatcher.prototype.once.call(this,"display",this,this._$2__onDisplay));return laya.events.EventDispatcher.prototype.once.call(this,t,e,i,n)};i._$2__onDisplay=function(){if(1!==this._mouseEnableState)for(var t=this;t&&1!==t._mouseEnableState;){t.mouseEnabled=!0;t=t.parent}};i.loadImage=function(t,e,i,n,s,r){function o(t){a.size(t.width,t.height);a.repaint();r&&r.runWith(t)}var a=this;void 0===e&&(e=0);void 0===i&&(i=0);void 0===n&&(n=0);void 0===s&&(s=0);this.graphics.loadImage(t,e,i,n,s,o);return this};i.repaint=function(){0===this._repaint&&(this._repaint=1,this.parentRepaint(this))};i.isRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache};i.childChanged=function(t){this._childs.length?this._renderType|=2048:this._renderType&=-2049;t&&t.zOrder&&Laya.timer.callLater(this,this.updateOrder);this.repaint()};i.parentRepaint=function(t){var e=this._parent;e&&0===e._repaint&&(e._repaint=1,e.parentRepaint(this))};i.startDrag=function(t,e,i,n,s,r){void 0===e&&(e=!1);void 0===i&&(i=0);void 0===n&&(n=300);void 0===r&&(r=!1);this._$P.dragging||(this.get$P().dragging=new Dragging);this._$P.dragging.start(this,t,e,i,n,s,r)};i.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()};i._setDisplay=function(e){if(!e&&this._$P.cacheCanvas&&this._$P.cacheCanvas.ctx){this._$P.cacheCanvas.ctx.destroy();this._$P.cacheCanvas.ctx=null}var i=this["_filterCache"];i&&(i.destroy(),i.recycle(),this["_filterCache"]=null);this["_isHaveGlowFilter"]=!1;t.prototype._setDisplay.call(this,e)};i.hitTestPoint=function(t,e){var i=this.globalToLocal(Point.TEMP.setTo(t,e)),n=this._$P.hitArea?this._$P.hitArea:Rectangle.EMPTY.setTo(0,0,this._width,this._height);return n.contains(i.x,i.y)};i.getMousePoint=function(){return this.globalToLocal(Point.TEMP.setTo(Laya.stage.mouseX,Laya.stage.mouseY))};i._getWords=function(){return null};i._addChildsToLayout=function(t){var e=this._getWords();if(null==e&&0==this._childs.length)return!1;e&&e.forEach(function(e){t.push(e)});this._childs.forEach(function(e){e._style._enableLayout()&&e._addToLayout(t)});return!0};i._addToLayout=function(t){this._style.absolute||(this._style.block?t.push(this):this._addChildsToLayout(t)&&(this.x=this.y=0))};i._isChar=function(){return!1};i._getCSSStyle=function(){return this._style.getCSSStyle()};i.setValue=function(t,e){switch(t){case"x":this.x=parseFloat(e);break;case"y":this.y=parseFloat(e);break;case"width":this.width=parseFloat(e);break;case"height":this.height=parseFloat(e);break;default:this[t]=e}};i.layoutLater=function(){this.parent&&this.parent.layoutLater()};__getset(0,i,"cacheAsBitmap",function(){return"none"!==this.cacheAs},function(t){this.cacheAs=t?"normal":"none"});__getset(0,i,"scrollRect",function(){return this._style.scrollRect},function(t){this.getStyle().scrollRect=t;this.repaint();t?this._renderType|=64:this._renderType&=-65});__getset(0,i,"viewHeight",function(){return this.height*this._style.scaleY});__getset(0,i,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type},function(t){if(t!==(this._$P.cacheCanvas?this._$P.cacheCanvas.type:"none")){if("none"!==t){this._$P.cacheCanvas||(this.get$P().cacheCanvas=Pool.getItemByClass("cacheCanvas",Object));this._$P.cacheCanvas.type=t;
this._$P.cacheCanvas.reCache=!0;this._renderType|=16}else{this._$P.cacheCanvas&&Pool.recover("cacheCanvas",this._$P.cacheCanvas);this._$P.cacheCanvas=null;this._renderType&=-17}this.repaint()}});__getset(0,i,"staticCache",function(){return this._$P.staticCache},function(t){this._$P.staticCache=t;!t&&this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0)});__getset(0,i,"x",function(){return this._x},function(t){var e=this._parent;this._x!==t&&(this._x=t,e&&0===e._repaint&&(e._repaint=1,e.parentRepaint(this)))});__getset(0,i,"y",function(){return this._y},function(t){var e=this._parent;this._y!==t&&(this._y=t,e&&0===e._repaint&&(e._repaint=1,e.parentRepaint(this)))});__getset(0,i,"skewX",function(){return this._style.skewX},function(t){var e,i=this.getStyle();if(i.skewX!==t){i.skewX=t;this._tfChanged=!0;this._renderType|=8;e=this._parent;e&&0===e._repaint&&(e._repaint=1,e.parentRepaint(this))}});__getset(0,i,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(t){this._width!==t&&(this._width=t,this.repaint())});__getset(0,i,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(t){this._height!==t&&(this._height=t,this.repaint())});__getset(0,i,"viewWidth",function(){return this.width*this._style.scaleX});__getset(0,i,"scaleX",function(){return this._style.scaleX},function(t){var e,i=this.getStyle();if(i.scaleX!==t){i.scaleX=t;this._tfChanged=!0;this._renderType|=8;e=this._parent;e&&0===e._repaint&&(e._repaint=1,e.parentRepaint(this))}});__getset(0,i,"hitArea",function(){return this._$P.hitArea},function(t){this.get$P().hitArea=t});__getset(0,i,"rotation",function(){return this._style.rotate},function(t){var e,i=this.getStyle();if(i.rotate!==t){i.rotate=t;this._tfChanged=!0;this._renderType|=8;e=this._parent;e&&0===e._repaint&&(e._repaint=1,e.parentRepaint(this))}});__getset(0,i,"scaleY",function(){return this._style.scaleY},function(t){var e,i=this.getStyle();if(i.scaleY!==t){i.scaleY=t;this._tfChanged=!0;this._renderType|=8;e=this._parent;e&&0===e._repaint&&(e._repaint=1,e.parentRepaint(this))}});__getset(0,i,"blendMode",function(){return this._style.blendMode},function(t){this.getStyle().blendMode=t;t&&"source-over"!=t?this._renderType|=32:this._renderType&=-33;this.parentRepaint(this)});__getset(0,i,"skewY",function(){return this._style.skewY},function(t){var e,i=this.getStyle();if(i.skewY!==t){i.skewY=t;this._tfChanged=!0;this._renderType|=8;e=this._parent;e&&0===e._repaint&&(e._repaint=1,e.parentRepaint(this))}});__getset(0,i,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function(t){this._tfChanged=!1;this._transform=t;if(t){this._x=t.tx;this._y=t.ty;t.tx=t.ty=0}t?this._renderType|=8:this._renderType&=-9;this.parentRepaint(this)});__getset(0,i,"pivotX",function(){return this._style.translateX},function(t){this.getStyle().translateX=t;this.repaint()});__getset(0,i,"pivotY",function(){return this._style.translateY},function(t){this.getStyle().translateY=t;this.repaint()});__getset(0,i,"alpha",function(){return this._style.alpha},function(t){if(this._style.alpha!==t){t=t<0?0:t>1?1:t;this.getStyle().alpha=t;1!==t?this._renderType|=4:this._renderType&=-5;this.parentRepaint(this)}});__getset(0,i,"visible",function(){return this._style.visible},function(t){if(this._style.visible!==t){this.getStyle().visible=t;this.parentRepaint(this)}});__getset(0,i,"graphics",function(){return this._graphics||(this.graphics=System.createGraphics())},function(t){this._graphics&&(this._graphics._sp=null);this._graphics=t;if(t){this._renderType&=-2;this._renderType|=256;t._sp=this}else{this._renderType&=-257;this._renderType&=-2}this.repaint()});__getset(0,i,"filters",function(){return this._$P.filters},function(t){t&&0===t.length&&(t=null);if(this._$P.filters!=t){this.get$P().filters=t?t.slice():null;if(Render.isWebGl){t&&t.length?this._renderType|=2:this._renderType&=-3;this.repaint()}else{this.cacheAsBitmap=t&&t.length>0;this.repaint()}}});__getset(0,i,"mask",function(){return this._$P._mask},function(t){this.cacheAsBitmap=!0;this.get$P()._mask=t;this._renderType|=32;this.parentRepaint(this)});__getset(0,i,"stage",function(){return Laya.stage});__getset(0,i,"mouseEnabled",function(){return this._mouseEnableState>1},function(t){this._mouseEnableState=t?2:1});__getset(0,i,"enableRenderMerge",function(){return this._enableRenderMerge},function(t){if(Render.isWebGl){t?this._renderType|=1024:this._renderType&=-1025;this._enableRenderMerge=t}});__getset(0,i,"mouseY",function(){return this.getMousePoint().y});__getset(0,i,"mouseX",function(){return this.getMousePoint().x});__getset(0,i,"zOrder",function(){return this._zOrder},function(t){if(this._zOrder!=t){this._zOrder=t;this._parent&&Laya.timer.callLater(this._parent,this.updateOrder)}});e.fromImage=function(t){return(new e).loadImage(t)};e.PropEmpty={};return e}(Node);AudioSoundChannel=function(t){function e(t){this._audio=null;this._onEnd=null;this._resumePlay=null;e.__super.call(this);this._onEnd=Utils.bind(this.__onEnd,this);this._resumePlay=Utils.bind(this.__resumePlay,this);t.addEventListener("ended",this._onEnd);this._audio=t}__class(e,"laya.media.h5audio.AudioSoundChannel",t);var i=e.prototype;i.__onEnd=function(){if(1!=this.loops){this.loops>0&&this.loops--;this.play()}else{if(this.completeHandler){this.completeHandler.run();this.completeHandler=null}this.stop();this.event("complete")}};i.__resumePlay=function(){try{this._audio.removeEventListener("canplay",this._resumePlay);this._audio.currentTime=this.startTime;Browser.document.body.appendChild(this._audio);this._audio.play()}catch(t){this.event("error")}};i.play=function(){try{this._audio.currentTime=this.startTime}catch(t){this._audio.addEventListener("canplay",this._resumePlay);return}Browser.document.body.appendChild(this._audio);this._audio.play()};i.stop=function(){this.isStopped=!0;SoundManager.removeChannel(this);this.completeHandler=null;if(this._audio){this._audio.pause();this._audio.removeEventListener("ended",this._onEnd);this._audio.removeEventListener("canplay",this._resumePlay);Pool.recover("audio:"+this.url,this._audio);Browser.removeElement(this._audio);this._audio=null}};__getset(0,i,"position",function(){return this._audio?this._audio.currentTime:0});__getset(0,i,"volume",function(){return this._audio?this._audio.volume:1},function(t){this._audio&&(this._audio.volume=t)});return e}(SoundChannel);WebAudioSoundChannel=function(t){function e(){this.audioBuffer=null;this.gain=null;this.bufferSource=null;this._currentTime=0;this._volume=1;this._startTime=0;this._onPlayEnd=null;this.context=WebAudioSound.ctx;e.__super.call(this);this._onPlayEnd=Utils.bind(this.__onPlayEnd,this);this.context["createGain"]?this.gain=this.context["createGain"]():this.gain=this.context["createGainNode"]()}__class(e,"laya.media.webaudio.WebAudioSoundChannel",t);var i=e.prototype;i.play=function(){var t,e,i;if(this.bufferSource){this.bufferSource.disconnect();this.bufferSource.onended=null;this.bufferSource=null}if(this.audioBuffer){t=this.context;e=this.gain;i=t.createBufferSource();this.bufferSource=i;i.buffer=this.audioBuffer;i.connect(e);e&&e.disconnect();e.connect(t.destination);i.onended=this._onPlayEnd;this._startTime=Browser.now();this.gain.gain.value=this._volume;0==this.loops&&(i.loop=!0);i.start(0,this.startTime);this._currentTime=0}};i.__onPlayEnd=function(){if(1!=this.loops){this.loops>0&&this.loops--;this.play()}else{if(this.completeHandler){this.completeHandler.run();this.completeHandler=null}this.stop();this.event("complete")}};i.stop=function(){if(this.bufferSource){var t=this.bufferSource;t.stop?t.stop(0):t.noteOff(0);this.bufferSource.disconnect();this.bufferSource=null;this.audioBuffer=null}this.gain&&this.gain.disconnect();this.isStopped=!0;SoundManager.removeChannel(this);this.completeHandler=null};__getset(0,i,"position",function(){return this.bufferSource?(Browser.now()-this._startTime)/1e3+this.startTime:0});__getset(0,i,"volume",function(){return this._volume},function(t){if(!this.isStopped){this._volume=t;this.gain.gain.value=t}});return e}(SoundChannel);Bitmap=function(t){function e(){e.__super.call(this);this._w=0;this._h=0}__class(e,"laya.resource.Bitmap",t);var i=e.prototype;i.copyTo=function(t){t._source=this._source;t._w=this._w;t._h=this._h};i.dispose=function(){this._resourceManager.removeResource(this);t.prototype.dispose.call(this)};__getset(0,i,"source",function(){return this._source});__getset(0,i,"width",function(){return this._w});__getset(0,i,"height",function(){return this._h});return e}(Resource);Animation=function(t){function e(){this.loop=!1;this._frames=null;this._index=0;this._count=0;this._isPlaying=!1;e.__super.call(this);this.interval=Config.animationInterval;this.on("display",this,this._$3__onDisplay);this.on("undisplay",this,this._$3__onDisplay)}__class(e,"laya.display.Animation",t);var i=e.prototype;i.destroy=function(e){void 0===e&&(e=!0);this.stop();t.prototype.destroy.call(this,e);this._frames=null};i._$3__onDisplay=function(){this._isPlaying&&(this._displayInStage?this.play(this._index,this.loop):this.clearTimer(this,this._frameLoop))};i.play=function(t,e){void 0===t&&(t=0);void 0===e&&(e=!0);this._isPlaying=!0;this._index=t;this.loop=e;this._frames&&this._frames.length>0&&this.interval>0&&this.timerLoop(this.interval,this,this._frameLoop,null,!0)};i._frameLoop=function(){if(this._style.visible){this.index=this._index,this._index++;if(this._index>=this._count){if(this.loop)this._index=0;else{this._index--;this.stop()}this.event("complete")}}};i.stop=function(){this._isPlaying=!1;this.clearTimer(this,this._frameLoop)};i.loadImages=function(t){var e,i,n,s=[];for(e=0,i=t.length;e<i;e++){n=new Graphics;n.loadImage(t[e],0,0);s.push(n)}this.frames=s;return this};i.clear=function(){this.stop();this.graphics=null;this._frames=null};i.loadAtlas=function(t){function e(){var e,n,s,r,o=Loader.getAtlas(t);if(o&&o.length){e=[];for(n=0,s=o.length;n<s;n++){r=new Graphics;r.drawTexture(o[n],0,0);e.push(r)}i.frames=e}}var i=this;Loader.getAtlas(t)?e():Laya.loader.load(t,Handler.create(null,e),null,"atlas");return this};__getset(0,i,"index",function(){return this._index},function(t){this._index=t;this._frames&&(this.graphics=this._frames[t])});__getset(0,i,"count",function(){return this._count});__getset(0,i,"frames",function(){return this._frames},function(t){this._frames=t;this._count=t.length;this._isPlaying?this.play(this._index,this.loop):this.index=this._index});e.fromUrl=function(t,i){var n,s,r,o=e._urlReg.exec(t),a=o[1],h=o[2],l=o[3],u=Laya.__parseInt(h),c=h.length,_=[];for(n=0;n<i;n++){s=u+n;r=Utils.preFixNumber(s,c);_.push(a+r+l)}return(new e).loadImages(_)};__static(e,["_urlReg",function(){return this._urlReg=/^(.*?)\{(.*?)\}(.*)$/}]);return e}(Sprite);Text=function(t){function e(){this._text=null;this._isChanged=!1;this._textWidth=0;this._textHeight=0;this._lines=[];this._startX=NaN;this._startY=NaN;this._lastVisibleLineIndex=-1;this._clipPoint=null;this._currBitmapFont=null;e.__super.call(this);this.overflow=e.VISIBLE;this._style=new CSSStyle(this);this._style.wordWrap=!1}__class(e,"laya.display.Text",t);var i=e.prototype;i.destroy=function(e){void 0===e&&(e=!0);t.prototype.destroy.call(this,e);this._lines=null};i._getBoundPointsM=function(t){void 0===t&&(t=!1);var e=Rectangle.TEMP;e.setTo(0,0,this.width,this.height);return e._getBoundPoints()};i.getGraphicBounds=function(){var t=Rectangle.TEMP;t.setTo(0,0,this.width,this.height);return t};i._getCSSStyle=function(){return this._style};i.lang=function(t,i,n,s,r,o,a,h,l,u,c){t=e.langPacks?e.langPacks[t]:t;if(arguments.length<2)this._text=t;else{for(var _=0,f=arguments.length;_<f;_++)t=t.replace("{"+_+"}",arguments[_+1]);this._text=t}};i.renderText=function(t,e){var i,n,s,r,o,a,h,l,u,c,_,f,d,p,g,m,y,v,w,x,T,S,b=this.graphics;b.clear();i=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;Browser.ctx.font=i;n=this.padding;s=n[3];r="left";o=this._lines;a=this.leading+this.fontSize;h=this._currBitmapFont;h&&(a=this.leading+h.getMaxHeight());l=n[0];if(!h&&this._width>0&&this._textWidth<=this._width)if("right"==this.align){r="right";s=this._width-n[1]}else if("center"==this.align){r="center";s=.5*this._width+n[3]-n[1]}if(this._height>0){u=this._textHeight>this._height?"top":this.valign;"middle"===u?l=.5*(this._height-e*a)+n[0]-n[2]:"bottom"===u&&(l=this._height-e*a-n[2])}c=this._style;h&&h.autoScaleSize&&(_=h.fontSize/this.fontSize);if(this._clipPoint){b.save();if(h&&h.autoScaleSize){f=0;d=0;f=this._width?this._width-n[3]-n[1]:this._textWidth;d=this._height?this._height-n[0]-n[2]:this._textHeight;f*=_;d*=_;b.clipRect(n[3],n[0],f,d)}else b.clipRect(n[3],n[0],this._width?this._width-n[3]-n[1]:this._textWidth,this._height?this._height-n[0]-n[2]:this._textHeight)}p=0,g=0;m=Math.min(this._lines.length,e+t)||1;for(y=t;y<m;y++){v=o[y];if(c.password){w=v.length;v="";for(x=w;x>0;x--)v+="·"}p=s-(this._clipPoint?this._clipPoint.x:0);g=l+a*y-(this._clipPoint?this._clipPoint.y:0);if(h){T=this.width;h.autoScaleSize&&(T=this.width*_);h.drawText(v,this,p,g,this.align,T)}else c.stroke?b.fillBorderText(v,p,g,i,this.color,c.strokeColor,c.stroke,r):b.fillText(v,p,g,i,this.color,r)}if(h&&h.autoScaleSize){S=1/_;this.scale(S,S)}this._clipPoint&&b.restore();this._startX=s;this._startY=l};i.typeset=function(){var t,i;this._isChanged=!1;if(this._text){Browser.ctx.font=this._getCSSStyle().font;this._lines.length=0;this.parseLines(this._text);this.evalTextSize();this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new Point(0,0)):this._clipPoint=null;t=this._lines.length;if(this.overflow!=e.VISIBLE){i=this.overflow==e.HIDDEN?Math.floor:Math.ceil;t=Math.min(t,i((this.height-this.padding[0]-this.padding[2])/(this.leading+this.fontSize)))}this.renderText(0,t);this.repaint()}else{this._clipPoint=null;this._textWidth=this._textHeight=0;this.graphics.clear()}};i.evalTextSize=function(){var t,e,i;this._textWidth=0;for(t=0,e=this._lines.length;t<e;++t){i=this._lines[t];this._textWidth=Math.max(this.getTextWidth(i)+this.padding[3]+this.padding[1],this._textWidth)}this._currBitmapFont?this._textHeight=this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._textHeight=this._lines.length*(this.fontSize+this.leading)+this.padding[0]+this.padding[2]};i.checkEnabledViewportOrNot=function(){return this.overflow==e.SCROLL&&(this._width>0&&this._textWidth>this._width||this._height>0&&this._textHeight>this._height)};i.changeText=function(t){if(this._text!==t){this.lang(t);this._graphics&&this._graphics.replaceText(t)||this.typeset()}};i.parseLines=function(t){var i,n,s,r,o=this.wordWrap||this.overflow==e.HIDDEN;o&&(i=this.getWordWrapWidth());n=t.split(/\r|\n|\\n/);for(s=0,r=n.length;s<r;s++){s<r-1&&(n[s]+="\n");o?this.parseLine(n[s],i):this._lines[s]=n[s]}};i.parseLine=function(t,i){var n,s,r,o,a=(Browser.ctx,this._lines),h=0,l=NaN,u=NaN,c=0;l=this.getTextWidth(t);if(l<=i)a.push(t);else{l=this._currBitmapFont?this._currBitmapFont.getMaxWidth():Browser.ctx.measureText("阳").width;h=Math.floor(i/l);0==h&&(h=1);l=this.getTextWidth(t.substring(0,h));u=l;for(s=h,r=t.length;s<r;s++){l=this.getTextWidth(t.charAt(s));u+=l;if(u>i)if(this.wordWrap){o=t.substring(c,s);n=/\b\w+$/.exec(o);if(n){s=n.index+c;0==n.index?s+=o.length:o=t.substring(c,s)}a.push(o);c=s;if(!(s+h<r)){a.push(t.substring(c,r));c=-1;break}s+=h;l=this.getTextWidth(t.substring(c,s));u=l;s--}else if(this.overflow==e.HIDDEN){a.push(t.substring(0,s));return}}this.wordWrap&&-1!=c&&a.push(t.substring(c,r))}};i.getTextWidth=function(t){return this._currBitmapFont?this._currBitmapFont.getTextWidth(t):Browser.ctx.measureText(t).width};i.getWordWrapWidth=function(){var t=this.padding,e=NaN;e=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width;e<=0&&(e=this.wordWrap?100:Browser.width);e<=0&&(e=100);return e-t[3]-t[1]};i.getCharPoint=function(t,e){var i,n,s,r,o,a,h,l,u;this._isChanged&&Laya.timer.runCallLater(this,this.typeset);i=0,n=this._lines,s=0;for(r=0,o=n.length;r<o;r++){i+=n[r].length;if(t<i){a=r;break}s=i}h=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;Browser.ctx.font=h;l=Browser.ctx.measureText(this._text.substring(s,t)).width;u=e||new Point;return u.setTo(this._startX+l-(this._clipPoint?this._clipPoint.x:0),this._startY+a*(this.fontSize+this.leading)-(this._clipPoint?this._clipPoint.y:0))};__getset(0,i,"textHeight",function(){this._isChanged&&Laya.timer.runCallLater(this,this.typeset);return this._textHeight});__getset(0,i,"width",function(){return this._width?this._width:this.textWidth},function(e){t.prototype._$set_width.call(this,e);this.isChanged=!0});__getset(0,i,"font",function(){return this._getCSSStyle().fontFamily},function(t){if(this._currBitmapFont){this._currBitmapFont=null;this.scale(1,1)}e.bitmapFonts&&e.bitmapFonts[t]&&(this._currBitmapFont=e.bitmapFonts[t]);this._getCSSStyle().fontFamily=t;this.isChanged=!0});__getset(0,i,"height",function(){return this._height?this._height:this.textHeight},function(e){t.prototype._$set_height.call(this,e);this.isChanged=!0});__getset(0,i,"leading",function(){return this._getCSSStyle().leading},function(t){this._getCSSStyle().leading=t;this.isChanged=!0});__getset(0,i,"text",function(){return this._text},function(t){if(this._text!==t){this.lang(t+"");this.isChanged=!0;this.event("change")}});__getset(0,i,"textWidth",function(){this._isChanged&&Laya.timer.runCallLater(this,this.typeset);return this._textWidth});__getset(0,i,"fontSize",function(){return this._getCSSStyle().fontSize},function(t){this._getCSSStyle().fontSize=t;this.isChanged=!0});__getset(0,i,"bold",function(){return this._getCSSStyle().bold},function(t){this._getCSSStyle().bold=t;this.isChanged=!0});__getset(0,i,"color",function(){return this._getCSSStyle().color},function(t){this._getCSSStyle().color=t;!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0});__getset(0,i,"strokeColor",function(){return this._getCSSStyle().strokeColor},function(t){this._getCSSStyle().strokeColor=t;this.isChanged=!0});__getset(0,i,"italic",function(){return this._getCSSStyle().italic},function(t){this._getCSSStyle().italic=t;this.isChanged=!0});__getset(0,i,"align",function(){return this._getCSSStyle().align},function(t){this._getCSSStyle().align=t;this.isChanged=!0});__getset(0,i,"valign",function(){return this._getCSSStyle().valign},function(t){this._getCSSStyle().valign=t;this.isChanged=!0});__getset(0,i,"wordWrap",function(){return this._getCSSStyle().wordWrap},function(t){this._getCSSStyle().wordWrap=t;this.isChanged=!0});__getset(0,i,"padding",function(){return this._getCSSStyle().padding},function(t){this._getCSSStyle().padding=t;this.isChanged=!0});__getset(0,i,"bgColor",function(){return this._getCSSStyle().backgroundColor},function(t){this._getCSSStyle().backgroundColor=t;this.isChanged=!0});__getset(0,i,"borderColor",function(){return this._getCSSStyle().borderColor},function(t){this._getCSSStyle().borderColor=t;this.isChanged=!0});__getset(0,i,"stroke",function(){return this._getCSSStyle().stroke},function(t){this._getCSSStyle().stroke=t;this.isChanged=!0});__getset(0,i,"asPassword",function(){return this._getCSSStyle().password},function(t){this._getCSSStyle().password=t;this.isChanged=!0});__getset(0,i,"isChanged",null,function(t){if(this._isChanged!==t){this._isChanged=t;t&&Laya.timer.callLater(this,this.typeset)}});__getset(0,i,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function(t){var i,n;if(!(this.overflow!=e.SCROLL||this.textWidth<this._width)&&this._clipPoint){t=t<this.padding[3]?this.padding[3]:t;i=this._textWidth-this._width;t=t>i?i:t;n=this._height/(this.fontSize+this.leading)|1;this._clipPoint.x=t;this.renderText(this._lastVisibleLineIndex,n)}});__getset(0,i,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function(t){var i,n,s;if(!(this.overflow!=e.SCROLL||this.textHeight<this._height)&&this._clipPoint){t=t<this.padding[0]?this.padding[0]:t;i=this._textHeight-this._height;t=t>i?i:t;n=t/(this.fontSize+this.leading)|0;this._lastVisibleLineIndex=n;s=(this._height/(this.fontSize+this.leading)|0)+1;this._clipPoint.y=t;this.renderText(n,s)}});__getset(0,i,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width});__getset(0,i,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height});e.registerBitmapFont=function(t,i){e.bitmapFonts||(e.bitmapFonts={});e.bitmapFonts[t]=i};e.unregisterBitmapFont=function(t,i){void 0===i&&(i=!0);if(e.bitmapFonts&&e.bitmapFonts[t]){var n=e.bitmapFonts[t];i&&n.destory();delete e.bitmapFonts[t]}};e.langPacks=null;e.bitmapFonts=null;e.VISIBLE="visible";e.SCROLL="scroll";e.HIDDEN="hidden";return e}(Sprite);Stage=function(t){function e(){var t,i;this.focus=null;this.frameRate="fast";this.desginWidth=0;this.desginHeight=0;this.canvasRotation=!1;this._screenMode="none";this._scaleMode="noscale";this._alignV="top";this._alignH="left";this._bgColor="black";this._mouseMoveTime=0;this._renderCount=0;e.__super.call(this);this.offset=new Point;this.now=Browser.now();this._canvasTransform=new Matrix;this._preLoopTime=Browser.now();this.mouseEnabled=!0;this._displayInStage=!0;t=this;i=Browser.window;i.addEventListener("focus",function(){t.event("focus")});i.addEventListener("blur",function(){t.event("blur")});i.addEventListener("resize",function(){t._resetCanvas();Laya.timer.once(100,t,t._changeCanvasSize)});i.addEventListener("orientationchange",function(e){t._resetCanvas();Laya.timer.once(100,t,t._changeCanvasSize)});this.on("mousemove",this,this._onmouseMove)}__class(e,"laya.display.Stage",t);var i=e.prototype;i.size=function(t,e){this.desginWidth=this.width=t;this.desginHeight=this.height=e;Laya.timer.callLater(this,this._changeCanvasSize);return this};i._changeCanvasSize=function(){this.setScreenSize(Browser.clientWidth*Browser.pixelRatio,Browser.clientHeight*Browser.pixelRatio)};i._resetCanvas=function(){var t=Render.canvas,e=t.source.style;t.size(1,1);e.transform=e.webkitTransform=e.msTransform=e.mozTransform=e.oTransform="";this.visible=!1};i.setScreenSize=function(t,e){var i,n,s,r,o,a,h,l,u,c,_,f,d,p=!1;if("none"!==this._screenMode){i=t/e<1?"vertical":"horizontal";p=i!==this._screenMode;if(p){n=e;e=t;t=n}}this.canvasRotation=p;s=Render.canvas;r=s.source.style;o=this._canvasTransform.identity();a=this._scaleMode;h=t/this.desginWidth;l=e/this.desginHeight;u=this.desginWidth;c=this.desginHeight;_=t;f=e;d=Browser.pixelRatio;this._width=this.desginWidth;this._height=this.desginHeight;switch(a){case"noscale":h=l=1;_=this.desginWidth;f=this.desginHeight;break;case"showall":h=l=Math.min(h,l);_=Math.round(this.desginWidth*h);f=Math.round(this.desginHeight*l);break;case"noborder":h=l=Math.max(h,l);_=Math.round(this.desginWidth*h);f=Math.round(this.desginHeight*l);break;case"full":h=l=1;this._width=u=t;this._height=c=e;break;case"fixedwidth":l=h;this._height=e/h;c=Math.round(e/h);break;case"fixedheight":h=l;this._width=t/l;u=Math.round(t/l)}if(1===h&&1===l)this.transform&&this.transform.identity();else{this.transform||(this.transform=new Matrix);this.transform.a=h/(_/u);this.transform.d=l/(f/c)}s.size(u,c);System.changeWebGLSize(u,c);o.scale(_/u/d,f/c/d);"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=t-_:this.offset.x=.5*(t-_)/d;"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=e-f:this.offset.y=.5*(e-f)/d;o.translate(this.offset.x,this.offset.y);if(p)if("horizontal"===this._screenMode){o.rotate(Math.PI/2);o.translate(e/d,0)}else{o.rotate(-Math.PI/2);o.translate(0,t/d)}o.a<1e-14&&(o.a=o.d=0);r.transformOrigin=r.webkitTransformOrigin=r.msTransformOrigin=r.mozTransformOrigin=r.oTransformOrigin="0px 0px 0px";r.transform=r.webkitTransform=r.msTransform=r.mozTransform=r.oTransform="matrix("+o.toString()+")";this.visible=!0;this._repaint=1;this.event("resize")};i.repaint=function(){this._repaint=1};i.parentRepaint=function(t){};i._loop=function(){this.render(Render.context,0,0);return!0};i._onmouseMove=function(t){this._mouseMoveTime=Browser.now()};i.render=function(e,i,n){var s,r,o,a,h=Browser.now();Log.enable()&&h-this.now>500&&Log.print("-------------render delay:"+(Browser.now()-this.now)+"  cound:"+this._renderCount);this.now=h;this._renderCount++;s=h-this._preLoopTime;r="slow"!==this.frameRate;o=this._renderCount%2===0;a=Render.context;Stat.renderSlow=!r;if(r||o){Stat.loopCount++;MouseManager.instance.runEvent();Laya.timer._update();if(this._style.visible){Render.isWebGl?a.clear():Render.clear(this._bgColor);t.prototype.render.call(this,e,i,n)}}if(this._style.visible&&(r||!o)){Render.isWebGl&&Render.clear(this._bgColor);e.flush();Render.finish()}this._preLoopTime=h};__getset(0,i,"scaleMode",function(){return this._scaleMode},function(t){this._scaleMode=t;Laya.timer.callLater(this,this._changeCanvasSize)});__getset(0,i,"alignH",function(){return this._alignH},function(t){this._alignH=t;Laya.timer.callLater(this,this._changeCanvasSize)});__getset(0,i,"alignV",function(){return this._alignV},function(t){this._alignV=t;Laya.timer.callLater(this,this._changeCanvasSize)});__getset(0,i,"bgColor",function(){return this._bgColor},function(t){this._bgColor=t;t?Render.canvas.source.style.background=t:Render.canvas.source.style.background="none"});__getset(0,i,"mouseX",function(){return Math.round(MouseManager.instance.mouseX/(this._transform?this._transform.a:1))});__getset(0,i,"mouseY",function(){return Math.round(MouseManager.instance.mouseY/(this._transform?this._transform.d:1))});__getset(0,i,"clientScaleX",function(){return this._transform?this._transform.a:1});__getset(0,i,"clientScaleY",function(){return this._transform?this._transform.d:1});__getset(0,i,"screenMode",function(){return this._screenMode},function(t){this._screenMode=t});e.SCALE_NOSCALE="noscale";e.SCALE_EXACTFIT="exactfit";e.SCALE_SHOWALL="showall";e.SCALE_NOBORDER="noborder";e.SCALE_FULL="full";e.SCALE_FIXED_WIDTH="fixedwidth";e.SCALE_FIXED_HEIGHT="fixedheight";e.ALIGN_LEFT="left";e.ALIGN_RIGHT="right";e.ALIGN_CENTER="center";e.ALIGN_TOP="top";e.ALIGN_MIDDLE="middle";e.ALIGN_BOTTOM="bottom";e.SCREEN_NONE="none";e.SCREEN_HORIZONTAL="horizontal";e.SCREEN_VERTICAL="vertical";e.FRAME_FAST="fast";e.FRAME_SLOW="slow";e.FRAME_MOUSE="mouse";return e}(Sprite);FileBitmap=function(t){function e(){this._src=null;this._onload=null;this._onerror=null;e.__super.call(this)}__class(e,"laya.resource.FileBitmap",t);var i=e.prototype;__getset(0,i,"onload",null,function(t){});__getset(0,i,"src",function(){return this._src},function(t){this._src=t});__getset(0,i,"onerror",null,function(t){});return e}(Bitmap);HTMLCanvas=function(t){function e(t){var i,n;this._is2D=!1;e.__super.call(this);i=this;this._source=this;if("2D"===t||"AUTO"===t&&!Render.isWebGl){this._is2D=!0;this._source=Browser.createElement("canvas");n=this;n.getContext=function(t,e){if(i._ctx)return i._ctx;var s=i._ctx=i._source.getContext(t,e);if(s){s._canvas=n;s.size=function(){}}"2d"===t&&Context._init(n,s);return s}}else this._source={}}__class(e,"laya.resource.HTMLCanvas",t);var i=e.prototype;i.clear=function(){this._ctx&&this._ctx.clear()};i.destroy=function(){this._ctx&&this._ctx.destroy();this._ctx=null};i.release=function(){};i._setContext=function(t){this._ctx=t};i.getContext=function(t,i){return this._ctx?this._ctx:this._ctx=e._createContext(this)};i.copyTo=function(e){t.prototype.copyTo.call(this,e);e._ctx=this._ctx};i.getMemSize=function(){return 0};i.size=function(t,e){if(this._w!=t||this._h!=e){this._w=t;this._h=e;this._ctx&&this._ctx.size(t,e);this._source&&(this._source.height=e,this._source.width=t)}};__getset(0,i,"context",function(){return this._ctx});__getset(0,i,"asBitmap",null,function(t){});e.TYPE2D="2D";e.TYPE3D="3D";e.TYPEAUTO="AUTO";e._createContext=null;return e}(Bitmap);HTMLSubImage=function(t){function e(t,i,n,s,r,o,a,h){e.__super.call(this);void 0===h&&(h=!1);throw new Error("不允许new！")}__class(e,"laya.resource.HTMLSubImage",t);return e}(Bitmap);Input=function(t){function e(){this._focus=!1;this._multiline=!1;this._editable=!0;this._restrictPattern=null;this.inputElementXAdjuster=0;this.inputElementYAdjuster=0;this.title="";this.clearOnFocus=!1;e.__super.call(this);this._maxChars=1e5;this._width=100;this._height=20;this.multiline=!1;this.overflow=Text.SCROLL;this.on("mousedown",this,this.onMouseDown);this.on("undisplay",this,this.onUnDisplay)}__class(e,"laya.display.Input",t);var i=e.prototype;i.onStageDown=function(t){if(t.target!=this){if(t.target instanceof laya.display.Input){this.focusOut();this.removeNeedlessInputMethod()}else this.focus=!1;Laya.stage.off("mousedown",this,this.onStageDown)}};i.onUnDisplay=function(t){this.focus=!1};i.onMouseDown=function(t){this.focus=!0;Browser.onMobile||Laya.stage.on("mousedown",this,this.onStageDown)};i.render=function(t,e,i){laya.display.Sprite.prototype.render.call(this,t,e,i)};i.syncInputPosition=function(){var t,e=this.nativeInput.style,i=Laya.stage,n=Utils.getGlobalPosAndScale(this),s=i._canvasTransform.a,r=i._canvasTransform.d;e.left=(n.x+this.padding[3]+this.inputElementXAdjuster)*i.clientScaleX*s+i.offset.x+"px";e.top=(n.y+this.padding[0]+this.inputElementYAdjuster)*i.clientScaleY*r+i.offset.y+"px";this._getVisible()||(this.focus=!1);if(i.transform||1!=n.width||1!=n.height){t="scale("+i.clientScaleX*s*n.width+","+i.clientScaleY*r*n.height+")";if(t!=e.transform){e.transformOrigin="0 0";e.transform=t}}};i._getVisible=function(){for(var t=this;t;){if(t.visible===!1)return!1;t=t.parent}return!0};i.select=function(){this.nativeInput.select()};i.focusIn=function(){var t,i,n,s,r,o=this.nativeInput;this._focus=!0;t=e.cssStyle;t+=";white-space:"+(this.wordWrap?"normal":"nowrap");o.readOnly=!this._editable;o.maxLength=this._maxChars;i=this.padding;n=this._width-i[1]-i[3];s=this._height-i[0]-i[2];t+=";width:"+n+"px";t+=";height:"+s+"px";t+=";color:"+this.color;t+=";font-size:"+this.fontSize+"px";t+=";font-family:"+this.font;t+=";line-height:"+(this.leading+this.fontSize)+"px";t+=";font-style:"+(this.italic?"italic":"normal");t+=";font-weight:"+(this.bold?"bold":"normal");t+=";text-align:"+this.align;r=this._text;o.value=r;this._text="";this.typeset();this._text=r;o.style.cssText=t;o.type=this.asPassword?"password":"input";o.focus();Laya.stage.off("keydown",this,this.onKeyDown);Laya.stage.on("keydown",this,this.onKeyDown);Laya.stage.focus=this;this.event("focus");Laya.timer.frameLoop(1,this,this.syncInputPosition)};i.focusOut=function(){this._focus=!1;var e=this._text||"";this._text="";t.prototype._$set_text.call(this,e);Laya.stage.off("keydown",this,this.onKeyDown);Laya.stage.focus=null;this.event("blur");Browser.document.body.scrollTop=0;Laya.timer.clear(this,this.syncInputPosition)};i.removeNeedlessInputMethod=function(){var t=Browser.document.body;!this._multiline&&t.contains(e.input)&&t.contains(e.area)?Browser.document.body.removeChild(e.input):this._multiline&&t.contains(e.area)&&t.contains(e.input)&&Browser.document.body.removeChild(e.area)};i.onKeyDown=function(t){13===t.keyCode&&this.event("enter")};__getset(0,i,"multiline",function(){return this._multiline},function(t){this._multiline=t;this.valign=t?"top":"middle";Browser.onMobile||(t?e.area||e.initInput(e.area=Browser.createElement("textarea")):e.input||e.initInput(e.input=Browser.createElement("input")))});__getset(0,i,"color",t.prototype._$get_color,function(e){this._focus&&(this.nativeInput.style.color=e);t.prototype._$set_color.call(this,e)});__getset(0,i,"nativeInput",function(){return this._multiline?e.area:e.input});__getset(0,i,"focus",function(){return this._focus},function(t){var e,i;if(Browser.onMobile){if(t&&this._editable){e=Browser.window.prompt(this.clearOnFocus?"":(this.title,this._text||""));if(null!=e){this._restrictPattern&&(e=e.replace(this._restrictPattern,""));this.text=e;this.event("input");this.event("blur")}}}else{
i=this.nativeInput;if(this._focus!==t){laya.display.Input.isInputting=t;if(t){i.target&&(i.target.focus=!1);i.target=this;Browser.document.body.appendChild(i);this.focusIn()}else{i.target=null;this.focusOut();Browser.document.body.removeChild(i)}}}});__getset(0,i,"text",function(){return this._focus?this.nativeInput.value:this._text},function(e){this._focus&&(this.nativeInput.value=e||"");t.prototype._$set_text.call(this,e)});__getset(0,i,"maxChars",function(){return this._maxChars},function(t){t<=0&&(t=1e5);this._maxChars=t});__getset(0,i,"restrict",function(){return this._restrictPattern.source},function(t){if(t){t="[^"+t+"]";t.indexOf("^^")>-1&&(t=t.replace("^^",""));this._restrictPattern=new RegExp(t,"g")}else this._restrictPattern=null});__getset(0,i,"editable",function(){return this._editable},function(t){this._editable=t});e.getActiveInput=function(){return Browser.document.body.contains(e.input)?e.input:Browser.document.body.contains(e.area)?e.area:null};e.initInput=function(t){var i=t.style;i.cssText=e.cssStyle;t.addEventListener("input",function(e){var i,n=t.target;if(n){i=t.value;if(n._restrictPattern){i=i.replace(n._restrictPattern,"");t.value=i}n._text=i;n.event("input")}});t.addEventListener("mousemove",e._stopEvent);t.addEventListener("mousedown",e._stopEvent);t.addEventListener("touchmove",e._stopEvent)};e._stopEvent=function(t){t.stopPropagation()};e.cssStyle="position:absolute;background-color:transparent;border:none;outline:none;resize:none;overflow:hidden;z-index:999";e.input=null;e.area=null;e.inputHeight=50;e.textAreaHeight=75;e.inputFontSize=25;e.borderStyle="3px solid orange";e.backgroundStyle="Linen";e.isInputting=!1;return e}(Text);HTMLImage=function(t){function e(t){this._recreateLock=!1;this._needReleaseAgain=!1;this._source=t||new Browser.window.Image;e.__super.call(this)}__class(e,"laya.resource.HTMLImage",t);var i=e.prototype;i.recreateResource=function(){var t,e=this;if(""===this._src)throw new Error("src不能为空！");this.startCreate();if(this._source){if(this._recreateLock)return;this.memorySize=this._w*this._h*4;this._recreateLock=!1;this.compoleteCreate()}else{this._recreateLock=!0;t=this;this._source=new Browser.window.Image;this._source.onload=function(){t._source.onload=null;if(t._needReleaseAgain){t._needReleaseAgain=!1;t._source=null}else{t.memorySize=e._w*e._h*4;t._recreateLock=!1;t.compoleteCreate()}};this._source.src=this._src}};i.detoryResource=function(){this._recreateLock&&(this._needReleaseAgain=!0);this._source&&(this._source=null,this.memorySize=0)};i.onresize=function(){this._w=this._source.width;this._h=this._source.height};i.dispose=function(){this.resourceManager.removeResource(this);laya.resource.Bitmap.prototype.dispose.call(this)};__getset(0,i,"source",function(){return this._source});__getset(0,i,"onload",null,function(t){var e=this;this._onload=t;this._source&&(this._source.onload=null!=this._onload?function(){e.onresize();e._onload()}:null)});__getset(0,i,"src",t.prototype._$get_src,function(t){this._src=t;this._source&&(this._source.src=this._src)});__getset(0,i,"onerror",null,function(t){var e=this;this._onerror=t;this._source&&(this._source.onerror=null!=this._onerror?function(){e._onerror()}:null)});return e}(FileBitmap);Laya.__init([Timer,LoaderManager,EventDispatcher,Browser,LocalStorage,LaterEvent,TimeLine])}(window,document,Laya);!function(t,e,i){var n=(i.un,i.uns,i["static"],i["class"]),s=(i.getset,i.__newvec,function(){function t(){}n(t,"LayaMain");return t}());new s}(window,document,Laya);
!function(t,e,i){var r,s,a,n,h,l,o,u,c,_,f,d,g,m,p,b,x,v,y,T,w,A,S,I,M,C,R,E,L,D,F,P,O,V,B,N,G,H,k,z,U,W,Y,X,Q,j,q,K,$,Z,J,tt,et,it,rt,st,at,nt,ht,lt,ot,ut,ct,_t,ft,dt,gt,mt,pt,bt=(i.un,i.uns,i["static"]),xt=i["class"],vt=i.getset,yt=i.__newvec,Tt=laya.maths.Arith,wt=laya.utils.Browser,At=laya.renders.Render,St=laya.resource.Bitmap,It=laya.maths.Rectangle,Mt=laya.resource.Context,Ct=(laya.utils.HTMLChar,laya.display.Sprite,laya.maths.Point),Rt=(laya.filters.ColorFilter,laya.utils.Handler,laya.maths.Matrix),Et=(laya.renders.RenderContext,laya.utils.Stat),Lt=laya.resource.HTMLCanvas,Dt=laya.resource.HTMLImage,Ft=(laya.display.Text,laya.resource.Texture),Pt=laya.utils.Color,Ot=laya.utils.Utils,Vt=i.Config,Bt=laya.renders.RenderSprite,Nt=laya.resource.FileBitmap,Gt=laya.display.Graphics,Ht=laya.system.System,kt=(laya.events.Event,laya.display.css.Style,laya.resource.Resource),zt=laya.utils.StringKey,Ut=(laya.utils.Byte,laya.filters.Filter),Wt=laya.resource.ResourceManager;i["interface"]("laya.webgl.shapes.IShape");i["interface"]("laya.webgl.submit.ISubmit");i["interface"]("laya.webgl.canvas.save.ISaveData");i["interface"]("laya.webgl.resource.IMergeAtlasBitmap");i["interface"]("laya.filters.IFilterActionGL","laya.filters.IFilterAction");r=function(){function t(){}xt(t,"laya.filters.webgl.FilterActionGL");var e=t.prototype;i.imps(e,{"laya.filters.IFilterActionGL":!0});e.setValue=function(t){};e.setValueMix=function(t){};e.apply3d=function(t,e,i,r,s){return null};e.apply=function(t){return null};vt(0,e,"typeMix",function(){return 0});return t}();s=function(){function t(){}xt(t,"laya.webgl.shader.ShaderValue");return t}();a=function(){function t(t,e,i){this._atlasID=0;this._width=0;this._height=0;this._texCount=0;this._rowInfo=null;this._cells=null;this._failSize=new r;void 0===t&&(t=0);void 0===e&&(e=0);void 0===i&&(i=0);this._cells=null;this._rowInfo=null;this._init(t,e);this._atlasID=i}var e,i,r,s;xt(t,"laya.webgl.atlas.AtlasGrid");s=t.prototype;s.getAltasID=function(){return this._atlasID};s.setAltasID=function(t){t>=0&&(this._atlasID=t)};s.addTex=function(t,e,i){var r=this._get(e,i);if(0==r.ret)return r;this._fill(r.x,r.y,e,i,t);this._texCount++;return r};s._release=function(){if(null!=this._cells){this._cells.length=0;this._cells=null}if(this._rowInfo){this._rowInfo.length=0;this._rowInfo=null}};s._init=function(t,r){this._width=t;this._height=r;this._release();if(0==this._width)return!1;this._cells=new Array(this._width*this._height);this._rowInfo=yt(this._height);for(var s=0;s<this._height;s++)this._rowInfo[s]=new i;for(s=0;s<this._width*this._height;s++)this._cells[s]=new e;this._clear();return!0};s._get=function(t,e){var i,r,s,a,n,l,o,u,c=new h;if(t>=this._failSize.width&&e>=this._failSize.height)return c;i=-1;r=-1;s=this._width;a=this._height;n=this._cells;for(l=0;l<a;l++)if(!(this._rowInfo[l].spaceCount<t))for(o=0;o<s;)if(0!=n[l*s+o].type||n[l*s+o].successionWidth<t||n[l*s+o].successionHeight<e)o+=n[l*s+o].successionWidth;else{i=o;r=l;for(u=0;u<t;u++)if(n[l*s+o+u].successionHeight<e){i=-1;break}if(!(i<0)){c.ret=!0;c.x=i;c.y=r;return c}o+=n[l*s+o].successionWidth}return c};s._fill=function(t,e,i,r,s){var a,n,h,l=this._width,o=this._height;this._check(t+i<=l&&e+r<=o);for(a=e;a<r+e;++a){this._check(this._rowInfo[a].spaceCount>=i);this._rowInfo[a].spaceCount-=i;for(n=0;n<i;n++){this._check(0==this._cells[t+a*l+n].type);this._cells[t+a*l+n].type=s;this._cells[t+a*l+n].successionWidth=i;this._cells[t+a*l+n].successionHeight=r}}if(t>0)for(a=0;a<r;++a){h=0;for(n=t-1;n>=0&&0==this._cells[(e+a)*l+n].type;--n,++h);for(n=h;n>0;--n){this._cells[(e+a)*l+t-n].successionWidth=n;this._check(n>0)}}if(e>0)for(n=t;n<t+i;++n){h=0;for(a=e-1;a>=0&&0==this._cells[n+a*l].type;--a,h++);for(a=h;a>0;--a){this._cells[n+(e-a)*l].successionHeight=a;this._check(a>0)}}};s._check=function(t){0==t&&console.log("xtexMerger 错误啦")};s._clear=function(){var t,e,i,r;this._texCount=0;for(t=0;t<this._height;t++)this._rowInfo[t].spaceCount=this._width;for(e=0;e<this._height;e++)for(i=0;i<this._width;i++){r=this._cells[e*this._width+i];r.type=0;r.successionWidth=this._width-i;r.successionHeight=this._width-e}this._failSize.width=this._width+1;this._failSize.height=this._height+1};t.__init$=function(){e=function(){function t(){this.type=0;this.successionWidth=0;this.successionHeight=0}xt(t,"");return t}();i=function(){function t(){this.spaceCount=0}xt(t,"");return t}();r=function(){function t(){this.width=0;this.height=0}xt(t,"");return t}()};return t}();n=function(){function t(t,e,i,r){this._currentAtlasCount=0;this._maxAtlaserCount=0;this._width=0;this._height=0;this._gridSize=0;this._gridNumX=0;this._gridNumY=0;this._init=!1;this._curAtlasIndex=0;this._setAtlasParam=!1;this._atlaserArray=null;this._needGC=!1;this._setAtlasParam=!0;this._width=t;this._height=e;this._gridSize=i;this._maxAtlaserCount=r;this._gridNumX=t/i;this._gridNumY=e/i;this._curAtlasIndex=0;this._atlaserArray=[]}xt(t,"laya.webgl.atlas.AtlasResourceManager");var e=t.prototype;e.setAtlasParam=function(e,i,r,s){if(1==this._setAtlasParam){t._sid_=0;this._width=e;this._height=i;this._gridSize=r;this._maxAtlaserCount=s;this._gridNumX=e/r;this._gridNumY=i/r;this._curAtlasIndex=0;this.freeAll();return!0}console.log("设置大图合集参数错误，只能在开始页面设置各种参数");throw-1;return!1;return!1};e.pushData=function(e){var i,r,s,a,n,h,l,o,u,c,_,f,d,g,m;this._setAtlasParam=!1;i=!1;r=Math.ceil((e.bitmap.width+2)/this._gridSize);s=Math.ceil((e.bitmap.height+2)/this._gridSize);a=!1;for(n=0;n<2;n++){h=this._maxAtlaserCount;for(l=0;l<h;l++){o=(this._curAtlasIndex+l)%h;this._atlaserArray[o]||this._atlaserArray.push(new W(this._gridNumX,this._gridNumY,this._width,this._height,t._sid_++));u=this._atlaserArray[o];c=e.bitmap;_=u.inAtlasWebGLImagesKey.indexOf(c);f=0,d=0;if(-1!=_){m=u.InAtlasWebGLImagesOffsetValue[_];f=m[0];d=m[1];u.addToAtlas(e,f,d);a=!0;this._curAtlasIndex=o;break}g=u.addTex(1,r,s);if(g.ret){f=g.x*this._gridSize+1;d=g.y*this._gridSize+1;c.lock=!0;u.addToAtlasTexture(c,f,d);u.addToAtlas(e,f,d);a=!0;this._curAtlasIndex=o;break}}if(a)break;this._atlaserArray.push(new W(this._gridNumX,this._gridNumY,this._width,this._height,t._sid_++));this._needGC=!0;this.garbageCollection();this._curAtlasIndex=this._atlaserArray.length-1}a||console.log(">>>AtlasManager pushData error");return a};e.addToAtlas=function(t){laya.webgl.atlas.AtlasResourceManager.instance.pushData(t)};e.garbageCollection=function(){var t,e;if(this._needGC===!0){t=this._atlaserArray.length-this._maxAtlaserCount;for(e=0;e<t;e++)this._atlaserArray[e].dispose();this._atlaserArray.splice(0,t);this._needGC=!1}return!0};e.freeAll=function(){for(var t=0,e=this._atlaserArray.length;t<e;t++)this._atlaserArray[t].dispose();this._atlaserArray.length=0};vt(1,t,"instance",function(){t._Instance||(t._Instance=new t(t.atlasTextureWidth,t.atlasTextureHeight,t.gridSize,t.maxTextureCount));return t._Instance});vt(1,t,"atlasLimitWidth",function(){return t._atlasLimitWidth},function(e){t._atlasLimitWidth=e});vt(1,t,"enabled",function(){return t._enabled});vt(1,t,"atlasLimitHeight",function(){return t._atlasLimitHeight},function(e){t._atlasLimitHeight=e});t.enable=function(){t._enabled=!0;Vt.atlasEnable=!0};t.disable=function(){t._enabled=!1;Vt.atlasEnable=!1};t.__init__=function(){t.atlasTextureWidth=2048;t.atlasTextureHeight=2048;t.gridSize=16;t.maxTextureCount=8;t.atlasLimitWidth=512;t.atlasLimitHeight=512};t._enabled=!1;t._atlasLimitWidth=0;t._atlasLimitHeight=0;t.atlasTextureWidth=0;t.atlasTextureHeight=0;t.gridSize=0;t.maxTextureCount=0;t.BOARDER_TYPE_NO=0;t.BOARDER_TYPE_RIGHT=1;t.BOARDER_TYPE_LEFT=2;t.BOARDER_TYPE_BOTTOM=4;t.BOARDER_TYPE_TOP=8;t.BOARDER_TYPE_ALL=15;t._sid_=0;t._Instance=null;return t}();h=function(){function t(){this.x=0;this.y=0;this.ret=!1;this.ret=!1;this.x=0;this.y=0}xt(t,"laya.webgl.atlas.MergeFillInfo");return t}();l=function(){function t(){}xt(t,"laya.webgl.canvas.BlendMode");t._init_=function(e){t.fns=[t.BlendNormal,t.BlendAdd,t.BlendMultiply,t.BlendScreen,t.BlendOverlay,t.BlendLight];t.targetFns=[t.BlendNormalTarget,t.BlendAddTarget,t.BlendMultiplyTarget,t.BlendScreenTarget,t.BlendOverlayTarget,t.BlendLightTarget]};t.BlendNormal=function(t){t.blendFunc(770,771)};t.BlendAdd=function(t){t.blendFunc(770,772)};t.BlendMultiply=function(t){t.blendFunc(774,771)};t.BlendScreen=function(t){t.blendFunc(770,1)};t.BlendOverlay=function(t){t.blendFunc(1,769)};t.BlendLight=function(t){t.blendFunc(770,1)};t.BlendNormalTarget=function(t){t.blendFuncSeparate(770,771,1,771)};t.BlendAddTarget=function(t){t.blendFunc(770,772)};t.BlendMultiplyTarget=function(t){t.blendFunc(774,771)};t.BlendScreenTarget=function(t){t.blendFunc(770,1)};t.BlendOverlayTarget=function(t){t.blendFunc(1,769)};t.BlendLightTarget=function(t){t.blendFunc(770,1)};t.NAMES=["normal","add","multiply","screen","overlay","light"];t.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5};t.NORMAL="normal";t.ADD="add";t.MULTIPLY="multiply";t.SCREEN="screen";t.LIGHT="light";t.OVERLAY="overlay";t.fns=[];t.targetFns=[];return t}();o=function(){function t(t){this._color=Pt.create("black");this.setValue(t)}xt(t,"laya.webgl.canvas.DrawStyle");var e=t.prototype;e.setValue=function(t){if(t){if("string"==typeof t){this._color=Pt.create(t);return}if(t instanceof laya.utils.Color){this._color=t;return}}};e.reset=function(){this._color=Pt.create("black")};e.equal=function(t){return"string"==typeof t?this._color.strColor===t:!1};e.toColorStr=function(){return this._color.strColor};t.DEFAULT=new t("#000000");return t}();u=function(){function t(){this._x=0;this._y=0;this.dirty=!1;this.offset=0;this.count=0;this.geoStart=0;this.geomatrys=[];V.mainContext;this.ib=new rt(34963,"INDEX",null,35044);this.vb=new rt(34962)}xt(t,"laya.webgl.canvas.Path");var e=t.prototype;e.clear=function(){this._rect=null};e.rect2=function(t,e,i,r,s,a,n){void 0===a&&(a=2);void 0===n&&(n=0);this.geomatrys.push(this._curGeomatry=new Z(t,e,i,r,s,a,n))};e.rect=function(t,e,i,r){this._rect=new It(t,e,i,r);this.dirty=!0};e.strokeRect=function(t,e,i,r){this._rect=new It(t,e,i,r)};e.circle=function(t,e,i,r,s,a,n){var h;this.geomatrys.push(this._curGeomatry=h=new X(t,e,i,r,s,a,n));s||(h.fill=!1);void 0==n&&(h.borderWidth=0)};e.fan=function(t,e,i,r,s,a,n,h){var l;this.geomatrys.push(this._curGeomatry=l=new j(t,e,i,r,s,a,n,h));a||(l.fill=!1)};e.ellipse=function(t,e,i,r,s,a,n){this.geomatrys.push(this._curGeomatry=new Q(t,e,i,r,s,a,n))};e.polygon=function(t,e,i,r,s,a){var n;this.geomatrys.push(this._curGeomatry=n=new $(t,e,i,r,s,a));r||(n.fill=!1);void 0==a&&(n.borderWidth=0)};e.loopLine=function(t,e,i,r,s){var a;this.geomatrys.push(this._curGeomatry=a=new K(t,e,i,r,s));a.fill=!1};e.drawPath=function(t,e,i,r,s){this.geomatrys.push(this._curGeomatry=new q(t,e,i,r,s))};e.update=function(){var t,e=this.ib.length,i=this.geomatrys.length;this.offset=e;for(t=this.geoStart;t<i;t++)this.geomatrys[t].getData(this.ib,this.vb,this.vb.length/20);this.geoStart=i;this.count=(this.ib.length-e)/2};e.sector=function(t,e,i,r){};e.roundRect=function(t,e,i,r,s,a){};e.reset=function(){this.vb.clear();this.ib.clear();this.offset=this.count=this.geoStart=0;this.geomatrys.length=0};return t}();c=function(){function t(){}xt(t,"laya.webgl.canvas.save.SaveBase");var e=t.prototype;i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0});e.isSaveMark=function(){return!1};e.restore=function(e){this._dataObj[this._valueName]=this._value;t._cache[t._cache._length++]=this;this._newSubmit&&(e._curSubmit=T.RENDERBASE)};t._createArray=function(){var t=[];t._length=0;return t};t._init=function(){var e=t._namemap={};e[1]="ALPHA";e[2]="fillStyle";e[8]="font";e[256]="lineWidth";e[512]="strokeStyle";e[8192]="_mergeID";e[1024]=e[2048]=e[4096]=[];e[16384]="textBaseline";e[32768]="textAlign";e[65536]="_nBlendType";e[524288]="shader";e[1048576]="filters";return e};t.save=function(e,i,r,s){var a,n,h;if((e._saveMark._saveuse&i)!==i){e._saveMark._saveuse|=i;a=t._cache;n=a._length>0?a[--a._length]:new t;n._value=r[n._valueName=t._namemap[i]];n._dataObj=r;n._newSubmit=s;h=e._save;h[h._length++]=n}};t._cache=laya.webgl.canvas.save.SaveBase._createArray();t._namemap=t._init();return t}();_=function(){function t(){this._clipRect=new It}xt(t,"laya.webgl.canvas.save.SaveClipRect");var e=t.prototype;i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0});e.isSaveMark=function(){return!1};e.restore=function(e){e._clipRect=this._clipSaveRect;t._cache[t._cache._length++]=this;this._submitScissor.submitLength=e._submits._length-this._submitScissor.submitIndex;e._curSubmit=T.RENDERBASE};t.save=function(e,i){var r,s,a;if(131072!=(131072&e._saveMark._saveuse)){e._saveMark._saveuse|=131072;r=t._cache;s=r._length>0?r[--r._length]:new t;s._clipSaveRect=e._clipRect;e._clipRect=s._clipRect.copyFrom(e._clipRect);s._submitScissor=i;a=e._save;a[a._length++]=s}};t._cache=c._createArray();return t}();f=function(){function t(){this._saveuse=0}xt(t,"laya.webgl.canvas.save.SaveMark");var e=t.prototype;i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0});e.isSaveMark=function(){return!0};e.restore=function(e){e._saveMark=this._preSaveMark;t._no[t._no._length++]=this};t.Create=function(e){var i=t._no,r=i._length>0?i[--i._length]:new t;r._saveuse=0;r._preSaveMark=e._saveMark;e._saveMark=r;return r};t._no=c._createArray();return t}();d=function(){function t(){this._matrix=new Rt}xt(t,"laya.webgl.canvas.save.SaveTransform");var e=t.prototype;i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0});e.isSaveMark=function(){return!1};e.restore=function(e){e._curMat=this._savematrix;t._no[t._no._length++]=this};t.save=function(e){var i,r,s,a=e._saveMark;if(2048!==(2048&a._saveuse)){a._saveuse|=2048;i=t._no;r=i._length>0?i[--i._length]:new t;r._savematrix=e._curMat;e._curMat=e._curMat.copy(r._matrix);s=e._save;s[s._length++]=r}};t._no=c._createArray();return t}();g=function(){function t(){}xt(t,"laya.webgl.canvas.save.SaveTranslate");var e=t.prototype;i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0});e.isSaveMark=function(){return!1};e.restore=function(e){e._curMat;e._x=this._x;e._y=this._y;t._no[t._no._length++]=this};t.save=function(e){var i,r=t._no,s=r._length>0?r[--r._length]:new t;s._x=e._x;s._y=e._y;i=e._save;i[i._length++]=s};t._no=c._createArray();return t}();m=function(){function t(){this.targets=null;this.oneTargets=null;this.repaint=!1;this._width=NaN;this._height=NaN;this._clipRect=new It}var e,i;xt(t,"laya.webgl.resource.RenderTargetMAX");i=t.prototype;i.size=function(t,i){if(this._width!==t||this._height!==i){this.repaint=!0;this._width=t;this._height=i;this.oneTargets?this.oneTargets.target.size(t,i):this.oneTargets=new e(t,i)}};i._flushToTarget=function(e,i){var r,s,a,n,h,l,o=P.worldScissorTest,u=P.worldClipRect;P.worldClipRect=this._clipRect;this._clipRect.x=this._clipRect.y=0;this._clipRect.width=this._width;this._clipRect.height=this._height;P.worldScissorTest=!1;V.mainContext.disable(3089);r=P.worldAlpha;s=P.worldMatrix4;a=P.worldMatrix;n=P.worldFilters;h=P.worldShaderDefines;P.worldMatrix=t._matrixDefault;P.worldMatrix4=P.TEMPMAT4_ARRAY;P.worldAlpha=1;P.worldFilters=null;P.worldShaderDefines=null;et.activeShader=null;i.start();Vt.showCanvasMark?i.clear(0,1,0,.3):i.clear(0,0,0,0);e.flush();i.end();et.activeShader=null;P.worldAlpha=r;P.worldMatrix4=s;P.worldMatrix=a;P.worldFilters=n;P.worldShaderDefines=h;P.worldScissorTest=o;if(o){l=P.height-u.y-u.height;V.mainContext.scissor(u.x,l,u.width,u.height);V.mainContext.enable(3089)}P.worldClipRect=u};i.flush=function(t){if(this.repaint){this._flushToTarget(t,this.oneTargets.target);this.repaint=!1}};i.drawTo=function(t,e,i,r,s){t.drawTexture(this.oneTargets.target.getTexture(),e,i,r,s,0,0)};i.destroy=function(){if(this.oneTargets){this.oneTargets.target.destroy();this.oneTargets.target=null;this.oneTargets=null}};bt(t,["_matrixDefault",function(){return this._matrixDefault=new Rt}]);t.__init$=function(){e=function(){function t(t,e){this.width=t;this.height=e;this.target=it.create(t,e)}xt(t,"");return t}()};return t}();p=function(){function t(){this.ALPHA=1;this.shaderType=0;this.glTexture=new pt;this.defines=new Y}xt(t,"laya.webgl.shader.d2.Shader2D");t.__init__=function(){et.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform float u_colorMatrix[20];\n");et.addInclude("parts/ColorFilter_ps_logic.glsl","vec4 rgba=gl_FragColor;\ngl_FragColor.r =rgba.r*u_colorMatrix[0]+rgba.g*u_colorMatrix[1]+rgba.b*u_colorMatrix[2]+rgba.a*u_colorMatrix[3]+u_colorMatrix[4]/255.0;\ngl_FragColor.g =rgba.r*u_colorMatrix[5]+rgba.g*u_colorMatrix[6]+rgba.b*u_colorMatrix[7]+rgba.a*u_colorMatrix[8]+u_colorMatrix[9]/255.0;\ngl_FragColor.b =rgba.r*u_colorMatrix[10]+rgba.g*u_colorMatrix[11]+rgba.b*u_colorMatrix[12]+rgba.a*u_colorMatrix[13]+u_colorMatrix[14]/255.0;\ngl_FragColor.a =rgba.r*u_colorMatrix[15]+rgba.g*u_colorMatrix[16]+rgba.b*u_colorMatrix[17]+rgba.a*u_colorMatrix[18]+u_colorMatrix[19]/255.0;");et.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;");et.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n	for(float j = 0.0;j<=c_IterationTime; ++j){\n		vec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n		vec4Color += texture2D(texture, v_texcoord + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n	}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);");et.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor=vec4(0.0);\ngl_FragColor += texture2D(texture, vBlurTexCoords[ 0])*0.004431848411938341;\ngl_FragColor += texture2D(texture, vBlurTexCoords[ 1])*0.05399096651318985;\ngl_FragColor += texture2D(texture, vBlurTexCoords[ 2])*0.2419707245191454;\ngl_FragColor += texture2D(texture, v_texcoord        )*0.3989422804014327;\ngl_FragColor += texture2D(texture, vBlurTexCoords[ 3])*0.2419707245191454;\ngl_FragColor += texture2D(texture, vBlurTexCoords[ 4])*0.05399096651318985;\ngl_FragColor += texture2D(texture, vBlurTexCoords[ 5])*0.004431848411938341;");et.addInclude("parts/BlurFilter_ps_uniform.glsl","varying vec2 vBlurTexCoords[6];");et.addInclude("parts/BlurFilter_vs_uniform.glsl","uniform float strength;\nvarying vec2 vBlurTexCoords[6];");et.addInclude("parts/BlurFilter_vs_logic.glsl","\nvBlurTexCoords[ 0] = v_texcoord + vec2(-0.012 * strength, 0.0);\nvBlurTexCoords[ 1] = v_texcoord + vec2(-0.008 * strength, 0.0);\nvBlurTexCoords[ 2] = v_texcoord + vec2(-0.004 * strength, 0.0);\nvBlurTexCoords[ 3] = v_texcoord + vec2( 0.004 * strength, 0.0);\nvBlurTexCoords[ 4] = v_texcoord + vec2( 0.008 * strength, 0.0);\nvBlurTexCoords[ 5] = v_texcoord + vec2( 0.012 * strength, 0.0);");et.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n");et.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);");var t,e;t='attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\nuniform mat4 mmat;\nvarying vec2 v_texcoord;\n\n#include?BLUR_FILTER  "parts/BlurFilter_vs_uniform.glsl";\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_texcoord = texcoord;\n  #include?BLUR_FILTER  "parts/BlurFilter_vs_logic.glsl";\n}';e='precision mediump float;\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}';et.preCompile(0,1,t,e,null);t="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}";e='precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n	vec4 a = vec4(color.r, color.g, color.b, color.a);\n	a.w = alpha;\n	gl_FragColor = a;\n	#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}';et.preCompile(0,2,t,e,null);t="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 pos=mmat*u_mmat2*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}";e="precision mediump float;\n//precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n	//vec4 a=vec4(color.r, color.g, color.b, 1);\n	//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n}";et.preCompile(0,4,t,e,null)};return t}();b=function(){function t(t,e,i){this._value=0;this._name2int=t;this._int2name=e;this._int2nameMap=i}xt(t,"laya.webgl.shader.ShaderDefines");var e=t.prototype;e.add=function(t){"string"==typeof t&&(t=this._name2int[t]);this._value|=t;return this._value};e.addInt=function(t){this._value|=t;return this._value};e.remove=function(t){"string"==typeof t&&(t=this._name2int[t]);this._value&=~t;return this._value};e.isDefine=function(t){return(this._value&t)===t};e.getValue=function(){return this._value};e.setValue=function(t){this._value=t};e.toNameDic=function(){var e=this._int2nameMap[this._value];return e?e:t._toText(this._value,this._int2name,this._int2nameMap)};t._reg=function(t,e,i,r){i[t]=e;r[e]=t};t._toText=function(t,e,i){var r,s,a,n,h=i[t];if(h)return h;r={};s=1;for(a=0;a<32;a++){s=1<<a;if(s>t)break;if(t&s){n=e[s];n&&(r[n]="")}}i[t]=r;return r};t._toInt=function(t,e){var i,r,s,a=t.split("."),n=0;for(i=0,r=a.length;i<r;i++){s=e[a[i]];if(!s)throw new Error("Defines to int err:"+t+"/"+a[i]);n|=s}return n};return t}();x=function(){function t(t,e,i,r,s,a,n,h,l){this.r0=0;this.fill=!0;this.r1=Math.PI/2;void 0===l&&(l=0);this.x=t;this.y=e;this.width=i;this.height=r;this.edges=s;this.color=a;this.borderWidth=n;this.borderColor=h}xt(t,"laya.webgl.shapes.BasePoly");var e=t.prototype;i.imps(e,{"laya.webgl.shapes.IShape":!0});e.getData=function(t,e,i){};e.circle=function(t,e,i){var r,s=this.x,a=this.y,n=this.edges,h=2*Math.PI/n,l=this.width,o=this.height,u=this.color,c=(u>>16&255)/255,_=(u>>8&255)/255,f=(255&u)/255;t.push(s,a,c,_,f);for(r=0;r<n;r++){t.push(s+Math.sin(h*r)*l,a+Math.cos(h*r)*o);t.push(c,_,f)}for(r=0;r<n;r++)e.push(i,i+r+1,i+r+2);e[e.length-1]=i+1};e.sector=function(t,e,i){var r,s=this.x,a=this.y,n=this.edges,h=(this.r1-this.r0)/n,l=this.width,o=this.height,u=this.color,c=(u>>16&255)/255,_=(u>>8&255)/255,f=(255&u)/255;t.push(s,a,c,_,f);for(r=0;r<n+1;r++){t.push(s+Math.sin(h*r+this.r0)*l,a+Math.cos(h*r+this.r0)*o);t.push(c,_,f)}for(r=0;r<n;r++)e.push(i,i+r+1,i+r+2)};e.createFanLine=function(t,e,i,r,s,a){var n,h,l,o,u,c,_,f,d,g,m,p,b,x,v,y,T,w,A,S,I,M,C,R,E,L,D=t.concat(),F=s?s:t,P=this.borderColor,O=(P>>16&255)/255,V=(P>>8&255)/255,B=(255&P)/255,N=[D[0],D[1]],G=[D[D.length-5],D[D.length-4]],H=G[0]+.5*(N[0]-G[0]),k=G[1]+.5*(N[1]-G[1]);D.unshift(H,k,0,0,0);D.push(H,k,0,0,0);n=D.length/5;h=r,l=i/2;c=D[0];_=D[1];f=D[5];d=D[6];p=-(_-d);b=c-f;R=Math.sqrt(p*p+b*b);p=p/R*l;b=b/R*l;F.push(c-p,_-b,O,V,B,c+p,_+b,O,V,B);for(E=1;E<n-1;E++){c=D[5*(E-1)];_=D[5*(E-1)+1];f=D[5*E];d=D[5*E+1];g=D[5*(E+1)];m=D[5*(E+1)+1];p=-(_-d);b=c-f;R=Math.sqrt(p*p+b*b);p=p/R*l;b=b/R*l;x=-(d-m);v=f-g;R=Math.sqrt(x*x+v*v);x=x/R*l;v=v/R*l;y=-b+_-(-b+d);T=-p+f-(-p+c);w=(-p+c)*(-b+d)-(-p+f)*(-b+_);A=-v+m-(-v+d);S=-x+f-(-x+g);I=(-x+g)*(-v+d)-(-x+f)*(-v+m);M=y*S-A*T;if(Math.abs(M)<.1){M+=10.1;F.push(f-p,d-b,O,V,B,f+p,d+b,O,V,B)}else{o=(T*I-S*w)/M;u=(A*w-y*I)/M;C=(o-f)*(o-f)+(u-d)+(u-d);F.push(o,u,O,V,B,f-(o-f),d-(u-d),O,V,B)}}e=a?a:e;L=this.edges+3;for(E=1;E<L;E++)e.push(h+2*(E-1),h+2*(E-1)+1,h+2*E+1,h+2*E+1,h+2*E,h+2*(E-1));e.push(h+2*(E-1),h+2*(E-1)+1,h+1,h+1,h,h+2*(E-1));return F};e.createLine2=function(t,e,i,r,s,a){var n,h,l,o,u,c,_,f,d,g,m,p,b,x,v,y,T=t.concat(),w=s,A=this.borderColor,S=(A>>16&255)/255,I=(A>>8&255)/255,M=(255&A)/255,C=T.length/2,R=r,E=i/2,L=T[0],D=T[1],F=T[2],P=T[3],O=-(D-P),V=L-F,B=Math.sqrt(O*O+V*V);O=O/B*E;V=V/B*E;w.push(L-O+this.x,D-V+this.y,S,I,M,L+O+this.x,D+V+this.y,S,I,M);for(v=1;v<C-1;v++){L=T[2*(v-1)];D=T[2*(v-1)+1];F=T[2*v];P=T[2*v+1];l=T[2*(v+1)];o=T[2*(v+1)+1];O=-(D-P);V=L-F;B=Math.sqrt(O*O+V*V);O=O/B*E;V=V/B*E;u=-(P-o);c=F-l;B=Math.sqrt(u*u+c*c);u=u/B*E;c=c/B*E;_=-V+D-(-V+P);f=-O+F-(-O+L);d=(-O+L)*(-V+P)-(-O+F)*(-V+D);g=-c+o-(-c+P);m=-u+F-(-u+l);p=(-u+l)*(-c+P)-(-u+F)*(-c+o);b=_*m-g*f;if(Math.abs(b)<.1){b+=10.1;w.push(F-O+this.x,P-V+this.y,S,I,M,F+O+this.x,P+V+this.y,S,I,M)}else{n=(f*p-m*d)/b;h=(g*d-_*p)/b;x=(n-F)*(n-F)+(h-P)+(h-P);w.push(n+this.x,h+this.y,S,I,M,F-(n-F)+this.x,P-(h-P)+this.y,S,I,M)}}L=T[T.length-4];D=T[T.length-3];F=T[T.length-2];P=T[T.length-1];O=-(D-P);V=L-F;B=Math.sqrt(O*O+V*V);O=O/B*E;V=V/B*E;w.push(F-O+this.x,P-V+this.y,S,I,M,F+O+this.x,P+V+this.y,S,I,M);y=a;for(v=1;v<y;v++)e.push(R+2*(v-1),R+2*(v-1)+1,R+2*v+1,R+2*v+1,R+2*v,R+2*(v-1));return w};e.createLine=function(t,e,i,r){var s,a,n,h,l,o,u,c,_,f,d,g,m,p,b,x,v,y,T,w,A,S,I,M,C,R,E=t.concat(),L=t,D=this.borderColor,F=(D>>16&255)/255,P=(D>>8&255)/255,O=(255&D)/255;E.splice(0,5);s=E.length/5;a=r,n=i/2;o=E[0];u=E[1];c=E[5];_=E[6];g=-(u-_);m=o-c;M=Math.sqrt(g*g+m*m);g=g/M*n;m=m/M*n;L.push(o-g,u-m,F,P,O,o+g,u+m,F,P,O);for(C=1;C<s-1;C++){o=E[5*(C-1)];u=E[5*(C-1)+1];c=E[5*C];_=E[5*C+1];f=E[5*(C+1)];d=E[5*(C+1)+1];g=-(u-_);m=o-c;M=Math.sqrt(g*g+m*m);g=g/M*n;m=m/M*n;p=-(_-d);b=c-f;M=Math.sqrt(p*p+b*b);p=p/M*n;b=b/M*n;x=-m+u-(-m+_);v=-g+c-(-g+o);y=(-g+o)*(-m+_)-(-g+c)*(-m+u);T=-b+d-(-b+_);w=-p+c-(-p+f);A=(-p+f)*(-b+_)-(-p+c)*(-b+d);S=x*w-T*v;if(Math.abs(S)<.1){S+=10.1;L.push(c-g,_-m,F,P,O,c+g,_+m,F,P,O)}else{h=(v*A-w*y)/S;l=(T*y-x*A)/S;I=(h-c)*(h-c)+(l-_)+(l-_);L.push(h,l,F,P,O,c-(h-c),_-(l-_),F,P,O)}}o=E[E.length-10];u=E[E.length-9];c=E[E.length-5];_=E[E.length-4];g=-(u-_);m=o-c;M=Math.sqrt(g*g+m*m);g=g/M*n;m=m/M*n;L.push(c-g,_-m,F,P,O,c+g,_+m,F,P,O);R=this.edges+1;for(C=1;C<R;C++)e.push(a+2*(C-1),a+2*(C-1)+1,a+2*C+1,a+2*C+1,a+2*C,a+2*(C-1));return L};e.createLoopLine=function(t,e,i,r,s,a){var n,h,l,o,u,c,_,f,d,g,m,p,b,x,v,y,T,w,A,S,I,M,C,R,E,L,D,F,P,O,V=t.concat(),B=s?s:t,N=this.borderColor,G=(N>>16&255)/255,H=(N>>8&255)/255,k=(255&N)/255;V.splice(0,5);n=[V[0],V[1]];h=[V[V.length-5],V[V.length-4]];l=h[0]+.5*(n[0]-h[0]);o=h[1]+.5*(n[1]-h[1]);V.unshift(l,o,0,0,0);V.push(l,o,0,0,0);u=V.length/5;c=r,_=i/2;g=V[0];m=V[1];p=V[5];b=V[6];y=-(m-b);T=g-p;F=Math.sqrt(y*y+T*T);y=y/F*_;T=T/F*_;B.push(g-y,m-T,G,H,k,g+y,m+T,G,H,k);for(P=1;P<u-1;P++){g=V[5*(P-1)];m=V[5*(P-1)+1];p=V[5*P];b=V[5*P+1];x=V[5*(P+1)];v=V[5*(P+1)+1];y=-(m-b);T=g-p;F=Math.sqrt(y*y+T*T);y=y/F*_;T=T/F*_;w=-(b-v);A=p-x;F=Math.sqrt(w*w+A*A);w=w/F*_;A=A/F*_;S=-T+m-(-T+b);I=-y+p-(-y+g);M=(-y+g)*(-T+b)-(-y+p)*(-T+m);C=-A+v-(-A+b);R=-w+p-(-w+x);E=(-w+x)*(-A+b)-(-w+p)*(-A+v);L=S*R-C*I;if(Math.abs(L)<.1){L+=10.1;B.push(p-y,b-T,G,H,k,p+y,b+T,G,H,k)}else{f=(I*E-R*M)/L;d=(C*M-S*E)/L;D=(f-p)*(f-p)+(d-b)+(d-b);B.push(f,d,G,H,k,p-(f-p),b-(d-b),G,H,k)}}a&&(e=a);O=this.edges+1;for(P=1;P<O;P++)e.push(c+2*(P-1),c+2*(P-1)+1,c+2*P+1,c+2*P+1,c+2*P,c+2*(P-1));e.push(c+2*(P-1),c+2*(P-1)+1,c+1,c+1,c,c+2*(P-1));return B};return t}();v=function(){function t(t,e,i,r,s,a,n){this.lineWidth=t;this.lineColor=e;this.lineAlpha=i;this.fillColor=r;this.fillAlpha=s;this.shape=n;this.fill=a}xt(t,"laya.webgl.shapes.GeometryData");var e=t.prototype;e.clone=function(){return new t(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)};e.getIndexData=function(){return null};e.getVertexData=function(){return null};e.destroy=function(){this.shape=null};return t}();y=function(){function t(t){if(t instanceof Float32Array)this.points=t;else if(t instanceof Array){t.length;this.points=new Float32Array(t)}}xt(t,"laya.webgl.shapes.Vertex");var e=t.prototype;i.imps(e,{"laya.webgl.shapes.IShape":!0});e.getData=function(t,e,i){};return t}();T=function(){function t(t){void 0===t&&(t=1);this._renderType=t}xt(t,"laya.webgl.submit.Submit");var e=t.prototype;i.imps(e,{"laya.webgl.submit.ISubmit":!0});e.releaseRender=function(){var e=t._cache;e[e._length++]=this;this.shaderValue.release();this._submitID=-1;this._vb=null};e.getRenderType=function(){return this._renderType};e.renderSubmit=function(){if(0===this._numEle)return 1;if(this.shaderValue.textureHost){if(!this.shaderValue.textureHost.bitmap||!this.shaderValue.textureHost.source)return 1;this.shaderValue.texture=this.shaderValue.textureHost.source}this._ib.upload_bind();this._vb.upload_bind();this.shaderValue.upload();var e=V.mainContext;if(t.activeBlendFunction!==this._blendFn){e.enable(3042);this._blendFn(e);t.activeBlendFunction=this._blendFn}Et.drawCall++;Et.trianglesFaces+=this._numEle/3;e.drawElements(4,this._numEle,5123,this._startIdx);return 1};t.__init__=function(){var e=t.RENDERBASE=new t(-1);e.shaderValue=new k(0,0);e.shaderValue.ALPHA=-1234};t.create=function(e,i,r,s,a,n,h){var o,u,c=t._cache._length?t._cache[--t._cache._length]:new t;if(null==a){a=c._selfVb||(c._selfVb=new rt(34962));a.clear();n=0}c._ib=s;c._vb=a;c._submitID=i;c._mergID=r;c._startIdx=n*D.BYTES_PIDX;c._numEle=0;o=e._nBlendType;c._blendFn=e._targets?l.targetFns[o]:l.fns[o];c.shaderValue=h;c.shaderValue.setValue(e._shader2D);u=e._shader2D.filters;u&&c.shaderValue.setFilters(u);return c};t.createShape=function(e,i,r,s,a,n){var h,o=t._cache._length?t._cache[--t._cache._length]:new t;o._ib=i;o._vb=r;o._numEle=s;o._startIdx=a;o.shaderValue=n;o.shaderValue.setValue(e._shader2D);h=e._nBlendType;o._blendFn=e._targets?l.targetFns[h]:l.fns[h];return o};t.TYPE_2D=1;t.TYPE_CANVAS=3;t.TYPE_CMDSETRT=4;t.TYPE_CUSTOM=5;t.TYPE_BLURRT=6;t.TYPE_CMDDESTORYPRERT=7;t.TYPE_DISABLESTENCIL=8;t.TYPE_OTHERIBVB=9;t.TYPE_PRIMITIVE=10;t.TYPE_RT=11;t.TYPE_BLUR_RT=12;t.TYPE_TARGET=13;t.TYPE_CHANGE_VALUE=14;t.TYPE_SHAPE=15;t.RENDERBASE=null;t.activeBlendFunction=null;t._cache=(t._cache=[],t._cache._length=0,t._cache);return t}();w=function(){function t(){this.fun=null;this.args=null}xt(t,"laya.webgl.submit.SubmitCMD");var e=t.prototype;i.imps(e,{"laya.webgl.submit.ISubmit":!0});e.renderSubmit=function(){this.fun.apply(null,this.args);return 1};e.getRenderType=function(){return 0};e.releaseRender=function(){var e=t._cache;e[e._length++]=this};t.create=function(e,i){var r=t._cache._length?t._cache[--t._cache._length]:new t;r.fun=i;r.args=e;return r};t._cache=(t._cache=[],t._cache._length=0,t._cache);return t}();A=function(){function t(){this.variables={}}xt(t,"laya.webgl.submit.SubmitCMDScope");var e=t.prototype;e.getValue=function(t){return this.variables[t]};e.addValue=function(t,e){return this.variables[t]=e};e.setValue=function(t,e){return this.variables.hasOwnProperty(t)?this.variables[t]=e:null};e.clear=function(){for(var t in this.variables)delete this.variables[t]};e.recycle=function(){this.clear();t.POOL.push(this)};t.create=function(){var e=t.POOL.pop();e||(e=new t);return e};t.POOL=[];return t}();S=function(){function t(){this.offset=0;this.startIndex=0;this._mat=Rt.create()}xt(t,"laya.webgl.submit.SubmitOtherIBVB");var e=t.prototype;i.imps(e,{"laya.webgl.submit.ISubmit":!0});e.releaseRender=function(){var e=t._cache;e[e._length++]=this;
};e.getRenderType=function(){return 9};e.renderSubmit=function(){var e,i,r,s,a;if(this._shaderValue.textureHost){e=this._shaderValue.textureHost.source;if(!e)return 1;this._shaderValue.texture=e}this._ib.upload_bind();this._vb.upload_bind();i=P.worldMatrix4;r=Rt.TEMP;Rt.mulPre(this._mat,i[0],i[1],i[4],i[5],i[12],i[13],r);s=P.worldMatrix4=t.tempMatrix4;s[0]=r.a;s[1]=r.b;s[4]=r.c;s[5]=r.d;s[12]=r.tx;s[13]=r.ty;this._shader._offset=this.offset;this._shaderValue.refresh();this._shader.upload(this._shaderValue);this._shader._offset=0;a=V.mainContext;if(T.activeBlendFunction!==this._blendFn){a.enable(3042);this._blendFn(a);T.activeBlendFunction=this._blendFn}Et.drawCall++;Et.trianglesFaces+=this._numEle/3;a.drawElements(4,this._numEle,5123,this.startIndex);P.worldMatrix4=i;et.activeShader=null;return 1};t.create=function(e,i,r,s,a,n,h,o){var u,c=t._cache._length?t._cache[--t._cache._length]:new t;c._ib=r;c._vb=i;c._numEle=s;c._shader=a;c._shaderValue=n;u=e._nBlendType;c._blendFn=e._targets?l.targetFns[u]:l.fns[u];c.startIndex=h;c.offset=o;return c};t._cache=(t._cache=[],t._cache._length=0,t._cache);t.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return t}();I=function(){function t(){this.submitIndex=0;this.submitLength=0;this.context=null;this.clipRect=new It;this.screenRect=new It}xt(t,"laya.webgl.submit.SubmitScissor");var e=t.prototype;i.imps(e,{"laya.webgl.submit.ISubmit":!0});e._scissor=function(t,e,i,r){var s,a,n,h,l=P.worldMatrix4,o=l[0],u=l[5],c=l[12],_=l[13];t=t*o+c;e=e*u+_;i*=o;r*=u;if(i<1||r<1)return!1;s=t+i;a=e+r;t<0&&(t=0,i=s-t);e<0&&(e=0,r=a-e);n=P.worldClipRect;t=Math.max(t,n.x);e=Math.max(e,n.y);i=Math.min(s,n.right)-t;r=Math.min(a,n.bottom)-e;if(i<1||r<1)return!1;h=P.worldScissorTest;this.screenRect.copyFrom(n);n.x=t;n.y=e;n.width=i;n.height=r;P.worldScissorTest=!0;e=P.height-e-r;V.mainContext.scissor(t,e,i,r);V.mainContext.enable(3089);this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength);if(h){e=P.height-this.screenRect.y-this.screenRect.height;V.mainContext.scissor(this.screenRect.x,e,this.screenRect.width,this.screenRect.height);V.mainContext.enable(3089)}else{V.mainContext.disable(3089);P.worldScissorTest=!1}n.copyFrom(this.screenRect);return!0};e._scissorWithTagart=function(t,e,i,r){var s,a,n,h;if(i<1||r<1)return!1;s=t+i;a=e+r;t<0&&(t=0,i=s-t);e<0&&(e=0,r=a-e);n=P.worldClipRect;t=Math.max(t,n.x);e=Math.max(e,n.y);i=Math.min(s,n.right)-t;r=Math.min(a,n.bottom)-e;if(i<1||r<1)return!1;h=P.worldScissorTest;this.screenRect.copyFrom(n);P.worldScissorTest=!0;n.x=t;n.y=e;n.width=i;n.height=r;e=P.height-e-r;V.mainContext.scissor(t,e,i,r);V.mainContext.enable(3089);this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength);if(h){e=P.height-this.screenRect.y-this.screenRect.height;V.mainContext.scissor(this.screenRect.x,e,this.screenRect.width,this.screenRect.height);V.mainContext.enable(3089)}else{V.mainContext.disable(3089);P.worldScissorTest=!1}n.copyFrom(this.screenRect);return!0};e.renderSubmit=function(){this.submitLength=Math.min(this.context._submits._length-1,this.submitLength);if(this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1)return this.submitLength+1;this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height);return this.submitLength+1};e.getRenderType=function(){return 0};e.releaseRender=function(){var e=t._cache;e[e._length++]=this;this.context=null};t.create=function(e){var i=t._cache._length?t._cache[--t._cache._length]:new t;i.context=e;return i};t._cache=(t._cache=[],t._cache._length=0,t._cache);return t}();M=function(){function t(){this.step=0;this.level=0}xt(t,"laya.webgl.submit.SubmitStencil");var e=t.prototype;i.imps(e,{"laya.webgl.submit.ISubmit":!0});e.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5()}return 1};e.getRenderType=function(){return 0};e.releaseRender=function(){var e=t._cache;e[e._length++]=this};e.do1=function(){var t=V.mainContext;t.enable(2960);t.clear(1024);t.colorMask(!1,!1,!1,!1);t.stencilFunc(514,this.level,255);t.stencilOp(7680,7680,7682)};e.do2=function(){var t=V.mainContext;t.stencilFunc(514,this.level+1,255);t.colorMask(!0,!0,!0,!0);t.stencilOp(7680,7680,7680)};e.do3=function(){var t=V.mainContext;t.colorMask(!0,!0,!0,!0);t.stencilOp(7680,7680,7680);t.clear(1024);t.disable(2960)};e.do4=function(){var t=V.mainContext;t.enable(2960);t.clear(1024);t.colorMask(!1,!1,!1,!1);t.stencilFunc(519,this.level,255);t.stencilOp(7680,7680,5386)};e.do5=function(){var t=V.mainContext;t.stencilFunc(514,255,255);t.colorMask(!0,!0,!0,!0);t.stencilOp(7680,7680,7680)};t.create=function(e){var i=t._cache._length?t._cache[--t._cache._length]:new t;i.step=e;return i};t._cache=(t._cache=[],t._cache._length=0,t._cache);return t}();C=function(){function t(){this._renderType=0;this._vb=null;this._ib=null;this._startIdx=0;this._numEle=0;this.shaderValue=null;this.blendType=0;this.proName=null;this.scope=null}xt(t,"laya.webgl.submit.SubmitTarget");var e=t.prototype;i.imps(e,{"laya.webgl.submit.ISubmit":!0});e.renderSubmit=function(){this._ib.upload_bind();this._vb.upload_bind();var t=this.scope.getValue(this.proName);this.shaderValue.texture=t.source;this.shaderValue.upload();this.blend();Et.drawCall++;Et.trianglesFaces+=this._numEle/3;V.mainContext.drawElements(4,this._numEle,5123,this._startIdx);return 1};e.blend=function(){if(t.activeBlendType!==this.blendType){var e=V.mainContext;e.enable(3042);l.fns[this.blendType](e);t.activeBlendType=this.blendType}};e.getRenderType=function(){return 0};e.releaseRender=function(){var e=t._cache;e[e._length++]=this};t.create=function(e,i,r,s,a,n){var h=t._cache._length?t._cache[--t._cache._length]:new t;h._ib=i;h._vb=r;h.proName=n;h._startIdx=s*D.BYTES_PIDX;h._numEle=0;h.blendType=e._nBlendType;h.shaderValue=a;h.shaderValue.setValue(e._shader2D);return h};t.activeBlendType=-1;t._cache=(t._cache=[],t._cache._length=0,t._cache);return t}();R=function(){function t(){}var e;xt(t,"laya.webgl.text.DrawText");t.getChar=function(e,i,r){return t._wordsMsg[i]=E.createOneChar(e,r)};t._drawSlow=function(e,i,r,s,a,n,h,l,o,u,c,_,f,d){var g,m,p,b,x,v,y=t._drawValue.value(n,l,o,u,f,d),T=0,w=0,A=t._charsTemp,S=0,I=NaN;if(s){A.length=s.length;for(T=0,w=s.length;T<w;T++){m=s[T];I=m.charNum+y.txtID;A[T]=g=t._wordsMsg[I]||t.getChar(m["char"],I,y);g.active()}}else{A.length=r.length;for(T=0,w=r.length;T<w;T++){I=r.charCodeAt(T)+y.txtID;A[T]=g=t._wordsMsg[I]||t.getChar(r.charAt(T),I,y);g.active();S+=g.width}}p=0;null!==h&&"left"!==h&&(p=-("center"==h?S/2:S));b=NaN;if(s)for(T=0,w=A.length;T<w;T++){g=A[T];if(!g.isSpace){m=s[T];b=g.borderSize;x=g.texture;i._drawText(x,c+p+(m.x-b)*f,_+(m.y-b)*d,x.width,x.height,a,0,0,0,0)}}else for(T=0,w=A.length;T<w;T++){g=A[T];if(!g.isSpace){b=g.borderSize;x=g.texture;i._drawText(x,c+p-b*f,_-b*d,x.width,x.height,a,0,0,0,0);e&&(e.push(v=[]),v[0]=x,v[1]=p-b*f,v[2]=-b*d)}p+=g.width}};t._drawFast=function(t,e,i,r,s){var a,n,h,l;for(h=0,l=t.length;h<l;h++){n=t[h];a=n[0];a.active();e._drawText(a,r+n[1],s+n[2],a.width,a.height,i,0,0,0,0)}};t.drawText=function(e,r,s,a,n,h,l,o,u,c,_){var f,d,g,m,p,b;if(!(r&&0===r.length||s&&0===s.length)){f=a.a,d=a.d;(0!==a.b||0!==a.c)&&(f=d=1);g=1!==f||1!==d;if(g&&i.stage.transform){m=i.stage.transform;g=m.a===f&&m.d===d}else g=!1;if(g){a=a.copy(H._tmpMatrix);a.scale(1/f,1/d);a._checkTransform();c*=f;_*=d}else f=d=1;if(s)t._drawSlow(null,e,r,s,a,n,h,l,o,u,c,_,f,d);else{p=r+n.toString()+l+o+u+f+d;b=t._textCache[p];if(b)t._drawFast(b,e,a,c,_);else{t._textCache.__length||(t._textCache.__length=0);if(t._textCache.__length>100){t._textCache={};t._textCache.__length=0}b=t._textCache[p]=[];t._drawSlow(b,e,r,s,a,n,h,l,o,u,c,_,f,d)}}}};t._wordsMsg={};t._textCache={};t._charsTemp=new Array;bt(t,["_drawValue",function(){return this._drawValue=new e}]);t.__init$=function(){e=function(){function t(){}xt(t,"");var e=t.prototype;e.value=function(e,i,r,s,a,n){this.font=e;this.fillColor=i;this.borderColor=r;this.lineWidth=s;this.scaleX=a;this.scaleY=n;var h=e.toString()+a+n+s+i+r;this.txtID=t._keymap[h];if(!this.txtID){this.txtID=1e-7*++t._keymapCount;t._keymap[h]=this.txtID}return this};t._keymap={};t._keymapCount=1;return t}()};return t}();E=function(){function t(t,e){var i,r;this["char"]=t;this.isSpace=" "===t;this.xs=e.scaleX;this.ys=e.scaleY;this.font=e.font.toString();this.fontSize=e.font.size;this.fillColor=e.fillColor;this.borderColor=e.borderColor;this.lineWidth=e.lineWidth;i=Ht.isConchApp;if(i){r=ConchTextCanvas;r._source=ConchTextCanvas;r._source.canvas=ConchTextCanvas;this.texture=new Ft(new ot(r,this))}else this.texture=new Ft(new ot(wt.canvas.source,this))}xt(t,"laya.webgl.text.DrawTextChar");var e=t.prototype;e.active=function(){this.texture.active()};t.createOneChar=function(e,i){var r=new t(e,i);return r};return t}();L=function(){function t(t){this._index=0;this._size=14;this._italic=-2;this.setFont(t||"14px Arial")}xt(t,"laya.webgl.text.FontInContext");var e=t.prototype;e.setFont=function(t){this._words=t.split(" ");for(var e=0,r=this._words.length;e<r;e++)if(this._words[e].indexOf("px")>0){this._index=e;break}this._size=i.__parseInt(this._words[this._index]);this._text=null;this._italic=-2};e.getItalic=function(){-2===this._italic&&(this._italic=this.hasType("italic"));return this._italic};e.hasType=function(t){for(var e=0,i=this._words.length;e<i;e++)if(this._words[e]===t)return e;return-1};e.removeType=function(t){for(var e=0,i=this._words.length;e<i;e++)if(this._words[e]===t){this._words.splice(e,1);this._index>e&&this._index--;break}this._text=null;this._italic=-2};e.copyTo=function(t){t._text=this._text;t._size=this._size;t._index=this._index;t._words=this._words.slice();t._italic=-2;return t};e.toString=function(){return this._text?this._text:this._text=this._words.join(" ")};vt(0,e,"size",function(){return this._size},function(t){this._size=t;this._words[this._index]=t+"px";this._text=null});t.create=function(e){var i=t._cache[e];if(i)return i;i=t._cache[e]=new t(e);return i};t.EMPTY=new t;t._cache={};return t}();D=function(){function e(){}xt(e,"laya.webgl.utils.CONST3D2D");e.BYTES_PE=t.Float32Array&&Float32Array.BYTES_PER_ELEMENT;e.BYTES_PIDX=t.Uint16Array&&Uint16Array.BYTES_PER_ELEMENT;e.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];e.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1];e.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0];e._TMPARRAY=[];e._OFFSETX=0;e._OFFSETY=0;return e}();F=function(){function t(){}xt(t,"laya.webgl.utils.GlUtils");t.make2DProjection=function(t,e,i){return[2/t,0,0,0,0,-2/e,0,0,0,0,2/i,0,-1,1,0,1]};t.fillIBQuadrangle=function(t,e){var i,r,s;if(e>65535/4){throw Error("IBQuadrangle count:"+e+" must<:"+Math.floor(65535/4));return!1}e=Math.floor(e);t._resizeBuffer(6*(e+1)*2,!1);t.length=t.bufferLength;i=new Uint16Array(t.getBuffer());r=0;for(s=0;s<e;s++){i[r++]=4*s;i[r++]=4*s+2;i[r++]=4*s+1;i[r++]=4*s;i[r++]=4*s+3;i[r++]=4*s+2}t.setNeedUpload();t.upload();return!0};t.expandIBQuadrangle=function(e,i){e.bufferLength>=6*i*2||t.fillIBQuadrangle(e,i)};t.mathCeilPowerOfTwo=function(t){t--;t|=t>>1;t|=t>>2;t|=t>>4;t|=t>>8;t|=t>>16;t++;return t};t.fillQuadrangleImgVb=function(t,e,i,r,s,a,n,h){"use strict";var l,o,u,c,_,f,d,g;e|=0;i|=0;n|=0;h|=0;l=(t._length>>2)+16;t.length=l<<2;o=t.getFloat32Array();l-=16;o[l+2]=s[0];o[l+3]=s[1];o[l+6]=s[2];o[l+7]=s[3];o[l+10]=s[4];o[l+11]=s[5];o[l+14]=s[6];o[l+15]=s[7];u=a.a,c=a.b,_=a.c,f=a.d;if(1!==u||0!==c||0!==_||1!==f){a.bTransform=!0;d=a.tx+n,g=a.ty+h;o[l]=(r[0]+e)*u+(r[1]+i)*_+d;o[l+1]=(r[0]+e)*c+(r[1]+i)*f+g;o[l+4]=(r[2]+e)*u+(r[3]+i)*_+d;o[l+5]=(r[2]+e)*c+(r[3]+i)*f+g;o[l+8]=(r[4]+e)*u+(r[5]+i)*_+d;o[l+9]=(r[4]+e)*c+(r[5]+i)*f+g;o[l+12]=(r[6]+e)*u+(r[7]+i)*_+d;o[l+13]=(r[6]+e)*c+(r[7]+i)*f+g}else{a.bTransform=!1;e+=a.tx+n;i+=a.ty+h;o[l]=e+r[0];o[l+1]=i+r[1];o[l+4]=e+r[2];o[l+5]=i+r[3];o[l+8]=e+r[4];o[l+9]=i+r[5];o[l+12]=e+r[6];o[l+13]=i+r[7]}t._upload=!0;return!0};t.fillTranglesVB=function(t,e,i,r,s,a,n){"use strict";var h,l,o,u,c,_,f,d,g,m=(t._length>>2)+r.length;t.length=m<<2;h=t.getFloat32Array();m-=r.length;l=r.length;o=s.a,u=s.b,c=s.c,_=s.d;for(f=0;f<l;f+=4){h[m+f+2]=r[f+2];h[m+f+3]=r[f+3];if(1!==o||0!==u||0!==c||1!==_){s.bTransform=!0;d=s.tx+a,g=s.ty+n;h[m+f]=(r[f]+e)*o+(r[f+1]+i)*c+d;h[m+f+1]=(r[f]+e)*u+(r[f+1]+i)*_+g}else{s.bTransform=!1;e+=s.tx+a;i+=s.ty+n;h[m+f]=e+r[f];h[m+f+1]=i+r[f+1]}}t._upload=!0;return!0};t.fillRectImgVb=function(t,e,i,r,s,a,n,h,l,o,u,c,_){var f,d,g,m,p,b,x,v,y,T,w,A,S,I,M,C,R,E,L,D,F,P,O,V,B,N,G,H,k,z,U,W,Y,X,Q,j,q,K;void 0===_&&(_=!1);f=1;E=h.a,L=h.b,D=h.c,F=h.d;P=!1;if(1!==E||0!==L||0!==D||1!==F){h.bTransform=!0;if(0===L&&0===D){f=P?30:23;T=s+i,w=a+r;A=h.tx+l,S=h.ty+o;d=E*i+A;m=E*T+A;g=F*r+S;p=F*w+S}}else{f=P?30:23;h.bTransform=!1;d=i+h.tx+l;m=d+s;g=r+h.ty+o;p=g+a}P&&(b=e.x,x=e.y,v=e.width+b,y=e.height+x);if(1!==f&&(d>=v||g>=y||m<=b||p<=x))return!1;O=(t._length>>2)+16;t.length=O<<2;V=t.getFloat32Array();O-=16;V[O+2]=n[0];V[O+3]=n[1];V[O+6]=n[2];V[O+7]=n[3];V[O+10]=n[4];V[O+11]=n[5];V[O+14]=n[6];V[O+15]=n[7];switch(f){case 1:A=h.tx+l,S=h.ty+o;T=s+i,w=a+r;B=i,N=r;G=E*B,H=D*N,k=F*N,z=L*B;U=E*T,W=D*w,Y=F*w,X=L*T;if(_){I=G+H+A;C=Math.round(I)-I;M=k+z+S;R=Math.round(M)-M;V[O]=I+C;V[O+1]=M+R;V[O+4]=U+H+A+C;V[O+5]=k+X+S+R;V[O+8]=U+W+A+C;V[O+9]=Y+X+S+R;V[O+12]=G+W+A+C;V[O+13]=Y+z+S+R}else{V[O]=G+H+A;V[O+1]=k+z+S;V[O+4]=U+H+A;V[O+5]=k+X+S;V[O+8]=U+W+A;V[O+9]=Y+X+S;V[O+12]=G+W+A;V[O+13]=Y+z+S}break;case 23:if(_){I=d+u;C=Math.round(I)-I;M=g;R=Math.round(M)-M;V[O]=I+C;V[O+1]=M+R;V[O+4]=m+u+C;V[O+5]=g+R;V[O+8]=m+C;V[O+9]=p+R;V[O+12]=d+C;V[O+13]=p+R}else{V[O]=d+u;V[O+1]=g;V[O+4]=m+u;V[O+5]=g;V[O+8]=m;V[O+9]=p;V[O+12]=d;V[O+13]=p}break;case 30:if(d<b||g<x||m>v||p>y){Q=b-d,j=x-g,q=m-v,K=p-y;if(Q>0){d=b;V[O+14]=V[O+2]=V[O+2]+Q/(s*E)*(V[O+6]-V[O+2])}if(j>0){g=x;V[O+7]=V[O+3]=V[O+3]+j/(a*F)*(V[O+11]-V[O+7])}if(q>0){m=v;V[O+6]=V[O+10]=V[O+6]-q/(s*E)*(V[O+6]-V[O+2])}if(K>0){p=y;V[O+11]=V[O+15]=V[O+15]-K/(a*F)*(V[O+11]-V[O+7])}}if(_){I=d+u;C=Math.round(I)-I;M=g;R=Math.round(M)-M;V[O]=I+C;V[O+1]=M+R;V[O+4]=m+u+C;V[O+5]=g+R;V[O+8]=m+C;V[O+9]=p+R;V[O+12]=d+C;V[O+13]=p+R}else{V[O]=d+u;V[O+1]=g;V[O+4]=m+u;V[O+5]=g;V[O+8]=m;V[O+9]=p;V[O+12]=d;V[O+13]=p}}t._upload=!0;return!0};t.fillLineVb=function(e,i,r,s,a,n,h,l){"use strict";var o,u,c=.5*h,_=t._fillLineArray,f=-(s-n),d=r-a,g=Math.sqrt(f*f+d*d);f/=g,d/=g,f*=c,d*=c;_[0]=r-f,_[1]=s-d,_[4]=r+f,_[5]=s+d,_[8]=a+f,_[9]=n+d,_[12]=a-f,_[13]=n-d;l&&l.transformPointArray(_,_);o=(e._length>>2)+16;e.length=o<<2;u=e.getFloat32Array();u.set(_,o-16);e._upload=!0;return!0};t._fillLineArray=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];return t}();P=function(){function t(){}xt(t,"laya.webgl.utils.RenderState2D");t.mat2MatArray=function(t,e){var i=t,r=e;r[0]=i.a;r[1]=i.b;r[4]=i.c;r[5]=i.d;r[12]=i.tx;r[13]=i.ty;return e};t.restoreTempArray=function(){t.TEMPMAT4_ARRAY[0]=1;t.TEMPMAT4_ARRAY[1]=0;t.TEMPMAT4_ARRAY[4]=0;t.TEMPMAT4_ARRAY[5]=1;t.TEMPMAT4_ARRAY[12]=0;t.TEMPMAT4_ARRAY[13]=0};t.clear=function(){t.worldScissorTest=!1;t.worldShaderDefines=null;t.worldFilters=null;t.worldAlpha=1;t.worldClipRect.x=t.worldClipRect.y=0;t.worldClipRect.width=t.width;t.worldClipRect.height=t.height;t.curRenderTarget=null};t._MAXSIZE=99999999;t.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];t.worldMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];t.worldAlpha=1;t.worldScissorTest=!1;t.worldFilters=null;t.worldShaderDefines=null;t.worldClipRect=new It(0,0,99999999,99999999);t.curRenderTarget=null;t.width=0;t.height=0;bt(t,["worldMatrix",function(){return this.worldMatrix=new Rt}]);return t}();O=function(){function t(t,i,r,s,a){function n(t){var e,i=t.split(" "),r=[];for(e=0;e<i.length;e++)i[e].length>0&&r.push(i[e]);return r}function h(t){var i,r,s,h,l,o,u=0,c=0,_=0,f=new e(0,null,null,null),d=f,g=t.split("\n");for(u=0,c=g.length;u<c;u++){s=g[u];if(s.indexOf("#ifdef")>=0){i=n(s);d=new e(1,i[1],"",d)}else if(s.indexOf("#else")>=0){r=d.condition;d=new e(2,null,"",d.parent);d.condition=r}else if(s.indexOf("#endif")>=0)d=d.parent;else if(s.indexOf("#include")>=0){i=n(s);h=i[1];l=h.charAt(0);if('"'===l||"'"===l){h=h.substr(1,h.length-2);_=h.lastIndexOf(l);_>0&&(h=h.substr(0,_))}_=i[0].indexOf("?");o=_>0?i[0].substr(_+1):i[0];new e(1,o,a[h],d)}else d.childs.length>0&&0===d.childs[d.childs.length-1].type?d.childs[d.childs.length-1].text+="\n"+s:new e(0,null,s,d)}return f}this._VSTXT=i;this._PSTXT=r;this._VS=h(i);this._PS=h(r);this._nameMap=s}var e,i;xt(t,"laya.webgl.utils.ShaderCompile");i=t.prototype;i.createShader=function(t,e,i){var r,s,a,n={},h="";if(t)for(r in t){h+="#define "+r+"\n";n[r]=!0}s=this._VS.toscript(n,[]);a=this._PS.toscript(n,[]);return(i||et.create)(h+s.join("\n"),h+a.join("\n"),e,this._nameMap)};t.IFDEF_NO=0;t.IFDEF_YES=1;t.IFDEF_ELSE=2;t.__init$=function(){e=function(){function t(t,e,i,r){var s,a,n,h,l,o,u;this.childs=new Array;this.type=t;this.text=i;this.parent=r;r&&r.childs.push(this);if(e){s="";a=!1,n=!1;for(h=0,l=e.length;h<l;h++){o=e.charAt(h);n="!&|() 	".indexOf(o)<0;if(a!=n){n&&(s+="this.");a=n}s+=o}u="(function() {return "+s+";})";this.condition=wt.window.eval(u)}}xt(t,"");var e=t.prototype;e.toscript=function(t,e){0===this.type&&this.text&&e.push(this.text);if(this.childs.length<1&&!this.text)return e;if(0!==this.type){var i=!!this.condition.call(t);2===this.type&&(i=!i);if(!i)return e;this.text&&e.push(this.text)}this.childs.length>0&&this.childs.forEach(function(i){i.toscript(t,e)});return e};return t}()};return t}();V=function(){function t(){}xt(t,"laya.webgl.WebGL");t.enable=function(){if(!t.isWebGLSupported())return!1;Dt=pt;Lt=lt;HTMLSubImage=ct;Ht.changeDefinition("HTMLImage",pt);Ht.changeDefinition("HTMLCanvas",lt);Ht.changeDefinition("HTMLSubImage",ct);At.WebGL=t;Ht.createRenderSprite=function(t,e){return new U(t,e)};Ht.createWebGLContext2D=function(t){return new H(t)};Ht.changeWebGLSize=function(t,e){laya.webgl.WebGL.onStageResize(t,e)};Ht.createGraphics=function(){return new G};var e=Ht.createFilterAction;Ht.createFilterAction=e?e:function(t){return new z};At.clear=function(t){P.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var e=Pt.create(t)._color;At.context.ctx.clearBG(e[0],e[1],e[2],e[3]);P.clear()};Ht.addToAtlas=function(t,e){void 0===e&&(e=!1);var r=t.bitmap;i.__typeof(r,"laya.webgl.resource.IMergeAtlasBitmap")&&r.allowMerageInAtlas&&r.on("recovered",null,function(e){r.enableMerageInAtlas&&n.instance.addToAtlas(t)})};Ht.drawToCanvas=function(t,e,i,r,s,a){var n,h=new it(i,r,!1,6408,5121,0);h.start();h.clear(1,0,0,1);t.render(At.context,-s,P.height-r-a);At.context.flush();h.end();n=h.getData(0,0,h.width,h.height);h.dispose();return n};Ht.createFilterAction=function(t){var e;switch(t){case 32:e=new z}return e};Ut._filterStart=function(t,e,i,r,s){var a,n=t.getValue("bounds"),h=it.create(n.width,n.height);h.start();h.clear(0,0,0,0);t.addValue("src",h);t.addValue("ScissorTest",P.worldScissorTest);if(P.worldScissorTest){a=new It;a.copyFrom(i.ctx._clipRect);t.addValue("clipRect",a);P.worldScissorTest=!1;laya.webgl.WebGL.mainContext.disable(3089)}};Ut._filterEnd=function(t,e,i,r,s){var a,n=t.getValue("bounds"),h=t.getValue("src");h.end();a=it.create(n.width,n.height);a.start();a.clear(0,0,0,0);t.addValue("out",a);e._filterCache=a;e._isHaveGlowFilter=t.getValue("isHaveGlowFilter")};Ut._EndTarget=function(t,e){var i,r,s,a=t.getValue("src");a.recycle();i=t.getValue("out");i.end();r=t.getValue("ScissorTest");if(r){P.worldScissorTest=!0;laya.webgl.WebGL.mainContext.enable(3089);e.ctx.save();s=t.getValue("clipRect");e.ctx.clipRect(s.x,s.y,s.width,s.height)}};Ut._useSrc=function(t){var e=t.getValue("out");e.end();e=t.getValue("src");e.start();e.clear(0,0,0,0)};Ut._endSrc=function(t){var e=t.getValue("src");e.end()};Ut._useOut=function(t){var e=t.getValue("src");e.end();e=t.getValue("out");e.start();e.clear(0,0,0,0)};Ut._endOut=function(t){var e=t.getValue("out");e.end()};Ut._recycleScope=function(t){t.recycle()};Ut._filter=function(t,e,i,r){var s,a,n,h,l,o,u,c,_,f,d,g,m,p,b,x,v,y,T,S,I,M=this._next;if(M){s=t.filters,a=s.length;if(1==a&&32==s[0].type){e.ctx.save();e.ctx.setFilters([s[0]]);M._fun.call(M,t,e,i,r);e.ctx.restore();return}l=A.create();o=Ct.TEMP;u=e.ctx._getTransformMatrix();c=Rt.create();u.copy(c);_=0;f=0;d=!1;g=t._filterCache?t._filterCache:null;if(!g||t._repaint){d=t.isHaveGlowFilter();l.addValue("isHaveGlowFilter",d);if(d){_=50;f=25}h=new It;h.copyFrom(t.getBounds());h.width+=_;h.height+=_;o.x=h.x*c.a+h.y*c.c;o.y=h.y*c.d+h.x*c.b;h.x=o.x;h.y=o.y;o.x=h.width*c.a+h.height*c.c;o.y=h.height*c.d+h.width*c.b;h.width=o.x;h.height=o.y;if(h.width<=0||h.height<=0)return;g&&g.recycle();l.addValue("bounds",h);m=w.create([l,t,e,0,0],Ut._filterStart);e.addRenderObject(m);e.ctx._shader2D.glTexture=null;p=t.x-t.pivotX;b=t.y-t.pivotY;x=p*c.a+b*c.c;v=b*c.d+p*c.b;y=-h.x+x+f-c.tx/c.a+t.pivotX;T=-h.y+v+f-c.ty/c.d+t.pivotY;M._fun.call(M,t,e,y,T);m=w.create([l,t,e,0,0],Ut._filterEnd);e.addRenderObject(m);for(S=0;S<a;S++){if(0!=S){m=w.create([l],Ut._useSrc);e.addRenderObject(m);n=k.create(1,0);Rt.TEMP.identity();e.ctx.drawTarget(l,0,0,h.width,h.height,Rt.TEMP,"out",n);m=w.create([l],Ut._useOut);e.addRenderObject(m)}I=s[S];I.action.apply3d(l,t,e,0,0)}m=w.create([l,e],Ut._EndTarget);e.addRenderObject(m)}else{d=t._isHaveGlowFilter?t._isHaveGlowFilter:!1;if(d){_=50;f=25}h=t.getBounds();if(h.width<=0||h.height<=0)return;h.width+=_;h.height+=_;o.x=h.x*c.a+h.y*c.c;o.y=h.y*c.d+h.x*c.b;h.x=o.x;h.y=o.y;o.x=h.width*c.a+h.height*c.c;o.y=h.height*c.d+h.width*c.b;l.addValue("out",g)}i=i-f-t.x;r=r-f-t.y;c.transformPoint(i,r,o);i=o.x+h.x;r=o.y+h.y;n=k.create(1,0);Rt.TEMP.identity();e.ctx.drawTarget(l,i,r,h.width,h.height,Rt.TEMP,"out",n);m=w.create([l],Ut._recycleScope);e.addRenderObject(m);c.destroy()}};return!0};t.isWebGLSupported=function(){var t,e,i=wt.createElement("canvas"),r=["webgl","experimental-webgl","webkit-3d","moz-webgl"];for(e=0;e<r.length;e++){try{t=i.getContext(r[e])}catch(s){}if(t)return r[e]}return null};t.onStageResize=function(e,i){t.mainContext.viewport(0,0,e,i);P.width=e;P.height=i};t.isExperimentalWebgl=function(){return t._isExperimentalWebgl};t.addRenderFinish=function(){t._isExperimentalWebgl&&(At.finish=function(){At.context.ctx.finish()})};t.removeRenderFinish=function(){t._isExperimentalWebgl&&(At.finish=function(){})};t.onInvalidGLRes=function(){n.instance.freeAll();Wt.releaseContentManagers(!0);t.doNodeRepaint(i.stage)};t.doNodeRepaint=function(e){0==e.numChildren&&e.repaint();for(var i=0;i<e.numChildren;i++)t.doNodeRepaint(e.getChildAt(i))};t.init=function(e,i,r){var s,a;t.mainCanvas=e;Lt._createContext=function(t){return new H(t)};s=t.isWebGLSupported();a=t.mainContext=e.getContext(s,{stencil:!0,alpha:!1,antialias:!0,premultipliedAlpha:!1});t._isExperimentalWebgl="webgl"!=s&&(wt.onWeiXin||wt.onMQQBrowser);wt.window.SetupWebglContext&&wt.window.SetupWebglContext(a);t.onStageResize(i,r);if(null==t.mainContext)throw new Error("webGL getContext err!");Ht.__init__();n.__init__();Y.__init__();T.__init__();H.__init__();k.__init__();p.__init__();rt.__int__(a);l._init_(a);Ht.isConchApp&&conch.setOnInvalidGLRes(t.onInvalidGLRes)};t.mainCanvas=null;t.mainContext=null;t.antialias=!0;t._bg_null=[0,0,0,0];t._isExperimentalWebgl=!1;return t}();B=function(){function t(){}xt(t,"laya.webgl.WebGLContext");t.UseProgram=function(e){if(t._useProgram===e)return!1;V.mainContext.useProgram(e);t._useProgram=e;return!0};t.setDepthTest=function(e,i){i!==t._depthTest&&(t._depthTest=i,i?e.enable(2929):e.disable(2929))};t.setDepthMask=function(e,i){i!==t._depthMask&&(t._depthMask=i,e.depthMask(i))};t.setBlend=function(e,i){i!==t._blend&&(t._blend=i,i?e.enable(3042):e.disable(3042))};t.setBlendFunc=function(e,i,r){(i!==t._sFactor||r!==t._dFactor)&&(t._sFactor=i,t._dFactor=r,e.blendFunc(i,r))};t.setCullFace=function(e,i){i!==t._cullFace&&(t._cullFace=i,i?e.enable(2884):e.disable(2884))};t.setFrontFaceCCW=function(e,i){i!==t._frontFace&&(t._frontFace=i,e.frontFace(i))};t._useProgram=null;t._depthTest=!0;t._depthMask=1;t._blend=!1;t._cullFace=!1;bt(t,["_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]);t.__init$=function(){};return t}();N=function(){function t(){this.img=null;V.enable();i.init(800,800);i.stage.bgColor="gray";Et.show()}xt(t,"LayaWebGLMain");return t}();G=function(t){function e(){e.__super.call(this)}xt(e,"laya.webgl.display.GraphicsGL",t);var i=e.prototype;i.setShader=function(t){this._saveToCmd(At.context._setShader,arguments)};i.setIBVB=function(t,e,i,r,s,a){this._saveToCmd(At.context._setIBVB,arguments)};i.drawParticle=function(t,e,i){var r=Ht.createParticleTemplate2D(i);r.x=t;r.y=e;this._saveToCmd(At.context.drawParticle,[r])};return e}(Gt);H=function(t){function e(t){this._x=0;this._y=0;this._id=++e._COUNT;this._drawCount=1;this._maxNumEle=0;this._clear=!1;this._submits=[];this._mergeID=0;this._curSubmit=null;this._ib=null;this._vb=null;this._nBlendType=0;this._saveMark=null;e.__super.call(this);this._path=new u;this._width=99999999;this._height=99999999;this._clipRect=e.MAXCLIPRECT;this._shader2D=new p;this.drawTexture=this._drawTextureM;this._canvas=t;this._curMat=Rt.create();this._ib=rt.QuadrangleIB;this._vb=new rt(34962);this._vb.getFloat32Array();this._other=r.DEFAULT;this._save=[f.Create(this)];this._save.length=10;this.clear()}var r,s;xt(e,"laya.webgl.canvas.WebGLContext2D",t);s=e.prototype;s.clearBG=function(t,e,i,r){var s=V.mainContext;s.clearColor(t,e,i,r);s.clear(16640)};s._getSubmits=function(){return this._submits};s.destroy=function(){this._curMat&&this._curMat.destroy();this._targets&&this._targets.destroy();this._vb&&this._vb.releaseResource();this._ib&&this._ib!=rt.QuadrangleIB&&this._ib.releaseResource()};s.clear=function(){this._vb.clear();this._targets&&(this._targets.repaint=!0);this._other=r.DEFAULT;this._clear=!0;this._mergeID=0;this._repaint=!1;this._drawCount=1;this._other.lineWidth=this._shader2D.ALPHA=1;this._nBlendType=0;this._clipRect=e.MAXCLIPRECT;this._curSubmit=T.RENDERBASE;this._shader2D.glTexture=null;this._shader2D.fillStyle=this._shader2D.strokeStyle=o.DEFAULT;for(var t=0,i=this._submits._length;t<i;t++)this._submits[t].releaseRender();this._submits._length=0;this._curMat.identity();this._other.clear();this._saveMark=this._save[0];this._save._length=1};s.size=function(t,e){this._width=t;this._height=e;this._targets&&this._targets.size(t,e)};s._getTransformMatrix=function(){return this._curMat};s.translate=function(t,e){if(0!==t||0!==e){g.save(this);if(this._curMat.bTransform){d.save(this);this._curMat.transformPoint(t,e,Ct.TEMP);t=Ct.TEMP.x;e=Ct.TEMP.y}this._x+=t;this._y+=e}};s.save=function(){this._save[this._save._length++]=f.Create(this)};s.restore=function(){var t,e,i=this._save._length;if(!(i<1))for(t=i-1;t>=0;t--){e=this._save[t];e.restore(this);if(e.isSaveMark()){this._save._length=t;return}}};s.measureText=function(t){return Ot.measureText(t,this._other.font.toString())};s._fillText=function(t,e,i,r,s,a,h){var l,o,u=this._shader2D,c=this._curSubmit.shaderValue,_=s?L.create(s):this._other.font;if(n.enabled){u.ALPHA!==c.ALPHA&&(u.glTexture=null);R.drawText(this,t,e,this._curMat,_,h||this._other.textAlign,a,null,-1,i,r)}else{l=this._shader2D.defines.getValue();o=a?Pt.create(a)._color:u.colorAdd;if(u.ALPHA!==c.ALPHA||o!==u.colorAdd||c.colorAdd!==u.colorAdd){u.glTexture=null;u.colorAdd=o}u.defines.add(64);R.drawText(this,t,e,this._curMat,_,h||this._other.textAlign,null,null,-1,i,r);u.defines.setValue(l)}};s.fillWords=function(t,e,i,r,s){t.length>0&&this._fillText(null,t,e,i,r,s,null)};s.fillText=function(t,e,i,r,s,a){t.length>0&&this._fillText(t,null,e,i,r,s,a)};s.strokeText=function(t,i,r,s,a,h,l){var o,u,c,_,f;if(0!==t.length){o=this._shader2D;u=this._curSubmit.shaderValue;c=s?(e._fontTemp.setFont(s),e._fontTemp):this._other.font;if(n.enabled){o.ALPHA!==u.ALPHA&&(o.glTexture=null);R.drawText(this,t,null,this._curMat,c,l||this._other.textAlign,null,a,h||1,i,r)}else{_=this._shader2D.defines.getValue();f=a?Pt.create(a)._color:o.colorAdd;if(o.ALPHA!==u.ALPHA||f!==o.colorAdd||u.colorAdd!==o.colorAdd){o.glTexture=null;o.colorAdd=f}o.defines.add(64);R.drawText(this,t,null,this._curMat,c,l||this._other.textAlign,null,a,h||1,i,r);o.defines.setValue(_)}}};s.fillBorderText=function(t,i,r,s,a,h,l,o){var u,c,_;if(0!==t.length)if(n.enabled){u=this._shader2D;c=this._curSubmit.shaderValue;u.ALPHA!==c.ALPHA&&(u.glTexture=null);_=s?(e._fontTemp.setFont(s),e._fontTemp):this._other.font;R.drawText(this,t,null,this._curMat,_,o||this._other.textAlign,a,h,l||1,i,r)}else{this.strokeText(t,i,r,s,h,l,o);this.fillText(t,i,r,s,a,o)}};s.fillRect=function(t,e,i,r,s){var a,n,h,l,u=this._vb;if(F.fillRectImgVb(u,this._clipRect,t,e,i,r,Ft.DEF_UV,this._curMat,this._x,this._y,0,0)){a=this._shader2D.fillStyle;s&&(this._shader2D.fillStyle=new o(s));n=this._shader2D;h=this._curSubmit.shaderValue;if(n.fillStyle!==h.fillStyle||n.ALPHA!==h.ALPHA){n.glTexture=null;l=this._curSubmit=T.create(this,0,this._mergeID,this._ib,u,(u._length-64)/32*3,k.create(2,0));l.shaderValue.color=n.fillStyle._color._color;l.shaderValue.ALPHA=n.ALPHA;this._submits[this._submits._length++]=l}this._curSubmit._numEle+=6;this._shader2D.fillStyle=a}};s.setShader=function(t){c.save(this,524288,this._shader2D,!0);this._shader2D.shader=t};s.setFilters=function(t){c.save(this,1048576,this._shader2D,!0);this._shader2D.filters=t;this._curSubmit=T.RENDERBASE;this._drawCount++;this._mergeID=0};s._findSameSubmit=function(t){var e,i;for(e=this._submits._length-1;e>=0;e--){i=this._submits[e];if(i._mergID&&i._mergID!==this._mergeID)break;if(i._submitID===t)return i}return null};s._drawTextureM=function(t,e,r,s,a,n,h,l){var o,u,c,_,f,d,g,m=this;if(t.loaded&&t.bitmap&&t.source){o=t.bitmap;u=this._shader2D;c=this._curSubmit.shaderValue;this._drawCount++;if(u.glTexture!==o||u.ALPHA!==c.ALPHA){u.glTexture=o;_=this._vb;f=null;d=NaN;g=_._length/32*3;if(this._mergeID){d=o.id+u.ALPHA/10;f=this._findSameSubmit(d);_=null}if(!f){f=T.create(this,d,this._mergeID,this._ib,_,g,k.create(1,0));this._submits[this._submits._length++]=f;f.shaderValue.textureHost=t}this._curSubmit=f}if(F.fillRectImgVb(this._curSubmit._vb||this._vb,this._clipRect,e+n+t.offsetX,r+h+t.offsetY,s||t.width,a||t.height,t.uv,l||this._curMat,this._x,this._y,0,0)){this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else this.sprite&&i.timer.callLater(null,function(){m.sprite.repaint()})};s.drawImage=function(t){var e,i,r,s,a=arguments,n=a[0],h=n.__texture||(n.__texture=new Ft(new pt(n)));h.uv=Ft.DEF_UV;switch(a.length){case 3:if(!n.__width){n.__width=n.width;n.__height=n.height}this.drawTexture(h,a[1],a[2],n.__width,n.__height,0,0);break;case 5:this.drawTexture(h,a[1],a[2],a[3],a[4],0,0);break;case 9:e=a[1]/n.__width;i=(a[1]+a[3])/n.__width;r=a[2]/n.__height;s=(a[2]+a[4])/n.__height;h.uv=[e,r,i,r,i,s,e,s];this.drawTexture(h,a[5],a[6],a[7],a[8],0,0)}};s._drawText=function(t,e,i,r,s,a,h,l,o,u){var c,_,f,d,g=t.bitmap,m=this._shader2D;this._curSubmit.shaderValue;this._drawCount++;if(m.glTexture!==g){m.glTexture=g;c=this._vb;_=null;f=NaN;d=c._length/32*3;if(this._mergeID){f=g.id+m.ALPHA/10+(n.enabled?0:m.colorAdd.__id/1e4);_=this._findSameSubmit(f);c=null}if(!_){if(n.enabled)_=T.create(this,f,this._mergeID,this._ib,c,d,k.create(1,0));else{_=T.create(this,f,this._mergeID,this._ib,c,d,mt.create());_.shaderValue.colorAdd=m.colorAdd;_.shaderValue.defines.add(64)}_.shaderValue.textureHost=t;this._submits[this._submits._length++]=_}this._curSubmit=_}t.active();if(F.fillRectImgVb(this._curSubmit._vb||this._vb,this._clipRect,e+h,i+l,r||t.width,s||t.height,t.uv,a||this._curMat,this._x,this._y,o,u,!0)){this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}};s.drawTextureWithTransform=function(t,i,r,s,a,n,h,l){var o=this._curMat;(0!==h||0!==l)&&(this._x=h*o.a+l*o.c,this._y=l*o.d+h*o.b);if(n&&o.bTransform){
Rt.mul(n,o,e._tmpMatrix);n=e._tmpMatrix;n._checkTransform()}else{this._x+=o.tx;this._y+=o.ty}this._drawTextureM(t,i,r,s,a,0,0,n);this._x=this._y=0};s.fillQuadrangle=function(t,e,i,r,s){var a,n=this._curSubmit,h=this._vb,l=this._shader2D,u=n.shaderValue;if(t.bitmap){a=t.bitmap;if(l.glTexture!=a||l.ALPHA!==u.ALPHA){l.glTexture=a;n=this._curSubmit=T.create(this,0,this._mergeID,this._ib,h,h._length/32*3,k.create(1,0));n.shaderValue.glTexture=a;this._submits[this._submits._length++]=n}F.fillQuadrangleImgVb(h,e,i,r,t.uv,s||this._curMat,this._x,this._y)}else{if(!n.shaderValue.fillStyle||!n.shaderValue.fillStyle.equal(t)||l.ALPHA!==u.ALPHA){l.glTexture=null;n=this._curSubmit=T.create(this,0,this._mergeID,this._ib,h,h._length/32*3,k.create(2,0));n.shaderValue.defines.add(2);n.shaderValue.fillStyle=new o(t);this._submits[this._submits._length++]=n}F.fillQuadrangleImgVb(h,e,i,r,Ft.DEF_UV,s||this._curMat,this._x,this._y)}n._numEle+=6};s.drawTexture2=function(t,i,r,s,a,n,h,o){var u,c,_=this._curMat;this._x=t*_.a+i*_.c;this._y=i*_.d+t*_.b;if(a&&_.bTransform){Rt.mul(a,_,e._tmpMatrix);a=e._tmpMatrix}if(1!==n||h){u=this._shader2D.ALPHA;c=this._nBlendType;this._shader2D.ALPHA=n;h&&(this._nBlendType=l.TOINT(h));this._drawTextureM(o[0],o[1]-r,o[2]-s,o[3],o[4],0,0,a);this._shader2D.ALPHA=u;this._nBlendType=c}else this._drawTextureM(o[0],o[1]-r,o[2]-s,o[3],o[4],0,0,a);this._x=this._y=0};s.drawCanvas=function(t,e,i,r,s){var a,n,h,l,o,u,c=t.context;if(c._targets){this._submits[this._submits._length++]=tt.create(c,0,null);this._curSubmit=T.RENDERBASE;c._targets.drawTo(this,e,i,r,s)}else{a=this._submits[this._submits._length++]=tt.create(c,this._shader2D.ALPHA,this._shader2D.filters);n=r/t.width;h=s/t.height;l=a._matrix;this._curMat.copy(l);1!=n&&1!=h&&l.scale(n,h);o=l.tx,u=l.ty;l.tx=l.ty=0;l.transformPoint(e,i,Ct.TEMP);l.translate(Ct.TEMP.x+o,Ct.TEMP.y+u);this._curSubmit=T.RENDERBASE}if(Vt.showCanvasMark){this.save();this.lineWidth=4;this.strokeStyle=c._targets?"yellow":"green";this.strokeRect(e-1,i-1,r+2,s+2,1);this.strokeRect(e,i,r,s,1);this.restore()}};s.drawTarget=function(t,e,i,r,s,a,n,h,l,o){var u,c,_,f;void 0===o&&(o=-1);u=this._vb;if(F.fillRectImgVb(u,this._clipRect,e,i,r,s,l||Ft.DEF_UV,a||this._curMat,this._x,this._y,0,0)){c=this._shader2D;c.glTexture=null;_=this._curSubmit.shaderValue;f=this._curSubmit=C.create(this,this._ib,u,(u._length-64)/32*3,h,n);-1==o?f.blendType=this._nBlendType:f.blendType=o;f.scope=t;this._submits[this._submits._length++]=f;this._curSubmit._numEle+=6}};s.transform=function(t,e,i,r,s,a){d.save(this);Rt.mul(Rt.TEMP.setTo(t,e,i,r,s,a),this._curMat,this._curMat);this._curMat._checkTransform()};s.setTransformByMatrix=function(t){t.copy(this._curMat)};s.transformByMatrix=function(t){d.save(this);Rt.mul(t,this._curMat,this._curMat);this._curMat._checkTransform()};s.rotate=function(t){d.save(this);this._curMat.rotate(t)};s.scale=function(t,e){d.save(this);this._curMat.scale(t,e)};s.clipRect=function(t,e,i,r){var s,a,n,h,l,o,u;i*=this._curMat.a;r*=this._curMat.d;s=Ct.TEMP;this._curMat.transformPoint(t,e,s);a=this._curSubmit=I.create(this);this._submits[this._submits._length++]=a;a.submitIndex=this._submits._length;a.submitLength=9999999;_.save(this,a);n=this._clipRect;h=n.x,l=n.y;o=s.x+i,u=s.y+r;h<s.x&&(n.x=s.x);l<s.y&&(n.y=s.y);n.width=Math.min(o,h+n.width)-n.x;n.height=Math.min(u,l+n.height)-n.y;this._shader2D.glTexture=null;a.clipRect.copyFrom(n);this._curSubmit=T.RENDERBASE;this._mergeID=0};s.setIBVB=function(t,e,i,r,s,a,n,h,l,o){void 0===l&&(l=0);void 0===o&&(o=0);null===i&&(F.expandIBQuadrangle(this._ib,r.length/64+8),i=this._ib);if(!h||!n)throw Error("setIBVB must input:shader shaderValues");var u=S.create(this,r,i,s,n,h,l,o);a||(a=Rt.EMPTY);a.translate(t,e);Rt.mul(a,this._curMat,u._mat);a.translate(-t,-e);this._submits[this._submits._length++]=u;this._curSubmit=T.RENDERBASE};s.addRenderObject=function(t){this._submits[this._submits._length++]=t};s.fillTrangles=function(t,e,i,r,s){var a=this._curSubmit,n=this._vb,h=this._shader2D,l=a.shaderValue,o=r.length>>4,u=t.bitmap;if(h.glTexture!=u||h.ALPHA!==l.ALPHA){a=this._curSubmit=T.create(this,0,this._mergeID,this._ib,n,n._length/32*3,k.create(1,0));a.shaderValue.textureHost=t;this._submits[this._submits._length++]=a}F.fillTranglesVB(n,e,i,r,s||this._curMat,this._x,this._y);a._numEle+=6*o};s.arc=function(t,e,i,r,s,a){void 0===a&&(a=!0)};s.fill=function(){};s.closePath=function(){};s.beginPath=function(){this._other=this._other.make();this._other.path||(this._other.path=new u);this._other.path.clear()};s.rect=function(t,e,i,r){this._other=this._other.make();this._other.path||(this._other.path=new u);this._other.path.rect(t,e,i,r)};s.strokeRect=function(t,e,i,r,s){var a=.5*s;this.line(t-a,e,t+i+a,e,s,this._curMat);this.line(t+i,e,t+i,e+r,s,this._curMat);this.line(t,e,t,e+r,s,this._curMat);this.line(t-a,e+r,t+i+a,e+r,s,this._curMat)};s.clip=function(){};s.stroke=function(){if(this._other!==r.DEFAULT){if(this._other.path._rect){var t=this._other.path._rect;this.strokeRect(t.x,t.y,t.width,t.height,this._other.lineWidth)}this._other.path.clear()}};s.moveTo=function(t,e){this._other.path._x=t;this._other.path._y=e};s.lineTo=function(t,e){this.line(this._other.path._x,this._other.path._y,t,e,this._other.lineWidth,this._curMat)};s.line=function(t,e,i,r,s,a){var n,h,l=this._curSubmit,o=this._vb;if(F.fillLineVb(o,this._clipRect,t,e,i,r,s,a)){n=this._shader2D;h=l.shaderValue;if(n.strokeStyle!==h.strokeStyle||n.ALPHA!==h.ALPHA){n.glTexture=null;l=this._curSubmit=T.create(this,0,this._mergeID,this._ib,o,(o._length-64)/32*3,k.create(2,0));l.shaderValue.strokeStyle=n.strokeStyle;l.shaderValue.mainID=2;l.shaderValue.ALPHA=n.ALPHA;this._submits[this._submits._length++]=l}l._numEle+=6}};s.submitElement=function(t,e){var i=this._submits;e<0&&(e=i._length);for(;t<e;)t+=i[t].renderSubmit()};s.finish=function(){V.mainContext.finish()};s.flush=function(){this._ib.upload_bind();var t=Math.max(this._vb.length/64,this._maxNumEle/6)+8;t>this._ib.bufferLength/12&&F.expandIBQuadrangle(this._ib,t);this._vb.upload_bind();this.submitElement(0,this._submits._length);this._path.reset();this._curSubmit=T.RENDERBASE;return this._submits._length};s.fan=function(t,e,i,r,s,a,n){this._path.fan(t,e,i,r,s,a,this._other.lineWidth?this._other.lineWidth:1,n);this._path.update();var h=T.createShape(this,this._path.ib,this._path.vb,this._path.count,this._path.offset,k.create(4,0));h.shaderValue.ALPHA=this._shader2D.ALPHA;h.shaderValue.u_mmat2=P.mat2MatArray(this._curMat,P.TEMPMAT4_ARRAY);this._submits[this._submits._length++]=h};s.drawCircle=function(t,e,i,r,s,a,n){this._path.circle(t,e,i,r,n,a?a:1,s);this._path.update();var h=T.createShape(this,this._path.ib,this._path.vb,this._path.count,this._path.offset,k.create(4,0));h.shaderValue.ALPHA=this._shader2D.ALPHA;h.shaderValue.u_mmat2=P.mat2MatArray(this._curMat,P.TEMPMAT4_ARRAY);this._submits[this._submits._length++]=h};s.drawPoly=function(t,e,i,r,s,a){var n,h;this._path.polygon(t,e,i,r,s?s:1,a);this._path.update();h=M.create(4);this.addRenderObject(h);n=T.createShape(this,this._path.ib,this._path.vb,this._path.count,this._path.offset,k.create(4,0));n.shaderValue.ALPHA=this._shader2D.ALPHA;n.shaderValue.u_mmat2=P.mat2MatArray(this._curMat,P.TEMPMAT4_ARRAY);this._submits[this._submits._length++]=n;h=M.create(5);this.addRenderObject(h);n=T.createShape(this,this._path.ib,this._path.vb,this._path.count,this._path.offset,k.create(4,0));n.shaderValue.ALPHA=this._shader2D.ALPHA;n.shaderValue.u_mmat2=P.mat2MatArray(this._curMat,P.TEMPMAT4_ARRAY);this._submits[this._submits._length++]=n;h=M.create(3);this.addRenderObject(h);if(s>0){this._path.loopLine(t,e,i,s,a);this._path.update();n=T.createShape(this,this._path.ib,this._path.vb,this._path.count,this._path.offset,k.create(4,0));n.shaderValue.ALPHA=this._shader2D.ALPHA;n.shaderValue.u_mmat2=P.mat2MatArray(this._curMat,P.TEMPMAT4_ARRAY);this._submits[this._submits._length++]=n}};s.drawPath=function(t,e,i,r,s){this._path.drawPath(t,e,i,r,s);this._path.update();var a=T.createShape(this,this._path.ib,this._path.vb,this._path.count,this._path.offset,k.create(4,0));this._submits[this._submits._length++]=a};s.drawParticle=function(t,e,i){i.x=t;i.y=e;this._submits[this._submits._length++]=i};s.drawLines=function(t,e,i,r,s){var a,n=Ct.TEMP;this._curMat.transformPoint(t,e,n);if(this._curMat.bTransform){i=i.concat();this._curMat.transformPointArrayScale(i,i)}this._path.drawPath(n.x,n.y,i,r,s);this._path.update();a=T.createShape(this,this._path.ib,this._path.vb,this._path.count,this._path.offset,k.create(4,0));a.shaderValue.ALPHA=this._shader2D.ALPHA;a.shaderValue.u_mmat2=P.mat2MatArray(this._curMat,P.TEMPMAT4_ARRAY);this._submits[this._submits._length++]=a};vt(0,s,"asBitmap",null,function(t){if(t){this._targets||(this._targets=new m);this._targets.repaint=!0;if(!this._width||!this._height)throw Error("asBitmap no size!");this._targets.size(this._width,this._height)}else this._targets=null});vt(0,s,"fillStyle",function(){return this._shader2D.fillStyle},function(t){this._shader2D.fillStyle.equal(t)||(c.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=new o(t))});vt(0,s,"globalCompositeOperation",function(){return l.NAMES[this._nBlendType]},function(t){var e=l.TOINT[t];null==e||this._nBlendType===e||(c.save(this,65536,this,!0),this._curSubmit=T.RENDERBASE,this._nBlendType=e)});vt(0,s,"textAlign",function(){return this._other.textAlign},function(t){this._other.textAlign===t||(this._other=this._other.make(),c.save(this,32768,this._other,!1),this._other.textAlign=t)});vt(0,s,"globalAlpha",function(){return this._shader2D.ALPHA},function(t){t=Math.floor(1e3*t)/1e3;if(t!=this._shader2D.ALPHA){c.save(this,1,this._shader2D,!0);this._shader2D.ALPHA=t}});vt(0,s,"textBaseline",function(){return this._other.textBaseline},function(t){this._other.textBaseline===t||(this._other=this._other.make(),c.save(this,16384,this._other,!1),this._other.textBaseline=t)});vt(0,s,"enableMerge",function(){return this._mergeID>0},function(t){c.save(this,8192,this,!0);this._mergeID=this._drawCount});vt(0,s,"strokeStyle",function(){return this._shader2D.strokeStyle},function(t){this._shader2D.strokeStyle.equal(t)||(c.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=new o(t))});vt(0,s,"lineWidth",function(){return this._other.lineWidth},function(t){this._other.lineWidth===t||(this._other=this._other.make(),c.save(this,256,this._other,!1),this._other.lineWidth=t)});vt(0,s,"font",null,function(t){if(t!=this._other.font.toString()){this._other=this._other.make();c.save(this,8,this._other,!1);this._other.font===L.EMPTY?this._other.font=new L(t):this._other.font.setFont(t)}});e.__init__=function(){r.DEFAULT=new r};e._SUBMITVBSIZE=32e3;e._MAXSIZE=99999999;e._RECTVBSIZE=16;e.MAXCLIPRECT=new It(0,0,99999999,99999999);e._COUNT=0;e._tmpMatrix=new Rt;bt(e,["_fontTemp",function(){return this._fontTemp=new L},"_drawStyleTemp",function(){return this._drawStyleTemp=new o(null)}]);e.__init$=function(){r=function(){function t(){this.lineWidth=1;this.path=null;this.textAlign=null;this.textBaseline=null;this.font=L.EMPTY}xt(t,"");var e=t.prototype;e.clear=function(){this.lineWidth=1;this.path&&this.path.clear();this.textAlign=this.textBaseline=null;this.font=L.EMPTY};e.make=function(){return this===t.DEFAULT?new t:this};t.DEFAULT=null;return t}()};return e}(Mt);k=function(t){function e(t,i){this.size=[0,0];this.alpha=1;this.mmat=null;this.ALPHA=1;this.shader=null;this.mainID=0;this.subID=0;this.filters=null;this.textureHost=null;this.texture=null;this.fillStyle=null;this.color=null;this.strokeStyle=null;this.colorAdd=null;this.glTexture=null;this.u_mmat2=null;this._inClassCache=null;this._cacheID=0;e.__super.call(this);this.defines=new Y;this.position=e._POSITION;this.mainID=t;this.subID=i;this.textureHost=null;this.texture=null;this.fillStyle=null;this.color=null;this.strokeStyle=null;this.colorAdd=null;this.glTexture=null;this.u_mmat2=null;this._cacheID=t|i;this._inClassCache=e._cache[this._cacheID];if(t>0&&!this._inClassCache){this._inClassCache=e._cache[this._cacheID]=[];this._inClassCache._length=0}this.clear()}xt(e,"laya.webgl.shader.d2.value.Value2D",t);var i=e.prototype;i.setValue=function(t){};i.refresh=function(){var t=this.size;t[0]=P.width;t[1]=P.height;this.alpha=this.ALPHA*P.worldAlpha;this.mmat=P.worldMatrix4;return this};i._ShaderWithCompile=function(){return et.withCompile(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,dt.create)};i._withWorldShaderDefines=function(){var t,e,i,r,s,a,n,h=P.worldShaderDefines,l=et.sharders[this.mainID|this.defines._value|h.getValue()];if(!l){t={};e=this.defines.toNameDic();for(i in e)t[i]="";e=h.toNameDic();for(i in e)t[i]="";l=et.withCompile(0,this.mainID,t,this.mainID|this.defines._value|h.getValue(),dt.create)}r=P.worldFilters;if(!r)return l;s=r.length;for(n=0;n<s;n++)(a=r[n])&&a.action.setValue(this);return l};i.upload=function(){var t,e,i=P;this.alpha=this.ALPHA*i.worldAlpha;t=i.worldShaderDefines?this._withWorldShaderDefines():et.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=i.width,this.size[1]=i.height;this.mmat=i.worldMatrix4;if(et.activeShader!==t){if(t._shaderValueWidth!==i.width||t._shaderValueHeight!==i.height){t._shaderValueWidth=i.width;t._shaderValueHeight=i.height}else e=t._params2dQuick2||t._make2dQuick2();t.upload(this,e)}else{if(t._shaderValueWidth!==i.width||t._shaderValueHeight!==i.height){t._shaderValueWidth=i.width;t._shaderValueHeight=i.height}else e=t._params2dQuick1||t._make2dQuick1();t.upload(this,e)}};i.setFilters=function(t){var e,i,r;this.filters=t;if(t){e=t.length;for(r=0;r<e;r++){i=t[r];if(i){this.defines.add(i.type);i.action.setValue(this)}}}};i.clear=function(){this.defines.setValue(this.subID)};i.release=function(){this._inClassCache[this._inClassCache._length++]=this;this.clear()};e._initone=function(t,i){e._typeClass[t]=i;e._cache[t]=[];e._cache[t]._length=0};e.__init__=function(){e._POSITION=[2,5126,!1,4*D.BYTES_PE,0];e._TEXCOORD=[2,5126,!1,4*D.BYTES_PE,2*D.BYTES_PE];e._initone(2,st);e._initone(4,nt);e._initone(1,at);e._initone(65,mt);e._initone(9,at)};e.create=function(t,i){var r=e._cache[t|i];return r._length?r[--r._length]:new e._typeClass[t|i](i)};e._POSITION=null;e._TEXCOORD=null;e._cache=[];e._typeClass=[];return e}(s);z=function(t){function e(){this.data=null;e.__super.call(this)}xt(e,"laya.filters.webgl.ColorFilterActionGL",t);var r=e.prototype;i.imps(r,{"laya.filters.IFilterActionGL":!0});r.setValue=function(t){t.u_colorMatrix=this.data._elements};r.apply3d=function(t,e,i,r,s){var a,n=t.getValue("bounds"),h=k.create(1,0);h.setFilters([this.data]);a=Rt.EMPTY;a.identity();i.ctx.drawTarget(t,0,0,n.width,n.height,a,"src",h)};return e}(r);U=function(t){function e(t,i){e.__super.call(this,t,i)}xt(e,"laya.webgl.utils.RenderSprite3D",t);var i=e.prototype;i.onCreate=function(t){switch(t){case 32:this._fun=this._blend;return;case 8:this._fun=this._transform;return}};i._blend=function(t,e,i,r){var s,a,n=t._style;e.ctx.save();if(t.mask){s=M.create(1);e.addRenderObject(s);t.mask.render(e,i,r);s=M.create(2);e.addRenderObject(s);a=this._next;a._fun.call(a,t,e,i,r);s=M.create(3);e.ctx._curSubmit=T.RENDERBASE;e.addRenderObject(s)}else{e.ctx.globalCompositeOperation=n.blendMode;a=this._next;a._fun.call(a,t,e,i,r)}e.ctx.restore()};i._transform=function(t,e,i,r){"use strict";var s,a,n,h,l=t.transform,o=this._next;if(l&&o!=Bt.NORENDER){s=e.ctx;a=t._style;l.tx=i;l.ty=r;n=s._getTransformMatrix();h=n.clone();Rt.mul(l,n,n);n._checkTransform();o._fun.call(o,t,e,0,0);h.copy(n);h.destroy();l.tx=l.ty=0}else o._fun.call(o,t,e,i,r)};return e}(Bt);W=function(t){function e(t,i,r,s,a){this._atlasCanvas=null;this._inAtlasTextureKey=null;this._inAtlasTextureBitmapValue=null;this._inAtlasTextureOriUVValue=null;this._InAtlasWebGLImagesKey=null;this._InAtlasWebGLImagesOffsetValue=null;e.__super.call(this,t,i,a);this._inAtlasTextureKey=[];this._inAtlasTextureBitmapValue=[];this._inAtlasTextureOriUVValue=[];this._InAtlasWebGLImagesKey=[];this._InAtlasWebGLImagesOffsetValue=[];this._atlasCanvas=new ht;this._atlasCanvas.width=r;this._atlasCanvas.height=s;this._atlasCanvas.activeResource()}xt(e,"laya.webgl.atlas.Atlaser",t);var i=e.prototype;i.computeUVinAtlasTexture=function(t,e,i,r){var s=n.atlasTextureWidth,a=n.atlasTextureHeight,h=i/s,l=r/a,o=(i+t.bitmap.width)/s,u=(r+t.bitmap.height)/a,c=t.bitmap.width/s,_=t.bitmap.height/a;t.uv=[h+e[0]*c,l+e[1]*_,o-(1-e[2])*c,l+e[3]*_,o-(1-e[4])*c,u-(1-e[5])*_,h+e[6]*c,u-(1-e[7])*_]};i.addToAtlasTexture=function(t,e,i){t instanceof laya.webgl.resource.WebGLImage&&(this._InAtlasWebGLImagesKey.push(t),this._InAtlasWebGLImagesOffsetValue.push([e,i]));this._atlasCanvas.texSubImage2D(t,e,i,t.atlasSource);t.clearAtlasSource()};i.addToAtlas=function(t,e,i){var r=t.uv.slice(),s=t.bitmap;this._inAtlasTextureKey.push(t);this._inAtlasTextureOriUVValue.push(r);this._inAtlasTextureBitmapValue.push(s);this.computeUVinAtlasTexture(t,r,e,i);t.bitmap=this._atlasCanvas};i.clear=function(){for(var t=0,e=this._inAtlasTextureKey.length;t<e;t++){this._inAtlasTextureKey[t].bitmap=this._inAtlasTextureBitmapValue[t];this._inAtlasTextureKey[t].uv=this._inAtlasTextureOriUVValue[t];this._inAtlasTextureKey[t].bitmap.lock=!0;this._inAtlasTextureKey[t].bitmap.releaseResource();this._inAtlasTextureKey[t].bitmap.lock=!1}this._inAtlasTextureKey.length=0;this._inAtlasTextureBitmapValue.length=0;this._inAtlasTextureOriUVValue.length=0;this._InAtlasWebGLImagesKey.length=0;this._InAtlasWebGLImagesOffsetValue.length=0};i.dispose=function(){this.clear();this._atlasCanvas.dispose()};vt(0,i,"texture",function(){return this._atlasCanvas});vt(0,i,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey});vt(0,i,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue});return e}(a);Y=function(t){function e(){e.__super.call(this,e.__name2int,e.__int2name,e.__int2nameMap)}xt(e,"laya.webgl.shader.d2.ShaderDefines2D",t);e.__init__=function(){e.reg("TEXTURE2D",1);e.reg("COLOR2D",2);e.reg("PRIMITIVE",4);e.reg("GLOW_FILTER",8);e.reg("BLUR_FILTER",16);e.reg("COLOR_FILTER",32);e.reg("COLOR_ADD",64)};e.reg=function(t,i){b._reg(t,i,e.__name2int,e.__int2name)};e.toText=function(t,e,i){return b._toText(t,e,i)};e.toInt=function(t){return b._toInt(t,e.__name2int)};e.TEXTURE2D=1;e.COLOR2D=2;e.PRIMITIVE=4;e.FILTERGLOW=8;e.FILTERBLUR=16;e.FILTERCOLOR=32;e.COLORADD=64;e.__name2int={};e.__int2name=[];e.__int2nameMap=[];return e}(b);X=function(t){function e(t,i,r,s,a,n,h){e.__super.call(this,t,i,r,r,s,a,n,h)}xt(e,"laya.webgl.shapes.Circle",t);var i=e.prototype;i.getData=function(t,e,i){var r,s,a=[],n=[];this.circle(n,a,i);if(this.fill){this.borderWidth>0&&this.createLoopLine(n,a,this.borderWidth,i+n.length/5);t.append(new Uint16Array(a));e.append(new Float32Array(n))}else{r=[];s=[];this.createLoopLine(n,a,this.borderWidth,i,r,s);t.append(new Uint16Array(s));e.append(new Float32Array(r))}};return e}(x);Q=function(t){function e(t,i,r,s,a,n,h){e.__super.call(this,t,i,r,s,40,a,n,h)}xt(e,"laya.webgl.shapes.Ellipse",t);return e}(x);j=function(t){function e(t,i,r,s,a,n,h,l,o){void 0===o&&(o=0);e.__super.call(this,t,i,r,r,30,n,h,l,o);this.r0=s;this.r1=a}xt(e,"laya.webgl.shapes.Fan",t);var i=e.prototype;i.getData=function(t,e,i){var r,s,a=[],n=[];this.sector(n,a,i);if(this.fill){this.borderWidth>0&&-1!=this.borderColor&&this.createFanLine(n,a,this.borderWidth,i+n.length/5,null,null);t.append(new Uint16Array(a));e.append(new Float32Array(n))}else{r=[];s=[];-1!=this.borderColor&&this.borderWidth>0&&this.createFanLine(n,a,this.borderWidth,i,r,s);t.append(new Uint16Array(s));e.append(new Float32Array(r))}};return e}(x);q=function(t){function e(t,i,r,s,a){this.points;e.__super.call(this,t,i,0,0,0,s,a,s,0);this.points=r}xt(e,"laya.webgl.shapes.Line",t);var i=e.prototype;i.getData=function(t,e,i){var r=[],s=[];this.borderWidth>0&&this.createLine2(this.points,r,this.borderWidth,i,s,this.points.length/2);t.append(new Uint16Array(r));e.append(new Float32Array(s))};return e}(x);K=function(t){function e(t,i,r,s,a){this._points=r;e.__super.call(this,t,i,0,0,this._points.length/2,0,s,a)}xt(e,"laya.webgl.shapes.LoopLine",t);var i=e.prototype;i.getData=function(t,e,i){var r,s,a,n,h,l,o,u;if(this.borderWidth>0){r=this.color;s=(r>>16&255)/255,a=(r>>8&255)/255,n=(255&r)/255;h=[];l=[];o=Math.floor(this._points.length/2);for(u=0;u<o;u++)h.push(this.x+this._points[2*u],this.y+this._points[2*u+1],s,a,n);this.createLoopLine(h,l,this.borderWidth,i+h.length/5);t.append(new Uint16Array(l));e.append(new Float32Array(h))}};i.createLoopLine=function(t,e,i,r,s,a){var n,h,l,o,u,c,_,f,d,g,m,p,b,x,v,y,T,w,A,S,I,M,C,R,E,L,D=t.concat(),F=s?s:t,P=this.borderColor,O=(P>>16&255)/255,V=(P>>8&255)/255,B=(255&P)/255,N=[D[0],D[1]],G=[D[D.length-5],D[D.length-4]],H=G[0]+.5*(N[0]-G[0]),k=G[1]+.5*(N[1]-G[1]);D.unshift(H,k,0,0,0);D.push(H,k,0,0,0);n=D.length/5;h=r,l=i/2;c=D[0];_=D[1];f=D[5];d=D[6];p=-(_-d);b=c-f;R=Math.sqrt(p*p+b*b);p=p/R*l;b=b/R*l;F.push(c-p,_-b,O,V,B,c+p,_+b,O,V,B);for(E=1;E<n-1;E++){c=D[5*(E-1)];_=D[5*(E-1)+1];f=D[5*E];d=D[5*E+1];g=D[5*(E+1)];m=D[5*(E+1)+1];p=-(_-d);b=c-f;R=Math.sqrt(p*p+b*b);p=p/R*l;b=b/R*l;x=-(d-m);v=f-g;R=Math.sqrt(x*x+v*v);x=x/R*l;v=v/R*l;y=-b+_-(-b+d);T=-p+f-(-p+c);w=(-p+c)*(-b+d)-(-p+f)*(-b+_);A=-v+m-(-v+d);S=-x+f-(-x+g);I=(-x+g)*(-v+d)-(-x+f)*(-v+m);M=y*S-A*T;if(Math.abs(M)<.1){M+=10.1;F.push(f-p,d-b,O,V,B,f+p,d+b,O,V,B)}else{o=(T*I-S*w)/M;u=(A*w-y*I)/M;C=(o-f)*(o-f)+(u-d)+(u-d);F.push(o,u,O,V,B,f-(o-f),d-(u-d),O,V,B)}}a&&(e=a);L=this.edges+1;for(E=1;E<L;E++)e.push(h+2*(E-1),h+2*(E-1)+1,h+2*E+1,h+2*E+1,h+2*E,h+2*(E-1));e.push(h+2*(E-1),h+2*(E-1)+1,h+1,h+1,h,h+2*(E-1));return F};return e}(x);$=function(t){function e(t,i,r,s,a,n){this._points=null;this._points=r;e.__super.call(this,t,i,0,0,this._points.length/2,s,a,n)}xt(e,"laya.webgl.shapes.Polygon",t);var i=e.prototype;i.getData=function(t,e,i){var r=[],s=[],a=this.color,n=(a>>16&255)/255,h=(a>>8&255)/255,l=(255&a)/255,o=this._points,u=0,c=Math.floor(o.length/2);for(u=0;u<c;u++)s.push(this.x+o[2*u],this.y+o[2*u+1],n,h,l);for(u=2;u<c;u++)r.push(i,i+u-1,i+u);t.append(new Uint16Array(r));e.append(new Float32Array(s))};return e}(x);Z=function(t){function e(t,i,r,s,a,n,h){e.__super.call(this,t+r/2,i+s/2,r/2,s/2,4,a,n,h)}xt(e,"laya.webgl.shapes.Rect",t);return e}(x);J=function(t){function e(t,i,r,s,a,n,h,l,o){e.__super.call(this,t,i,r,s,a,n,h,l,o)}xt(e,"laya.webgl.shapes.RoundPolygon",t);return e}(x);tt=function(t){function e(){this._matrix=new Rt;this._matrix4=D.defaultMatrix4.concat();e.__super.call(this,1);this.shaderValue=new k(0,0)}xt(e,"laya.webgl.submit.SubmitCanvas",t);var i=e.prototype;i.renderSubmit=function(){var t,e,i,r,s,a,n,h,l;if(this._ctx_src._targets){this._ctx_src._targets.flush(this._ctx_src);return 1}t=P.worldAlpha;e=P.worldMatrix4;i=P.worldMatrix;r=P.worldFilters;s=P.worldShaderDefines;a=this.shaderValue;n=this._matrix;h=this._matrix4;l=Rt.TEMP;Rt.mul(n,i,l);h[0]=l.a;h[1]=l.b;h[4]=l.c;h[5]=l.d;h[12]=l.tx;h[13]=l.ty;P.worldMatrix=l.clone();P.worldMatrix4=h;P.worldAlpha=P.worldAlpha*a.alpha;if(a.filters&&a.filters.length){P.worldFilters=a.filters;P.worldShaderDefines=a.defines}this._ctx_src.flush();P.worldAlpha=t;P.worldMatrix4=e;P.worldMatrix.destroy();P.worldMatrix=i;P.worldFilters=r;P.worldShaderDefines=s;return 1};i.releaseRender=function(){var t=e._cache;t[t._length++]=this};i.getRenderType=function(){return 3};e.create=function(t,i,r){var s,a=e._cache._length?e._cache[--e._cache._length]:new e;a._ctx_src=t;s=a.shaderValue;s.alpha=i;s.defines.setValue(0);r&&r.length&&s.setFilters(r);return a};e._cache=(e._cache=[],e._cache._length=0,e._cache);return e}(T);et=function(t){function e(t,i,r,s){this.customCompile=!1;this.tag={};this._program=null;this._params=null;this._paramsMap={};this._offset=0;e.__super.call(this);Ht.isConchApp&&(this.customCompile=!0);this._id=++e._count;this._vs=t;this._ps=i;this._nameMap=s?s:{};null!=r&&(e.sharders[r]=this)}xt(e,"laya.webgl.shader.Shader",t);var r=e.prototype;r.recreateResource=function(){this.startCreate();this.compile();this.compoleteCreate();this.memorySize=0};r.detoryResource=function(){V.mainContext.deleteShader(this._vshader);V.mainContext.deleteShader(this._pshader);V.mainContext.deleteProgram(this._program);this._vshader=this._pshader=this._program=null;this._params=null;this._paramsMap={};this.memorySize=0};r.compileParams=function(){};r.compile=function(){var t,i,r,s,a,n,h,l,o,u,c,_;if(this._vs&&this._ps&&!this._params){this._reCompile=!0;this._params=[];t=[this._vs,this._ps];this.customCompile&&(i=this.preGetParams(this._vs,this._ps));r=V.mainContext;this._program=r.createProgram();this._vshader=e._createShader(r,t[0],35633);this._pshader=e._createShader(r,t[1],35632);r.attachShader(this._program,this._vshader);r.attachShader(this._program,this._pshader);r.linkProgram(this._program);if(!r.getProgramParameter(this._program,35714))throw r.getProgramInfoLog(this._program);a=0,n=0,h=0;o=0;o=this.customCompile?i.attributes.length:r.getProgramParameter(this._program,35721);for(a=0;a<o;a++){u=this.customCompile?i.attributes[a]:r.getActiveAttrib(this._program,a);l=r.getAttribLocation(this._program,u.name);s={vartype:"attribute",ivartype:0,attrib:u,location:l,name:u.name,type:u.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0};this._params.push(s)}c=0;c=this.customCompile?i.uniforms.length:r.getProgramParameter(this._program,35718);for(a=0;a<c;a++){_=this.customCompile?i.uniforms[a]:r.getActiveUniform(this._program,a);l=r.getUniformLocation(this._program,_.name);s={vartype:"uniform",ivartype:1,attrib:u,location:l,name:_.name,type:_.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0};if(s.name.indexOf("[0]")>0){s.name=s.name.substr(0,s.name.length-3);s.isArray=!0;s.location=r.getUniformLocation(this._program,s.name)}this._params.push(s)}for(a=0,h=this._params.length;a<h;a++){s=this._params[a];s.indexOfParams=a;s.index=1;s.value=[s.location,null];s.codename=s.name;s.name=this._nameMap[s.codename]?this._nameMap[s.codename]:s.codename;this._paramsMap[s.name]=s;s._this=this;s.saveValue=[];if("attribute"!==s.vartype)switch(s.type){case 5126:s.fun=s.isArray?this._uniform1fv:this._uniform1f;break;case 35664:s.fun=this._uniform_vec2;break;case 35665:s.fun=this._uniform_vec3;break;case 35666:s.fun=this._uniform_vec4;break;case 35678:s.fun=this._uniform_sampler2D;break;case 35676:s.fun=this._uniformMatrix4fv;break;case 35670:s.fun=this._uniform1i;break;case 35680:case 35674:case 35675:throw new Error("compile shader err!");break;default:throw new Error("compile shader err!")}else s.fun=this._attribute}}};r.getUniform=function(t){return this._paramsMap[t]};r._attribute=function(t,e){var i=V.mainContext;i.enableVertexAttribArray(t.location);i.vertexAttribPointer(t.location,e[0],e[1],e[2],e[3],e[4]+this._offset);return 2};r._uniformMatrix4fv=function(t,e){V.mainContext.uniformMatrix4fv(t.location,!1,e);return 1};r._uniform1i=function(t,e){var i=t.saveValue;if(i[0]!==e){V.mainContext.uniform1i(t.location,i[0]=e);return 1}return 0};r._uniform1f=function(t,e){var i=t.saveValue;if(i[0]!==e){V.mainContext.uniform1f(t.location,i[0]=e);return 1}return 0};r._uniform1fv=function(t,e){var i=t.saveValue;if(i[0]!==e){V.mainContext.uniform1fv(t.location,i[0]=e);return 1}return 0};r._uniform_vec2=function(t,e){var i=t.saveValue;if(i[0]!==e[0]||i[1]!==e[1]){V.mainContext.uniform2f(t.location,i[0]=e[0],i[1]=e[1]);return 1}return 0};r._uniform_vec3=function(t,e){V.mainContext.uniform3f(t.location,e[0],e[1],e[2]);return 1};r._uniform_vec4=function(t,e){V.mainContext.uniform4f(t.location,e[0],e[1],e[2],e[3]);return 1};r._uniform_sampler2D=function(t,i){var r,s=V.mainContext;s.activeTexture(e._TEXTURES[this._texIndex]);s.bindTexture(3553,i);r=t.saveValue;r[0]!==this._texIndex&&s.uniform1i(t.location,r[0]=this._texIndex);this._texIndex++;return 1};r._noSetValue=function(t){console.log("no....:"+t.name)};r.uploadOne=function(t,e){this.activeResource();B.UseProgram(this._program);var i=this._paramsMap[t];i.fun.call(this,i,e)};r.upload=function(t,i){var r,s,a,n,h;e.activeShader=this;this.activeResource();B.UseProgram(this._program);this._texIndex=0;if(this._reCompile){i=this._params;this._reCompile=!1}else i=i||this._params;a=i.length,n=0;for(h=0;h<a;h++){r=i[h];null!==(s=t[r.name])&&(n+=r.fun.call(this,r,s))}Et.shaderCall+=n};r.uploadArray=function(t,i,r){var s,a,n,h,l,o,u,c,_;e.activeShader=this;this.activeResource();this._texIndex=0;s=!B.UseProgram(this._program);a=this._params;l=0,o=e._uploadArrayCount++;for(u=i-2;u>=0;u-=2){h=this._paramsMap[t[u]];if(h&&h._uploadArrayCount!==o){h._uploadArrayCount=o;c=t[u+1];_=c[1];if(!(s&&1===h.ivartype&&_>0&&_===h.__uploadid)){n=c[0];if(null!=n){r&&r[h.name]&&r[h.name].bind();l+=h.fun.call(this,h,n);h.__uploadid=_}}}}Et.shaderCall+=l};r.getParams=function(){return this._params};r.preGetParams=function(t,r){var s,a,n,h,l,o,u,c,_,f,d=[t,r],g={},m=[],p=[];g.attributes=m;g.uniforms=p;s=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g");a=new RegExp("(\".*\")|('.*')|([\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g");n=0,h=0;for(o=0;o<2;o++){d[o]=d[o].replace(s,"");u=d[o].match(a);c="";_=0;for(n=0,h=u.length;n<h;n++){f=u[n];if("attribute"==f||"uniform"==f){l={type:e.shaderParamsMap[u[n+1]],name:u[n+2],size:isNaN(i.__parseInt(u[n+3]))?1:i.__parseInt(u[n+3])};"attribute"==f?m.push(l):p.push(l);c+=l.vartype+" "+l.type+" "+l.name+" ";if(":"==u[n+3]){l.type=u[n+4];n+=2}n+=2}else{c+=f;";"!=f&&(c+=" ")}}d[o]=c}return g};r.dispose=function(){this.resourceManager.removeResource(this);t.prototype.dispose.call(this)};e.getShader=function(t){return e.sharders[t]};e.create=function(t,i,r,s){return new e(t,i,r,s)};e.withCompile=function(t,i,r,s,a){if(s&&e.sharders[s])return e.sharders[s];var n=e._preCompileShader[2e-4*t+i];if(!n)throw new Error("withCompile shader err!"+t+" "+i);return n.createShader(r,s,a)};e.addInclude=function(t,i){if(!i||0===i.length)throw new Error("add shader include file err:"+t);if(e._includeFiles[t])throw new Error("add shader include file err, has add:"+t);e._includeFiles[t]=i};e.preCompile=function(t,i,r,s,a){var n=2e-4*t+i;e._preCompileShader[n]=new O(n,r,s,a,e._includeFiles)};e._createShader=function(t,e,i){var r=t.createShader(i);t.shaderSource(r,e);t.compileShader(r);if(!t.getShaderParameter(r,35713))throw t.getShaderInfoLog(r);return r};e._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992];e._includeFiles={};e._count=0;e._preCompileShader={};e._uploadArrayCount=1;e.SHADERNAME2ID=2e-4;e.activeShader=null;e.sharders=(e.sharders=[],e.sharders.length=32,e.sharders);bt(e,["shaderParamsMap",function(){return this.shaderParamsMap={"float":5126,"int":5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new zt}]);return e}(kt);it=function(t){function e(t,i,r,s,a,n){this._type=0;this._svWidth=NaN;this._svHeight=NaN;this._preRenderTarget=null;this._alreadyResolved=!1;this._looked=!1;this._surfaceFormat=0;this._surfaceType=0;this._depthFormat=0;this._mipMap=!1;this._destroy=!1;this._type=1;this._w=t;this._h=i;this._surfaceFormat=s;this._surfaceType=a;this._depthFormat=n;this._mipMap=r;this._createWebGLRenderTarget();this.bitmap.lock=!0;e.__super.call(this,this.bitmap,Ft.INV_UV)}xt(e,"laya.webgl.resource.RenderTarget2D",t);var r=e.prototype;i.imps(r,{"laya.resource.IDispose":!0});r.getType=function(){return this._type};r.getTexture=function(){return this};r.size=function(t,e){if(!this.bitmap||this._w!=t||this._h!=e){this._w=t;this._h=e;this.release();this._createWebGLRenderTarget()}};r.release=function(){this.destroy()};r.recycle=function(){e.POOL.push(this)};r.start=function(){var t=V.mainContext;this._preRenderTarget=P.curRenderTarget;P.curRenderTarget=this;t.bindFramebuffer(36160,this.bitmap.frameBuffer);this._alreadyResolved=!1;if(1==this._type){t.viewport(0,0,this._w,this._h);
this._svWidth=P.width;this._svHeight=P.height;P.width=this._w;P.height=this._h;et.activeShader=null}return this};r.clear=function(t,e,i,r){var s,a;void 0===t&&(t=0);void 0===e&&(e=0);void 0===i&&(i=0);void 0===r&&(r=1);s=V.mainContext;s.clearColor(t,e,i,r);a=16384;this._depthFormat&&(a|=256);s.clear(a)};r.end=function(){var t=V.mainContext;t.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null);this._alreadyResolved=!0;P.curRenderTarget=this._preRenderTarget;if(1==this._type){t.viewport(0,0,this._svWidth,this._svHeight);P.width=this._svWidth;P.height=this._svHeight;et.activeShader=null}else t.viewport(0,0,i.stage.width,i.stage.height)};r.getData=function(t,e,i,r){var s,a,n=V.mainContext;n.bindFramebuffer(36160,this.bitmap.frameBuffer);s=36053===n.checkFramebufferStatus(36160);if(!s){n.bindFramebuffer(36160,null);return null}a=new Uint8Array(this._w*this._h*4);n.readPixels(t,e,i,r,this._surfaceFormat,this._surfaceType,a);n.bindFramebuffer(36160,null);return a};r.destroy=function(){if(!this._destroy){this._loaded=!1;this.bitmap.dispose();this.bitmap=null;this._destroy=!0;t.prototype.destroy.call(this)}};r.dispose=function(){};r._createWebGLRenderTarget=function(){this.bitmap=new ut(this.width,this.height,this.mipMap,this.surfaceFormat,this.surfaceType,this.depthFormat);this.bitmap.activeResource();this._alreadyResolved=!0;this._destroy=!1;this._loaded=!0};vt(0,r,"surfaceFormat",function(){return this._surfaceFormat});vt(0,r,"surfaceType",function(){return this._surfaceType});vt(0,r,"depthFormat",function(){return this._depthFormat});vt(0,r,"mipMap",function(){return this._mipMap});vt(0,r,"source",function(){if(this._alreadyResolved)return t.prototype._$get_source.call(this);throw new Error("RenderTarget  还未准备好！")});e.create=function(t,i,r){void 0===r&&(r=1);var s=e.POOL.pop();s||(s=new e(t,i,!1,6408,5121,0));s.size(t,i);return s};e.TYPE2D=1;e.TYPE3D=2;e.POOL=[];return e}(Ft);rt=function(t){function e(t,i,r,s){this._length=0;this._upload=!0;this._uploadSize=0;this._maxsize=0;void 0===s&&(s=35048);e.__super.call(this);this.lock=!0;e._gl=V.mainContext;this._$2__id=++e._COUNT;this._usage=i;34963==t&&(t=34963,this._usage="INDEX");34962==t&&(t=34962);this._glTarget=t;this._bufferUsage=s;this._buffer=new ArrayBuffer(8);r&&this.append(r)}xt(e,"laya.webgl.utils.Buffer",t);var i=e.prototype;i.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))};i.getUint16Array=function(){return new Uint16Array(this._buffer)};i.clear=function(){this._length=0;this._upload=!0};i.append=function(t){this._upload=!0;var e,i=0;if(t instanceof Uint8Array){i=t.length;this._resizeBuffer(this._length+i,!0);e=new Uint8Array(this._buffer,this._length)}else if(t instanceof Float32Array){i=4*t.length;this._resizeBuffer(this._length+i,!0);e=new Float32Array(this._buffer,this._length)}else if(t instanceof Uint16Array){i=2*t.length;this._resizeBuffer(this._length+i,!0);e=new Uint16Array(this._buffer,this._length)}e.set(t,0);this._length+=i;this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))};i.setdata=function(t){this._buffer=t.buffer;this._upload=!0;this._floatArray32||(this._floatArray32=new Float32Array(this._buffer));this._length=this._buffer.byteLength};i.getBuffer=function(){return this._buffer};i.seLength=function(t){if(this._length!==t){t<=this._buffer.byteLength||this._resizeBuffer(2*t+256,!0);this._length=t}};i._resizeBuffer=function(t,e){var i,r;if(t<this._buffer.byteLength)return this;this.memorySize=this._buffer.byteLength;if(e&&this._buffer&&this._buffer.byteLength>0){i=new ArrayBuffer(t);r=new Uint8Array(i);r.set(new Uint8Array(this._buffer),0);this._buffer=i}else this._buffer=new ArrayBuffer(t);this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer));this._upload=!0;return this};i.setNeedUpload=function(){this._upload=!0};i.getNeedUpload=function(){return this._upload};i.bind=function(){this.activeResource();e._bindActive[this._glTarget]===this._glBuffer||(e._gl.bindBuffer(this._glTarget,e._bindActive[this._glTarget]=this._glBuffer),et.activeShader=null)};i.recreateResource=function(){this.startCreate();this._glBuffer||(this._glBuffer=e._gl.createBuffer());this.compoleteCreate()};i.detoryResource=function(){if(this._glBuffer){V.mainContext.disableVertexAttribArray(0);V.mainContext.disableVertexAttribArray(1);V.mainContext.disableVertexAttribArray(2);V.mainContext.deleteBuffer(this._glBuffer);this._glBuffer;this._glBuffer=null;this._upload=!0;this._uploadSize=0;this.memorySize=0}};i.upload=function(){if(!this._upload)return!1;this._upload=!1;this.bind();this._maxsize=Math.max(this._maxsize,this._length);if(Et.loopCount%30==0){if(this._buffer.byteLength>this._maxsize+64){this.memorySize=this._buffer.byteLength;this._buffer=this._buffer.slice(0,this._maxsize+64);this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))}this._maxsize=this._length}if(this._uploadSize<this._buffer.byteLength){this._uploadSize=this._buffer.byteLength;e._gl.bufferData(this._glTarget,this._uploadSize,this._bufferUsage);this.memorySize=this._uploadSize}e._gl.bufferSubData(this._glTarget,0,this._buffer);Et.bufferLen+=this._length;return!0};i.subUpload=function(t,i,r){void 0===t&&(t=0);void 0===i&&(i=0);void 0===r&&(r=0);if(!this._upload)return!1;this._upload=!1;this.bind();this._maxsize=Math.max(this._maxsize,this._length);if(Et.loopCount%30==0){if(this._buffer.byteLength>this._maxsize+64){this.memorySize=this._buffer.byteLength;this._buffer=this._buffer.slice(0,this._maxsize+64);this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))}this._maxsize=this._length}if(this._uploadSize<this._buffer.byteLength){this._uploadSize=this._buffer.byteLength;e._gl.bufferData(this._glTarget,this._uploadSize,this._bufferUsage);this.memorySize=this._uploadSize}if(i||r){var s=this._buffer.slice(i,r);e._gl.bufferSubData(this._glTarget,t,s)}else e._gl.bufferSubData(this._glTarget,t,this._buffer);return!0};i.upload_bind=function(){this._upload&&this.upload()||this.bind()};i.disposeCPUData=function(){this._buffer=null;this._floatArray32=null};i.dispose=function(){this.resourceManager.removeResource(this);t.prototype.dispose.call(this)};vt(0,i,"uintArray16",function(){this._uint16=new Uint16Array(this._buffer);return this._uint16});vt(0,i,"bufferLength",function(){return this._buffer.byteLength});vt(0,i,"length",function(){return this._length},function(t){if(this._length!==t){t<=this._buffer.byteLength||this._resizeBuffer(2*t+256,!0);this._length=t}});vt(0,i,"usage",function(){return this._usage});e.__int__=function(t){e._gl=t;e.QuadrangleIB=new e(34963,"INDEX",null,35044);F.fillIBQuadrangle(e.QuadrangleIB,16)};e.INDEX="INDEX";e.POSITION0="POSITION";e.NORMAL0="NORMAL";e.COLOR0="COLOR";e.UV0="UV";e.NEXTUV0="NEXTUV";e.UV1="UV1";e.NEXTUV1="NEXTUV1";e.BLENDWEIGHT0="BLENDWEIGHT";e.BLENDINDICES0="BLENDINDICES";e.MATRIX0="MATRIX0";e.MATRIX1="MATRIX1";e.MATRIX2="MATRIX2";e.DIFFUSETEXTURE="DIFFUSETEXTURE";e.NORMALTEXTURE="NORMALTEXTURE";e.SPECULARTEXTURE="SPECULARTEXTURE";e.EMISSIVETEXTURE="EMISSIVETEXTURE";e.AMBIENTTEXTURE="AMBIENTTEXTURE";e.REFLECTTEXTURE="REFLECTTEXTURE";e.MATRIXARRAY0="MATRIXARRAY0";e.FLOAT0="FLOAT0";e.UVAGEX="UVAGEX";e.CAMERAPOS="CAMERAPOS";e.LUMINANCE="LUMINANCE";e.ALPHATESTVALUE="ALPHATESTVALUE";e.FOGCOLOR="FOGCOLOR";e.FOGSTART="FOGSTART";e.FOGRANGE="FOGRANGE";e.MATERIALAMBIENT="MATERIALAMBIENT";e.MATERIALDIFFUSE="MATERIALDIFFUSE";e.MATERIALSPECULAR="MATERIALSPECULAR";e.LIGHTDIRECTION="LIGHTDIRECTION";e.LIGHTDIRDIFFUSE="LIGHTDIRDIFFUSE";e.LIGHTDIRAMBIENT="LIGHTDIRAMBIENT";e.LIGHTDIRSPECULAR="LIGHTDIRSPECULAR";e.POINTLIGHTPOS="POINTLIGHTPOS";e.POINTLIGHTRANGE="POINTLIGHTRANGE";e.POINTLIGHTATTENUATION="POINTLIGHTATTENUATION";e.POINTLIGHTDIFFUSE="POINTLIGHTDIFFUSE";e.POINTLIGHTAMBIENT="POINTLIGHTAMBIENT";e.POINTLIGHTSPECULAR="POINTLIGHTSPECULAR";e.SPOTLIGHTPOS="SPOTLIGHTPOS";e.SPOTLIGHTDIRECTION="SPOTLIGHTDIRECTION";e.SPOTLIGHTSPOT="SPOTLIGHTSPOT";e.SPOTLIGHTRANGE="SPOTLIGHTRANGE";e.SPOTLIGHTATTENUATION="SPOTLIGHTATTENUATION";e.SPOTLIGHTDIFFUSE="SPOTLIGHTDIFFUSE";e.SPOTLIGHTAMBIENT="SPOTLIGHTAMBIENT";e.SPOTLIGHTSPECULAR="SPOTLIGHTSPECULAR";e.CORNERTEXTURECOORDINATE="CORNERTEXTURECOORDINATE";e.VELOCITY="VELOCITY";e.SIZEROTATION="SIZEROTATION";e.RADIUSRADIAN="RADIUSRADIAN";e.AGEADDSCALE="AGEADDSCALE";e.TIME="TIME";e.VIEWPORTSCALE="VIEWPORTSCALE";e.CURRENTTIME="CURRENTTIME";e.DURATION="DURATION";e.GRAVITY="GRAVITY";e.ENDVELOCITY="ENDVELOCITY";e.FLOAT32=4;e.SHORT=2;e.QuadrangleIB=null;e._gl=null;e._bindActive=[];e._COUNT=1;return e}(kt);st=function(t){function e(){e.__super.call(this,2,0);this.color=[]}xt(e,"laya.webgl.shader.d2.value.Color2dSV",t);var i=e.prototype;i.setValue=function(t){t.fillStyle&&(this.color=t.fillStyle._color._color);t.strokeStyle&&(this.color=t.strokeStyle._color._color)};return e}(k);at=function(t){function e(t){this.u_colorMatrix=null;this.texcoord=k._TEXCOORD;void 0===t&&(t=0);e.__super.call(this,1,t)}xt(e,"laya.webgl.shader.d2.value.TextureSV",t);var i=e.prototype;i.setValue=function(t){this.ALPHA=t.ALPHA;t.filters&&this.setFilters(t.filters)};i.clear=function(){this.texture=null;this.shader=null;this.defines.setValue(0)};return e}(k);nt=function(t){function e(){this.a_color=null;e.__super.call(this,4,0);this.position=[2,5126,!1,5*D.BYTES_PE,0];this.a_color=[3,5126,!1,5*D.BYTES_PE,8]}xt(e,"laya.webgl.shader.d2.value.PrimitiveSV",t);return e}(k);ht=function(t){function e(){e.__super.call(this)}xt(e,"laya.webgl.atlas.AtlasWebGLCanvas",t);var i=e.prototype;i.recreateResource=function(){var t,e;this.startCreate();t=V.mainContext;e=this._source=t.createTexture();t.bindTexture(3553,e);t.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null);t.texParameteri(3553,10241,9729);t.texParameteri(3553,10240,9729);t.texParameteri(3553,10242,33071);t.texParameteri(3553,10243,33071);t.bindTexture(3553,null);this.memorySize=this._w*this._h*4;this.compoleteCreate()};i.detoryResource=function(){if(this._source){V.mainContext.deleteTexture(this._source);this._source=null;this.memorySize=0}};i.texSubImage2D=function(t,e,i,r){var s=V.mainContext;s.bindTexture(3553,this._source);e-1>=0&&s.texSubImage2D(3553,0,e-1,i,6408,5121,r);e+1<=t.width&&s.texSubImage2D(3553,0,e+1,i,6408,5121,r);i-1>=0&&s.texSubImage2D(3553,0,e,i-1,6408,5121,r);i+1<=t.height&&s.texSubImage2D(3553,0,e,i+1,6408,5121,r);s.texSubImage2D(3553,0,e,i,6408,5121,r);s.bindTexture(3553,null)};i.texSubImage2DPixel=function(t,e,i,r,s,a){var n,h=V.mainContext;h.bindTexture(3553,this._source);n=new Uint8Array(a.data);h.texSubImage2D(3553,0,e,i,r,s,6408,5121,n);h.bindTexture(3553,null)};vt(0,i,"width",t.prototype._$get_width,function(t){this._w=t});vt(0,i,"height",t.prototype._$get_height,function(t){this._h=t});return e}(St);lt=function(t){function e(t){var i,r;this._is2D=!1;i=this;e.__super.call(this);this._canvas=this;if("2D"===t||"AUTO"===t&&!At.isWebGl){this._is2D=!0;this._canvas=this._source=wt.createElement("canvas");this.iscpuSource=!0;r=this;r.getContext=function(t,e){if(i._ctx)return i._ctx;var s=i._ctx=i._canvas.getContext(t,e);if(s){s._canvas=r;s.size=function(){}}"2d"===t&&Mt._init(r,s);return s}}else this._canvas={}}xt(e,"laya.webgl.resource.WebGLCanvas",t);var i=e.prototype;i.clear=function(){this._ctx&&this._ctx.clear()};i.destroy=function(){this._ctx&&this._ctx.destroy();this._ctx=null};i._setContext=function(t){this._ctx=t};i.getContext=function(t,i){return this._ctx?this._ctx:this._ctx=e._createContext(this)};i.copyTo=function(e){t.prototype.copyTo.call(this,e);e._ctx=this._ctx};i.size=function(t,e){if(this._w!=t||this._h!=e){this._w=t;this._h=e;this._ctx&&this._ctx.size(t,e);this._canvas&&(this._canvas.height=e,this._canvas.width=t)}};i.recreateResource=function(){this.startCreate();this.createWebGlTexture();this.compoleteCreate()};i.detoryResource=function(){if(this._source&&!this.iscpuSource){V.mainContext.deleteTexture(this._source);this._source=null;this.memorySize=0}};i.createWebGlTexture=function(){var t,e=V.mainContext;if(!this._canvas)throw"create GLTextur err:no data:"+this._canvas;t=this._source=e.createTexture();this.iscpuSource=!1;e.bindTexture(3553,t);e.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null);e.texParameteri(3553,10240,9729);e.texParameteri(3553,10241,9729);e.texParameteri(3553,10242,33071);e.texParameteri(3553,10243,33071);this.memorySize=this._w*this._h*4;e.bindTexture(3553,null);this._canvas=null};i.texSubImage2D=function(t,e,i){var r=V.mainContext;r.bindTexture(3553,this._source);r.texSubImage2D(3553,0,e,i,6408,5121,t._source)};vt(0,i,"canvas",function(){return this._canvas});vt(0,i,"context",function(){return this._ctx});vt(0,i,"asBitmap",null,function(t){this._ctx&&(this._ctx.asBitmap=t)});e._createContext=null;return e}(St);ot=function(t){function e(t,i){var r,s,a,n;this.borderSize=12;e.__super.call(this);this.canvas=t;this["char"]=i;this._enableMerageInAtlas=!0;r=Ht.isConchApp;r?this._ctx=t:this._ctx=t.getContext("2d",void 0);s=i.xs,a=i.ys;n=null;if(r){this._ctx.font=i.font;n=this._ctx.measureText(i["char"]);i.width=n.width1*s;i.height=n.height*a}else{n=Ot.measureText(i["char"],i.font);i.width=n.width*s;i.height=n.height*a}this.onresize(i.width+2*this.borderSize,i.height+2*this.borderSize)}xt(e,"laya.webgl.resource.WebGLCharImage",t);var r=e.prototype;i.imps(r,{"laya.webgl.resource.IMergeAtlasBitmap":!0});r.recreateResource=function(){var t,e,i,r,s;this.startCreate();t=this["char"];e=Ht.isConchApp;i=t.xs,r=t.ys;this.onresize(t.width+2*this.borderSize,t.height+2*this.borderSize);this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w);if(e){s="normal 100 "+t.fontSize+"px Arial";t.borderColor&&(s+=" 1 "+t.borderColor);this._ctx.font=s;this._ctx.textBaseline="top";this._ctx.fillStyle=t.fillColor;this._ctx.fillText(t["char"],this.borderSize,this.borderSize,null,null,null)}else{this._ctx.save();this._ctx.clearRect(0,0,t.width+2*this.borderSize,t.height+2*this.borderSize);this._ctx.font=t.font;this._ctx.textBaseline="top";1==i&&1==r||this._ctx.scale(i,r);this._ctx.translate(this.borderSize,this.borderSize);if(t.fillColor&&t.borderColor){this._ctx.strokeStyle=t.borderColor;this._ctx.lineWidth=t.lineWidth;this._ctx.strokeText(t["char"],0,0,null,null,0,null);this._ctx.fillStyle=t.fillColor;this._ctx.fillText(t["char"],0,0,null,null,null)}else if(-1===t.lineWidth){this._ctx.fillStyle=t.fillColor?t.fillColor:"white";this._ctx.fillText(t["char"],0,0,null,null,null)}else{this._ctx.strokeStyle=t.borderColor?t.borderColor:"white";this._ctx.lineWidth=t.lineWidth;this._ctx.strokeText(t["char"],0,0,null,null,0,null)}this._ctx.restore()}t.borderSize=this.borderSize;this.compoleteCreate()};r.copyTo=function(e){var i=e;i._ctx=this._ctx;i.canvas=this.canvas;i["char"]=this["char"];t.prototype.copyTo.call(this,e)};r.onresize=function(t,e){this._w=t;this._h=e;if(!(this._w<n.atlasLimitWidth&&this._h<n.atlasLimitHeight)){this._allowMerageInAtlas=!1;throw new Error("文字尺寸超出大图合集限制！")}this._allowMerageInAtlas=!0};r.clearAtlasSource=function(){};r.dispose=function(){this.resourceManager.removeResource(this);t.prototype.dispose.call(this)};vt(0,r,"allowMerageInAtlas",function(){return this._allowMerageInAtlas});vt(0,r,"atlasSource",function(){return this.canvas});vt(0,r,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function(t){this._allowMerageInAtlas=t});return e}(St);ut=function(t){function e(t,i,r,s,a,n){void 0===r&&(r=!1);void 0===s&&(s=6408);void 0===a&&(a=5121);void 0===n&&(n=33189);e.__super.call(this);this._w=t;this._h=i;this._mipMap=r;this._surfaceFormat=s;this._surfaceType=a;this._depthFormat=n}xt(e,"laya.webgl.resource.WebGLRenderTarget",t);var i=e.prototype;i.recreateResource=function(){var t,e;this.startCreate();t=V.mainContext;this._frameBuffer||(this._frameBuffer=t.createFramebuffer());this._source||(this._source=t.createTexture());t.bindTexture(3553,this._source);t.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);t.texParameteri(3553,10241,9729);t.texParameteri(3553,10242,33071);t.texParameteri(3553,10243,33071);e=Tt.isPOT(this._w,this._h);if(this._mipMap&&e){t.texParameteri(3553,10240,9987);t.generateMipmap(3553)}else{t.texParameteri(3553,10240,9729);this._mipMap&&(this._mipMap=!1)}t.bindFramebuffer(36160,this._frameBuffer);t.framebufferTexture2D(36160,36064,3553,this._source,0);if(this._depthFormat){this._depthBuffer||(this._depthBuffer=t.createRenderbuffer());t.bindRenderbuffer(36161,this._depthBuffer);t.renderbufferStorage(36161,this._depthFormat,this._w,this._h);t.framebufferRenderbuffer(36160,36096,36161,this._depthBuffer)}t.bindFramebuffer(36160,null);t.bindTexture(3553,null);t.bindRenderbuffer(36161,null);this.memorySize=this._w*this._h*4;this.compoleteCreate()};i.detoryResource=function(){if(this._frameBuffer){V.mainContext.deleteTexture(this._source);V.mainContext.deleteFramebuffer(this._frameBuffer);V.mainContext.deleteRenderbuffer(this._depthBuffer);this._source=null;this._frameBuffer=null;this._depthBuffer=null;this.memorySize=0}};vt(0,i,"frameBuffer",function(){return this._frameBuffer});vt(0,i,"depthBuffer",function(){return this._depthBuffer});return e}(St);ct=function(t){function e(t,i,r,s,a,n,h,l){this.offsetX=0;this.offsetY=0;void 0===l&&(l=!0);e.__super.call(this);this.repeat=!0;this.mipmap=!1;this.minFifter=-1;this.magFifter=-1;this.atlasImage=n;this.canvas=t;this._ctx=t.getContext("2d",void 0);this._w=s;this._h=a;this.offsetX=i;this.offsetY=r;this.src=h;this._enableMerageInAtlas=l}xt(e,"laya.webgl.resource.WebGLSubImage",t);var r=e.prototype;i.imps(r,{"laya.webgl.resource.IMergeAtlasBitmap":!0});r.copyTo=function(e){var i=e;t.prototype.copyTo.call(this,e);i._ctx=this._ctx};r.size=function(t,e){this._w=t;this._h=e;this._ctx&&this._ctx.size(t,e);this.canvas&&(this.canvas.height=e,this.canvas.width=t)};r.recreateResource=function(){this.startCreate();this.size(this._w,this._h);this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h);!(n.enabled&&this._allowMerageInAtlas)&&this.createWebGlTexture();this.compoleteCreate()};r.createWebGlTexture=function(){var t,e,i,r,s,a=V.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;t=this._source=a.createTexture();a.bindTexture(3553,t);a.texImage2D(3553,0,6408,6408,5121,this.canvas);e=this.minFifter;i=this.magFifter;r=this.repeat?10497:33071;s=Tt.isPOT(this.width,this.height);if(s){this.mipmap?-1!==e||(e=9987):-1!==e||(e=9729);-1!==i||(i=9729);a.texParameteri(3553,10240,i);a.texParameteri(3553,10241,e);a.texParameteri(3553,10242,r);a.texParameteri(3553,10243,r);this.mipmap&&a.generateMipmap(3553)}else{-1!==e||(e=9729);-1!==i||(i=9729);a.texParameteri(3553,10241,e);a.texParameteri(3553,10240,i);a.texParameteri(3553,10242,33071);a.texParameteri(3553,10243,33071)}a.bindTexture(3553,null);this.canvas=null;this.memorySize=this._w*this._h*4};r.detoryResource=function(){if((!n.enabled||!this._allowMerageInAtlas)&&this._source){V.mainContext.deleteTexture(this._source);this._source=null;this.memorySize=0}};r.clearAtlasSource=function(){this.canvas=null};r.dispose=function(){this.resourceManager.removeResource(this);t.prototype.dispose.call(this)};vt(0,r,"allowMerageInAtlas",function(){return this._allowMerageInAtlas});vt(0,r,"atlasSource",function(){return this.canvas});vt(0,r,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function(t){this._allowMerageInAtlas=t});return e}(St);_t=function(t){function e(){var t="attribute vec4 position;\nattribute vec2 texcoord;\nuniform  mat4 mmat;\nuniform vec2 size;\nvarying vec2 v_texcoord;\nvoid main() {\n  gl_Position =mmat*vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  v_texcoord = texcoord;\n}",i="precision mediump float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\nuniform float u_colorMatrix[20];\n\nvoid main(){\n 	vec4 rgba=gl_FragColor= texture2D(texture, v_texcoord)*vec4(1,1,1,alpha);\n   gl_FragColor.r =rgba.r*u_colorMatrix[0]+rgba.g*u_colorMatrix[1]+rgba.b*u_colorMatrix[2]+rgba.a*u_colorMatrix[3]+u_colorMatrix[4];\n   gl_FragColor.g =rgba.r*u_colorMatrix[5]+rgba.g*u_colorMatrix[6]+rgba.b*u_colorMatrix[7]+rgba.a*u_colorMatrix[8]+u_colorMatrix[9];\n   gl_FragColor.b =rgba.r*u_colorMatrix[10]+rgba.g*u_colorMatrix[11]+rgba.b*u_colorMatrix[12]+rgba.a*u_colorMatrix[13]+u_colorMatrix[14];\n   gl_FragColor.a =rgba.r*u_colorMatrix[15]+rgba.g*u_colorMatrix[16]+rgba.b*u_colorMatrix[17]+rgba.a*u_colorMatrix[18]+u_colorMatrix[19];	   \n}\n";e.__super.call(this,t,i,"colorFilter")}xt(e,"laya.webgl.shader.d2.filters.ColorFilter",t,"ColorFilter1");return e}(et);ft=function(t){function e(){var t="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\nuniform  mat4 mmat;\nuniform  mat4 pmat;\nvarying vec2  v_texcoord;\nvoid main(){\n gl_Position =mmat*vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  v_texcoord = texcoord;\n}",i="precision mediump float;\nconst int c_FilterTime = 9;\nconst float c_Gene = (1.0/(1.0 + 2.0*(0.93 + 0.8 + 0.7 + 0.6 + 0.5 + 0.4 + 0.3 + 0.2 + 0.1)));\nuniform sampler2D texture;\nconst bool u_FiterMode=true;\nconst float u_GlowGene=1.5;\nconst vec4 u_GlowColor=vec4(1.0,0.0,0.0,0.5);\nconst float u_FilterOffset=2.0;\nconst float u_TexSpaceU=1.0/10.0;\nconst float u_TexSpaceV=1.0/10.0;\nvarying vec2 v_texcoord;\nvoid main()\n{\n	float aryAttenuation[c_FilterTime];\n	aryAttenuation[0] = 0.93;\n	aryAttenuation[1] = 0.8;\n	aryAttenuation[2] = 0.7;\n	aryAttenuation[3] = 0.6;\n	aryAttenuation[4] = 0.5;\n	aryAttenuation[5] = 0.4;\n	aryAttenuation[6] = 0.3;\n	aryAttenuation[7] = 0.2;\n	aryAttenuation[8] = 0.1;\n	vec4 vec4Color = texture2D(texture, v_texcoord)*c_Gene;\n	vec2 vec2FilterDir;\n	if(u_FiterMode)\n	  vec2FilterDir = vec2(u_FilterOffset*u_TexSpaceU/9.0, 0.0);\n	else\n		vec2FilterDir =  vec2(0.0, u_FilterOffset*u_TexSpaceV/9.0);\n	vec2 vec2Step = vec2FilterDir;\n	for(int i = 0;i< c_FilterTime; ++i){\n		vec4Color += texture2D(texture, v_texcoord + vec2Step)*aryAttenuation[i]*c_Gene;\n		vec4Color += texture2D(texture, v_texcoord - vec2Step)*aryAttenuation[i]*c_Gene;\n		vec2Step += vec2FilterDir;\n	}\n	if(u_FiterMode)\n		gl_FragColor = vec4Color.a*u_GlowColor*u_GlowGene;\n	else\n		gl_FragColor = vec4Color.a*u_GlowColor;\n}";e.__super.call(this,t,i,"glowFilter")}xt(e,"laya.webgl.shader.d2.filters.GlowFilterShader",t);return e}(et);dt=function(t){function e(t,i,r,s){this._params2dQuick1=null;this._params2dQuick2=null;this._shaderValueWidth=NaN;this._shaderValueHeight=NaN;e.__super.call(this,t,i,r,s)}xt(e,"laya.webgl.shader.d2.Shader2X",t);var i=e.prototype;i.upload2dQuick1=function(t){this.upload(t,this._params2dQuick1||this._make2dQuick1())};i._make2dQuick1=function(){var t,e,i,r;try{if(!this._params2dQuick1){this.activeResource();this._params2dQuick1=[];t=this._params;for(i=0,r=t.length;i<r;i++){e=t[i];"size"!==e.name&&"al2pha"!==e.name&&"mmat"!==e.name&&"position"!==e.name&&"texcoord"!==e.name&&this._params2dQuick1.push(e)}}return this._params2dQuick1}catch(s){}return null};i.detoryResource=function(){t.prototype.detoryResource.call(this);this._params2dQuick1=null;this._params2dQuick2=null};i.upload2dQuick2=function(t){this.upload(t,this._params2dQuick2||this._make2dQuick2())};i._make2dQuick2=function(){var t,e,i,r;try{if(!this._params2dQuick2){this.activeResource();this._params2dQuick2=[];t=this._params;for(i=0,r=t.length;i<r;i++){e=t[i];"size"!==e.name&&"al2pha"!==e.name&&this._params2dQuick2.push(e)}}return this._params2dQuick2}catch(s){}return null};e.create=function(t,i,r,s){return new e(t,i,r,s)};return e}(et);gt=function(t){function e(){this.u_blurX=!1;this.u_color=null;this.u_offset=null;this.u_strength=NaN;this.u_texW=0;this.u_texH=0;e.__super.call(this,9)}xt(e,"laya.webgl.shader.d2.value.GlowSV",t);var i=e.prototype;i.setValue=function(e){t.prototype.setValue.call(this,e)};i.clear=function(){t.prototype.clear.call(this)};return e}(at);mt=function(t){function e(){e.__super.call(this,64);this.defines.add(64)}xt(e,"laya.webgl.shader.d2.value.TextSV",t);var i=e.prototype;i.release=function(){e.pool[e._length++]=this;this.clear()};i.clear=function(){t.prototype.clear.call(this)};e.create=function(){return e._length?e.pool[--e._length]:new e};e.pool=[];e._length=0;return e}(at);pt=function(t){function e(t){this._recreateLock=!1;this._needReleaseAgain=!1;this._image=null;this._allowMerageInAtlas=!1;this._enableMerageInAtlas=!1;this.repeat=!1;this.mipmap=!1;this.minFifter=0;this.magFifter=0;e.__super.call(this);this.repeat=!0;this.mipmap=!1;this.minFifter=-1;this.magFifter=-1;this._image=t||new wt.window.Image;this._enableMerageInAtlas=!0}xt(e,"laya.webgl.resource.WebGLImage",t);var r=e.prototype;i.imps(r,{"laya.webgl.resource.IMergeAtlasBitmap":!0});r.recreateResource=function(){var t,e=this;if(null!=this._src&&""!==this._src){this.startCreate();if(this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this.createWebGlTexture();this.compoleteCreate()}else{this._recreateLock=!0;t=this;this._image=new wt.window.Image;this._image.onload=function(){t._image.onload=null;if(t._needReleaseAgain){t._needReleaseAgain=!1;t._image=null}else{t._allowMerageInAtlas&&t._enableMerageInAtlas?(e.memorySize=0,e._recreateLock=!1):t.createWebGlTexture();t.compoleteCreate()}};t._image.src=this._src}}};r.copyTo=function(t){var e=t;e._image=this._image;laya.resource.Bitmap.prototype.copyTo.call(this,e)};r.detoryResource=function(){this._recreateLock&&(this._needReleaseAgain=!0);if(this._source){V.mainContext.deleteTexture(this._source);this._source=null;this.memorySize=0}};r.createWebGlTexture=function(){var t,e,i,r,s,a=V.mainContext;if(!this._image)throw"create GLTextur err:no data:"+this._image;t=this._source=a.createTexture();a.bindTexture(3553,t);a.texImage2D(3553,0,6408,6408,5121,this._image);e=this.minFifter;i=this.magFifter;r=this.repeat?10497:33071;s=Tt.isPOT(this.width,this.height);if(s){this.mipmap?-1!==e||(e=9987):-1!==e||(e=9729);-1!==i||(i=9729);a.texParameteri(3553,10240,i);a.texParameteri(3553,10241,e);a.texParameteri(3553,10242,r);a.texParameteri(3553,10243,r);this.mipmap&&a.generateMipmap(3553)}else{-1!==e||(e=9729);-1!==i||(i=9729);a.texParameteri(3553,10241,e);a.texParameteri(3553,10240,i);a.texParameteri(3553,10242,33071);a.texParameteri(3553,10243,33071)}a.bindTexture(3553,null);this._image=null;s?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4;this._recreateLock=!1};r.onresize=function(){this._w=this._image.width;this._h=this._image.height;n.enabled&&this._w<n.atlasLimitWidth&&this._h<n.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1};r.clearAtlasSource=function(){this._image=null};r.dispose=function(){this.resourceManager.removeResource(this);laya.resource.Bitmap.prototype.dispose.call(this)};vt(0,r,"image",function(){return this._image});vt(0,r,"onload",null,function(t){var e=this;this._onload=t;this._image&&(this._image.onload=null!=this._onload?function(){e.onresize();e._onload()}:null)});vt(0,r,"src",t.prototype._$get_src,function(t){this._src=t;this._image&&(this._image.src=t)});vt(0,r,"allowMerageInAtlas",function(){return this._allowMerageInAtlas});vt(0,r,"atlasSource",function(){return this._image});vt(0,r,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function(t){this._allowMerageInAtlas=t});vt(0,r,"onerror",null,function(t){var e=this;this._onerror=t;this._image&&(this._image.onerror=null!=this._onerror?function(){e._onerror()}:null)});return e}(Nt);i.__init([H,O,B,a,m,R])}(window,document,Laya);
!function(t,e,i){var s=(i.un,i.uns,i["static"],i["class"]),a=i.getset,n=(i.__newvec,laya.display.Animation),h=laya.utils.Byte,r=laya.display.Sprite,_=(laya.events.Event,laya.net.Loader),o=laya.maths.Matrix,l=laya.net.URL,u=laya.display.Graphics,p=laya.utils.Handler,d=laya.maths.Arith,f=laya.resource.Texture,c=function(){function t(t,e){this._vision="";this._anims=[];this._targetAnim=[];this._boneCount=0;this._textures=[];this.frameCount=0;this.frameRate=0;this.animNames={};this._graphicsArrs_=[];this._texture=e;this._textureWidth=e.width;this._textureHeight=e.height;this._execute(t)}s(t,"laya.ani.bone.Templet");var e=t.prototype;e._execute=function(e){var i,s,a,n,r,_,o,l,u,p,d,c,g,m,y,x,v,I,U,b,w,A,N,F,C=new h(e);this._vision=[C.getUint8(),C.getUint8(),C.getUint8(),C.getUint8()].join(",");this.frameRate=C.getUint8();this._usePack=C.getUint8();this._strArr=C.getString().split("\n");i=C.getInt16();this._uv=C.getInt16Array(C.pos,8*i*2);for(s=0;s<i;++s){a=this._texture.uv[0],n=this._texture.uv[1],r=this._texture.uv[4],_=this._texture.uv[5];o=r-a,l=_-n;u=8*s,p=this._uv[u],d=this._uv[u+1],c=this._uv[u+2],g=this._uv[u+3];m=p/this._textureWidth,y=(p+c)/this._textureWidth,x=d/this._textureHeight,v=(d+g)/this._textureHeight;I=[m,x,y,x,y,v,m,v];U=this._textures[s]=new f(this._texture.bitmap,[a+I[0]*o,n+I[1]*l,r-(1-I[2])*o,n+I[3]*l,r-(1-I[4])*o,_-(1-I[5])*l,a+I[6]*o,_-(1-I[7])*l]);U.w=this._uv[u+4];U.h=this._uv[u+5];U.__w=c;U.__h=g;U._offsetX=this._uv[u+6];U._offsetY=this._uv[u+7]}this._boneCount=i=C.getInt16();this._boneMatrix=C.getFloat32Array(C.pos,6*i*4);this._bones=C.getInt16Array(C.pos,4*i*2);i=C.getInt16();for(b=0;b<i;b++){w=[];w._index_=b;this._graphicsArrs_.push(w);A=C.getInt16();this.animNames[this._strArr[A]]=b;this.frameCount=C.getInt16();w.length=w._length=this.frameCount;N=C.getInt16();this._anims.push(C.getFloat32Array(C.pos,N*t.SRC_ANIMLEN*4));F=new Float32Array(this.frameCount*this._boneCount*t.ANIMLEN);this._targetAnim.push(F);this.interpolation(this._anims[b],F,N)}};e.planish=function(e,i){var s,a,n,h,r,_,l,p,d,f,c,g,m,y,x,v,I,U=this._targetAnim[i],b=new u,w=[],A=e*t.ANIMLEN;for(s=0;s<this._boneCount;s++){a=4*s;n=6*s;h=this._bones[a];r=s*this.frameCount*t.ANIMLEN+A;_=this._getMat(this._boneMatrix,n);d=new o;if(h>-1){f=h*this.frameCount*t.ANIMLEN+A;c=w[h];g=this._bones[a+2];switch(g){case 0:l=this._getMat(U,r);p=o.TEMP;m=l.tx,y=l.ty;l.setTranslate(0,0);o.mul(l,_,p);p.translate(m,y);o.mul(p,c,w[s]=d);l=null;break;case 1:x=U[r+7];if(-1==x)continue;v=U[r+6];if(v<.001)continue;x=U[r+7];I=this._textures[x];_.tx-=I._offsetX;_.ty-=I._offsetY;o.mul(_,c,d);if(v<.9999){b.save();b.alpha(v);b.drawTexture(I,-I.w/2,-I.w/2,I.__w,I.__h,d);b.restore()}else b.drawTexture(I,-I.w/2,-I.w/2,I.__w,I.__h,d);break;case 2:}}else{l=this._getMat(U,r);o.mul(l,_,w[s]=d)}}return b};e.interpolation=function(e,i,s){var a=0,n=0,h=0,r=0,_=0,o=0,l=0,u=0,p=NaN,f=0;for(n=0;n<s;n++,_+=t.SRC_ANIMLEN){o=e[_+6];l=e[_+7];if(o>1){f=_+t.SRC_ANIMLEN;for(h=0;h<o;h++){u=a++*t.ANIMLEN;if(-1==l){for(r=0;r<6;r++)i[u+r]=e[_+r];i[u+6]=e[_+8];i[u+7]=e[_+9]}else{for(r=0;r<6;r++){p=e[f+r]-e[_+r];1!=r&&2!=r||(p=d.formatR(p));p/=o;i[u+r]=h*p+e[_+r]}p=(e[f+8]-e[_+8])/o;i[u+6]=h*p+e[_+8];i[u+7]=e[_+9]}}}else{u=a++*t.ANIMLEN;for(h=0;h<6;h++)i[u+h]=e[_+h];i[u+6]=1;i[u+7]=e[_+9]}}};e._getMat=function(t,e){var i,s,a=new o,n=t[e],h=t[e+1],r=t[e+2],_=t[e+3],l=t[e+4],u=t[e+5];if(0!=r||0!=h){i=Math.cos(h),s=Math.sin(h);a.setTo(n*i,n*s,_*-s,_*i,l,u)}else a.setTo(n,h,r,_,l,u);return a};a(0,e,"textureWidth",function(){return this._textureWidth});a(0,e,"textureHeight",function(){return this._textureHeight});t.ANIMLEN=8;t.SRC_ANIMLEN=10;return t}(),g=(function(t){function e(){this.interval=30;this._start=0;this._Pos=0;this._data=null;this._curIndex=0;this._playIndex=0;this._playing=!1;this._ended=!0;this._frameCount=0;this._ids=null;this._idOfSprite=null;this.basePath=null;e.__super.call(this);this._ids={};this._idOfSprite=[];this._reset();this._playing=!1}s(e,"laya.ani.swf.MovieClip",t);var n=e.prototype;n.update=function(){if(this._data&&this._playing){this._playIndex++;this._playIndex>=this.totalFrames&&(this._playIndex=0);this._parse(this._playIndex)}};n.stop=function(){this._playing=!1;i.timer.clear(this,this.update)};n.gotoStop=function(t){this.stop();this._displayFrame(t)};n.clear=function(){this._idOfSprite.length=0;this.removeChildren();this.graphics=null};n.play=function(t){void 0===t&&(t=-1);this._displayFrame(t);this._playing=!0;i.timer.loop(this.interval,this,this.update,null,!0)};n._displayFrame=function(t){void 0===t&&(t=-1);if(-1!=t){this._curIndex>t&&this._reset();this._parse(t)}};n._reset=function(t){void 0===t&&(t=!0);t&&1!=this._curIndex&&this.removeChildren();this._curIndex=-1;this._Pos=this._start};n._parse=function(t){var i,s,a,n,h,_,l,u=0,p=0,d=0,f=0,c=!1,g=this._idOfSprite,m=this._data;this._ended&&this._reset();m.pos=this._Pos;this._ended=!1;this._playIndex=t;this._curIndex>=t&&(this._curIndex=-1);for(;this._curIndex<=t&&!this._ended;){p=m.getUint16();switch(p){case 12:u=m.getUint16();d=this._ids[m.getUint16()];this._Pos=m.pos;m.pos=d;if(0==(f=m.getUint8())){n=m.getUint16();s=g[u];if(!s){s=g[u]=new r;h=new r;h.loadImage(this.basePath+n+".png");s.addChild(h);h.size(m.getFloat32(),m.getFloat32());_=m._getMatrix();h.transform=_}}else if(1==f){i=g[u];if(!i){g[u]=i=new e;i.interval=this.interval;i._ids=this._ids;i._setData(m,d);i.basePath=this.basePath;i.play(0)}}m.pos=this._Pos;break;case 3:this.addChild(g[m.getUint16()]).zOrder=m.getUint16();c=!0;break;case 4:g[m.getUint16()].removeSelf();break;case 5:g[m.getUint16()][e._ValueList[m.getUint16()]]=m.getFloat32();break;case 6:g[m.getUint16()].visible=m.getUint8()>0;break;case 7:s=g[m.getUint16()];l=new o(m.getFloat32(),m.getFloat32(),m.getFloat32(),m.getFloat32(),m.getFloat32(),m.getFloat32());s.transform=l;break;case 8:g[m.getUint16()].setPos(m.getFloat32(),m.getFloat32());break;case 9:g[m.getUint16()].setSize(m.getFloat32(),m.getFloat32());break;case 10:g[m.getUint16()].alpha=m.getFloat32();break;case 11:g[m.getUint16()].setScale(m.getFloat32(),m.getFloat32());break;case 98:a=m.getString();this.event(a);"stop"==a&&this.stop();break;case 99:this._curIndex=m.getUint16();c&&this.updateOrder();this._playing&&this.event("enterframe");break;case 100:this._frameCount=this._curIndex+1;this._ended=!0;this.event("end");this._reset(!1)}}this._Pos=m.pos};n._setData=function(t,e){this._data=t;this._start=e+3};n.load=function(t){var e,i,s=this;t=l.formatURL(t);this.basePath=t.replace(".swf","/image/");e=_.getRes(t);if(e)this._initData(e);else{i=new _;i.once("complete",null,function(t){s._initData(t)});i.once("error",null,function(t){});i.load(t,"arraybuffer")}};n._initData=function(t){this._data=new h(t);var e=0,i=this._data.getUint16();for(e=0;e<i;e++)this._ids[this._data.getInt16()]=this._data.getInt32();this.interval=1e3/this._data.getUint16();this._setData(this._data,this._ids[32767]);this._reset();this._ended=!1;for(;!this._ended;)this._parse(++this._playIndex);this.play(0);this.event("loaded")};a(0,n,"currentFrame",function(){return this._playIndex});a(0,n,"totalFrames",function(){return this._frameCount});a(0,n,"skin",null,function(t){this.load(t)});e._ValueList=["x","y","width","height","scaleX","scaleY","rotation","alpha"];return e}(r),function(t){function e(t){this._tp_=null;e.__super.call(this);if(t){this._tp_=t;this._count=t.frameCount;this.interval=1e3/t.frameRate;this.frames=this._tp_._graphicsArrs_[0]}}s(e,"laya.ani.bone.Skeleton",t);var i=e.prototype;i.setTpl=function(t){this._tp_=t;this._count=t.frameCount;this.interval=1e3/t.frameRate;this.setAnim(0)};i.setAnim=function(t){this.frames=this._tp_._graphicsArrs_[t]};i.stAnimName=function(t){this.frames=this._tp_._graphicsArrs_[this._tp_.animNames[t]]};i.pause=function(t){void 0===t&&(t=-1);t>-1&&(this.index=t);this.stop()};a(0,i,"frames",t.prototype._$get_frames,function(t){this._frames=t;this.repaint()});a(0,i,"index",t.prototype._$get_index,function(t){this._index=t;null!=(this.graphics=this._frames[t])||(this.graphics=this._frames[t]=this._tp_.planish(t,this._frames._index_))});return e}(n));(function(t){function e(t){this.completeHandler=null;this.dataUrl=null;this.imgUrl=null;e.__super.call(this,t);this.on("complete",this,this._complete)}s(e,"laya.ani.bone.SkeletonPlayer",t);var n=e.prototype;n._complete=function(){if(this.completeHandler){var t;t=this.completeHandler;this.completeHandler=null;t.run()}};n.load=function(t){this.dataUrl=t;this.imgUrl=t.replace(".sk",".png");i.loader.load([{url:this.dataUrl,type:"arraybuffer"},{url:this.imgUrl,type:"image"}],p.create(this,this._resLoaded))};n._resLoaded=function(){this._tp_=new c(_.getRes(this.dataUrl),_.getRes(this.imgUrl));this.setTpl(this._tp_);this.play()};a(0,n,"skin",null,function(t){this.load(t)});return e})(g)}(window,document,Laya);
!function(t,i,e){var s,h,n,l,o,r,a,c,u,_,d,f,p,g,m,y,b,C,v,S,x,w,B,k,I,L,z,M,P,N,H,T,$,O,A,Y,E,X=(e.un,e.uns,e["static"]),V=e["class"],R=e.getset,D=(e.__newvec,laya.events.Event),G=laya.net.Loader,W=laya.maths.Point,F=laya.filters.ColorFilter,j=laya.display.Graphics,U=laya.utils.Handler,K=laya.display.Sprite,q=laya.resource.Texture,J=laya.display.css.Font,Q=laya.display.Input,Z=laya.utils.Utils,tt=laya.display.Text,it=(laya.display.Stage,laya.maths.Rectangle),et=(laya.display.Node,laya.utils.Tween),st=laya.utils.Ease;e["interface"]("laya.ui.IItem");e["interface"]("laya.ui.IRender");e["interface"]("laya.ui.IComponent");e["interface"]("laya.ui.ISelect");e["interface"]("laya.ui.IBox","IComponent");s=function(){function t(){this.enable=!1;this.top=NaN;this.bottom=NaN;this.left=NaN;this.right=NaN;this.centerX=NaN;this.centerY=NaN}V(t,"laya.ui.LayoutStyle");X(t,["EMPTY",function(){return this.EMPTY=new t}]);return t}();h=function(){function t(){}V(t,"laya.ui.Styles");t.labelColor="#000000";t.buttonStateNum=3;t.scrollBarMinNum=15;t.scrollBarDelayTime=500;X(t,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]);return t}();n=function(){function t(){}V(t,"laya.ui.UIUtils");t.fillArray=function(t,i,e){var s,h,n,l,o=t.concat();if(i){s=i.split(",");for(h=0,n=Math.min(o.length,s.length);h<n;h++){l=s[h];o[h]="true"==l?!0:"false"==l?!1:l;null!=e&&(o[h]=e(l))}}return o};t.toColor=function(t){for(var i=t.toString("16");i.length<6;)i="0"+i;return"#"+i};t.gray=function(i,e){void 0===e&&(e=!0);e?t.addFilter(i,t.grayFilter):t.clearFilter(i,F)};t.addFilter=function(t,i){var e=t.filters||[];e.push(i);t.filters=e};t.clearFilter=function(t,i){var s,h,n=t.filters;if(null!=n&&n.length>0){for(s=n.length-1;s>-1;s--){h=n[s];e.__typeof(h,i)&&n.splice(s,1)}t.filters=n}};X(t,["grayFilter",function(){return this.grayFilter=new F([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])}]);return t}();l=function(){function t(){}V(t,"UIConfig");t.resPath="";t.uiPath="";t.touchScrollEnable=!0;t.mouseWheelEnable=!0;t.showButtons=!0;t.popupBgColor="#000000";t.popupBgAlpha=.5;return t}();o=function(t){function i(){this.autoCacheCmd=!0;this._width=0;this._height=0;this._source=null;this._sizeGrid=null;i.__super.call(this)}V(i,"laya.ui.AutoBitmap",t);var s=i.prototype;s.destroy=function(){t.prototype.destroy.call(this);this._source=null;this._sizeGrid=null};s.changeSource=function(){var t,e,s,h,n,l,o,r,a,c,u=this._source;if(u){t=this.width;e=this.height;s=this._sizeGrid;h=u.width;n=u.height;if(!s||h===t&&n===e){this.clear();this.drawTexture(u,0,0,t,e)}else{u.$_GID||(u.$_GID=Z.getGID());l=u.$_GID+"."+t+"."+e+"."+s.join(".");if(i.cmdCaches[l]){this.cmds=i.cmdCaches[l];return}this.clear();o=s[0];r=s[1];a=s[2];c=s[3];c+r>t&&(r=0);c&&o&&this.drawTexture(i.getTexture(u,0,0,c,o),0,0,c,o);r&&o&&this.drawTexture(i.getTexture(u,h-r,0,r,o),t-r,0,r,o);c&&a&&this.drawTexture(i.getTexture(u,0,n-a,c,a),0,e-a,c,a);r&&a&&this.drawTexture(i.getTexture(u,h-r,n-a,r,a),t-r,e-a,r,a);o&&this.drawTexture(i.getTexture(u,c,0,h-c-r,o),c,0,t-c-r,o);a&&this.drawTexture(i.getTexture(u,c,n-a,h-c-r,a),c,e-a,t-c-r,a);c&&this.drawTexture(i.getTexture(u,0,o,c,n-o-a),0,o,c,e-o-a);r&&this.drawTexture(i.getTexture(u,h-r,o,r,n-o-a),t-r,o,r,e-o-a);this.drawTexture(i.getTexture(u,c,o,h-c-r,n-o-a),c,o,t-c-r,e-o-a);this.autoCacheCmd&&(i.cmdCaches[l]=this.cmds)}this._repaint()}};R(0,s,"sizeGrid",function(){return this._sizeGrid},function(t){this._sizeGrid=t;e.timer.callLater(this,this.changeSource)});R(0,s,"source",function(){return this._source},function(t){if(t){this._source=t;e.timer.callLater(this,this.changeSource)}else{this._source=null;this.clear()}});R(0,s,"width",function(){return this._width?this._width:this._source?this._source.width:0},function(t){this._width=t;e.timer.callLater(this,this.changeSource)});R(0,s,"height",function(){return this._height?this._height:this._source?this._source.height:0},function(t){this._height=t;e.timer.callLater(this,this.changeSource)});i.getTexture=function(t,e,s,h,n){var l,o;t.$GID||(t.$GID=Z.getGID());l=t.$GID+"."+e+"."+s+"."+h+"."+n;o=i.textureCache[l];o||(o=i.textureCache[l]=q.create(t,e,s,h,n));return o};i.clearCache=function(){i.cmdCaches={};i.textureCache={}};i.cmdCaches={};i.textureCache={};return i}(j);r=function(t){function i(){i.__super.call(this)}V(i,"laya.ui.UIEvent",t);i.SHOW_TIP="showtip";i.HIDE_TIP="hidetip";return i}(D);a=function(t){function i(){this._comXml=null;this._dataSource=null;this._toolTip=null;this._tag=null;this._disabled=!1;i.__super.call(this);this._layout=s.EMPTY;this.preinitialize();this.createChildren();this.initialize()}V(i,"laya.ui.Component",t);var h=i.prototype;e.imps(h,{"laya.ui.IComponent":!0});h.destroy=function(i){void 0===i&&(i=!0);t.prototype.destroy.call(this,i);this._dataSource=this._layout=null;this._tag=null;this._toolTip=null};h.preinitialize=function(){};h.createChildren=function(){};h.initialize=function(){};h.callLater=function(t,i){e.timer.callLater(this,t,i)};h.runCallLater=function(t){e.timer.runCallLater(this,t)};h.commitMeasure=function(){};h.changeSize=function(){this.event("resize")};h.getLayout=function(){this._layout===s.EMPTY&&(this._layout=new s);return this._layout};h.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)};h.onAdded=function(){this.parent.on("resize",this,this.onCompResize);this.resetLayoutX();this.resetLayoutY()};h.onCompResize=function(){if(this._layout.enable){this.resetLayoutX();this.resetLayoutY()}};h.resetLayoutX=function(){var t,i=this.parent;if(i){t=this._layout;if(isNaN(t.centerX))if(isNaN(t.left))isNaN(t.right)||(this.x=i.width-this.displayWidth-t.right);else{this.x=t.left;isNaN(t.right)||(this.width=(i._width-t.left-t.right)/this.scaleX)}else this.x=.5*(i.width-this.displayWidth)+t.centerX}};h.resetLayoutY=function(){var t,i=this.parent;if(i){t=this._layout;if(isNaN(t.centerY))if(isNaN(t.top))isNaN(t.bottom)||(this.y=i.height-this.displayHeight-t.bottom);else{this.y=t.top;isNaN(t.bottom)||(this.height=(i._height-t.top-t.bottom)/this.scaleY)}else this.y=.5*(i.height-this.displayHeight)+t.centerY}};h.onMouseOver=function(t){e.stage.event("showtip",this._toolTip)};h.onMouseOut=function(t){e.stage.event("hidetip",this._toolTip)};R(0,h,"width",function(){return this._width?this._width:this.measureWidth},function(t){if(this._width!=t){this._width=t;this.callLater(this.changeSize);!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)||this.resetLayoutX()}});R(0,h,"displayWidth",function(){return this.width*this.scaleX});R(0,h,"centerX",function(){return this._layout.centerX},function(t){this.getLayout().centerX=t;this.layOutEabled=!0;this.resetLayoutX()});R(0,h,"displayHeight",function(){return this.height*this.scaleY});R(0,h,"measureHeight",function(){var t,i,e=0;this.commitMeasure();for(t=this.numChildren-1;t>-1;t--){i=this.getChildAt(t);i.visible&&(e=Math.max(i.y+i.height*i.scaleY,e))}return e});R(0,h,"measureWidth",function(){var t,i,e=0;this.commitMeasure();for(t=this.numChildren-1;t>-1;t--){i=this.getChildAt(t);i.visible&&(e=Math.max(i.x+i.width*i.scaleX,e))}return e});R(0,h,"height",function(){return this._height?this._height:this.measureHeight},function(t){if(this._height!=t){this._height=t;this.callLater(this.changeSize);!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)||this.resetLayoutY()}});R(0,h,"scaleX",t.prototype._$get_scaleX,function(i){if(t.prototype._$get_scaleX.call(this)!=i){t.prototype._$set_scaleX.call(this,i);this.callLater(this.changeSize);this._layout.enable&&this.resetLayoutX()}});R(0,h,"scaleY",t.prototype._$get_scaleY,function(i){if(t.prototype._$get_scaleY.call(this)!=i){t.prototype._$set_scaleY.call(this,i);this.callLater(this.changeSize);this._layout.enable&&this.resetLayoutY()}});R(0,h,"dataSource",function(){return this._dataSource},function(t){this._dataSource=t;for(var i in this._dataSource)this.hasOwnProperty(i)&&(this[i]=this._dataSource[i])});R(0,h,"toolTip",function(){return this._toolTip},function(t){if(this._toolTip!=t){this._toolTip=t;if(null!=t){this.on("mouseover",this,this.onMouseOver);this.on("mouseout",this,this.onMouseOut)}else{this.off("mouseover",this,this.onMouseOver);this.off("mouseout",this,this.onMouseOut)}}});R(0,h,"top",function(){return this._layout.top},function(t){this.getLayout().top=t;this.layOutEabled=!0;this.resetLayoutY()});R(0,h,"bottom",function(){return this._layout.bottom},function(t){this.getLayout().bottom=t;this.layOutEabled=!0;this.resetLayoutY()});R(0,h,"left",function(){return this._layout.left},function(t){this.getLayout().left=t;this.layOutEabled=!0;this.resetLayoutX()});R(0,h,"right",function(){return this._layout.right},function(t){this.getLayout().right=t;this.layOutEabled=!0;this.resetLayoutX()});R(0,h,"centerY",function(){return this._layout.centerY},function(t){this.getLayout().centerY=t;this.layOutEabled=!0;this.resetLayoutY()});R(0,h,"tag",function(){return this._tag},function(t){this._tag=t});R(0,h,"layOutEabled",null,function(t){if(this._layout.enable!=t){this._layout.enable=t;if(!this.hasListener("added")){this.on("added",this,this.onAdded);this.on("removed",this,this.onRemoved)}}});R(0,h,"comXml",function(){return this._comXml},function(t){this._comXml=t});R(0,h,"x",t.prototype._$get_x,function(i){t.prototype._$set_x.call(this,Math.round(i))});R(0,h,"y",t.prototype._$get_y,function(i){t.prototype._$set_y.call(this,Math.round(i))});R(0,h,"disabled",function(){return this._disabled},function(t){if(t!==this._disabled){this._disabled=t;n.gray(this,t)}});return i}(K);c=function(t){function i(){i.__super.call(this)}V(i,"laya.ui.Box",t);var s=i.prototype;e.imps(s,{"laya.ui.IBox":!0});R(0,s,"dataSource",t.prototype._$get_dataSource,function(t){var i,e;this._dataSource=t;for(i in t){e=this.getChildByName(i);e?e.dataSource=t[i]:this.hasOwnProperty(i)&&(this[i]=t[i])}});return i}(a);u=function(t){function i(t,e){this.toggle=!1;this._bitmap=null;this._text=null;this._strokeColors=null;this._state=0;this._selected=!1;this._skin=null;this._autoSize=!0;this._sources=null;this._clickHandler=null;i.__super.call(this);this._labelColors=h.buttonLabelColors;this._stateNum=h.buttonStateNum;void 0===e&&(e="");this.skin=t;this.label=e}V(i,"laya.ui.Button",t);var s=i.prototype;e.imps(s,{"laya.ui.ISelect":!0});s.destroy=function(i){void 0===i&&(i=!0);t.prototype.destroy.call(this,i);this._bitmap&&this._bitmap.destroy();this._text&&this._text.destroy(i);this._sources&&(this._sources.length=0);this._bitmap=null;this._text=null;this._clickHandler=null;this._labelColors=this._sources=this._strokeColors=null};s.createChildren=function(){this.graphics=this._bitmap=new o;this._text=new tt;this._text.align="center";this._text.valign="middle"};s.initialize=function(){this.on("mouseover",this,this.onMouse);this.on("mouseout",this,this.onMouse);this.on("mousedown",this,this.onMouse);this.on("mouseup",this,this.onMouse);this.on("click",this,this.onMouse)};s.onMouse=function(t){if(!(this.toggle===!1&&this._selected||this.disabled))if("click"!==t.type)!this._selected&&(this.state=i.stateMap[t.type]);else{this.toggle&&(this.selected=!this._selected);this._clickHandler&&this._clickHandler.run()}};s.changeClips=function(){var t,i,e,s=G.getRes(this._skin);if(s){this._sources||(this._sources=[]);this._sources.length=0;t=s.width;i=s.height/this._stateNum;for(e=0;e<this._stateNum;e++)this._sources.push(q.create(s,0,i*e,t,i));if(this._autoSize){this._bitmap.width=this._text.width=this._width||t;this._bitmap.height=this._text.height=this._height||i}else this._text.x=t}else console.log("lose skin",this._skin)};s.changeState=function(){this.runCallLater(this.changeClips);var t=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[t]);if(this.label){this._text.color=this._labelColors[t];this._strokeColors&&(this._text.strokeColor=this._strokeColors[t])}};R(0,s,"labelStrokeColor",function(){return this._text.strokeColor},function(t){this._text.strokeColor=t});R(0,s,"skin",function(){return this._skin},function(t){if(this._skin!=t){this._skin=t;this.callLater(this.changeClips);this.callLater(this.changeState)}});R(0,s,"state",function(){return this._state},function(t){if(this._state!=t){this._state=t;this.callLater(this.changeState)}});R(0,s,"label",function(){return this._text.text},function(t){if(this._text.text!=t){t&&!this._text.displayInStage&&this.addChild(this._text);this._text.text=t;this.callLater(this.changeState)}});R(0,s,"stateNum",function(){return this._stateNum},function(t){if(this._stateNum!=t){this._stateNum=t<1?1:t>3?3:t;this.callLater(this.changeClips)}});R(0,s,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function(t){this._strokeColors=n.fillArray(h.buttonLabelColors,t,String);this.callLater(this.changeState)});R(0,s,"labelStroke",function(){return this._text.stroke},function(t){this._text.stroke=t});R(0,s,"measureHeight",function(){this.runCallLater(this.changeClips);return this._bitmap.height});R(0,s,"measureWidth",function(){this.runCallLater(this.changeClips);if(this._autoSize)return this._bitmap.width;this.runCallLater(this.changeState);return this._bitmap.width+this._text.width});R(0,s,"selected",function(){return this._selected},function(t){if(this._selected!=t){this._selected=t;this.state=this._selected?2:0;this.event("change")}});R(0,s,"labelColors",function(){return this._labelColors.join(",")},function(t){this._labelColors=n.fillArray(h.buttonLabelColors,t,String);this.callLater(this.changeState)});R(0,s,"labelPadding",function(){return this._text.padding.join(",")},function(t){this._text.padding=n.fillArray(h.labelPadding,t,Number)});R(0,s,"labelSize",function(){return this._text.fontSize},function(t){this._text.fontSize=t});R(0,s,"labelBold",function(){return this._text.bold},function(t){this._text.bold=t});R(0,s,"labelAlign",function(){return this._text.align},function(t){this._text.align=t});R(0,s,"labelFont",function(){return this._text.font},function(t){this._text.font=t});R(0,s,"clickHandler",function(){return this._clickHandler},function(t){this._clickHandler=t});R(0,s,"text",function(){return this._text});R(0,s,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(t){this._bitmap.sizeGrid=n.fillArray(h.defaultSizeGrid,t,Number)});R(0,s,"width",t.prototype._$get_width,function(i){t.prototype._$set_width.call(this,i);if(this._autoSize){this._bitmap.width=i;this._text.width=i}});R(0,s,"height",t.prototype._$get_height,function(i){t.prototype._$set_height.call(this,i);if(this._autoSize){this._bitmap.height=i;this._text.height=i}});R(0,s,"dataSource",t.prototype._$get_dataSource,function(i){this._dataSource=i;"number"==typeof i||"string"==typeof i?this.label=i+"":t.prototype._$set_dataSource.call(this,i)});X(i,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]);return i}(a);_=function(t){function i(t,e,s){this._sources=null;this._bitmap=null;this._skin=null;this._clipX=1;this._clipY=1;this._clipWidth=0;this._clipHeight=0;this._autoPlay=!1;this._interval=50;this._complete=null;this._isPlaying=!1;this._index=0;i.__super.call(this);void 0===e&&(e=1);void 0===s&&(s=1);this._clipX=e;this._clipY=s;this.skin=t}V(i,"laya.ui.Clip",t);var s=i.prototype;s.destroy=function(i){void 0===i&&(i=!1);t.prototype.destroy.call(this,!0);this._bitmap&&this._bitmap.destroy();this._bitmap=null;this._sources=null};s.dispose=function(){this.destroy(!0);e.loader.clearRes(this._skin)};s.createChildren=function(){this.graphics=this._bitmap=new o};s.initialize=function(){this.on("display",this,this._onDisplay);this.on("undisplay",this,this._onDisplay)};s._onDisplay=function(t){this._isPlaying?this._displayInStage?this.play():this.stop():this._autoPlay&&this._displayInStage&&this.play()};s.changeClip=function(){var t=G.getRes(this._skin);t?this.loadComplete(this._skin,t):e.loader.load(this._skin,U.create(this,this.loadComplete,[this._skin]))};s.loadComplete=function(t,i){var e,s;if(t===this._skin&&i){this._clipWidth||(this._clipWidth=Math.ceil(i.width/this._clipX));this._clipHeight||(this._clipHeight=Math.ceil(i.height/this._clipY));this._sources||(this._sources=[]);this._sources.length=0;for(e=0;e<this._clipY;e++)for(s=0;s<this._clipX;s++)this._sources.push(q.create(i,this._clipWidth*s,this._clipHeight*e,this._clipWidth,this._clipHeight));this.index=this._index;this.event("loaded");this.onCompResize()}};s.play=function(){this._isPlaying=!0;this._index=0;e.timer.loop(this.interval,this,this._loop)};s._loop=function(){if(this._style.visible&&this._sources){this.index=this._index,this._index++;this._index>=this._sources.length&&(this._index=0)}};s.stop=function(){this._isPlaying=!1;e.timer.clear(this,this._loop)};R(0,s,"autoPlay",function(){return this._autoPlay},function(t){if(this._autoPlay!=t){this._autoPlay=t;t?this.play():this.stop()}});R(0,s,"clipX",function(){return this._clipX},function(t){this._clipX=t;this.callLater(this.changeClip)});R(0,s,"skin",function(){return this._skin},function(t){this._skin=t;this.callLater(this.changeClip)});R(0,s,"sources",function(){return this._sources},function(t){this._sources=t;this.index=this._index;this.event("loaded")});R(0,s,"clipY",function(){return this._clipY},function(t){this._clipY=t;this.callLater(this.changeClip)});R(0,s,"clipWidth",function(){return this._clipWidth},function(t){this._clipWidth=t;this.callLater(this.changeClip)});R(0,s,"measureWidth",function(){this.runCallLater(this.changeClip);return this._bitmap.width});R(0,s,"clipHeight",function(){return this._clipHeight},function(t){this._clipHeight=t;this.callLater(this.changeClip)});R(0,s,"total",function(){this.runCallLater(this.changeClip);return this._sources?this._sources.length:0});R(0,s,"width",t.prototype._$get_width,function(i){t.prototype._$set_width.call(this,i);this._bitmap.width=i});R(0,s,"height",t.prototype._$get_height,function(i){t.prototype._$set_height.call(this,i);this._bitmap.height=i});R(0,s,"measureHeight",function(){this.runCallLater(this.changeClip);return this._bitmap.height});R(0,s,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(t){this._bitmap.sizeGrid=n.fillArray(h.defaultSizeGrid,t,Number)});R(0,s,"index",function(){return this._index},function(t){this._index=t;this._bitmap&&this._sources&&(this._bitmap.source=this._sources[t]);this.event("change")});R(0,s,"interval",function(){return this._interval},function(t){if(this._interval!=t){this._interval=t;this._isPlaying&&this.play()}});R(0,s,"isPlaying",function(){return this._isPlaying},function(t){this._isPlaying=t});R(0,s,"dataSource",t.prototype._$get_dataSource,function(i){this._dataSource=i;"number"==typeof i&&Math.floor(i)==i||"string"==typeof i?this.index=e.__parseInt(i):t.prototype._$set_dataSource.call(this,i)});R(0,s,"bitmap",function(){return this._bitmap});return i}(a);d=function(t){function i(){this.changeHandler=null;this._gridSize=11;this._bgColor="#ffffff";this._borderColor="#000000";this._inputColor="#000000";this._inputBgColor="#efefef";this._colorPanel=null;this._colorTiles=null;this._colorBlock=null;this._colorInput=null;this._colorButton=null;this._colors=[];this._selectedColor="#000000";i.__super.call(this)}V(i,"laya.ui.ColorPicker",t);var s=i.prototype;s.destroy=function(i){void 0===i&&(i=!0);t.prototype.destroy.call(this,i);this._colorPanel&&this._colorPanel.destroy(i);this._colorButton&&this._colorButton.destroy(i);this._colorPanel=null;this._colorTiles=null;this._colorBlock=null;this._colorInput=null;this._colorButton=null;this._colors=null;this.changeHandler=null};s.createChildren=function(){this.addChild(this._colorButton=new u);this._colorPanel=new c;this._colorPanel.size(230,166);this._colorPanel.addChild(this._colorTiles=new K);this._colorPanel.addChild(this._colorBlock=new K);this._colorPanel.addChild(this._colorInput=new Q)};s.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick);this._colorBlock.pos(5,5);this._colorInput.pos(60,5);this._colorInput.size(60,20);this._colorInput.on("change",this,this.onColorInputChange);this._colorInput.on("keydown",this,this.onColorFieldKeyDown);this._colorTiles.pos(5,30);this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove);this._colorTiles.on("click",this,this.onColorTilesClick);this._colorTiles.size(20*this._gridSize,12*this._gridSize);this._colorPanel.on("mousedown",this,this.onPanelMouseDown);this.bgColor=this._bgColor};s.onPanelMouseDown=function(t){t.stopPropagation()};s.changePanel=function(){var t,i,e,s,h,l,o,r=this._colorPanel.graphics;r.clear();r.drawRect(0,0,230,166,this._bgColor,this._borderColor);this.drawBlock(this._selectedColor);this._colorInput.borderColor=this._borderColor;this._colorInput.bgColor=this._inputBgColor;this._colorInput.color=this._inputColor;r=this._colorTiles.graphics;r.clear();t=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935];for(i=0;i<12;i++)for(e=0;e<20;e++){s=0;s=0===e?t[i]:1===e?0:51*(((3*i+e/6)%3<<0)+3*(i/6<<0))<<16|e%6*51<<8|(i<<0)%6*51;h=n.toColor(s);this._colors.push(h);l=e*this._gridSize;o=i*this._gridSize;r.drawRect(l,o,this._gridSize,this._gridSize,h,"#000000")}};s.onColorButtonClick=function(t){this._colorPanel.parent?this.close():this.open()};s.open=function(){var t=this.localToGlobal(new W),i=t.x+this._colorPanel.width<=e.stage.width?t.x:e.stage.width-this._colorPanel.width,s=t.y+this._colorButton.height;s=s+this._colorPanel.height<=e.stage.height?s:t.y-this._colorPanel.height;this._colorPanel.pos(i,s);e.stage.addChild(this._colorPanel);e.stage.on("mousedown",this,this.removeColorBox)};s.close=function(){e.stage.off("mousedown",this,this.removeColorBox);this._colorPanel.removeSelf()};s.removeColorBox=function(t){this.close()};s.onColorFieldKeyDown=function(t){if(13==t.keyCode){this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null;this.close();t.stopPropagation()}};s.onColorInputChange=function(t){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")};s.onColorTilesClick=function(t){this.selectedColor=this.getColorByMouse();this.close()};s.onColorTilesMouseMove=function(t){this._colorInput.focus=!1;var i=this.getColorByMouse();this._colorInput.text=i;this.drawBlock(i)};s.getColorByMouse=function(){var t=this._colorTiles.getMousePoint(),i=Math.floor(t.x/this._gridSize),e=Math.floor(t.y/this._gridSize);return this._colors[20*e+i]};s.drawBlock=function(t){var i,e=this._colorBlock.graphics;e.clear();i=t?t:"#ffffff";e.drawRect(0,0,50,20,i,this._borderColor);t||e.drawLine(0,0,50,20,"#ff0000")};s.changeColor=function(){var t,i=this.graphics;i.clear();t=this._selectedColor||"#000000";i.drawRect(0,0,this._colorButton.width,this._colorButton.height,t)};R(0,s,"borderColor",function(){return this._borderColor},function(t){this._borderColor=t;this.callLater(this.changePanel)});R(0,s,"selectedColor",function(){return this._selectedColor},function(t){if(this._selectedColor!=t){this._selectedColor=this._colorInput.text=t;this.drawBlock(t);this.changeColor();this.changeHandler&&this.changeHandler.runWith(this._selectedColor);this.event("change",D.EMPTY.setTo("change",this,this))}});R(0,s,"inputBgColor",function(){return this._inputBgColor},function(t){this._inputBgColor=t;this.callLater(this.changePanel)});R(0,s,"skin",function(){return this._colorButton.skin},function(t){this._colorButton.skin=t;this.changeColor()});R(0,s,"bgColor",function(){return this._bgColor},function(t){this._bgColor=t;this.callLater(this.changePanel)});R(0,s,"inputColor",function(){return this._inputColor},function(t){this._inputColor=t;this.callLater(this.changePanel)});return i}(a);f=function(t){function i(t,e){this._visibleNum=6;this._button=null;this._list=null;this._isOpen=!1;this._scrollBar=null;this._itemSize=12;this._labels=[];this._selectedIndex=-1;this._selectHandler=null;this._itemHeight=NaN;this._listHeight=NaN;this._listChanged=!1;this._itemChanged=!1;this._scrollBarSkin=null;i.__super.call(this);this._itemColors=h.comboBoxItemColors;this.skin=t;this.labels=e}V(i,"laya.ui.ComboBox",t);var s=i.prototype;s.destroy=function(i){void 0===i&&(i=!0);t.prototype.destroy.call(this,i);this._button&&this._button.destroy(i);this._list&&this._list.destroy(i);this._scrollBar&&this._scrollBar.destroy(i);this._button=null;this._list=null;this._scrollBar=null;this._itemColors=null;this._labels=null;this._selectHandler=null};s.createChildren=function(){this.addChild(this._button=new u);this._button.text.align="left";this._button.labelPadding="0,0,0,5";this._button.on("mousedown",this,this.onButtonMouseDown)};s._createList=function(){this._list=new w;this._list.selectEnable=!0;this._list.on("mousedown",this,this.onListDown);this._list.mouseHandler=U.create(this,this.onlistItemMouse,null,!1);if(this._scrollBarSkin){this._list.addChild(this._scrollBar=new P);this._scrollBar.skin=this._scrollBarSkin;this._scrollBar.name="scrollBar";this._scrollBar.y=1;this._scrollBar.on("mousedown",this,this.onScrollBarDown)}};s.onListDown=function(t){t.stopPropagation()};s.onScrollBarDown=function(t){t.stopPropagation()};s.onButtonMouseDown=function(t){this.callLater(this.switchTo,[!this._isOpen])};s.changeList=function(){var t,i;this._listChanged=!1;t=this.width-2;i=this._itemColors[2];this._itemHeight=this._itemSize+6;this._list.itemRender={type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:t,height:this._itemHeight,fontSize:this._itemSize,color:i}}]};this._list.repeatY=this._visibleNum;this._scrollBar&&(this._scrollBar.x=this.width-this._scrollBar.width-1);this._list.refresh()};s.onlistItemMouse=function(t,i){var e,s,h=t.type;if("mouseover"===h||"mouseout"===h){e=this._list.getCell(i);if(!e)return;s=e.getChildByName("label");if("mouseover"===h){s.bgColor=this._itemColors[0];s.color=this._itemColors[1]}else{s.bgColor=null;s.color=this._itemColors[2]}}else if("click"===h){this.selectedIndex=i;this.isOpen=!1}};s.switchTo=function(t){this.isOpen=t};s.changeOpen=function(){this.isOpen=!this._isOpen};s.changeItem=function(){var t,i,e,s;this._itemChanged=!1;this.runCallLater(this.changeList);this._listHeight=this._labels.length>0?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight;this._scrollBar&&(this._scrollBar.height=this._listHeight-2);t=this._list.graphics;t.clear();t.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3]);i=this._list.array||[];i.length=0;for(e=0,s=this._labels.length;e<s;e++)i.push({label:this._labels[e]});this._list.array=i};s.changeSelected=function(){this._button.label=this.selectedLabel};s.removeList=function(t){this.isOpen=!1};R(0,s,"labels",function(){return this._labels.join(",")},function(t){this._labels.length>0&&(this.selectedIndex=-1);t?this._labels=t.split(","):this._labels.length=0;this._itemChanged=!0});R(0,s,"skin",function(){return this._button.skin},function(t){if(this._button.skin!=t){this._button.skin=t;this._listChanged=!0}});R(0,s,"measureHeight",function(){return this._button.height});R(0,s,"measureWidth",function(){return this._button.width});R(0,s,"selectedLabel",function(){return this._selectedIndex>-1&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function(t){this.selectedIndex=this._labels.indexOf(t)});R(0,s,"selectedIndex",function(){return this._selectedIndex},function(t){if(this._selectedIndex!=t){this._selectedIndex=t;this._labels.length>0?this.changeSelected():this.callLater(this.changeSelected);this.event("change",[D.EMPTY.setTo("change",this,this)]);this._selectHandler&&this._selectHandler.runWith(this._selectedIndex)}});R(0,s,"width",t.prototype._$get_width,function(i){t.prototype._$set_width.call(this,i);this._button.width=this._width;this._itemChanged=!0;this._listChanged=!0});R(0,s,"height",t.prototype._$get_height,function(i){t.prototype._$set_height.call(this,i);this._button.height=this._height});R(0,s,"selectHandler",function(){return this._selectHandler},function(t){this._selectHandler=t});R(0,s,"stateNum",function(){return this._button.stateNum},function(t){this._button.stateNum=t});R(0,s,"visibleNum",function(){return this._visibleNum},function(t){this._visibleNum=t;this._listChanged=!0});R(0,s,"itemColors",function(){return String(this._itemColors)},function(t){this._itemColors=n.fillArray(this._itemColors,t,String);this._listChanged=!0});R(0,s,"itemSize",function(){return this._itemSize},function(t){this._itemSize=t;this._listChanged=!0});R(0,s,"isOpen",function(){return this._isOpen},function(t){var i,s;if(this._isOpen!=t){this._isOpen=t;this._button.selected=this._isOpen;if(this._isOpen){this._list||this._createList();this._listChanged&&this.changeList();this._itemChanged&&this.changeItem();W.EMPTY.setTo(0,0);i=this.localToGlobal(W.EMPTY);s=i.y+this._button.height;s=s+this._listHeight<=e.stage.width?s:i.y-this._listHeight;this._list.pos(i.x,s);e.stage.addChild(this._list);e.stage.once("mousedown",this,this.removeList);this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()}});R(0,s,"sizeGrid",function(){return this._button.sizeGrid},function(t){this._button.sizeGrid=t});R(0,s,"button",function(){return this._button});R(0,s,"scrollBarSkin",function(){return this._scrollBarSkin},function(t){this._scrollBarSkin=t});R(0,s,"scrollBar",function(){return this._scrollBar});R(0,s,"list",function(){return this._list});R(0,s,"dataSource",t.prototype._$get_dataSource,function(i){this._dataSource=i;"number"==typeof i&&Math.floor(i)==i||"string"==typeof i?this.selectedIndex=e.__parseInt(i):i instanceof Array?this.labels=i.join(","):t.prototype._$set_dataSource.call(this,i)});R(0,s,"labelColors",function(){return this._button.labelColors},function(t){this._button.labelColors=t});R(0,s,"labelPadding",function(){return this._button.text.padding.join(",")},function(t){this._button.text.padding=n.fillArray(h.labelPadding,t,Number)});R(0,s,"labelSize",function(){return this._button.text.fontSize},function(t){this._button.text.fontSize=t});R(0,s,"labelBold",function(){return this._button.text.bold},function(t){this._button.text.bold=t});R(0,s,"labelFont",function(){return this._button.text.font},function(t){this._button.text.font=t});return i}(a);p=function(t){function i(t){this.changeHandler=null;this.scaleBar=!0;this.autoHide=!1;this.elasticDistance=0;this.elasticBackTime=500;this._scrollSize=1;this._skin=null;this._upButton=null;this._downButton=null;this._slider=null;this._thumbPercent=1;this._target=null;this._lastPoint=null;this._lastOffset=0;this._checkElastic=!1;this._isElastic=!1;this._value=NaN;this._hide=!1;this._clickOnly=!0;this._offsets=null;i.__super.call(this);this._showButtons=l.showButtons;this._touchScrollEnable=l.touchScrollEnable;this._mouseWheelEnable=l.mouseWheelEnable;this.skin=t;this.max=1}V(i,"laya.ui.ScrollBar",t);var s=i.prototype;s.destroy=function(i){void 0===i&&(i=!0);t.prototype.destroy.call(this,i);this._upButton&&this._upButton.destroy(i);this._downButton&&this._downButton.destroy(i);this._slider&&this._slider.destroy(i);this._upButton=this._downButton=null;this._slider=null;this.changeHandler=null;this._offsets=null};s.createChildren=function(){this.addChild(this._slider=new g);this.addChild(this._upButton=new u);this.addChild(this._downButton=new u)};s.initialize=function(){this._slider.showLabel=!1;this._slider.on("change",this,this.onSliderChange);this._slider.setSlider(0,0,0);this._upButton.on("mousedown",this,this.onButtonMouseDown);this._downButton.on("mousedown",this,this.onButtonMouseDown)};s.onSliderChange=function(t){
this.value=this._slider.value};s.onButtonMouseDown=function(t){var i=t.currentTarget===this._upButton;this.slide(i);e.timer.once(h.scrollBarDelayTime,this,this.startLoop,[i]);e.stage.once("mouseup",this,this.onStageMouseUp)};s.startLoop=function(t){e.timer.frameLoop(1,this,this.slide,[t])};s.slide=function(t){t?this.value-=this._scrollSize:this.value+=this._scrollSize};s.onStageMouseUp=function(t){e.timer.clear(this,this.startLoop);e.timer.clear(this,this.slide)};s.changeScrollBar=function(){this._upButton.visible=this._showButtons;this._downButton.visible=this._showButtons;if(this._showButtons){this._upButton.skin=this._skin.replace(".png","$up.png");this._downButton.skin=this._skin.replace(".png","$down.png")}this._slider.isVertical?this._slider.y=this._showButtons?this._upButton.height:0:this._slider.x=this._showButtons?this._upButton.width:0;this.resetPositions()};s.changeSize=function(){t.prototype.changeSize.call(this);this.resetPositions();this.event("change");this.changeHandler&&this.changeHandler.runWith(this.value)};s.resetPositions=function(){this._slider.isVertical?this._slider.height=this.height-(this._showButtons?this._upButton.height+this._downButton.height:0):this._slider.width=this.width-(this._showButtons?this._upButton.width+this._downButton.width:0);this.resetButtonPosition()};s.resetButtonPosition=function(){this._slider.isVertical?this._downButton.y=this._slider.y+this._slider.height:this._downButton.x=this._slider.x+this._slider.width};s.setScroll=function(t,i,e){this.runCallLater(this.changeSize);this._slider.setSlider(t,i,e);this._slider.bar.visible=i>0;!this._hide&&this.autoHide&&(this.visible=!1)};s.onTargetMouseWheel=function(t){this.value-=t.delta*this._scrollSize;this.target=this._target};s.onTargetMouseDown=function(t){this._clickOnly=!0;this._lastOffset=0;this._checkElastic=!1;this._lastPoint||(this._lastPoint=new W);this._lastPoint.setTo(e.stage.mouseX,e.stage.mouseY);e.timer.clear(this,this.tweenMove);et.clearTween(this);e.stage.once("mouseup",this,this.onStageMouseUp2);e.stage.once("mouseout",this,this.onStageMouseUp2);e.timer.frameLoop(1,this,this.loop);this.event("start")};s.loop=function(){var t=e.stage.mouseY,i=e.stage.mouseX;this._lastOffset=this.isVertical?t-this._lastPoint.y:i-this._lastPoint.x;if(this._clickOnly){if(!(Math.abs(this._lastOffset*(this.isVertical?e.stage._canvasTransform.getScaleY():e.stage._canvasTransform.getScaleX()))>1))return;this._clickOnly=!1;this._offsets||(this._offsets=[]);this._offsets.length=0;this._target.mouseEnabled=!1;if(!this.hide&&this.autoHide){this.alpha=1;this.visible=!0}}this._offsets.push(this._lastOffset);this._lastPoint.x=i;this._lastPoint.y=t;if(0!==this._lastOffset){if(!this._checkElastic)if(this.elasticDistance>0){if(!this._checkElastic&&0!=this._lastOffset){this._checkElastic=!0;this._lastOffset>0&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?this._isElastic=!0:this._isElastic=!1}}else this._checkElastic=!0;this._checkElastic&&(this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset)}};s.onStageMouseUp2=function(t){var i,s,h;e.stage.off("mouseup",this,this.onStageMouseUp2);e.stage.off("mouseout",this,this.onStageMouseUp2);e.timer.clear(this,this.loop);if(!this._clickOnly){this._target.mouseEnabled=!0;if(this._isElastic)this._value<this.min?et.to(this,{value:this.min},this.elasticBackTime,st.sineOut,U.create(this,this.elasticOver)):this._value>this.max&&et.to(this,{value:this.max},this.elasticBackTime,st.sineOut,U.create(this,this.elasticOver));else{this._offsets.length<1&&(this._offsets[0]=this.isVertical?e.stage.mouseY-this._lastPoint.y:e.stage.mouseX-this._lastPoint.x);i=0;s=Math.min(this._offsets.length,3);for(h=0;h<s;h++)i+=this._offsets[this._offsets.length-1-h];this._lastOffset=i/s;i=Math.abs(this._lastOffset);if(i<2)return;i>60&&(this._lastOffset=this._lastOffset>0?60:-60);e.timer.frameLoop(1,this,this.tweenMove)}}};s.elasticOver=function(){this._isElastic=!1;!this.hide&&this.autoHide&&et.to(this,{alpha:0},500)};s.tweenMove=function(){this._lastOffset*=.95;this.value-=this._lastOffset;if(Math.abs(this._lastOffset)<1){e.timer.clear(this,this.tweenMove);this.event("end");!this.hide&&this.autoHide&&et.to(this,{alpha:0},500)}};s.stopScroll=function(){this.onStageMouseUp2(null);e.timer.clear(this,this.tweenMove);et.clearTween(this)};R(0,s,"isVertical",function(){return this._slider.isVertical},function(t){this._slider.isVertical=t});R(0,s,"skin",function(){return this._skin},function(t){if(this._skin!=t){this._skin=t;this._slider.skin=this._skin;this.callLater(this.changeScrollBar)}});R(0,s,"max",function(){return this._slider.max},function(t){this._slider.max=t});R(0,s,"scrollSize",function(){return this._scrollSize},function(t){this._scrollSize=t});R(0,s,"measureHeight",function(){return this._slider.isVertical?100:this._slider.height});R(0,s,"measureWidth",function(){return this._slider.isVertical?this._slider.width:100});R(0,s,"sizeGrid",function(){return this._slider.sizeGrid},function(t){this._slider.sizeGrid=t});R(0,s,"min",function(){return this._slider.min},function(t){this._slider.min=t});R(0,s,"value",function(){return this._value},function(t){if(t!==this._value){if(this._isElastic)this._value=t;else{this._slider.value=t;this._value=this._slider.value}this.event("change");this.changeHandler&&this.changeHandler.runWith(this.value)}});R(0,s,"dataSource",t.prototype._$get_dataSource,function(i){this._dataSource=i;"number"==typeof i||"string"==typeof i?this.value=Number(i):t.prototype._$set_dataSource.call(this,i)});R(0,s,"thumbPercent",function(){return this._thumbPercent},function(t){this.runCallLater(this.changeScrollBar);this.runCallLater(this.changeSize);t=t>=1?.99:t;this._thumbPercent=t;this.scaleBar&&(this._slider.isVertical?this._slider.bar.height=Math.max(this._slider.height*t,h.scrollBarMinNum):this._slider.bar.width=Math.max(this._slider.width*t,h.scrollBarMinNum))});R(0,s,"target",function(){return this._target},function(t){if(this._target){this._target.off("mousewheel",this,this.onTargetMouseWheel);this._target.off("mousedown",this,this.onTargetMouseDown)}this._target=t;if(t){this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel);this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown)}});R(0,s,"hide",function(){return this._hide},function(t){this._hide=t;this.visible=!t});R(0,s,"showButtons",function(){return this._showButtons},function(t){this._showButtons=t;this.callLater(this.changeScrollBar)});R(0,s,"touchScrollEnable",function(){return this._touchScrollEnable},function(t){this._touchScrollEnable=t;this.target=this._target});R(0,s,"mouseWheelEnable",function(){return this._mouseWheelEnable},function(t){this._mouseWheelEnable=t});return i}(a);g=function(t){function i(t){this.changeHandler=null;this.isVertical=!0;this.showLabel=!0;this._allowClickBack=!1;this._max=100;this._min=0;this._tick=1;this._value=0;this._skin=null;this._bg=null;this._bar=null;this._tx=NaN;this._ty=NaN;this._maxMove=NaN;i.__super.call(this);this.skin=t}V(i,"laya.ui.Slider",t);var s=i.prototype;s.destroy=function(i){void 0===i&&(i=!0);t.prototype.destroy.call(this,i);this._bg&&this._bg.destroy(i);this._bar&&this._bar.destroy(i);this._bg=null;this._bar=null;this.changeHandler=null};s.createChildren=function(){this.addChild(this._bg=new m);this.addChild(this._bar=new u)};s.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown);this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0";this.allowClickBack=!0};s.onBarMouseDown=function(t){this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width;this._tx=e.stage.mouseX;this._ty=e.stage.mouseY;e.stage.on("mousemove",this,this.mouseMove);e.stage.once("mouseup",this,this.mouseUp);this.showValueText()};s.showValueText=function(){if(this.showLabel){var t=laya.ui.Slider.label;this.addChild(t);t.textField.changeText(this._value+"");if(this.isVertical){t.x=this._bar.x+20;t.y=.5*(this._bar.height-t.height)+this._bar.y}else{t.y=this._bar.y-20;t.x=.5*(this._bar.width-t.width)+this._bar.x}}};s.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()};s.mouseUp=function(t){e.stage.off("mousemove",this,this.mouseMove);this.sendChangeEvent("changed");this.hideValueText()};s.mouseMove=function(t){var i,s=this._value;if(this.isVertical){this._bar.y+=e.stage.mouseY-this._ty;this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0);this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min}else{this._bar.x+=e.stage.mouseX-this._tx;this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0);this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min}this._tx=e.stage.mouseX;this._ty=e.stage.mouseY;i=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*i)/i;this._value!=s&&this.sendChangeEvent();this.showValueText()};s.sendChangeEvent=function(t){void 0===t&&(t="change");this.event(t);this.changeHandler&&this.changeHandler.runWith(this._value)};s.setBarPoint=function(){this.isVertical?this._bar.x=.5*(this._bg.width-this._bar.width):this._bar.y=.5*(this._bg.height-this._bar.height)};s.changeSize=function(){t.prototype.changeSize.call(this);this.isVertical?this._bg.height=this.height:this._bg.width=this.width;this.setBarPoint();this.changeValue()};s.setSlider=function(t,i,e){this._value=-1;this._min=t;this._max=i>t?i:t;this.value=e<t?t:e>i?i:e};s.changeValue=function(){var t=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*t)/t;this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;this.isVertical?this._bar.y=(this._value-this._min)/(this._max-this._min)*(this.height-this._bar.height):this._bar.x=(this._value-this._min)/(this._max-this._min)*(this.width-this._bar.width)};s.onBgMouseDown=function(t){var i=this._bg.getMousePoint();this.isVertical?this.value=i.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=i.x/(this.width-this._bar.width)*(this._max-this._min)+this._min};R(0,s,"skin",function(){return this._skin},function(t){if(this._skin!=t){this._skin=t;this._bg.skin=this._skin;this._bar.skin=this._skin.replace(".png","$bar.png");this.setBarPoint()}});R(0,s,"max",function(){return this._max},function(t){if(this._max!=t){this._max=t;this.callLater(this.changeValue)}});R(0,s,"bar",function(){return this._bar});R(0,s,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height)});R(0,s,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width)});R(0,s,"sizeGrid",function(){return this._bg.sizeGrid},function(t){this._bg.sizeGrid=t;this._bar.sizeGrid=t});R(0,s,"tick",function(){return this._tick},function(t){this._tick=t;this.callLater(this.changeValue)});R(0,s,"min",function(){return this._min},function(t){if(this._min!=t){this._min=t;this.callLater(this.changeValue)}});R(0,s,"value",function(){return this._value},function(t){if(this._value!=t){var i=this._value;this._value=t;this.changeValue();this._value!=i&&this.sendChangeEvent()}});R(0,s,"allowClickBack",function(){return this._allowClickBack},function(t){if(this._allowClickBack!=t){this._allowClickBack=t;t?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown)}});R(0,s,"dataSource",t.prototype._$get_dataSource,function(i){this._dataSource=i;"number"==typeof i||"string"==typeof i?this.value=Number(i):t.prototype._$set_dataSource.call(this,i)});X(i,["label",function(){return this.label=new y}]);return i}(a);m=function(t){function i(t){this._bitmap=null;this._skin=null;i.__super.call(this);this.skin=t}V(i,"laya.ui.Image",t);var s=i.prototype;s.destroy=function(i){void 0===i&&(i=!0);t.prototype.destroy.call(this,!0);this._bitmap&&this._bitmap.destroy();this._bitmap=null};s.dispose=function(){this.destroy(!0);e.loader.clearRes(this._skin)};s.createChildren=function(){this.graphics=this._bitmap=new o;this._bitmap.autoCacheCmd=!1};s.setSource=function(t,i){t===this._skin&&(this.source=i);this.onCompResize()};R(0,s,"skin",function(){return this._skin},function(t){if(this._skin!=t){this._skin=t;if(t){var i=G.getRes(t);i?this.source=i:e.loader.load(this._skin,U.create(this,this.setSource,[this._skin]),null,"image")}else this.source=null}});R(0,s,"source",function(){return this._bitmap.source},function(t){if(this._bitmap){this._bitmap.source=t;this.event("loaded");this.repaint()}});R(0,s,"width",t.prototype._$get_width,function(i){t.prototype._$set_width.call(this,i);this._bitmap.width=0==i?1e-7:i});R(0,s,"measureHeight",function(){return this._bitmap.height});R(0,s,"measureWidth",function(){return this._bitmap.width});R(0,s,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(t){this._bitmap.sizeGrid=n.fillArray(h.defaultSizeGrid,t,Number)});R(0,s,"height",t.prototype._$get_height,function(i){t.prototype._$set_height.call(this,i);this._bitmap.height=0==i?1e-7:i});R(0,s,"dataSource",t.prototype._$get_dataSource,function(i){this._dataSource=i;"string"==typeof i?this.skin=i:t.prototype._$set_dataSource.call(this,i)});return i}(a);y=function(t){function i(t){this._tf=null;i.__super.call(this);void 0===t&&(t="");J.defaultColor=h.labelColor;this.text=t}V(i,"laya.ui.Label",t);var e=i.prototype;e.destroy=function(i){void 0===i&&(i=!0);t.prototype.destroy.call(this,i);this._tf=null};e.createChildren=function(){this.addChild(this._tf=new tt)};R(0,e,"leading",function(){return this._tf.leading},function(t){this._tf.leading=t});R(0,e,"text",function(){return this._tf.text},function(t){if(this._tf.text!=t){this._tf.text=t;this.event("change")}});R(0,e,"color",function(){return this._tf.color},function(t){this._tf.color=t});R(0,e,"strokeColor",function(){return this._tf.strokeColor},function(t){this._tf.strokeColor=t});R(0,e,"wordWrap",function(){return this._tf.wordWrap},function(t){this._tf.wordWrap=t});R(0,e,"font",function(){return this._tf.font},function(t){this._tf.font=t});R(0,e,"italic",function(){return this._tf.italic},function(t){this._tf.italic=t});R(0,e,"valign",function(){return this._tf.valign},function(t){this._tf.valign=t});R(0,e,"align",function(){return this._tf.align},function(t){this._tf.align=t});R(0,e,"bold",function(){return this._tf.bold},function(t){this._tf.bold=t});R(0,e,"textField",function(){return this._tf});R(0,e,"fontSize",function(){return this._tf.fontSize},function(t){this._tf.fontSize=t});R(0,e,"padding",function(){return this._tf.padding.join(",")},function(t){this._tf.padding=n.fillArray(h.labelPadding,t,Number)});R(0,e,"bgColor",function(){return this._tf.bgColor},function(t){this._tf.bgColor=t});R(0,e,"measureWidth",function(){return this._tf.width});R(0,e,"borderColor",function(){return this._tf.borderColor},function(t){this._tf.borderColor=t});R(0,e,"stroke",function(){return this._tf.stroke},function(t){this._tf.stroke=t});R(0,e,"asPassword",function(){return this._tf.asPassword},function(t){this._tf.asPassword=t});R(0,e,"measureHeight",function(){return this._tf.height});R(0,e,"width",function(){return this._width||this._tf.text?t.prototype._$get_width.call(this):0},function(i){t.prototype._$set_width.call(this,i);this._tf.width=i});R(0,e,"height",function(){return this._height||this._tf.text?t.prototype._$get_height.call(this):0},function(i){t.prototype._$set_height.call(this,i);this._tf.height=i});R(0,e,"dataSource",t.prototype._$get_dataSource,function(i){this._dataSource=i;"number"==typeof i||"string"==typeof i?this.text=i+"":t.prototype._$set_dataSource.call(this,i)});return i}(a);b=function(t){function i(t){this.changeHandler=null;this._bg=null;this._bar=null;this._skin=null;this._value=.5;i.__super.call(this);this.skin=t}V(i,"laya.ui.ProgressBar",t);var e=i.prototype;e.destroy=function(i){void 0===i&&(i=!0);t.prototype.destroy.call(this,i);this._bg&&this._bg.destroy(i);this._bar&&this._bar.destroy(i);this._bg=this._bar=null;this.changeHandler=null};e.createChildren=function(){this.addChild(this._bg=new m);this.addChild(this._bar=new m);this._bar["_bitmap"].autoCacheCmd=!1};e.changeValue=function(){var t,i,e,s,h;if(this.sizeGrid){t=this.sizeGrid.split(",");i=Number(t[0]);e=Number(t[2]);s=this.width-i-e;h=s*this._value;this._bar.width=i+e+h;this._bar.visible=this._bar.width>i+e}else this._bar.width=this.width*this._value};R(0,e,"skin",function(){return this._skin},function(t){if(this._skin!=t){this._skin=t;this._bg.skin=this._skin;this._bar.skin=this._skin.replace(".png","$bar.png");this.callLater(this.changeValue)}});R(0,e,"bar",function(){return this._bar});R(0,e,"measureHeight",function(){return this._bg.height});R(0,e,"measureWidth",function(){return this._bg.width});R(0,e,"sizeGrid",function(){return this._bg.sizeGrid},function(t){this._bg.sizeGrid=this._bar.sizeGrid=t});R(0,e,"bg",function(){return this._bg});R(0,e,"height",t.prototype._$get_height,function(i){t.prototype._$set_height.call(this,i);this._bg.height=this._height;this._bar.height=this._height});R(0,e,"value",function(){return this._value},function(t){if(this._value!=t){t=t>1?1:t<0?0:t;this._value=t;this.callLater(this.changeValue);this.event("change");this.changeHandler&&this.changeHandler.runWith(t)}});R(0,e,"width",t.prototype._$get_width,function(i){t.prototype._$set_width.call(this,i);this._bg.width=this._width;this.callLater(this.changeValue)});R(0,e,"dataSource",t.prototype._$get_dataSource,function(i){this._dataSource=i;"number"==typeof i||"string"==typeof i?this.value=Number(i):t.prototype._$set_dataSource.call(this,i)});return i}(a);C=function(t){function i(t,e){void 0===e&&(e="");i.__super.call(this,t,e)}V(i,"laya.ui.CheckBox",t);var e=i.prototype;e.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this);this.toggle=!0;this._autoSize=!1};e.initialize=function(){t.prototype.initialize.call(this);this._text.align="left";this._text.valign="top";this._text.width=0};R(0,e,"dataSource",t.prototype._$get_dataSource,function(i){this._dataSource=i;"boolean"==typeof i?this.selected=i:"string"==typeof i?this.selected="true"===i:t.prototype._$set_dataSource.call(this,i)});return i}(u);v=function(t){function i(){i.__super.call(this)}V(i,"laya.ui.View",t);var s=i.prototype;s.createView=function(t){i.createComp(t,this,this)};s.loadUI=function(t){var e=i.uiMap[t];e&&this.createView(e)};i.createComp=function(t,e,s){var h,n,l,o,r,a,c;e=e||i.getCompInstance(t);h=t.child;if(h)for(n=0,l=h.length;n<l;n++){o=h[n];e.hasOwnProperty("itemRender")&&"render"==o.props.name?e.itemRender=o:e.addChild(i.createComp(o,null,s))}r=t.props;for(a in r){c=r[a];i.setCompValue(e,a,c,s)}e["initItems"]&&e.initItems();return e};i.setCompValue=function(t,i,e,s){"var"===i&&s?s[e]=t:"width"===i||"height"===i||"x"===i||"y"===i||"pivotX"===i||"pivotY"===i||"number"==typeof t[i]?t[i]=Number(e):t[i]="true"===e?!0:"false"===e?!1:e};i.getCompInstance=function(t){var s=t.props?t.props.runtime:"",h=s?i.viewClassMap[s]||e["__classmap"][s]:i.uiClassMap[t.type];return h?new h:null};i.regComponent=function(t,e){i.uiClassMap[t]=e};i.regViewRuntime=function(t,e){i.viewClassMap[t]=e};i.uiMap={};i.viewClassMap={};X(i,["uiClassMap",function(){return this.uiClassMap={ViewStack:M,LinkButton:u,TextArea:E,ColorPicker:d,Box:c,Button:u,CheckBox:C,Clip:_,ComboBox:f,Component:a,HScrollBar:k,HSlider:L,Image:m,Label:y,List:w,Panel:B,ProgressBar:b,Radio:I,RadioGroup:O,ScrollBar:p,Slider:g,Tab:A,TextInput:N,View:i,VScrollBar:P,VSlider:H,Tree:z,HBox:$,VBox:Y}}]);return i}(c);S=function(t){function i(t,e){this.selectHandler=null;this._items=null;this._selectedIndex=-1;this._skin=null;this._direction="horizontal";this._space=0;this._labels=null;this._labelColors=null;this._labelStrokeColor=null;this._strokeColors=null;this._labelStroke=NaN;this._labelSize=0;this._labelBold=!1;this._labelPadding=null;this._labelAlign=null;this._stateNum=0;i.__super.call(this);this.skin=e;this.labels=t}V(i,"laya.ui.Group",t);var s=i.prototype;e.imps(s,{"laya.ui.IItem":!0});s.preinitialize=function(){this.mouseEnabled=!0};s.destroy=function(t){void 0===t&&(t=!0);laya.ui.Component.prototype.destroy.call(this,t);this._items&&(this._items.length=0);this._items=null;this.selectHandler=null};s.addItem=function(t,i){var e,s,h;void 0===i&&(i=!0);e=t;s=this._items.length;e.name="item"+s;this.addChild(e);this.initItems();if(i&&s>0){h=this._items[s-1];"horizontal"==this._direction?e.x=h.x+h.width+this._space:e.y=h.y+h.height+this._space}else if(i){e.x=0;e.y=0}return s};s.delItem=function(t,i){var e,s,h,n,l,o;void 0===i&&(i=!0);e=this._items.indexOf(t);if(-1!=e){s=t;this.removeChild(s);for(h=e+1,n=this._items.length;h<n;h++){l=this._items[h];l.name="item"+(h-1);i&&("horizontal"==this._direction?l.x-=s.width+this._space:l.y-=s.height+this._space)}this.initItems();if(this._selectedIndex>-1){o=0;o=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1;this._selectedIndex=-1;this.selectedIndex=o}}};s.initItems=function(){var t,i;this._items||(this._items=[]);this._items.length=0;for(t=0;t<1e4;t++){i=this.getChildByName("item"+t);if(null==i)break;this._items.push(i);i.selected=t===this._selectedIndex;i.clickHandler=U.create(this,this.itemClick,[t],!1)}};s.itemClick=function(t){this.selectedIndex=t};s.setSelect=function(t,i){this._items&&t>-1&&t<this._items.length&&(this._items[t].selected=i)};s.createItem=function(t,i){return null};s.changeLabels=function(){var t,i,e,s;if(this._items){t=0;for(i=0,e=this._items.length;i<e;i++){s=this._items[i];this._skin&&(s.skin=this._skin);this._labelColors&&(s.labelColors=this._labelColors);this._labelSize&&(s.labelSize=this._labelSize);this._labelStroke&&(s.labelStroke=this._labelStroke);this._labelStrokeColor&&(s.labelStrokeColor=this._labelStrokeColor);this._strokeColors&&(s.strokeColors=this._strokeColors);this._labelBold&&(s.labelBold=this._labelBold);this._labelPadding&&(s.labelPadding=this._labelPadding);this._labelAlign&&(s.labelAlign=this._labelAlign);this._stateNum&&(s.stateNum=this._stateNum);if("horizontal"===this._direction){s.y=0;s.x=t;t+=s.width+this._space}else{s.x=0;s.y=t;t+=s.height+this._space}}}this.changeSize()};s.commitMeasure=function(){this.runCallLater(this.changeLabels)};R(0,s,"selectedIndex",function(){return this._selectedIndex},function(t){if(this._selectedIndex!=t){this.setSelect(this._selectedIndex,!1);this._selectedIndex=t;this.setSelect(t,!0);this.event("change");this.selectHandler&&this.selectHandler.runWith(this._selectedIndex)}});R(0,s,"labelStrokeColor",function(){return this._labelStrokeColor},function(t){if(this._labelStrokeColor!=t){this._labelStrokeColor=t;this.callLater(this.changeLabels)}});R(0,s,"skin",function(){return this._skin},function(t){if(this._skin!=t){this._skin=t;this.callLater(this.changeLabels)}});R(0,s,"labels",function(){return this._labels},function(t){var i,e,s,h;if(this._labels!=t){this._labels=t;this.removeChildren();this.callLater(this.changeLabels);if(this._labels){i=this._labels.split(",");for(e=0,s=i.length;e<s;e++){h=this.createItem(this._skin,i[e]);h.name="item"+e;this.addChild(h)}}this.initItems()}});R(0,s,"labelColors",function(){return this._labelColors},function(t){if(this._labelColors!=t){this._labelColors=t;this.callLater(this.changeLabels)}});R(0,s,"labelStroke",function(){return this._labelStroke},function(t){if(this._labelStroke!=t){this._labelStroke=t;this.callLater(this.changeLabels)}});R(0,s,"stateNum",function(){return this._stateNum},function(t){if(this._stateNum!=t){this._stateNum=t;this.callLater(this.changeLabels)}});R(0,s,"strokeColors",function(){return this._strokeColors},function(t){if(this._strokeColors!=t){this._strokeColors=t;this.callLater(this.changeLabels)}});R(0,s,"labelSize",function(){return this._labelSize},function(t){if(this._labelSize!=t){this._labelSize=t;this.callLater(this.changeLabels)}});R(0,s,"space",function(){return this._space},function(t){this._space=t;this.callLater(this.changeLabels)});R(0,s,"labelBold",function(){return this._labelBold},function(t){if(this._labelBold!=t){this._labelBold=t;this.callLater(this.changeLabels)}});R(0,s,"labelPadding",function(){return this._labelPadding},function(t){if(this._labelPadding!=t){this._labelPadding=t;this.callLater(this.changeLabels)}});R(0,s,"selection",function(){return this._selectedIndex>-1&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(t){this.selectedIndex=this._items.indexOf(t)});R(0,s,"direction",function(){return this._direction},function(t){this._direction=t;this.callLater(this.changeLabels)});R(0,s,"items",function(){return this._items});R(0,s,"dataSource",t.prototype._$get_dataSource,function(i){this._dataSource=i;"number"==typeof i&&Math.floor(i)==i||"string"==typeof i?this.selectedIndex=int(i):i instanceof Array?this.labels=i.join(","):t.prototype._$set_dataSource.call(this,i)});return i}(c);x=function(t){function i(){this._space=0;this._align="none";i.__super.call(this)}V(i,"laya.ui.LayoutBox",t);var e=i.prototype;e.addChild=function(t){t.on("resize",this,this.onResize);this.callLater(this.changeItems);return laya.display.Node.prototype.addChild.call(this,t)};e.onResize=function(t){this.callLater(this.changeItems)};e.addChildAt=function(t,i){t.on("resize",this,this.onResize);this.callLater(this.changeItems);return laya.display.Node.prototype.addChildAt.call(this,t,i)};e.removeChild=function(t){t.off("resize",this,this.onResize);this.callLater(this.changeItems);return laya.display.Node.prototype.removeChild.call(this,t)};e.removeChildAt=function(t){this.getChildAt(t).off("resize",this,this.onResize);this.callLater(this.changeItems);return laya.display.Node.prototype.removeChildAt.call(this,t)};e.refresh=function(){this.callLater(this.changeItems)};e.changeItems=function(){};e.sortItem=function(t){t&&t.sort(function(t,i){return t.y>i.y?1:-1})};R(0,e,"space",function(){return this._space},function(t){this._space=t;this.callLater(this.changeItems)});R(0,e,"align",function(){return this._align},function(t){this._align=t;this.callLater(this.changeItems)});return i}(c);w=function(t){function i(){this.selectHandler=null;this.renderHandler=null;this.mouseHandler=null;this.selectEnable=!1;this.totalPage=0;this._content=null;this._scrollBar=null;this._itemRender=null;this._repeatX=0;this._repeatY=0;this._repeatX2=0;this._repeatY2=0;this._spaceX=0;this._spaceY=0;this._array=null;this._startIndex=0;this._selectedIndex=-1;this._page=0;this._isVertical=!0;this._cellSize=20;this._cellOffset=0;this._isMoved=!1;this._cacheBox=null;this.cacheContent=!1;i.__super.call(this);this._cells=[]}V(i,"laya.ui.List",t);var s=i.prototype;e.imps(s,{"laya.ui.IItem":!0,"laya.ui.IRender":!0});s.destroy=function(t){void 0===t&&(t=!0);laya.ui.Component.prototype.destroy.call(this,t);this._content&&this._content.destroy(t);this._scrollBar&&this._scrollBar.destroy(t);this._content=null;this._scrollBar=null;this._itemRender=null;this._cells=null;this._array=null;this.selectHandler=this.renderHandler=this.mouseHandler=null};s.createChildren=function(){this.addChild(this._content=new c)};s.onMouseDown=function(){this._$P.cacheAs=t.prototype._$get_cacheAs.call(this);t.prototype._$set_cacheAs.call(this,"none");this._scrollBar&&this._scrollBar.once("end",this,this.onScrollEnd)};s.onScrollEnd=function(){t.prototype._$set_cacheAs.call(this,this._$P.cacheAs)};s.changeCells=function(){var t,i,e,s,h,n,l,o;if(this._itemRender){for(t=this._cells.length-1;t>-1;t--)this._cells[t].destroy();this._cells.length=0;this.scrollBar=this.getChildByName("scrollBar");i=this.createItem();e=i.width+this._spaceX;s=i.height+this._spaceY;this._width>0&&(this._repeatX2=this._isVertical?Math.round(this._width/e):Math.ceil(this._width/e));this._height>0&&(this._repeatY2=this._isVertical?Math.ceil(this._height/s):Math.round(this._height/s));h=this._width?this._width:e*this.repeatX-this._spaceX;n=this._height?this._height:s*this.repeatY-this._spaceY;this._cellSize=this._isVertical?s:e;this._cellOffset=this._isVertical?s*Math.max(this._repeatY2,this._repeatY)-n-this._spaceY:e*Math.max(this._repeatX2,this._repeatX)-h-this._spaceX;this._isVertical&&this._scrollBar?this._scrollBar.height=n:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=h);this.setContentSize(h,n);l=this._isVertical?this.repeatX:this.repeatY;o=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,l,o);if(this._array){this.array=this._array;this.runCallLater(this.renderItems)}}};s._createItems=function(t,i,e){var s,h,n,l=this._content;if(this.cacheContent){if(!this._cacheBox){this._content.addChild(this._cacheBox=new c);this._cacheBox.cacheAsBitmap=!0}l=this._cacheBox}for(s=t;s<e;s++)for(h=0;h<i;h++){n=this.createItem();n.x=(this._isVertical?h:s)*(n.width+this._spaceX);n.y=(this._isVertical?s:h)*(n.height+this._spaceY);n.name="item"+(s*i+h);l.addChild(n);this.addCell(n)}};s.createItem=function(){return"function"==typeof this._itemRender?new this._itemRender:v.createComp(this._itemRender)};s.addCell=function(t){t.on("click",this,this.onCellMouse);t.on("rightclick",this,this.onCellMouse);t.on("mouseover",this,this.onCellMouse);t.on("mouseout",this,this.onCellMouse);t.on("mousedown",this,this.onCellMouse);t.on("mouseup",this,this.onCellMouse);this._cells.push(t)};s.initItems=function(){var t,i;if(!this._itemRender)for(t=0;t<1e4;t++){i=this.getChildByName("item"+t);if(!i)break;this.addCell(i)}};s.setContentSize=function(t,i){this._content.width=t;this._content.height=i;if(this._scrollBar){this._content.scrollRect||(this._content.scrollRect=new it);this._content.scrollRect.setTo(0,0,t,i);this.event("resize")}};s.onCellMouse=function(t){var i,e;"mousedown"===t.type&&(this._isMoved=!1);i=t.currentTarget;e=this._startIndex+this._cells.indexOf(i);if(!(e<0)){"click"===t.type||"rightclick"===t.type?this.selectEnable&&!this._isMoved?this.selectedIndex=e:this.changeCellState(i,!0,0):"mouseover"!==t.type&&"mouseout"!==t.type||this._selectedIndex===e||this.changeCellState(i,"mouseover"===t.type,0);this.mouseHandler&&this.mouseHandler.runWith([t,e])}};s.changeCellState=function(t,i,e){var s=t.getChildByName("selectBox");if(s){this.selectEnable=!0;s.visible=i;s.index=e}};s.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this);this._scrollBar&&e.timer.once(10,this,this.onScrollBarChange)};s.onScrollBarChange=function(t){var i,e,s,h,n,l,o,r,a,c,u;this.runCallLater(this.changeCells);i=this._scrollBar.value;if(!this.cacheContent){e=this._isVertical?this.repeatX:this.repeatY;s=this._isVertical?this.repeatY:this.repeatX;h=Math.floor(i/this._cellSize)*e;if(h>this._startIndex){n=h-this._startIndex;l=!0;o=this._startIndex+e*(s+1);this._isMoved=!0}else if(h<this._startIndex){n=this._startIndex-h;l=!1;o=this._startIndex-1;this._isMoved=!0}for(r=0;r<n;r++){if(l){a=this._cells.shift();this._cells[this._cells.length]=a;c=o+r}else{a=this._cells.pop();this._cells.unshift(a);c=o-r}u=Math.floor(c/e)*this._cellSize;this._isVertical?a.y=u:a.x=u;this.renderItem(a,c)}this._startIndex=h}this._isVertical?this._content.scrollRect.y=i:this._content.scrollRect.x=i;this.repaint()};s.posCell=function(t,i){var e,s,h;if(this._scrollBar){e=this._isVertical?this.repeatX:this.repeatY;s=this._isVertical?this.repeatY:this.repeatX;h=Math.floor(i/e)*this._cellSize;this._isVertical?t.y=h:t.x=h}};s.changeSelectStatus=function(){for(var t=0,i=this._cells.length;t<i;t++)this.changeCellState(this._cells[t],this._selectedIndex===this._startIndex+t,1)};s.renderItems=function(){for(var t=0,i=this._cells.length;t<i;t++)this.renderItem(this._cells[t],this._startIndex+t);this.changeSelectStatus()};s.renderItem=function(t,i){if(i>=0&&i<this._array.length){t.visible=!0;t.dataSource=this._array[i];this.posCell(t,i)}else{t.visible=!1;t.dataSource=null}this.event("render",[t,i]);
this.renderHandler&&this.renderHandler.runWith([t,i])};s.refresh=function(){this.array=this._array};s.getItem=function(t){return t>-1&&t<this._array.length?this._array[t]:null};s.changeItem=function(t,i){if(t>-1&&t<this._array.length){this._array[t]=i;t>=this._startIndex&&t<this._startIndex+this._cells.length&&this.renderItem(this.getCell(t),t)}};s.addItem=function(t){this._array.push(t);this.array=this._array};s.addItemAt=function(t,i){this._array.splice(i,0,t);this.array=this._array};s.deleteItem=function(t){this._array.splice(t,1);this.array=this._array};s.getCell=function(t){this.runCallLater(this.changeCells);return t>-1&&this._cells?this._cells[(t-this._startIndex)%this._cells.length]:null};s.scrollTo=function(t){if(this._scrollBar){var i=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor(t/i)*this._cellSize}else this.startIndex=t};s.tweenTo=function(t,i){void 0===i&&(i=200);if(this._scrollBar){var e=this._isVertical?this.repeatX:this.repeatY;et.to(this._scrollBar,{value:Math.floor(t/e)*this._cellSize},i,null,null,0,!0)}else this.startIndex=t};R(0,s,"cacheAs",t.prototype._$get_cacheAs,function(i){t.prototype._$set_cacheAs.call(this,i);this._scrollBar&&("none"!==i?this.on("mousedown",this,this.onMouseDown):this.off("mousedown",this,this.onMouseDown))});R(0,s,"content",function(){return this._content});R(0,s,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(t){this.removeChildByName("scrollBar");var i=new k;i.name="scrollBar";i.bottom=0;i.skin=t;this.scrollBar=i;this.addChild(i);this.callLater(this.changeCells)});R(0,s,"height",t.prototype._$get_height,function(i){t.prototype._$set_height.call(this,i);this.callLater(this.changeCells)});R(0,s,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(t){this.removeChildByName("scrollBar");var i=new P;i.name="scrollBar";i.right=0;i.skin=t;this.scrollBar=i;this.addChild(i);this.callLater(this.changeCells)});R(0,s,"itemRender",function(){return this._itemRender},function(t){this._itemRender=t;this.callLater(this.changeCells)});R(0,s,"scrollBar",function(){return this._scrollBar},function(t){if(this._scrollBar!=t){this._scrollBar=t;if(t){this.addChild(this._scrollBar);this._scrollBar.on("change",this,this.onScrollBarChange);this._isVertical=this._scrollBar.isVertical}}});R(0,s,"selectedIndex",function(){return this._selectedIndex},function(t){if(this._selectedIndex!=t){this._selectedIndex=t;this.changeSelectStatus();this.event("change");this.selectHandler&&this.selectHandler.runWith(t)}if(this.selectEnable&&this._scrollBar){var i=this._isVertical?this.repeatX:this.repeatY;(t<this._startIndex||t+i>this._startIndex+this.repeatX*this.repeatY)&&this.scrollTo(t)}});R(0,s,"width",t.prototype._$get_width,function(i){t.prototype._$set_width.call(this,i);this.callLater(this.changeCells)});R(0,s,"repeatX",function(){return this._repeatX>0?this._repeatX:this._repeatX2>0?this._repeatX2:1},function(t){this._repeatX=t;this.callLater(this.changeCells)});R(0,s,"repeatY",function(){return this._repeatY>0?this._repeatY:this._repeatY2>0?this._repeatY2:1},function(t){this._repeatY=t;this.callLater(this.changeCells)});R(0,s,"spaceX",function(){return this._spaceX},function(t){this._spaceX=t;this.callLater(this.changeCells)});R(0,s,"array",function(){return this._array},function(t){var i,e,s,h,n,l,o,r;this.runCallLater(this.changeCells);this._array=t||[];if(this.cacheContent&&t.length>this._cells.length){i=this._isVertical?this.repeatX:this.repeatY;e=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);s=Math.ceil(t.length/i);this._createItems(e,i,s)}h=this._array.length;this.totalPage=Math.ceil(h/(this.repeatX*this.repeatY));this._selectedIndex=this._selectedIndex<h?this._selectedIndex:h-1;this.startIndex=this._startIndex;if(this._scrollBar){n=this._isVertical?this.repeatX:this.repeatY;l=this._isVertical?this.repeatY:this.repeatX;o=Math.ceil(h/n);r=this._cellOffset>0?this.totalPage+1:this.totalPage;if(r>1){this._scrollBar.scrollSize=this._cellSize;this._scrollBar.thumbPercent=l/o;this._scrollBar.setScroll(0,(o-l)*this._cellSize+this._cellOffset,this._isVertical?this._content.scrollRect.y:this._content.scrollRect.x);this._scrollBar.target=this._content}else{this._scrollBar.setScroll(0,0,0);this._scrollBar.target=this._content}}});R(0,s,"spaceY",function(){return this._spaceY},function(t){this._spaceY=t;this.callLater(this.changeCells)});R(0,s,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function(t){this.selectedIndex=this._array.indexOf(t)});R(0,s,"selection",function(){return this.getCell(this._selectedIndex)},function(t){this.selectedIndex=this._startIndex+this._cells.indexOf(t)});R(0,s,"startIndex",function(){return this._startIndex},function(t){this._startIndex=t>0?t:0;this.callLater(this.renderItems)});R(0,s,"page",function(){return this._page},function(t){this._page=t;if(this._array){this._page=t>0?t:0;this._page=this._page<this.totalPage?this._page:this.totalPage-1;this.startIndex=this._page*this.repeatX*this.repeatY}});R(0,s,"length",function(){return this._array.length});R(0,s,"dataSource",t.prototype._$get_dataSource,function(i){this._dataSource=i;"number"==typeof i&&Math.floor(i)==i||"string"==typeof i?this.selectedIndex=e.__parseInt(i):i instanceof Array?this.array=i:t.prototype._$set_dataSource.call(this,i)});R(0,s,"cells",function(){this.runCallLater(this.changeCells);return this._cells});return i}(c);B=function(t){function i(){this._content=null;this._vScrollBar=null;this._hScrollBar=null;i.__super.call(this);this.width=this.height=100;this._content.optimizeFloat=!0}V(i,"laya.ui.Panel",t);var e=i.prototype;e.destroy=function(t){void 0===t&&(t=!0);laya.ui.Component.prototype.destroy.call(this,t);this._content&&this._content.destroy(t);this._vScrollBar&&this._vScrollBar.destroy(t);this._hScrollBar&&this._hScrollBar.destroy(t);this._vScrollBar=null;this._hScrollBar=null;this._content=null};e.destroyChildren=function(){this._content.destroyChildren()};e.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new c)};e.addChild=function(t){t.on("resize",this,this.onResize);this.callLater(this.changeScroll);return this._content.addChild(t)};e.onResize=function(t){this.callLater(this.changeScroll)};e.addChildAt=function(t,i){t.on("resize",this,this.onResize);this.callLater(this.changeScroll);return this._content.addChildAt(t,i)};e.removeChild=function(t){t.off("resize",this,this.onResize);this.callLater(this.changeScroll);return this._content.removeChild(t)};e.removeChildAt=function(t){this.getChildAt(t).off("resize",this,this.onResize);this.callLater(this.changeScroll);return this._content.removeChildAt(t)};e.removeChildren=function(t,i){void 0===t&&(t=0);void 0===i&&(i=2147483647);for(var e=this._content.numChildren-1;e>-1;e--)this._content.removeChildAt(e);this.callLater(this.changeScroll);return this};e.getChildAt=function(t){return this._content.getChildAt(t)};e.getChildByName=function(t){return this._content.getChildByName(t)};e.getChildIndex=function(t){return this._content.getChildIndex(t)};e.changeScroll=function(){var t=this.contentWidth,i=this.contentHeight,e=this._vScrollBar,s=this._hScrollBar,h=e&&i>this._height,n=s&&t>this._width,l=h?this._width-e.width:this._width,o=n?this._height-s.height:this._height;if(e){e.x=this._width-e.width;e.y=0;e.height=this._height-(n?s.height:0);e.scrollSize=Math.max(.033*this._height,1);e.thumbPercent=o/i;e.setScroll(0,i-o,e.value)}if(s){s.x=0;s.y=this._height-s.height;s.width=this._width-(h?e.width:0);s.scrollSize=Math.max(.033*this._width,1);s.thumbPercent=l/t;s.setScroll(0,t-l,s.value)}};e.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this);this.setContentSize(this._width,this._height)};e.setContentSize=function(t,i){var e=this._content;e.width=t;e.height=i;e.scrollRect||(e.scrollRect=new it);e.scrollRect.setTo(0,0,t,i)};e.onScrollBarChange=function(t,i){var e,s=this._content.scrollRect;if(s){e=Math.round(t.value);t.isVertical?s.y=e:s.x=e}};e.scrollTo=function(t,i){void 0===t&&(t=0);void 0===i&&(i=0);this.vScrollBar&&(this.vScrollBar.value=i);this.hScrollBar&&(this.hScrollBar.value=t)};e.refresh=function(){this.changeScroll()};e.onMouseDown=function(){this._$P.cacheAs=t.prototype._$get_cacheAs.call(this);t.prototype._$set_cacheAs.call(this,"none");this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd);this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)};e.onScrollEnd=function(){t.prototype._$set_cacheAs.call(this,this._$P.cacheAs)};R(0,e,"numChildren",function(){return this._content.numChildren});R(0,e,"contentWidth",function(){var t,i,e=0;for(t=this._content.numChildren-1;t>-1;t--){i=this._content.getChildAt(t);e=Math.max(i.x+i.width*i.scaleX,e)}return e});R(0,e,"contentHeight",function(){var t,i,e=0;for(t=this._content.numChildren-1;t>-1;t--){i=this._content.getChildAt(t);e=Math.max(i.y+i.height*i.scaleY,e)}return e});R(0,e,"vScrollBar",function(){return this._vScrollBar});R(0,e,"width",t.prototype._$get_width,function(i){t.prototype._$set_width.call(this,i);this.callLater(this.changeScroll)});R(0,e,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(t){if(null==this._hScrollBar){laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new k);this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]);this._hScrollBar.target=this._content;this.callLater(this.changeScroll)}this._hScrollBar.skin=t});R(0,e,"height",t.prototype._$get_height,function(i){t.prototype._$set_height.call(this,i);this.callLater(this.changeScroll)});R(0,e,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(t){if(null==this._vScrollBar){laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new P);this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]);this._vScrollBar.target=this._content;this.callLater(this.changeScroll)}this._vScrollBar.skin=t});R(0,e,"hScrollBar",function(){return this._hScrollBar});R(0,e,"content",function(){return this._content});R(0,e,"cacheAs",t.prototype._$get_cacheAs,function(i){t.prototype._$set_cacheAs.call(this,i);"none"!==i?this.on("mousedown",this,this.onMouseDown):this.off("mousedown",this,this.onMouseDown)});return i}(c);k=function(t){function i(){i.__super.call(this)}V(i,"laya.ui.HScrollBar",t);var e=i.prototype;e.initialize=function(){t.prototype.initialize.call(this);this._slider.isVertical=!1};return i}(p);I=function(t){function i(t,e){this._value=null;void 0===e&&(e="");i.__super.call(this,t,e)}V(i,"laya.ui.Radio",t);var e=i.prototype;e.destroy=function(i){void 0===i&&(i=!0);t.prototype.destroy.call(this,i);this._value=null};e.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this);this.toggle=!1;this._autoSize=!1};e.initialize=function(){t.prototype.initialize.call(this);this._text.align="left";this._text.valign="top";this._text.width=0;this.on("click",this,this.onClick)};e.onClick=function(t){this.selected=!0};R(0,e,"value",function(){return null!=this._value?this._value:this.label},function(t){this._value=t});return i}(u);L=function(t){function i(t){i.__super.call(this,t);this.isVertical=!1}V(i,"laya.ui.HSlider",t);return i}(g);z=function(t){function i(){this._list=null;this._source=null;this._renderHandler=null;this._spaceLeft=10;this._spaceBottom=0;this._keepStatus=!0;i.__super.call(this);this.width=this.height=200}V(i,"laya.ui.Tree",t);var s=i.prototype;e.imps(s,{"laya.ui.IRender":!0});s.destroy=function(t){void 0===t&&(t=!0);laya.ui.Component.prototype.destroy.call(this,t);this._list&&this._list.destroy(t);this._list=null;this._source=null;this._renderHandler=null};s.createChildren=function(){this.addChild(this._list=new w);this._list.renderHandler=U.create(this,this.renderItem,null,!1);this._list.repeatX=1;this._list.on("change",this,this.onListChange)};s.onListChange=function(t){this.event("change")};s.getArray=function(){var t,i,e=[];for(i in this._source){t=this._source[i];if(this.getParentOpenStatus(t)){t.x=this._spaceLeft*this.getDepth(t);e.push(t)}}return e};s.getDepth=function(t,i){void 0===i&&(i=0);return null==t.nodeParent?i:this.getDepth(t.nodeParent,i+1)};s.getParentOpenStatus=function(t){var i=t.nodeParent;return null==i?!0:i.isOpen?null!=i.nodeParent?this.getParentOpenStatus(i):!0:!1};s.renderItem=function(t,i){var e,s,h=t.dataSource;if(h){t.left=h.x;e=t.getChildByName("arrow");if(e)if(h.hasChild){e.visible=!0;e.index=h.isOpen?1:0;e.tag=i;e.off("click",this,this.onArrowClick);e.on("click",this,this.onArrowClick)}else e.visible=!1;s=t.getChildByName("folder");s&&(2==s.clipY?s.index=h.isDirectory?0:1:s.index=h.isDirectory?h.isOpen?1:0:2);this._renderHandler&&this._renderHandler.runWith([t,i])}};s.onArrowClick=function(t){var i=t.currentTarget,e=i.tag;this._list.array[e].isOpen=!this._list.array[e].isOpen;this._list.array=this.getArray()};s.setItemState=function(t,i){if(this._list.array[t]){this._list.array[t].isOpen=i;this._list.array=this.getArray()}};s.fresh=function(){this._list.array=this.getArray();this.repaint()};s.parseXml=function(t,i,e,s){var h,n,l,o,r,a,c,u,_=t.childNodes,d=_.length;if(!s){h={};n=t.attributes;for(o in n){l=n[o];r=l.nodeName;a=l.nodeValue;h[r]="true"==a?!0:"false"==a?!1:a}h.nodeParent=e;d>0&&(h.isDirectory=!0);h.hasChild=d>0;i.push(h)}for(c=0;c<d;c++){u=_[c];this.parseXml(u,i,h,!1)}};s.parseOpenStatus=function(t,i){var e,s,h,n,l,o;for(e=0,s=i.length;e<s;e++){h=i[e];if(h.isDirectory)for(n=0,l=t.length;n<l;n++){o=t[n];if(o.isDirectory&&this.isSameParent(o,h)&&h.label==o.label){h.isOpen=o.isOpen;break}}}};s.isSameParent=function(t,i){return null==t.nodeParent&&null==i.nodeParent?!0:null==t.nodeParent||null==i.nodeParent?!1:t.nodeParent.label==i.nodeParent.label?this.isSameParent(t.nodeParent,i.nodeParent):!1};s.filter=function(t){if(Boolean(t)){var i=[];this.getFilterSource(this._source,i,t);this._list.array=i}else this._list.array=this.getArray()};s.getFilterSource=function(t,i,e){var s,h;e=e.toLocaleLowerCase();for(h in t){s=t[h];if(!s.isDirectory&&String(s.label).toLowerCase().indexOf(e)>-1){s.x=0;i.push(s)}s.child&&s.child.length>0&&this.getFilterSource(s.child,i,e)}};R(0,s,"keepStatus",function(){return this._keepStatus},function(t){this._keepStatus=t});R(0,s,"list",function(){return this._list});R(0,s,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function(t){this._list.vScrollBarSkin=t});R(0,s,"array",function(){return this._list.array},function(t){this._keepStatus&&this._list.array&&t&&this.parseOpenStatus(this._list.array,t);this._source=t;this._list.array=this.getArray()});R(0,s,"selectedItem",function(){return this._list.selectedItem},function(t){this._list.selectedItem=t});R(0,s,"source",function(){return this._source});R(0,s,"itemRender",function(){return this._list.itemRender},function(t){this._list.itemRender=t});R(0,s,"scrollBar",function(){return this._list.scrollBar});R(0,s,"mouseHandler",function(){return this._list.mouseHandler},function(t){this._list.mouseHandler=t});R(0,s,"renderHandler",function(){return this._renderHandler},function(t){this._renderHandler=t});R(0,s,"spaceLeft",function(){return this._spaceLeft},function(t){this._spaceLeft=t});R(0,s,"spaceBottom",function(){return this._list.spaceY},function(t){this._list.spaceY=t});R(0,s,"selectedIndex",function(){return this._list.selectedIndex},function(t){this._list.selectedIndex=t});R(0,s,"width",t.prototype._$get_width,function(i){t.prototype._$set_width.call(this,i);this._list.width=i});R(0,s,"height",t.prototype._$get_height,function(i){t.prototype._$set_height.call(this,i);this._list.height=i});R(0,s,"dataSource",t.prototype._$get_dataSource,function(i){this._dataSource=i;e.__typeof(i,laya.ui.XmlDom)?this.xml=i:t.prototype._$set_dataSource.call(this,i)});R(0,s,"xml",null,function(t){var i=[];this.parseXml(t.childNodes[0],i,null,!0);this.array=i});R(0,s,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null});return i}(c);M=function(t){function i(){this._items=null;this._selectedIndex=0;i.__super.call(this);this._setIndexHandler=U.create(this,this.setIndex,null,!1)}V(i,"laya.ui.ViewStack",t);var s=i.prototype;e.imps(s,{"laya.ui.IItem":!0});s.setItems=function(t){var i,e,s,h;this.removeChildren();i=0;for(e=0,s=t.length;e<s;e++){h=t[e];if(h){h.name="item"+i;this.addChild(h);i++}}this.initItems()};s.addItem=function(t){t.name="item"+this._items.length;this.addChild(t);this.initItems()};s.initItems=function(){var t,i;this._items=[];for(t=0;t<1e4;t++){i=this.getChildByName("item"+t);if(null==i)break;this._items.push(i);i.visible=t==this._selectedIndex}};s.setSelect=function(t,i){this._items&&t>-1&&t<this._items.length&&(this._items[t].visible=i)};s.setIndex=function(t){this.selectedIndex=t};R(0,s,"selectedIndex",function(){return this._selectedIndex},function(t){if(this._selectedIndex!=t){this.setSelect(this._selectedIndex,!1);this._selectedIndex=t;this.setSelect(this._selectedIndex,!0)}});R(0,s,"selection",function(){return this._selectedIndex>-1&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(t){this.selectedIndex=this._items.indexOf(t)});R(0,s,"setIndexHandler",function(){return this._setIndexHandler},function(t){this._setIndexHandler=t});R(0,s,"items",function(){return this._items});R(0,s,"dataSource",t.prototype._$get_dataSource,function(t){this._dataSource=t;if("number"==typeof t&&Math.floor(t)==t||"string"==typeof t)this.selectedIndex=int(t);else for(var i in this._dataSource)this.hasOwnProperty(i)&&(this[i]=this._dataSource[i])});return i}(c);P=function(t){function i(){i.__super.call(this)}V(i,"laya.ui.VScrollBar",t);return i}(p);N=function(t){function i(t){this._bg=null;this._skin=null;i.__super.call(this);void 0===t&&(t="");this.text=t;this.skin=this.skin}V(i,"laya.ui.TextInput",t);var e=i.prototype;e.preinitialize=function(){this.mouseEnabled=!0};e.destroy=function(i){void 0===i&&(i=!0);t.prototype.destroy.call(this,i);this._bg&&this._bg.destroy();this._bg=null};e.createChildren=function(){this.addChild(this._tf=new Q);this._tf.padding=h.inputLabelPadding;this._tf.on("input",this,this.onInput);this._tf.on("enter",this,this.onEnter);this._tf.on("blur",this,this.onBlur);this._tf.on("focus",this,this.onFocus)};e.onFocus=function(t){this.event("focus",this)};e.onBlur=function(t){this.event("blur",this)};e.onInput=function(t){this.event("input",this)};e.onEnter=function(t){this.event("enter",this)};e.initialize=function(){this.width=128;this.height=22};e.select=function(){this._tf.select()};R(0,e,"bg",function(){return this._bg},function(t){this.graphics=this._bg=t});R(0,e,"editable",function(){return this._tf.editable},function(t){this._tf.editable=t});R(0,e,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster},function(t){this._tf.inputElementYAdjuster=t});R(0,e,"height",t.prototype._$get_height,function(i){t.prototype._$set_height.call(this,i);this._bg&&(this._bg.height=i)});R(0,e,"skin",function(){return this._skin},function(t){if(this._skin!=t){this._skin=t;this._bg||(this.graphics=this._bg=new o);this._bg.source=G.getRes(this._skin);this._width&&(this._bg.width=this._width);this._height&&(this._bg.height=this._height)}});R(0,e,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function(t){this._bg||(this.graphics=this._bg=new o);this._bg.sizeGrid=n.fillArray(h.defaultSizeGrid,t,Number)});R(0,e,"title",function(){return this._tf.title},function(t){this._tf.title=t});R(0,e,"width",t.prototype._$get_width,function(i){t.prototype._$set_width.call(this,i);this._bg&&(this._bg.width=i)});R(0,e,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster},function(t){this._tf.inputElementXAdjuster=t});R(0,e,"multiline",function(){return this._tf.multiline},function(t){this._tf.multiline=t});R(0,e,"restrict",function(){return this._tf.restrict},function(t){this._tf.restrict=t});R(0,e,"clearOnFocus",function(){return this._tf.clearOnFocus},function(t){this._tf.clearOnFocus=t});R(0,e,"maxChars",function(){return this._tf.maxChars},function(t){this._tf.maxChars=t});return i}(y);H=function(t){function i(){i.__super.call(this)}V(i,"laya.ui.VSlider",t);return i}(g);T=function(t){function i(){this.popupCenter=!0;this.closeHandler=null;this._dragArea=null;i.__super.call(this)}var s,h;V(i,"laya.ui.Dialog",t);h=i.prototype;h.initialize=function(){var t=this.getChildByName("drag");if(t){this.dragArea=t.x+","+t.y+","+t.width+","+t.height;t.removeSelf()}this.on("click",this,this.onClick)};h.onClick=function(t){var i=t.target;if(i)switch(i.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close(i.name)}};h.show=function(t){void 0===t&&(t=!1);i.manager.show(this,t)};h.popup=function(t){void 0===t&&(t=!1);i.manager.popup(this,t)};h.close=function(t){i.manager.close(this);this.closeHandler&&this.closeHandler.runWith(t)};h.onMouseDown=function(t){var i=this.getMousePoint();this._dragArea.contains(i.x,i.y)?this.startDrag():this.stopDrag()};R(0,h,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function(t){if(t){var i=n.fillArray([0,0,0,0],t,Number);this._dragArea=new it(i[0],i[1],i[2],i[3]);this.on("mousedown",this,this.onMouseDown)}else{this._dragArea=null;this.off("mousedown",this,this.onMouseDown)}});R(0,h,"isPopup",function(){return null!=this.parent});R(1,i,"manager",function(){return i._manager||(i._manager=new s)},laya.ui.View._$SET_manager);i.closeAll=function(){i.manager.closeAll()};i.CLOSE="close";i.CANCEL="cancel";i.SURE="sure";i.NO="no";i.OK="ok";i.YES="yes";i._manager=null;i.__init$=function(){s=function(t){function i(){this._stage=null;i.__super.call(this);this.dialogLayer=new K;this.modalLayer=new K;this.mouseEnabled=this.dialogLayer.mouseEnabled=this.modalLayer.mouseEnabled=!0;this.addChild(this.dialogLayer);this._stage=e.stage;this._stage.addChild(this);this._stage.on("resize",this,this.onResize);this.onResize(null)}V(i,"",t);var s=i.prototype;s.onResize=function(t){var i,e,s=this.modalLayer.width=this._stage.width,h=this.modalLayer.height=this._stage.height;this.modalLayer.graphics.clear();this.modalLayer.graphics.alpha(l.popupBgAlpha);this.modalLayer.graphics.drawRect(0,0,s,h,l.popupBgColor);this.modalLayer.graphics.alpha(1);for(i=this.dialogLayer.numChildren-1;i>-1;i--){e=this.dialogLayer.getChildAt(i);if(e.popupCenter){e.x=.5*(s-e.width);e.y=.5*(h-e.height)}}for(i=this.modalLayer.numChildren-1;i>-1;i--){e=this.modalLayer.getChildAt(i);if(e.isPopup&&e.popupCenter){e.x=.5*(s-e.width);e.y=.5*(h-e.height)}}};s.show=function(t,i){void 0===i&&(i=!1);i&&this.dialogLayer.removeChildren();if(t.popupCenter){t.x=.5*(this._stage.width-t.width);t.y=.5*(this._stage.height-t.height)}this.dialogLayer.addChild(t);this.event("open")};s.popup=function(t,i){void 0===i&&(i=!1);i&&this.modalLayer.removeChildren();if(t.popupCenter){t.x=.5*(this._stage.width-t.width);t.y=.5*(this._stage.height-t.height)}this.modalLayer.addChild(t);this.addChild(this.modalLayer);this.event("open")};s.close=function(t){t.removeSelf();0===this.modalLayer.numChildren?this.modalLayer.removeSelf():this.showFirst();this.event("close")};s.showFirst=function(){for(var t=0,i=this.modalLayer.numChildren-1;t<=i;t++)this.modalLayer.getChildAt(t).visible=t===i};s.closeAll=function(){this.dialogLayer.removeChildren();this.modalLayer.removeChildren();this.modalLayer.removeSelf();this.event("close")};return i}(K)};return i}(v);$=function(t){function i(){i.__super.call(this)}V(i,"laya.ui.HBox",t);var e=i.prototype;e.sortItem=function(t){t&&t.sort(function(t,i){return t.x>i.x?1:-1})};e.changeItems=function(){var t,i,e,s,h,n=[],l=0;for(t=0,i=this.numChildren;t<i;t++){e=this.getChildAt(t);if(e){n.push(e);l=Math.max(l,e.displayHeight)}}this.sortItem(n);s=0;for(h in n){e=n[h];e.x=s;s+=e.displayWidth+this._space;"top"==this._align?e.y=0:"middle"==this._align?e.y=.5*(l-e.displayHeight):"bottom"==this._align&&(e.y=l-e.displayHeight)}this.changeSize()};i.NONE="none";i.TOP="top";i.MIDDLE="middle";i.BOTTOM="bottom";return i}(x);O=function(t){function i(){i.__super.call(this)}V(i,"laya.ui.RadioGroup",t);var e=i.prototype;e.createItem=function(t,i){return new I(t,i)};return i}(S);A=function(t){function i(){i.__super.call(this)}V(i,"laya.ui.Tab",t);var e=i.prototype;e.createItem=function(t,i){return new u(t,i)};return i}(S);Y=function(t){function i(){i.__super.call(this)}V(i,"laya.ui.VBox",t);var e=i.prototype;e.changeItems=function(){var t,i,e,s,h,n=[],l=0;for(t=0,i=this.numChildren;t<i;t++){e=this.getChildAt(t);if(e){n.push(e);l=Math.max(l,e.displayWidth)}}this.sortItem(n);s=0;for(h in n){e=n[h];e.y=s;s+=e.displayHeight+this._space;"left"==this._align?e.x=0:"center"==this._align?e.x=.5*(l-e.displayWidth):"right"==this._align&&(e.x=l-e.displayWidth)}this.changeSize()};i.NONE="none";i.LEFT="left";i.CENTER="center";i.RIGHT="right";return i}(x);E=function(t){function i(t){void 0===t&&(t="");i.__super.call(this,t);this.multiline=!0}V(i,"laya.ui.TextArea",t);return i}(N);e.__init([T])}(window,document,Laya);
!function(e){if("object"===typeof exports&&"undefined"!==typeof module)module.exports=e();else if("function"===typeof define&&define.amd)define([],e);else{var t;t="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this;t.Matter=e()}}(function(){return function e(t,o,n){function i(r,a){var l,c,d;if(!o[r]){if(!t[r]){l="function"==typeof require&&require;if(!a&&l)return l(r,!0);if(s)return s(r,!0);c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}d=o[r]={exports:{}};t[r][0].call(d.exports,function(e){var o=t[r][1][e];return i(o?o:e)},d,d.exports,e,t,o,n)}return o[r].exports}var r,s="function"==typeof require&&require;for(r=0;r<n.length;r++)i(n[r]);return i}({1:[function(e,t,o){var n,i,r,s,a,l,c,d={};t.exports=d;n=e("../geometry/Vertices");i=e("../geometry/Vector");r=e("../core/Sleeping");s=e("../render/Render");a=e("../core/Common");l=e("../geometry/Bounds");c=e("../geometry/Axes");!function(){var e,t;d._inertiaScale=4;d._nextCollidingGroupId=1;d._nextNonCollidingGroupId=-1;d._nextCategory=1;d.create=function(t){var o={id:a.nextId(),type:"body",label:"Body",parts:[],angle:0,vertices:n.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0},lineWidth:1.5}},i=a.extend(o,t);e(i,t);return i};d.nextGroup=function(e){return e?d._nextNonCollidingGroupId--:d._nextCollidingGroupId++};d.nextCategory=function(){d._nextCategory=d._nextCategory<<1;return d._nextCategory};e=function(e,t){d.set(e,{bounds:e.bounds||l.create(e.vertices),positionPrev:e.positionPrev||i.clone(e.position),anglePrev:e.anglePrev||e.angle,vertices:e.vertices,parts:e.parts||[e],isStatic:e.isStatic,isSleeping:e.isSleeping,parent:e.parent||e});n.rotate(e.vertices,e.angle,e.position);c.rotate(e.axes,e.angle);l.update(e.bounds,e.vertices,e.velocity);d.set(e,{axes:t.axes||e.axes,area:t.area||e.area,mass:t.mass||e.mass,inertia:t.inertia||e.inertia});var o=e.isStatic?"#eeeeee":a.choose(["#556270","#4ECDC4","#C7F464","#FF6B6B","#C44D58"]),r=a.shadeColor(o,-20);e.render.fillStyle=e.render.fillStyle||o;e.render.strokeStyle=e.render.strokeStyle||r;e.render.sprite.xOffset+=-(e.bounds.min.x-e.position.x)/(e.bounds.max.x-e.bounds.min.x);e.render.sprite.yOffset+=-(e.bounds.min.y-e.position.y)/(e.bounds.max.y-e.bounds.min.y)};d.set=function(e,t,o){var n;if("string"===typeof t){n=t;t={};t[n]=o}for(n in t){o=t[n];if(t.hasOwnProperty(n))switch(n){case"isStatic":d.setStatic(e,o);break;case"isSleeping":r.set(e,o);break;case"mass":d.setMass(e,o);break;case"density":d.setDensity(e,o);break;case"inertia":d.setInertia(e,o);break;case"vertices":d.setVertices(e,o);break;case"position":d.setPosition(e,o);break;case"angle":d.setAngle(e,o);break;case"velocity":d.setVelocity(e,o);break;case"angularVelocity":d.setAngularVelocity(e,o);break;case"parts":d.setParts(e,o);break;default:e[n]=o}}};d.setStatic=function(e,t){var o,n;for(o=0;o<e.parts.length;o++){n=e.parts[o];n.isStatic=t;if(t){n.restitution=0;n.friction=1;n.mass=n.inertia=n.density=1/0;n.inverseMass=n.inverseInertia=0;n.positionPrev.x=n.position.x;n.positionPrev.y=n.position.y;n.anglePrev=n.angle;n.angularVelocity=0;n.speed=0;n.angularSpeed=0;n.motion=0}}};d.setMass=function(e,t){e.mass=t;e.inverseMass=1/e.mass;e.density=e.mass/e.area};d.setDensity=function(e,t){d.setMass(e,t*e.area);e.density=t};d.setInertia=function(e,t){e.inertia=t;e.inverseInertia=1/e.inertia};d.setVertices=function(e,t){t[0].body===e?e.vertices=t:e.vertices=n.create(t,e);e.axes=c.fromVertices(e.vertices);e.area=n.area(e.vertices);d.setMass(e,e.density*e.area);var o=n.centre(e.vertices);n.translate(e.vertices,o,-1);d.setInertia(e,d._inertiaScale*n.inertia(e.vertices,e.mass));n.translate(e.vertices,e.position);l.update(e.bounds,e.vertices,e.velocity)};d.setParts=function(e,o,i){var r,s,a,l,c,u;o=o.slice(0);e.parts.length=0;e.parts.push(e);e.parent=e;for(r=0;r<o.length;r++){s=o[r];if(s!==e){s.parent=e;e.parts.push(s)}}if(1!==e.parts.length){i="undefined"!==typeof i?i:!0;if(i){a=[];for(r=0;r<o.length;r++)a=a.concat(o[r].vertices);n.clockwiseSort(a);l=n.hull(a),c=n.centre(l);d.setVertices(e,l);n.translate(e.vertices,c)}u=t(e);e.area=u.area;e.parent=e;e.position.x=u.centre.x;e.position.y=u.centre.y;e.positionPrev.x=u.centre.x;e.positionPrev.y=u.centre.y;d.setMass(e,u.mass);d.setInertia(e,u.inertia);d.setPosition(e,u.centre)}};d.setPosition=function(e,t){var o,r,s=i.sub(t,e.position);e.positionPrev.x+=s.x;e.positionPrev.y+=s.y;for(o=0;o<e.parts.length;o++){r=e.parts[o];r.position.x+=s.x;r.position.y+=s.y;n.translate(r.vertices,s);l.update(r.bounds,r.vertices,e.velocity)}};d.setAngle=function(e,t){var o,r,s=t-e.angle;e.anglePrev+=s;for(o=0;o<e.parts.length;o++){r=e.parts[o];r.angle+=s;n.rotate(r.vertices,s,e.position);c.rotate(r.axes,s);l.update(r.bounds,r.vertices,e.velocity);o>0&&i.rotateAbout(r.position,s,e.position,r.position)}};d.setVelocity=function(e,t){e.positionPrev.x=e.position.x-t.x;e.positionPrev.y=e.position.y-t.y;e.velocity.x=t.x;e.velocity.y=t.y;e.speed=i.magnitude(e.velocity)};d.setAngularVelocity=function(e,t){e.anglePrev=e.angle-t;e.angularVelocity=t;e.angularSpeed=Math.abs(e.angularVelocity)};d.translate=function(e,t){d.setPosition(e,i.add(e.position,t))};d.rotate=function(e,t){d.setAngle(e,e.angle+t)};d.scale=function(e,o,i,r){var s,a,u;for(s=0;s<e.parts.length;s++){a=e.parts[s];n.scale(a.vertices,o,i,e.position);a.axes=c.fromVertices(a.vertices);if(!e.isStatic){a.area=n.area(a.vertices);d.setMass(a,e.density*a.area);n.translate(a.vertices,{x:-a.position.x,y:-a.position.y});d.setInertia(a,n.inertia(a.vertices,a.mass));n.translate(a.vertices,{x:a.position.x,y:a.position.y})}l.update(a.bounds,a.vertices,e.velocity)}e.circleRadius&&(o===i?e.circleRadius*=o:e.circleRadius=null);if(!e.isStatic){u=t(e);e.area=u.area;d.setMass(e,u.mass);d.setInertia(e,u.inertia)}};d.update=function(e,t,o,r){var s,a,d=Math.pow(t*o*e.timeScale,2),u=1-e.frictionAir*o*e.timeScale,p=e.position.x-e.positionPrev.x,f=e.position.y-e.positionPrev.y;e.velocity.x=p*u*r+e.force.x/e.mass*d;e.velocity.y=f*u*r+e.force.y/e.mass*d;e.positionPrev.x=e.position.x;e.positionPrev.y=e.position.y;e.position.x+=e.velocity.x;e.position.y+=e.velocity.y;e.angularVelocity=(e.angle-e.anglePrev)*u*r+e.torque/e.inertia*d;e.anglePrev=e.angle;e.angle+=e.angularVelocity;e.speed=i.magnitude(e.velocity);e.angularSpeed=Math.abs(e.angularVelocity);for(s=0;s<e.parts.length;s++){a=e.parts[s];n.translate(a.vertices,e.velocity);if(s>0){a.position.x+=e.velocity.x;a.position.y+=e.velocity.y}if(0!==e.angularVelocity){n.rotate(a.vertices,e.angularVelocity,e.position);c.rotate(a.axes,e.angularVelocity);s>0&&i.rotateAbout(a.position,e.angularVelocity,e.position,a.position)}l.update(a.bounds,a.vertices,e.velocity)}};d.applyForce=function(e,t,o){e.force.x+=o.x;e.force.y+=o.y;var n={x:t.x-e.position.x,y:t.y-e.position.y};e.torque+=n.x*o.y-n.y*o.x};t=function(e){var t,o,n={mass:0,area:0,inertia:0,centre:{x:0,y:0}};for(t=1===e.parts.length?0:1;t<e.parts.length;t++){o=e.parts[t];n.mass+=o.mass;n.area+=o.area;n.inertia+=o.inertia;n.centre=i.add(n.centre,i.mult(o.position,o.mass!==1/0?o.mass:1))}n.centre=i.div(n.centre,n.mass!==1/0?n.mass:e.parts.length);return n}}()},{"../core/Common":14,"../core/Sleeping":20,"../geometry/Axes":23,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27,"../render/Render":29}],2:[function(e,t,o){var n,i,r,s={};t.exports=s;n=e("../core/Events");i=e("../core/Common");r=e("./Body");!function(){s.create=function(e){return i.extend({id:i.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite"},e)};s.setModified=function(e,t,o,n){var i,r;e.isModified=t;o&&e.parent&&s.setModified(e.parent,t,o,n);if(n)for(i=0;i<e.composites.length;i++){r=e.composites[i];s.setModified(r,t,o,n)}};s.add=function(e,t){var o,r,a=[].concat(t);n.trigger(e,"beforeAdd",{object:t});for(o=0;o<a.length;o++){r=a[o];switch(r.type){case"body":if(r.parent!==r){i.log("Composite.add: skipped adding a compound body part (you must add its parent instead)","warn");break}s.addBody(e,r);break;case"constraint":s.addConstraint(e,r);break;case"composite":s.addComposite(e,r);break;case"mouseConstraint":s.addConstraint(e,r.constraint)}}n.trigger(e,"afterAdd",{object:t});return e};s.remove=function(e,t,o){var i,r,a=[].concat(t);n.trigger(e,"beforeRemove",{object:t});for(i=0;i<a.length;i++){r=a[i];switch(r.type){case"body":s.removeBody(e,r,o);break;case"constraint":s.removeConstraint(e,r,o);break;case"composite":s.removeComposite(e,r,o);break;case"mouseConstraint":s.removeConstraint(e,r.constraint)}}n.trigger(e,"afterRemove",{object:t});return e};s.addComposite=function(e,t){e.composites.push(t);t.parent=e;s.setModified(e,!0,!0,!1);return e};s.removeComposite=function(e,t,o){var n,r=i.indexOf(e.composites,t);if(-1!==r){s.removeCompositeAt(e,r);s.setModified(e,!0,!0,!1)}if(o)for(n=0;n<e.composites.length;n++)s.removeComposite(e.composites[n],t,!0);return e};s.removeCompositeAt=function(e,t){e.composites.splice(t,1);s.setModified(e,!0,!0,!1);return e};s.addBody=function(e,t){e.bodies.push(t);s.setModified(e,!0,!0,!1);return e};s.removeBody=function(e,t,o){var n,r=i.indexOf(e.bodies,t);if(-1!==r){s.removeBodyAt(e,r);s.setModified(e,!0,!0,!1)}if(o)for(n=0;n<e.composites.length;n++)s.removeBody(e.composites[n],t,!0);return e};s.removeBodyAt=function(e,t){e.bodies.splice(t,1);s.setModified(e,!0,!0,!1);return e};s.addConstraint=function(e,t){e.constraints.push(t);s.setModified(e,!0,!0,!1);return e};s.removeConstraint=function(e,t,o){var n,r=i.indexOf(e.constraints,t);-1!==r&&s.removeConstraintAt(e,r);if(o)for(n=0;n<e.composites.length;n++)s.removeConstraint(e.composites[n],t,!0);return e};s.removeConstraintAt=function(e,t){e.constraints.splice(t,1);s.setModified(e,!0,!0,!1);return e};s.clear=function(e,t,o){if(o)for(var n=0;n<e.composites.length;n++)s.clear(e.composites[n],t,!0);t?e.bodies=e.bodies.filter(function(e){return e.isStatic}):e.bodies.length=0;e.constraints.length=0;e.composites.length=0;s.setModified(e,!0,!0,!1);return e};s.allBodies=function(e){var t,o=[].concat(e.bodies);for(t=0;t<e.composites.length;t++)o=o.concat(s.allBodies(e.composites[t]));return o};s.allConstraints=function(e){var t,o=[].concat(e.constraints);for(t=0;t<e.composites.length;t++)o=o.concat(s.allConstraints(e.composites[t]));return o};s.allComposites=function(e){var t,o=[].concat(e.composites);for(t=0;t<e.composites.length;t++)o=o.concat(s.allComposites(e.composites[t]));return o};s.get=function(e,t,o){var n,i;switch(o){case"body":n=s.allBodies(e);break;case"constraint":n=s.allConstraints(e);break;case"composite":n=s.allComposites(e).concat(e)}if(!n)return null;i=n.filter(function(e){return e.id.toString()===t.toString()});return 0===i.length?null:i[0]};s.move=function(e,t,o){s.remove(e,t);s.add(o,t);return e};s.rebase=function(e){var t,o=s.allBodies(e).concat(s.allConstraints(e)).concat(s.allComposites(e));for(t=0;t<o.length;t++)o[t].id=i.nextId();s.setModified(e,!0,!0,!1);return e};s.translate=function(e,t,o){var n,i=o?s.allBodies(e):e.bodies;for(n=0;n<i.length;n++)r.translate(i[n],t);s.setModified(e,!0,!0,!1);return e};s.rotate=function(e,t,o,n){var i,a,l,c,d=Math.cos(t),u=Math.sin(t),p=n?s.allBodies(e):e.bodies;for(i=0;i<p.length;i++){a=p[i],l=a.position.x-o.x,c=a.position.y-o.y;r.setPosition(a,{x:o.x+(l*d-c*u),y:o.y+(l*u+c*d)});r.rotate(a,t)}s.setModified(e,!0,!0,!1);return e};s.scale=function(e,t,o,n,i){var a,l,c,d,u=i?s.allBodies(e):e.bodies;for(a=0;a<u.length;a++){l=u[a],c=l.position.x-n.x,d=l.position.y-n.y;r.setPosition(l,{x:n.x+c*t,y:n.y+d*o});r.scale(l,t,o)}s.setModified(e,!0,!0,!1);return e}}()},{"../core/Common":14,"../core/Events":16,"./Body":1}],3:[function(e,t,o){var n,i,r,s={};t.exports=s;n=e("./Composite");i=e("../constraint/Constraint");r=e("../core/Common");!function(){s.create=function(e){var t=n.create(),o={label:"World",gravity:{x:0,y:1,scale:.001},bounds:{min:{x:-(1/0),y:-(1/0)},max:{x:1/0,y:1/0}}};return r.extend(t,o,e)}}()},{"../constraint/Constraint":12,"../core/Common":14,"./Composite":2}],4:[function(e,t,o){var n={};t.exports=n;!function(){n.create=function(e){return{id:n.id(e),vertex:e,normalImpulse:0,tangentImpulse:0}};n.id=function(e){return e.body.id+"_"+e.index}}()},{}],5:[function(e,t,o){var n,i,r,s={};t.exports=s;n=e("./SAT");i=e("./Pair");r=e("../geometry/Bounds");!function(){s.collisions=function(e,t){var o,a,l,c,d,u,p,f,y,m,g,v=[],x=t.pairs.table;for(o=0;o<e.length;o++){a=e[o][0],l=e[o][1];if((!a.isStatic&&!a.isSleeping||!l.isStatic&&!l.isSleeping)&&s.canCollide(a.collisionFilter,l.collisionFilter)&&r.overlaps(a.bounds,l.bounds))for(c=a.parts.length>1?1:0;c<a.parts.length;c++){d=a.parts[c];for(u=l.parts.length>1?1:0;u<l.parts.length;u++){p=l.parts[u];if(d===a&&p===l||r.overlaps(d.bounds,p.bounds)){f=i.id(d,p),y=x[f];m=y&&y.isActive?y.collision:null;g=n.collides(d,p,m);g.collided&&v.push(g)}}}}return v};s.canCollide=function(e,t){return e.group===t.group&&0!==e.group?e.group>0:0!==(e.mask&t.category)&&0!==(t.mask&e.category)}}()},{"../geometry/Bounds":24,"./Pair":7,"./SAT":11}],6:[function(e,t,o){var n,i,r,s={};t.exports=s;n=e("./Pair");i=e("./Detector");r=e("../core/Common");!function(){var e,t,o,a,l,c,d,u;s.create=function(e){var t={controller:s,detector:i.collisions,buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return r.extend(t,e)};s.update=function(o,n,i,r){var s,p,f,y,m,g,v,x,h,b,S=i.world,C=o.buckets,w=!1;for(s=0;s<n.length;s++){g=n[s];if((!g.isSleeping||r)&&!(g.bounds.max.x<S.bounds.min.x||g.bounds.min.x>S.bounds.max.x||g.bounds.max.y<S.bounds.min.y||g.bounds.min.y>S.bounds.max.y)){v=t(o,g);if(!g.region||v.id!==g.region.id||r){g.region&&!r||(g.region=v);x=e(v,g.region);for(p=x.startCol;p<=x.endCol;p++)for(f=x.startRow;f<=x.endRow;f++){m=a(p,f);y=C[m];h=p>=v.startCol&&p<=v.endCol&&f>=v.startRow&&f<=v.endRow;b=p>=g.region.startCol&&p<=g.region.endCol&&f>=g.region.startRow&&f<=g.region.endRow;!h&&b&&b&&y&&d(o,y,g);if(g.region===v||h&&!b||r){y||(y=l(C,m));c(o,y,g)}}g.region=v;w=!0}}}w&&(o.pairsList=u(o))};s.clear=function(e){e.buckets={};e.pairs={};e.pairsList=[]};e=function(e,t){var n=Math.min(e.startCol,t.startCol),i=Math.max(e.endCol,t.endCol),r=Math.min(e.startRow,t.startRow),s=Math.max(e.endRow,t.endRow);return o(n,i,r,s)};t=function(e,t){var n=t.bounds,i=Math.floor(n.min.x/e.bucketWidth),r=Math.floor(n.max.x/e.bucketWidth),s=Math.floor(n.min.y/e.bucketHeight),a=Math.floor(n.max.y/e.bucketHeight);return o(i,r,s,a)};o=function(e,t,o,n){return{id:e+","+t+","+o+","+n,startCol:e,endCol:t,startRow:o,endRow:n}};a=function(e,t){return e+","+t};l=function(e,t){var o=e[t]=[];return o};c=function(e,t,o){var i,r,s,a;for(i=0;i<t.length;i++){r=t[i];if(!(o.id===r.id||o.isStatic&&r.isStatic)){s=n.id(o,r),a=e.pairs[s];a?a[2]+=1:e.pairs[s]=[o,r,1]}}t.push(o)};d=function(e,t,o){var i,s,a,l;t.splice(r.indexOf(t,o),1);for(i=0;i<t.length;i++){s=t[i],a=n.id(o,s),l=e.pairs[a];l&&(l[2]-=1)}};u=function(e){var t,o,n=[],i=r.keys(e.pairs);for(o=0;o<i.length;o++){t=e.pairs[i[o]];t[2]>0?n.push(t):delete e.pairs[i[o]]}return n}}()},{"../core/Common":14,"./Detector":5,"./Pair":7}],7:[function(e,t,o){var n,i={};t.exports=i;n=e("./Contact");!function(){i.create=function(e,t){var o=e.bodyA,n=e.bodyB,r=e.parentA,s=e.parentB,a={id:i.id(o,n),bodyA:o,bodyB:n,contacts:{},activeContacts:[],separation:0,isActive:!0,isSensor:o.isSensor||n.isSensor,timeCreated:t,timeUpdated:t,inverseMass:r.inverseMass+s.inverseMass,friction:Math.min(r.friction,s.friction),frictionStatic:Math.max(r.frictionStatic,s.frictionStatic),restitution:Math.max(r.restitution,s.restitution),slop:Math.max(r.slop,s.slop)};i.update(a,e,t);return a};i.update=function(e,t,o){var r,s,a,l,c=e.contacts,d=t.supports,u=e.activeContacts,p=t.parentA,f=t.parentB;e.collision=t;e.inverseMass=p.inverseMass+f.inverseMass;e.friction=Math.min(p.friction,f.friction);e.frictionStatic=Math.max(p.frictionStatic,f.frictionStatic);e.restitution=Math.max(p.restitution,f.restitution);e.slop=Math.max(p.slop,f.slop);u.length=0;if(t.collided){for(r=0;r<d.length;r++){s=d[r],a=n.id(s),l=c[a];l?u.push(l):u.push(c[a]=n.create(s))}e.separation=t.depth;i.setActive(e,!0,o)}else e.isActive===!0&&i.setActive(e,!1,o)};i.setActive=function(e,t,o){if(t){e.isActive=!0;e.timeUpdated=o}else{e.isActive=!1;e.activeContacts.length=0}};i.id=function(e,t){return e.id<t.id?e.id+"_"+t.id:t.id+"_"+e.id}}()},{"./Contact":4}],8:[function(e,t,o){var n,i,r={};t.exports=r;n=e("./Pair");i=e("../core/Common");!function(){var e=1e3;r.create=function(e){return i.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},e)};r.update=function(e,t,o){var r,s,a,l,c=e.list,d=e.table,u=e.collisionStart,p=e.collisionEnd,f=e.collisionActive,y=[];u.length=0;p.length=0;f.length=0;for(l=0;l<t.length;l++){r=t[l];if(r.collided){s=n.id(r.bodyA,r.bodyB);y.push(s);a=d[s];if(a){a.isActive?f.push(a):u.push(a);n.update(a,r,o)}else{a=n.create(r,o);d[s]=a;u.push(a);c.push(a)}}}for(l=0;l<c.length;l++){a=c[l];if(a.isActive&&-1===i.indexOf(y,a.id)){n.setActive(a,!1,o);p.push(a)}}};r.removeOld=function(t,o){var n,i,r,s,a=t.list,l=t.table,c=[];for(s=0;s<a.length;s++){n=a[s];i=n.collision;i.bodyA.isSleeping||i.bodyB.isSleeping?n.timeUpdated=o:o-n.timeUpdated>e&&c.push(s)}for(s=0;s<c.length;s++){r=c[s]-s;n=a[r];delete l[n.id];a.splice(r,1)}};r.clear=function(e){e.table={};e.list.length=0;e.collisionStart.length=0;e.collisionActive.length=0;e.collisionEnd.length=0;return e}}()},{"../core/Common":14,"./Pair":7}],9:[function(e,t,o){var n,i,r,s,a,l={};t.exports=l;n=e("../geometry/Vector");i=e("./SAT");r=e("../geometry/Bounds");s=e("../factory/Bodies");a=e("../geometry/Vertices");!function(){l.ray=function(e,t,o,a){var l,c,d,u,p,f,y,m,g,v,x;a=a||1e-100;l=n.angle(t,o),c=n.magnitude(n.sub(t,o)),d=.5*(o.x+t.x),u=.5*(o.y+t.y),p=s.rectangle(d,u,c,a,{angle:l}),f=[];for(y=0;y<e.length;y++){m=e[y];if(r.overlaps(m.bounds,p.bounds))for(g=1===m.parts.length?0:1;g<m.parts.length;g++){v=m.parts[g];if(r.overlaps(v.bounds,p.bounds)){x=i.collides(v,p);if(x.collided){x.body=x.bodyA=x.bodyB=m;f.push(x);break}}}}return f};l.region=function(e,t,o){var n,i,s,a=[];for(n=0;n<e.length;n++){i=e[n],s=r.overlaps(i.bounds,t);(s&&!o||!s&&o)&&a.push(i)}return a};l.point=function(e,t){var o,n,i,s,l=[];for(o=0;o<e.length;o++){n=e[o];if(r.contains(n.bounds,t))for(i=1===n.parts.length?0:1;i<n.parts.length;i++){s=n.parts[i];if(r.contains(s.bounds,t)&&a.contains(s.vertices,t)){l.push(n);break}}}return l}}()},{"../factory/Bodies":21,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27,"./SAT":11}],10:[function(e,t,o){var n,i,r,s,a={};t.exports=a;n=e("../geometry/Vertices");i=e("../geometry/Vector");r=e("../core/Common");s=e("../geometry/Bounds");!function(){a._restingThresh=4;a._restingThreshTangent=6;a._positionDampen=.9;a._positionWarming=.8;a._frictionNormalMultiplier=5;a.preSolvePosition=function(e){var t,o,n;for(t=0;t<e.length;t++){o=e[t];if(o.isActive){n=o.activeContacts.length;o.collision.parentA.totalContacts+=n;o.collision.parentB.totalContacts+=n}}};a.solvePosition=function(e,t){var o,n,r,s,l,c,d,u,p,f=i._temp[0],y=i._temp[1],m=i._temp[2],g=i._temp[3];for(o=0;o<e.length;o++){n=e[o];if(n.isActive&&!n.isSensor){r=n.collision;s=r.parentA;l=r.parentB;c=r.normal;d=i.sub(i.add(l.positionImpulse,l.position,f),i.add(s.positionImpulse,i.sub(l.position,r.penetration,y),m),g);n.separation=i.dot(c,d)}}for(o=0;o<e.length;o++){n=e[o];if(!(!n.isActive||n.isSensor||n.separation<0)){r=n.collision;s=r.parentA;l=r.parentB;c=r.normal;p=(n.separation-n.slop)*t;(s.isStatic||l.isStatic)&&(p*=2);if(!s.isStatic&&!s.isSleeping){u=a._positionDampen/s.totalContacts;s.positionImpulse.x+=c.x*p*u;s.positionImpulse.y+=c.y*p*u}if(!l.isStatic&&!l.isSleeping){u=a._positionDampen/l.totalContacts;l.positionImpulse.x-=c.x*p*u;l.positionImpulse.y-=c.y*p*u}}}};a.postSolvePosition=function(e){var t,o,r,l;for(t=0;t<e.length;t++){o=e[t];o.totalContacts=0;if(0!==o.positionImpulse.x||0!==o.positionImpulse.y){for(r=0;r<o.parts.length;r++){l=o.parts[r];n.translate(l.vertices,o.positionImpulse);s.update(l.bounds,l.vertices,o.velocity);l.position.x+=o.positionImpulse.x;l.position.y+=o.positionImpulse.y}o.positionPrev.x+=o.positionImpulse.x;o.positionPrev.y+=o.positionImpulse.y;if(i.dot(o.positionImpulse,o.velocity)<0){o.positionImpulse.x=0;o.positionImpulse.y=0}else{o.positionImpulse.x*=a._positionWarming;o.positionImpulse.y*=a._positionWarming}}}};a.preSolveVelocity=function(e){var t,o,n,r,s,a,l,c,d,u,p,f,y,m,g=i._temp[0],v=i._temp[1];for(t=0;t<e.length;t++){n=e[t];if(n.isActive&&!n.isSensor){r=n.activeContacts;s=n.collision;a=s.parentA;l=s.parentB;c=s.normal;d=s.tangent;for(o=0;o<r.length;o++){u=r[o];p=u.vertex;f=u.normalImpulse;y=u.tangentImpulse;if(0!==f||0!==y){g.x=c.x*f+d.x*y;g.y=c.y*f+d.y*y;if(!a.isStatic&&!a.isSleeping){m=i.sub(p,a.position,v);a.positionPrev.x+=g.x*a.inverseMass;a.positionPrev.y+=g.y*a.inverseMass;a.anglePrev+=i.cross(m,g)*a.inverseInertia}if(!l.isStatic&&!l.isSleeping){m=i.sub(p,l.position,v);l.positionPrev.x-=g.x*l.inverseMass;l.positionPrev.y-=g.y*l.inverseMass;l.anglePrev-=i.cross(m,g)*l.inverseInertia}}}}}};a.solveVelocity=function(e,t){var o,n,s,l,c,d,u,p,f,y,m,g,v,x,h,b,S,C,w,A,B,P,M,k,I,T,V,R,E,_,O=t*t,L=i._temp[0],W=i._temp[1],F=i._temp[2],D=i._temp[3],q=i._temp[4],N=i._temp[5];for(o=0;o<e.length;o++){n=e[o];if(n.isActive&&!n.isSensor){s=n.collision,l=s.parentA,c=s.parentB,d=s.normal,u=s.tangent,p=n.activeContacts,f=1/p.length;l.velocity.x=l.position.x-l.positionPrev.x;l.velocity.y=l.position.y-l.positionPrev.y;c.velocity.x=c.position.x-c.positionPrev.x;c.velocity.y=c.position.y-c.positionPrev.y;l.angularVelocity=l.angle-l.anglePrev;c.angularVelocity=c.angle-c.anglePrev;for(y=0;y<p.length;y++){m=p[y],g=m.vertex,v=i.sub(g,l.position,W),x=i.sub(g,c.position,F),h=i.add(l.velocity,i.mult(i.perp(v),l.angularVelocity),D),b=i.add(c.velocity,i.mult(i.perp(x),c.angularVelocity),q),S=i.sub(h,b,N),C=i.dot(d,S);w=i.dot(u,S),A=Math.abs(w),B=r.sign(w);P=(1+n.restitution)*C,M=r.clamp(n.separation+C,0,1)*a._frictionNormalMultiplier;k=w,I=1/0;if(A>n.friction*n.frictionStatic*M*O){I=A;k=r.clamp(n.friction*B*O,-I,I)}T=i.cross(v,d),V=i.cross(x,d),R=f/(l.inverseMass+c.inverseMass+l.inverseInertia*T*T+c.inverseInertia*V*V);P*=R;k*=R;if(C<0&&C*C>a._restingThresh*O)m.normalImpulse=0;else{E=m.normalImpulse;m.normalImpulse=Math.min(m.normalImpulse+P,0);P=m.normalImpulse-E}if(w*w>a._restingThreshTangent*O)m.tangentImpulse=0;else{_=m.tangentImpulse;m.tangentImpulse=r.clamp(m.tangentImpulse+k,-I,I);k=m.tangentImpulse-_}L.x=d.x*P+u.x*k;L.y=d.y*P+u.y*k;if(!l.isStatic&&!l.isSleeping){l.positionPrev.x+=L.x*l.inverseMass;l.positionPrev.y+=L.y*l.inverseMass;l.anglePrev+=i.cross(v,L)*l.inverseInertia}if(!c.isStatic&&!c.isSleeping){c.positionPrev.x-=L.x*c.inverseMass;c.positionPrev.y-=L.y*c.inverseMass;c.anglePrev-=i.cross(x,L)*c.inverseInertia}}}}}}()},{"../core/Common":14,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27}],11:[function(e,t,o){var n,i,r={};t.exports=r;n=e("../geometry/Vertices");i=e("../geometry/Vector");!function(){var e,t,o;r.collides=function(t,r,s){var a,l,c,d,u,p,f,y,m,g,v,x,h,b=s,S=!1;if(b){u=t.parent,p=r.parent,f=u.speed*u.speed+u.angularSpeed*u.angularSpeed+p.speed*p.speed+p.angularSpeed*p.angularSpeed;S=b&&b.collided&&f<.2;d=b}else d={collided:!1,bodyA:t,bodyB:r};if(b&&S){y=d.axisBody,m=y===t?r:t,g=[y.axes[b.axisNumber]];c=e(y.vertices,m.vertices,g);d.reused=!0;if(c.overlap<=0){d.collided=!1;return d}}else{a=e(t.vertices,r.vertices,t.axes);if(a.overlap<=0){d.collided=!1;return d}l=e(r.vertices,t.vertices,r.axes);if(l.overlap<=0){d.collided=!1;return d}if(a.overlap<l.overlap){c=a;d.axisBody=t}else{c=l;d.axisBody=r}d.axisNumber=c.axisNumber}d.bodyA=t.id<r.id?t:r;d.bodyB=t.id<r.id?r:t;d.collided=!0;d.normal=c.axis;d.depth=c.overlap;d.parentA=d.bodyA.parent;d.parentB=d.bodyB.parent;t=d.bodyA;r=d.bodyB;i.dot(d.normal,i.sub(r.position,t.position))>0&&(d.normal=i.neg(d.normal));d.tangent=i.perp(d.normal);d.penetration={x:d.normal.x*d.depth,y:d.normal.y*d.depth};v=o(t,r,d.normal),x=d.supports||[];x.length=0;n.contains(t.vertices,v[0])&&x.push(v[0]);n.contains(t.vertices,v[1])&&x.push(v[1]);if(x.length<2){h=o(r,t,i.neg(d.normal));n.contains(r.vertices,h[0])&&x.push(h[0]);x.length<2&&n.contains(r.vertices,h[1])&&x.push(h[1])}x.length<1&&(x=[v[0]]);d.supports=x;return d};e=function(e,o,n){var r,s,a,l=i._temp[0],c=i._temp[1],d={overlap:Number.MAX_VALUE};for(a=0;a<n.length;a++){s=n[a];t(l,e,s);t(c,o,s);r=Math.min(l.max-c.min,c.max-l.min);if(r<=0){d.overlap=r;return d}if(r<d.overlap){d.overlap=r;d.axis=s;d.axisNumber=a}}return d};t=function(e,t,o){var n,r,s=i.dot(t[0],o),a=s;for(n=1;n<t.length;n+=1){r=i.dot(t[n],o);r>a?a=r:r<s&&(s=r)}e.min=s;e.max=a};o=function(e,t,o){var n,r,s,a,l,c,d,u=Number.MAX_VALUE,p=i._temp[0],f=t.vertices,y=e.position;for(l=0;l<f.length;l++){r=f[l];p.x=r.x-y.x;p.y=r.y-y.y;n=-i.dot(o,p);if(n<u){u=n;s=r}}c=s.index-1>=0?s.index-1:f.length-1;r=f[c];p.x=r.x-y.x;p.y=r.y-y.y;u=-i.dot(o,p);a=r;d=(s.index+1)%f.length;r=f[d];p.x=r.x-y.x;p.y=r.y-y.y;n=-i.dot(o,p);n<u&&(a=r);return[s,a]}}()},{"../geometry/Vector":26,"../geometry/Vertices":27}],12:[function(e,t,o){var n,i,r,s,a,l,c={};t.exports=c;n=e("../geometry/Vertices");i=e("../geometry/Vector");r=e("../core/Sleeping");s=e("../geometry/Bounds");a=e("../geometry/Axes");l=e("../core/Common");!function(){var e=1e-6,t=.001;c.create=function(t){var o,n,r,s,a=t;a.bodyA&&!a.pointA&&(a.pointA={x:0,y:0});a.bodyB&&!a.pointB&&(a.pointB={x:0,y:0});o=a.bodyA?i.add(a.bodyA.position,a.pointA):a.pointA,n=a.bodyB?i.add(a.bodyB.position,a.pointB):a.pointB,r=i.magnitude(i.sub(o,n));a.length=a.length||r||e;s={visible:!0,lineWidth:2,strokeStyle:"#666"};a.render=l.extend(s,a.render);a.id=a.id||l.nextId();a.label=a.label||"Constraint";a.type="constraint";a.stiffness=a.stiffness||1;a.angularStiffness=a.angularStiffness||0;a.angleA=a.bodyA?a.bodyA.angle:a.angleA;a.angleB=a.bodyB?a.bodyB.angle:a.angleB;return a};c.solveAll=function(e,t){for(var o=0;o<e.length;o++)c.solve(e[o],t)};c.solve=function(o,n){var r,s,a,l,c,d,u,p,f,y,m,g,v,x,h,b,S,C,w,A=o.bodyA,B=o.bodyB,P=o.pointA,M=o.pointB;if(A&&!A.isStatic){o.pointA=i.rotate(P,A.angle-o.angleA);o.angleA=A.angle}if(B&&!B.isStatic){o.pointB=i.rotate(M,B.angle-o.angleB);o.angleB=B.angle}r=P,s=M;A&&(r=i.add(A.position,P));B&&(s=i.add(B.position,M));if(r&&s){a=i.sub(r,s),l=i.magnitude(a);0===l&&(l=e);c=(l-o.length)/l,d=i.div(a,l),u=i.mult(a,.5*c*o.stiffness*n*n);if(!(Math.abs(1-l/o.length)<t*n)){if(A&&!A.isStatic){y={x:r.x-A.position.x+u.x,y:r.y-A.position.y+u.y};A.velocity.x=A.position.x-A.positionPrev.x;A.velocity.y=A.position.y-A.positionPrev.y;A.angularVelocity=A.angle-A.anglePrev;p=i.add(A.velocity,i.mult(i.perp(y),A.angularVelocity));g=i.dot(y,d);x=A.inverseMass+A.inverseInertia*g*g}else{p={x:0,y:0};x=A?A.inverseMass:0}if(B&&!B.isStatic){m={x:s.x-B.position.x-u.x,y:s.y-B.position.y-u.y};B.velocity.x=B.position.x-B.positionPrev.x;B.velocity.y=B.position.y-B.positionPrev.y;B.angularVelocity=B.angle-B.anglePrev;f=i.add(B.velocity,i.mult(i.perp(m),B.angularVelocity));v=i.dot(m,d);h=B.inverseMass+B.inverseInertia*v*v}else{f={x:0,y:0};h=B?B.inverseMass:0}b=i.sub(f,p),S=i.dot(d,b)/(x+h);S>0&&(S=0);C={x:d.x*S,y:d.y*S};if(A&&!A.isStatic){w=i.cross(y,C)*A.inverseInertia*(1-o.angularStiffness);A.constraintImpulse.x-=u.x;A.constraintImpulse.y-=u.y;A.constraintImpulse.angle+=w;A.position.x-=u.x;A.position.y-=u.y;A.angle+=w}if(B&&!B.isStatic){w=i.cross(m,C)*B.inverseInertia*(1-o.angularStiffness);B.constraintImpulse.x+=u.x;B.constraintImpulse.y+=u.y;B.constraintImpulse.angle-=w;B.position.x+=u.x;B.position.y+=u.y;B.angle-=w}}}};c.postSolveAll=function(e){var t,o,l,c,d;for(t=0;t<e.length;t++){o=e[t],l=o.constraintImpulse;if(0!==l.x||0!==l.y||0!==l.angle){r.set(o,!1);for(c=0;c<o.parts.length;c++){d=o.parts[c];n.translate(d.vertices,l);if(c>0){d.position.x+=l.x;d.position.y+=l.y}if(0!==l.angle){n.rotate(d.vertices,l.angle,o.position);a.rotate(d.axes,l.angle);c>0&&i.rotateAbout(d.position,l.angle,o.position,d.position)}s.update(d.bounds,d.vertices,o.velocity)}l.angle=0;l.x=0;l.y=0}}}}()},{"../core/Common":14,"../core/Sleeping":20,"../geometry/Axes":23,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27}],13:[function(e,t,o){var n,i,r,s,a,l,c,d,u,p={};t.exports=p;n=e("../geometry/Vertices");i=e("../core/Sleeping");r=e("../core/Mouse");s=e("../core/Events");a=e("../collision/Detector");l=e("./Constraint");c=e("../body/Composite");d=e("../core/Common");u=e("../geometry/Bounds");!function(){p.create=function(t,o){var n,i,a,u=(t?t.mouse:null)||(o?o.mouse:null);if(!u)if(t&&t.render&&t.render.canvas)u=r.create(t.render.canvas);else{u=r.create();d.log("MouseConstraint.create: options.mouse was undefined, engine.render.canvas was undefined, may not function as expected","warn")}n=l.create({label:"Mouse Constraint",pointA:u.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}});i={type:"mouseConstraint",mouse:u,body:null,constraint:n,collisionFilter:{category:1,mask:4294967295,group:0}};a=d.extend(i,o);s.on(t,"tick",function(){var o=c.allBodies(t.world);p.update(a,o);e(a)});return a};p.update=function(e,t){var o,r,l,c=e.mouse,d=e.constraint,p=e.body;if(0===c.button)if(d.bodyB){i.set(d.bodyB,!1);d.pointA=c.position}else for(o=0;o<t.length;o++){p=t[o];if(u.contains(p.bounds,c.position)&&a.canCollide(p.collisionFilter,e.collisionFilter))for(r=p.parts.length>1?1:0;r<p.parts.length;r++){l=p.parts[r];if(n.contains(l.vertices,c.position)){d.pointA=c.position;d.bodyB=e.body=p;d.pointB={x:c.position.x-p.position.x,y:c.position.y-p.position.y};d.angleB=p.angle;i.set(p,!1);s.trigger(e,"startdrag",{mouse:c,body:p});break}}}else{d.bodyB=e.body=null;d.pointB=null;p&&s.trigger(e,"enddrag",{mouse:c,body:p})}};var e=function(e){var t=e.mouse,o=t.sourceEvents;o.mousemove&&s.trigger(e,"mousemove",{mouse:t});o.mousedown&&s.trigger(e,"mousedown",{mouse:t});o.mouseup&&s.trigger(e,"mouseup",{mouse:t});r.clearSourceEvents(t)}}()},{"../body/Composite":2,"../collision/Detector":5,"../core/Common":14,"../core/Events":16,"../core/Mouse":18,"../core/Sleeping":20,"../geometry/Bounds":24,"../geometry/Vertices":27,"./Constraint":12}],14:[function(e,t,o){var n={};t.exports=n;!function(){n._nextId=0;n._seed=0;n.extend=function(e,t){var o,i,r,s,a,l;if("boolean"===typeof t){o=2;r=t}else{o=1;r=!0}i=Array.prototype.slice.call(arguments,o);for(s=0;s<i.length;s++){a=i[s];if(a)for(l in a)if(r&&a[l]&&a[l].constructor===Object)if(e[l]&&e[l].constructor!==Object)e[l]=a[l];else{e[l]=e[l]||{};n.extend(e[l],r,a[l])}else e[l]=a[l]}return e};n.clone=function(e,t){return n.extend({},t,e)};n.keys=function(e){var t,o;if(Object.keys)return Object.keys(e);t=[];for(o in e)t.push(o);return t};n.values=function(e){var t,o,n,i=[];if(Object.keys){t=Object.keys(e);for(o=0;o<t.length;o++)i.push(e[t[o]]);return i}for(n in e)i.push(e[n]);return i};n.shadeColor=function(e,t){var o=parseInt(e.slice(1),16),n=Math.round(2.55*t),i=(o>>16)+n,r=(o>>8&255)+n,s=(255&o)+n;return"#"+(16777216+65536*(i<255?i<1?0:i:255)+256*(r<255?r<1?0:r:255)+(s<255?s<1?0:s:255)).toString(16).slice(1)};n.shuffle=function(e){var t,o,i;for(t=e.length-1;t>0;t--){o=Math.floor(n.random()*(t+1));i=e[t];e[t]=e[o];e[o]=i}return e};n.choose=function(e){return e[Math.floor(n.random()*e.length)]};n.isElement=function(e){try{return e instanceof HTMLElement}catch(t){return"object"===typeof e&&1===e.nodeType&&"object"===typeof e.style&&"object"===typeof e.ownerDocument}};n.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e);
};n.clamp=function(e,t,o){return e<t?t:e>o?o:e};n.sign=function(e){return e<0?-1:1};n.now=function(){var e=window.performance||{};e.now=function(){return e.now||e.webkitNow||e.msNow||e.oNow||e.mozNow||function(){return+new Date}}();return e.now()};n.random=function(t,o){t="undefined"!==typeof t?t:0;o="undefined"!==typeof o?o:1;return t+e()*(o-t)};n.colorToNumber=function(e){e=e.replace("#","");3==e.length&&(e=e.charAt(0)+e.charAt(0)+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2));return parseInt(e,16)};n.log=function(e,t){if(console&&console.log&&console.warn)switch(t){case"warn":console.warn("Matter.js:",e);break;case"error":console.log("Matter.js:",e)}};n.nextId=function(){return n._nextId++};n.indexOf=function(e,t){if(e.indexOf)return e.indexOf(t);for(var o=0;o<e.length;o++)if(e[o]===t)return o;return-1};var e=function(){n._seed=(9301*n._seed+49297)%233280;return n._seed/233280}}()},{}],15:[function(e,t,o){var n,i,r,s,a,l,c,d,u,p,f,y,m={};t.exports=m;n=e("../body/World");i=e("./Sleeping");r=e("../collision/Resolver");s=e("../render/Render");a=e("../collision/Pairs");l=e("./Metrics");c=e("../collision/Grid");d=e("./Events");u=e("../body/Composite");p=e("../constraint/Constraint");f=e("./Common");y=e("../body/Body");!function(){var e,t,o;m.create=function(e,t){var o,i,r;t=f.isElement(e)?t:e;e=f.isElement(e)?e:null;t=t||{};o={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],timing:{timestamp:0,timeScale:1},broadphase:{controller:c}};i=f.extend(o,t);if(e||i.render){r={element:e,controller:s};i.render=f.extend(r,i.render)}i.render&&i.render.controller&&(i.render=i.render.controller.create(i.render));i.world=t.world||n.create(i.world);i.pairs=a.create();i.broadphase=i.broadphase.controller.create(i.broadphase);i.metrics=i.metrics||{extended:!1};return i};m.update=function(n,s,l){var c,f,y,m,g,v,x,h,b,S,C;s=s||1e3/60;l=l||1;c=n.world,f=n.timing,y=n.broadphase,m=[];f.timestamp+=s*f.timeScale;v={timestamp:f.timestamp};d.trigger(n,"beforeUpdate",v);x=u.allBodies(c),h=u.allConstraints(c);n.enableSleeping&&i.update(x,f.timeScale);t(x,c.gravity);o(x,s,f.timeScale,l,c.bounds);for(g=0;g<n.constraintIterations;g++)p.solveAll(h,f.timeScale);p.postSolveAll(x);if(y.controller){c.isModified&&y.controller.clear(y);y.controller.update(y,x,n,c.isModified);m=y.pairsList}else m=x;c.isModified&&u.setModified(c,!1,!1,!0);b=y.detector(m,n);S=n.pairs,C=f.timestamp;a.update(S,b,C);a.removeOld(S,C);n.enableSleeping&&i.afterCollisions(S.list,f.timeScale);S.collisionStart.length>0&&d.trigger(n,"collisionStart",{pairs:S.collisionStart});r.preSolvePosition(S.list);for(g=0;g<n.positionIterations;g++)r.solvePosition(S.list,f.timeScale);r.postSolvePosition(x);r.preSolveVelocity(S.list);for(g=0;g<n.velocityIterations;g++)r.solveVelocity(S.list,f.timeScale);S.collisionActive.length>0&&d.trigger(n,"collisionActive",{pairs:S.collisionActive});S.collisionEnd.length>0&&d.trigger(n,"collisionEnd",{pairs:S.collisionEnd});e(x);d.trigger(n,"afterUpdate",v);return n};m.merge=function(e,t){var o,n,r;f.extend(e,t);if(t.world){e.world=t.world;m.clear(e);o=u.allBodies(e.world);for(n=0;n<o.length;n++){r=o[n];i.set(r,!1);r.id=f.nextId()}}};m.clear=function(e){var t,o,n=e.world;a.clear(e.pairs);t=e.broadphase;if(t.controller){o=u.allBodies(n);t.controller.clear(t);t.controller.update(t,o,e,!0)}};e=function(e){var t,o;for(t=0;t<e.length;t++){o=e[t];o.force.x=0;o.force.y=0;o.torque=0}};t=function(e,t){var o,n,i="undefined"!==typeof t.scale?t.scale:.001;if((0!==t.x||0!==t.y)&&0!==i)for(o=0;o<e.length;o++){n=e[o];if(!n.isStatic&&!n.isSleeping){n.force.y+=n.mass*t.y*i;n.force.x+=n.mass*t.x*i}}};o=function(e,t,o,n,i){var r,s;for(r=0;r<e.length;r++){s=e[r];s.isStatic||s.isSleeping||y.update(s,t,o,n)}}}()},{"../body/Body":1,"../body/Composite":2,"../body/World":3,"../collision/Grid":6,"../collision/Pairs":8,"../collision/Resolver":10,"../constraint/Constraint":12,"../render/Render":29,"./Common":14,"./Events":16,"./Metrics":17,"./Sleeping":20}],16:[function(e,t,o){var n,i={};t.exports=i;n=e("./Common");!function(){i.on=function(e,t,o){var n,i,r=t.split(" ");for(i=0;i<r.length;i++){n=r[i];e.events=e.events||{};e.events[n]=e.events[n]||[];e.events[n].push(o)}return o};i.off=function(e,t,o){var i,r,s,a,l;if(t){if("function"===typeof t){o=t;t=n.keys(e.events).join(" ")}i=t.split(" ");for(r=0;r<i.length;r++){s=e.events[i[r]],a=[];if(o&&s)for(l=0;l<s.length;l++)s[l]!==o&&a.push(s[l]);e.events[i[r]]=a}}else e.events={}};i.trigger=function(e,t,o){var i,r,s,a,l,c;if(e.events){o||(o={});i=t.split(" ");for(l=0;l<i.length;l++){r=i[l];s=e.events[r];if(s){a=n.clone(o,!1);a.name=r;a.source=e;for(c=0;c<s.length;c++)s[c].apply(e,[a])}}}}}()},{"./Common":14}],17:[function(e,t,o){},{"../body/Composite":2,"./Common":14}],18:[function(e,t,o){var n,i={};t.exports=i;n=e("../core/Common");!function(){i.create=function(t){var o={};t||n.log("Mouse.create: element was undefined, defaulting to document.body","warn");o.element=t||document.body;o.absolute={x:0,y:0};o.position={x:0,y:0};o.mousedownPosition={x:0,y:0};o.mouseupPosition={x:0,y:0};o.offset={x:0,y:0};o.scale={x:1,y:1};o.wheelDelta=0;o.button=-1;o.pixelRatio=o.element.getAttribute("data-pixel-ratio")||1;o.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null};o.mousemove=function(t){var n=e(t,o.element,o.pixelRatio),i=t.changedTouches;if(i){o.button=0;t.preventDefault()}o.absolute.x=n.x;o.absolute.y=n.y;o.position.x=o.absolute.x*o.scale.x+o.offset.x;o.position.y=o.absolute.y*o.scale.y+o.offset.y;o.sourceEvents.mousemove=t};o.mousedown=function(t){var n=e(t,o.element,o.pixelRatio),i=t.changedTouches;if(i){o.button=0;t.preventDefault()}else o.button=t.button;o.absolute.x=n.x;o.absolute.y=n.y;o.position.x=o.absolute.x*o.scale.x+o.offset.x;o.position.y=o.absolute.y*o.scale.y+o.offset.y;o.mousedownPosition.x=o.position.x;o.mousedownPosition.y=o.position.y;o.sourceEvents.mousedown=t};o.mouseup=function(t){var n=e(t,o.element,o.pixelRatio),i=t.changedTouches;i&&t.preventDefault();o.button=-1;o.absolute.x=n.x;o.absolute.y=n.y;o.position.x=o.absolute.x*o.scale.x+o.offset.x;o.position.y=o.absolute.y*o.scale.y+o.offset.y;o.mouseupPosition.x=o.position.x;o.mouseupPosition.y=o.position.y;o.sourceEvents.mouseup=t};o.mousewheel=function(e){o.wheelDelta=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));e.preventDefault()};i.setElement(o,o.element);return o};i.setElement=function(e,t){e.element=t;t.addEventListener("mousemove",e.mousemove);t.addEventListener("mousedown",e.mousedown);t.addEventListener("mouseup",e.mouseup);t.addEventListener("mousewheel",e.mousewheel);t.addEventListener("DOMMouseScroll",e.mousewheel);t.addEventListener("touchmove",e.mousemove);t.addEventListener("touchstart",e.mousedown);t.addEventListener("touchend",e.mouseup)};i.clearSourceEvents=function(e){e.sourceEvents.mousemove=null;e.sourceEvents.mousedown=null;e.sourceEvents.mouseup=null;e.sourceEvents.mousewheel=null;e.wheelDelta=0};i.setOffset=function(e,t){e.offset.x=t.x;e.offset.y=t.y;e.position.x=e.absolute.x*e.scale.x+e.offset.x;e.position.y=e.absolute.y*e.scale.y+e.offset.y};i.setScale=function(e,t){e.scale.x=t.x;e.scale.y=t.y;e.position.x=e.absolute.x*e.scale.x+e.offset.x;e.position.y=e.absolute.y*e.scale.y+e.offset.y};var e=function(e,t,o){var n,i,r=t.getBoundingClientRect(),s=document.documentElement||document.body.parentNode||document.body,a=void 0!==window.pageXOffset?window.pageXOffset:s.scrollLeft,l=void 0!==window.pageYOffset?window.pageYOffset:s.scrollTop,c=e.changedTouches;if(c){n=c[0].pageX-r.left-a;i=c[0].pageY-r.top-l}else{n=e.pageX-r.left-a;i=e.pageY-r.top-l}return{x:n/(t.clientWidth/t.width*o),y:i/(t.clientHeight/t.height*o)}}}()},{"../core/Common":14}],19:[function(e,t,o){var n,i,r,s={};t.exports=s;n=e("./Events");i=e("./Engine");r=e("./Common");!function(){var e,t;if("undefined"!==typeof window){e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(function(){e(r.now())},1e3/60)};t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame}s.create=function(e){var t={fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0},o=r.extend(t,e);o.delta=o.delta||1e3/o.fps;o.deltaMin=o.deltaMin||1e3/o.fps;o.deltaMax=o.deltaMax||1e3/(.5*o.fps);o.fps=1e3/o.delta;return o};s.run=function(t,o){if("undefined"!==typeof t.positionIterations){o=t;t=s.create()}!function n(i){t.frameRequestId=e(n);i&&t.enabled&&s.tick(t,o,i)}();return t};s.tick=function(e,t,o){var r,s=t.timing,a=1,l={timestamp:s.timestamp};n.trigger(e,"beforeTick",l);n.trigger(t,"beforeTick",l);if(e.isFixed)r=e.delta;else{r=o-e.timePrev||e.delta;e.timePrev=o;e.deltaHistory.push(r);e.deltaHistory=e.deltaHistory.slice(-e.deltaSampleSize);r=Math.min.apply(null,e.deltaHistory);r=r<e.deltaMin?e.deltaMin:r;r=r>e.deltaMax?e.deltaMax:r;a=r/e.delta;e.delta=r}0!==e.timeScalePrev&&(a*=s.timeScale/e.timeScalePrev);0===s.timeScale&&(a=0);e.timeScalePrev=s.timeScale;e.correction=a;e.frameCounter+=1;if(o-e.counterTimestamp>=1e3){e.fps=e.frameCounter*((o-e.counterTimestamp)/1e3);e.counterTimestamp=o;e.frameCounter=0}n.trigger(e,"tick",l);n.trigger(t,"tick",l);t.world.isModified&&t.render&&t.render.controller&&t.render.controller.clear&&t.render.controller.clear(t.render);n.trigger(e,"beforeUpdate",l);i.update(t,r,a);n.trigger(e,"afterUpdate",l);if(t.render&&t.render.controller){n.trigger(e,"beforeRender",l);n.trigger(t,"beforeRender",l);t.render.controller.world(t);n.trigger(e,"afterRender",l);n.trigger(t,"afterRender",l)}n.trigger(e,"afterTick",l);n.trigger(t,"afterTick",l)};s.stop=function(e){t(e.frameRequestId)};s.start=function(e,t){s.run(e,t)}}()},{"./Common":14,"./Engine":15,"./Events":16}],20:[function(e,t,o){var n,i={};t.exports=i;n=e("./Events");!function(){i._motionWakeThreshold=.18;i._motionSleepThreshold=.08;i._minBias=.9;i.update=function(e,t){var o,n,r,s,a,l=t*t*t;for(o=0;o<e.length;o++){n=e[o],r=n.speed*n.speed+n.angularSpeed*n.angularSpeed;if(0===n.force.x&&0===n.force.y){s=Math.min(n.motion,r),a=Math.max(n.motion,r);n.motion=i._minBias*s+(1-i._minBias)*a;if(n.sleepThreshold>0&&n.motion<i._motionSleepThreshold*l){n.sleepCounter+=1;n.sleepCounter>=n.sleepThreshold&&i.set(n,!0)}else n.sleepCounter>0&&(n.sleepCounter-=1)}else i.set(n,!1)}};i.afterCollisions=function(e,t){var o,n,r,s,a,l,c,d=t*t*t;for(o=0;o<e.length;o++){n=e[o];if(n.isActive){r=n.collision,s=r.bodyA.parent,a=r.bodyB.parent;if(!(s.isSleeping&&a.isSleeping||s.isStatic||a.isStatic)&&(s.isSleeping||a.isSleeping)){l=s.isSleeping&&!s.isStatic?s:a,c=l===s?a:s;!l.isStatic&&c.motion>i._motionWakeThreshold*d&&i.set(l,!1)}}}};i.set=function(e,t){var o=e.isSleeping;if(t){e.isSleeping=!0;e.sleepCounter=e.sleepThreshold;e.positionImpulse.x=0;e.positionImpulse.y=0;e.positionPrev.x=e.position.x;e.positionPrev.y=e.position.y;e.anglePrev=e.angle;e.speed=0;e.angularSpeed=0;e.motion=0;o||n.trigger(e,"sleepStart")}else{e.isSleeping=!1;e.sleepCounter=0;o&&n.trigger(e,"sleepEnd")}}}()},{"./Events":16}],21:[function(e,t,o){var n,i,r,s,a,l={};t.exports=l;n=e("../geometry/Vertices");i=e("../core/Common");r=e("../body/Body");s=e("../geometry/Bounds");a=e("../geometry/Vector");!function(){l.rectangle=function(e,t,o,s,a){var l,c;a=a||{};l={label:"Rectangle Body",position:{x:e,y:t},vertices:n.fromPath("L 0 0 L "+o+" 0 L "+o+" "+s+" L 0 "+s)};if(a.chamfer){c=a.chamfer;l.vertices=n.chamfer(l.vertices,c.radius,c.quality,c.qualityMin,c.qualityMax);delete a.chamfer}return r.create(i.extend({},l,a))};l.trapezoid=function(e,t,o,s,a,l){var c,d,u,p,f,y,m;l=l||{};a*=.5;c=(1-2*a)*o;d=o*a,u=d+c,p=u+d;f=a<.5?"L 0 0 L "+d+" "+-s+" L "+u+" "+-s+" L "+p+" 0":"L 0 0 L "+u+" "+-s+" L "+p+" 0";y={label:"Trapezoid Body",position:{x:e,y:t},vertices:n.fromPath(f)};if(l.chamfer){m=l.chamfer;y.vertices=n.chamfer(y.vertices,m.radius,m.quality,m.qualityMin,m.qualityMax);delete l.chamfer}return r.create(i.extend({},y,l))};l.circle=function(e,t,o,n,r){var s,a;n=n||{};s={label:"Circle Body",circleRadius:o};r=r||25;a=Math.ceil(Math.max(10,Math.min(r,o)));a%2===1&&(a+=1);return l.polygon(e,t,a,o,i.extend({},s,n))};l.polygon=function(e,t,o,s,a){var c,d,u,p,f,y,m,g,v;a=a||{};if(o<3)return l.circle(e,t,s,a);c=2*Math.PI/o,d="",u=.5*c;for(p=0;p<o;p+=1){f=u+p*c,y=Math.cos(f)*s,m=Math.sin(f)*s;d+="L "+y.toFixed(3)+" "+m.toFixed(3)+" "}g={label:"Polygon Body",position:{x:e,y:t},vertices:n.fromPath(d)};if(a.chamfer){v=a.chamfer;g.vertices=n.chamfer(g.vertices,v.radius,v.quality,v.qualityMin,v.qualityMax);delete a.chamfer}return r.create(i.extend({},g,a))};l.fromVertices=function(e,t,o,l,c,d,u){var p,f,y,m,g,v,x,h,b,S,C,w,A,B,P,M,k,I,T,V;l=l||{};f=[];c="undefined"!==typeof c?c:!1;d="undefined"!==typeof d?d:.01;u="undefined"!==typeof u?u:10;window.decomp||i.log("Bodies.fromVertices: poly-decomp.js required. Could not decompose vertices. Fallback to convex hull.","warn");i.isArray(o[0])||(o=[o]);for(h=0;h<o.length;h+=1){m=o[h];y=n.isConvex(m);if(y||!window.decomp){m=y?n.clockwiseSort(m):n.hull(m);f.push({position:{x:e,y:t},vertices:m})}else{S=new decomp.Polygon;for(g=0;g<m.length;g++)S.vertices.push([m[g].x,m[g].y]);S.makeCCW();d!==!1&&S.removeCollinearPoints(d);C=S.quickDecomp();for(g=0;g<C.length;g++){w=C[g],A=[];for(v=0;v<w.vertices.length;v++)A.push({x:w.vertices[v][0],y:w.vertices[v][1]});u>0&&n.area(A)<u||f.push({position:n.centre(A),vertices:A})}}}for(g=0;g<f.length;g++)f[g]=r.create(i.extend(f[g],l));if(c){B=5;for(g=0;g<f.length;g++){P=f[g];for(v=g+1;v<f.length;v++){M=f[v];if(s.overlaps(P.bounds,M.bounds)){k=P.vertices,I=M.vertices;for(x=0;x<P.vertices.length;x++)for(b=0;b<M.vertices.length;b++){T=a.magnitudeSquared(a.sub(k[(x+1)%k.length],I[b])),V=a.magnitudeSquared(a.sub(k[x],I[(b+1)%I.length]));if(T<B&&V<B){k[x].isInternal=!0;I[b].isInternal=!0}}}}}}if(f.length>1){p=r.create(i.extend({parts:f.slice(0)},l));r.setPosition(p,{x:e,y:t});return p}return f[0]}}()},{"../body/Body":1,"../core/Common":14,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27}],22:[function(e,t,o){var n,i,r,s,a,l={};t.exports=l;n=e("../body/Composite");i=e("../constraint/Constraint");r=e("../core/Common");s=e("../body/Body");a=e("./Bodies");!function(){l.stack=function(e,t,o,i,r,a,l){var c,d,u,p,f,y,m,g=n.create({label:"Stack"}),v=e,x=t,h=0;for(d=0;d<i;d++){u=0;for(p=0;p<o;p++){f=l(v,x,p,d,c,h);if(f){y=f.bounds.max.y-f.bounds.min.y,m=f.bounds.max.x-f.bounds.min.x;y>u&&(u=y);s.translate(f,{x:.5*m,y:.5*y});v=f.bounds.max.x+r;n.addBody(g,f);c=f;h+=1}else v+=r}x+=u+a;v=e}return g};l.chain=function(e,t,o,s,a,l){var c,d,u,p,f,y,m,g,v,x=e.bodies;for(c=1;c<x.length;c++){d=x[c-1],u=x[c],p=d.bounds.max.y-d.bounds.min.y,f=d.bounds.max.x-d.bounds.min.x,y=u.bounds.max.y-u.bounds.min.y,m=u.bounds.max.x-u.bounds.min.x;g={bodyA:d,pointA:{x:f*t,y:p*o},bodyB:u,pointB:{x:m*s,y:y*a}};v=r.extend(g,l);n.addConstraint(e,i.create(v))}e.label+=" Chain";return e};l.mesh=function(e,t,o,s,a){var l,c,d,u,p,f=e.bodies;for(l=0;l<o;l++){for(c=1;c<t;c++){d=f[c-1+l*t];u=f[c+l*t];n.addConstraint(e,i.create(r.extend({bodyA:d,bodyB:u},a)))}if(l>0)for(c=0;c<t;c++){d=f[c+(l-1)*t];u=f[c+l*t];n.addConstraint(e,i.create(r.extend({bodyA:d,bodyB:u},a)));if(s&&c>0){p=f[c-1+(l-1)*t];n.addConstraint(e,i.create(r.extend({bodyA:p,bodyB:u},a)))}if(s&&c<t-1){p=f[c+1+(l-1)*t];n.addConstraint(e,i.create(r.extend({bodyA:p,bodyB:u},a)))}}}e.label+=" Mesh";return e};l.pyramid=function(e,t,o,n,i,r,a){return l.stack(e,t,o,n,i,r,function(t,r,l,c,d,u){var p,f,y,m=Math.min(n,Math.ceil(o/2)),g=d?d.bounds.max.x-d.bounds.min.x:0;if(!(c>m)){c=m-c;p=c,f=o-1-c;if(!(l<p||l>f)){1===u&&s.translate(d,{x:(l+(o%2===1?1:-1))*g,y:0});y=d?l*g:0;return a(e+y+l*i,r,l,c,d,u)}}})};l.newtonsCradle=function(e,t,o,r,s){var l,c,d,u,p=n.create({label:"Newtons Cradle"});for(l=0;l<o;l++){c=1.9,d=a.circle(e+l*(r*c),t+s,r,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),u=i.create({pointA:{x:e+l*(r*c),y:t},bodyB:d});n.addBody(p,d);n.addConstraint(p,u)}return p};l.car=function(e,t,o,r,l){var c=s.nextGroup(!0),d=-20,u=.5*-o+d,p=.5*o-d,f=0,y=n.create({label:"Car"}),m=a.trapezoid(e,t,o,r,.3,{collisionFilter:{group:c},friction:.01,chamfer:{radius:10}}),g=a.circle(e+u,t+f,l,{collisionFilter:{group:c},friction:.8,density:.01}),v=a.circle(e+p,t+f,l,{collisionFilter:{group:c},friction:.8,density:.01}),x=i.create({bodyA:m,pointA:{x:u,y:f},bodyB:g,stiffness:.2}),h=i.create({bodyA:m,pointA:{x:p,y:f},bodyB:v,stiffness:.2});n.addBody(y,m);n.addBody(y,g);n.addBody(y,v);n.addConstraint(y,x);n.addConstraint(y,h);return y};l.softBody=function(e,t,o,n,i,s,c,d,u,p){u=r.extend({inertia:1/0},u);p=r.extend({stiffness:.4},p);var f=l.stack(e,t,o,n,i,s,function(e,t){return a.circle(e,t,d,u)});l.mesh(f,o,n,c,p);f.label="Soft Body";return f}}()},{"../body/Body":1,"../body/Composite":2,"../constraint/Constraint":12,"../core/Common":14,"./Bodies":21}],23:[function(e,t,o){var n,i,r={};t.exports=r;n=e("../geometry/Vector");i=e("../core/Common");!function(){r.fromVertices=function(e){var t,o,r,s,a={};for(t=0;t<e.length;t++){o=(t+1)%e.length,r=n.normalise({x:e[o].y-e[t].y,y:e[t].x-e[o].x}),s=0===r.y?1/0:r.x/r.y;s=s.toFixed(3).toString();a[s]=r}return i.values(a)};r.rotate=function(e,t){var o,n,i,r,s;if(0!==t){o=Math.cos(t),n=Math.sin(t);for(i=0;i<e.length;i++){r=e[i];s=r.x*o-r.y*n;r.y=r.x*n+r.y*o;r.x=s}}}}()},{"../core/Common":14,"../geometry/Vector":26}],24:[function(e,t,o){var n={};t.exports=n;!function(){n.create=function(e){var t={min:{x:0,y:0},max:{x:0,y:0}};e&&n.update(t,e);return t};n.update=function(e,t,o){var n,i;e.min.x=1/0;e.max.x=-(1/0);e.min.y=1/0;e.max.y=-(1/0);for(n=0;n<t.length;n++){i=t[n];i.x>e.max.x&&(e.max.x=i.x);i.x<e.min.x&&(e.min.x=i.x);i.y>e.max.y&&(e.max.y=i.y);i.y<e.min.y&&(e.min.y=i.y)}if(o){o.x>0?e.max.x+=o.x:e.min.x+=o.x;o.y>0?e.max.y+=o.y:e.min.y+=o.y}};n.contains=function(e,t){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y};n.overlaps=function(e,t){return e.min.x<=t.max.x&&e.max.x>=t.min.x&&e.max.y>=t.min.y&&e.min.y<=t.max.y};n.translate=function(e,t){e.min.x+=t.x;e.max.x+=t.x;e.min.y+=t.y;e.max.y+=t.y};n.shift=function(e,t){var o=e.max.x-e.min.x,n=e.max.y-e.min.y;e.min.x=t.x;e.max.x=t.x+o;e.min.y=t.y;e.max.y=t.y+n}}()},{}],25:[function(e,t,o){var n,i={};t.exports=i;n=e("../geometry/Bounds");!function(){i.pathToVertices=function(t,o){var n,i,r,s,a,l,c,d,u,p,f,y,m,g,v=[],x=0,h=0,b=0;o=o||15;m=function(e,t,o){var n,i=o%2===1&&o>1;if(!u||e!=u.x||t!=u.y){if(u&&i){f=u.x;y=u.y}else{f=0;y=0}n={x:f+e,y:y+t};!i&&u||(u=n);v.push(n);h=f+e;b=y+t}};g=function(e){var t=e.pathSegTypeAsLetter.toUpperCase();if("Z"!==t){switch(t){case"M":case"L":case"T":case"C":case"S":case"Q":h=e.x;b=e.y;break;case"H":h=e.x;break;case"V":b=e.y}m(h,b,e.pathSegType)}};e(t);r=t.getTotalLength();l=[];for(n=0;n<t.pathSegList.numberOfItems;n+=1)l.push(t.pathSegList.getItem(n));c=l.concat();for(;x<r;){p=t.getPathSegAtLength(x);a=l[p];if(a!=d){for(;c.length&&c[0]!=a;)g(c.shift());d=a}switch(a.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":s=t.getPointAtLength(x);m(s.x,s.y,0)}x+=o}for(n=0,i=c.length;n<i;++n)g(c[n]);return v};var e=function(e){var t,o,n,i,r,s,a,l,c,d=e.pathSegList,u=0,p=0,f=d.numberOfItems;for(a=0;a<f;++a){l=d.getItem(a),c=l.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(c)){"x"in l&&(u=l.x);"y"in l&&(p=l.y)}else{"x1"in l&&(n=u+l.x1);"x2"in l&&(r=u+l.x2);"y1"in l&&(i=p+l.y1);"y2"in l&&(s=p+l.y2);"x"in l&&(u+=l.x);"y"in l&&(p+=l.y);switch(c){case"m":d.replaceItem(e.createSVGPathSegMovetoAbs(u,p),a);break;case"l":d.replaceItem(e.createSVGPathSegLinetoAbs(u,p),a);break;case"h":d.replaceItem(e.createSVGPathSegLinetoHorizontalAbs(u),a);break;case"v":d.replaceItem(e.createSVGPathSegLinetoVerticalAbs(p),a);break;case"c":d.replaceItem(e.createSVGPathSegCurvetoCubicAbs(u,p,n,i,r,s),a);break;case"s":d.replaceItem(e.createSVGPathSegCurvetoCubicSmoothAbs(u,p,r,s),a);break;case"q":d.replaceItem(e.createSVGPathSegCurvetoQuadraticAbs(u,p,n,i),a);break;case"t":d.replaceItem(e.createSVGPathSegCurvetoQuadraticSmoothAbs(u,p),a);break;case"a":d.replaceItem(e.createSVGPathSegArcAbs(u,p,l.r1,l.r2,l.angle,l.largeArcFlag,l.sweepFlag),a);break;case"z":case"Z":u=t;p=o}}if("M"==c||"m"==c){t=u;o=p}}}}()},{"../geometry/Bounds":24}],26:[function(e,t,o){var n={};t.exports=n;!function(){n.create=function(e,t){return{x:e||0,y:t||0}};n.clone=function(e){return{x:e.x,y:e.y}};n.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)};n.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y};n.rotate=function(e,t){var o=Math.cos(t),n=Math.sin(t);return{x:e.x*o-e.y*n,y:e.x*n+e.y*o}};n.rotateAbout=function(e,t,o,n){var i,r=Math.cos(t),s=Math.sin(t);n||(n={});i=o.x+((e.x-o.x)*r-(e.y-o.y)*s);n.y=o.y+((e.x-o.x)*s+(e.y-o.y)*r);n.x=i;return n};n.normalise=function(e){var t=n.magnitude(e);return 0===t?{x:0,y:0}:{x:e.x/t,y:e.y/t}};n.dot=function(e,t){return e.x*t.x+e.y*t.y};n.cross=function(e,t){return e.x*t.y-e.y*t.x};n.cross3=function(e,t,o){return(t.x-e.x)*(o.y-e.y)-(t.y-e.y)*(o.x-e.x)};n.add=function(e,t,o){o||(o={});o.x=e.x+t.x;o.y=e.y+t.y;return o};n.sub=function(e,t,o){o||(o={});o.x=e.x-t.x;o.y=e.y-t.y;return o};n.mult=function(e,t){return{x:e.x*t,y:e.y*t}};n.div=function(e,t){return{x:e.x/t,y:e.y/t}};n.perp=function(e,t){t=t===!0?-1:1;return{x:t*-e.y,y:t*e.x}};n.neg=function(e){return{x:-e.x,y:-e.y}};n.angle=function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)};n._temp=[n.create(),n.create(),n.create(),n.create(),n.create(),n.create()]}()},{}],27:[function(e,t,o){var n,i,r={};t.exports=r;n=e("../geometry/Vector");i=e("../core/Common");!function(){r.create=function(e,t){var o,n,i,r=[];for(o=0;o<e.length;o++){n=e[o],i={x:n.x,y:n.y,index:o,body:t,isInternal:!1};r.push(i)}return r};r.fromPath=function(e,t){var o=/L?\s*([\-\d\.e]+)[\s,]*([\-\d\.e]+)*/gi,n=[];e.replace(o,function(e,t,o){n.push({x:parseFloat(t),y:parseFloat(o)})});return r.create(n,t)};r.centre=function(e){var t,o,i,s,a=r.area(e,!0),l={x:0,y:0};for(s=0;s<e.length;s++){i=(s+1)%e.length;t=n.cross(e[s],e[i]);o=n.mult(n.add(e[s],e[i]),t);l=n.add(l,o)}return n.div(l,6*a)};r.mean=function(e){var t,o={x:0,y:0};for(t=0;t<e.length;t++){o.x+=e[t].x;o.y+=e[t].y}return n.div(o,e.length)};r.area=function(e,t){var o,n=0,i=e.length-1;for(o=0;o<e.length;o++){n+=(e[i].x-e[o].x)*(e[i].y+e[o].y);i=o}return t?n/2:Math.abs(n)/2};r.inertia=function(e,t){var o,i,r,s=0,a=0,l=e;for(r=0;r<l.length;r++){i=(r+1)%l.length;o=Math.abs(n.cross(l[i],l[r]));s+=o*(n.dot(l[i],l[i])+n.dot(l[i],l[r])+n.dot(l[r],l[r]));a+=o}return t/6*(s/a)};r.translate=function(e,t,o){var n;if(o)for(n=0;n<e.length;n++){e[n].x+=t.x*o;e[n].y+=t.y*o}else for(n=0;n<e.length;n++){e[n].x+=t.x;e[n].y+=t.y}return e};r.rotate=function(e,t,o){var n,i,r,s,a,l;if(0!==t){n=Math.cos(t),i=Math.sin(t);for(r=0;r<e.length;r++){s=e[r],a=s.x-o.x,l=s.y-o.y;s.x=o.x+(a*n-l*i);s.y=o.y+(a*i+l*n)}return e}};r.contains=function(e,t){var o,n,i;for(o=0;o<e.length;o++){n=e[o],i=e[(o+1)%e.length];if((t.x-n.x)*(i.y-n.y)+(t.y-n.y)*(n.x-i.x)>0)return!1}return!0};r.scale=function(e,t,o,i){var s,a,l;if(1===t&&1===o)return e;i=i||r.centre(e);for(l=0;l<e.length;l++){s=e[l];a=n.sub(s,i);e[l].x=i.x+a.x*t;e[l].y=i.y+a.y*o}return e};r.chamfer=function(e,t,o,r,s){var a,l,c,d,u,p,f,y,m,g,v,x,h,b,S,C;t=t||[8];t.length||(t=[t]);o="undefined"!==typeof o?o:-1;r=r||2;s=s||14;a=[];for(l=0;l<e.length;l++){c=e[l-1>=0?l-1:e.length-1],d=e[l],u=e[(l+1)%e.length],p=t[l<t.length?l:t.length-1];if(0!==p){f=n.normalise({x:d.y-c.y,y:c.x-d.x});y=n.normalise({x:u.y-d.y,y:d.x-u.x});m=Math.sqrt(2*Math.pow(p,2)),g=n.mult(i.clone(f),p),v=n.normalise(n.mult(n.add(f,y),.5)),x=n.sub(d,n.mult(v,m));h=o;-1===o&&(h=1.75*Math.pow(p,.32));h=i.clamp(h,r,s);h%2===1&&(h+=1);b=Math.acos(n.dot(f,y)),S=b/h;for(C=0;C<h;C++)a.push(n.add(n.rotate(g,S*C),x))}else a.push(d)}return a};r.clockwiseSort=function(e){var t=r.mean(e);e.sort(function(e,o){return n.angle(t,e)-n.angle(t,o)});return e};r.isConvex=function(e){var t,o,n,i,r=0,s=e.length;if(s<3)return null;for(t=0;t<s;t++){o=(t+1)%s;n=(t+2)%s;i=(e[o].x-e[t].x)*(e[n].y-e[o].y);i-=(e[o].y-e[t].y)*(e[n].x-e[o].x);i<0?r|=1:i>0&&(r|=2);if(3===r)return!1}return 0!==r?!0:null};r.hull=function(e){var t,o,i=[],r=[];e=e.slice(0);e.sort(function(e,t){var o=e.x-t.x;return 0!==o?o:e.y-t.y});for(o=0;o<e.length;o++){t=e[o];for(;r.length>=2&&n.cross3(r[r.length-2],r[r.length-1],t)<=0;)r.pop();r.push(t)}for(o=e.length-1;o>=0;o--){t=e[o];for(;i.length>=2&&n.cross3(i[i.length-2],i[i.length-1],t)<=0;)i.pop();i.push(t)}i.pop();r.pop();return i.concat(r)}}()},{"../core/Common":14,"../geometry/Vector":26}],28:[function(e,t,o){var n=t.exports={};n.version="master";n.Body=e("../body/Body");n.Composite=e("../body/Composite");n.World=e("../body/World");n.Contact=e("../collision/Contact");n.Detector=e("../collision/Detector");n.Grid=e("../collision/Grid");n.Pairs=e("../collision/Pairs");n.Pair=e("../collision/Pair");n.Query=e("../collision/Query");n.Resolver=e("../collision/Resolver");n.SAT=e("../collision/SAT");n.Constraint=e("../constraint/Constraint");n.MouseConstraint=e("../constraint/MouseConstraint");n.Common=e("../core/Common");n.Engine=e("../core/Engine");n.Events=e("../core/Events");n.Mouse=e("../core/Mouse");n.Runner=e("../core/Runner");n.Sleeping=e("../core/Sleeping");n.Bodies=e("../factory/Bodies");n.Composites=e("../factory/Composites");n.Axes=e("../geometry/Axes");n.Bounds=e("../geometry/Bounds");n.Svg=e("../geometry/Svg");n.Vector=e("../geometry/Vector");n.Vertices=e("../geometry/Vertices");n.Render=e("../render/Render");n.RenderPixi=e("../render/RenderPixi");n.World.add=n.Composite.add;n.World.remove=n.Composite.remove;n.World.addComposite=n.Composite.addComposite;n.World.addBody=n.Composite.addBody;n.World.addConstraint=n.Composite.addConstraint;n.World.clear=n.Composite.clear;n.Engine.run=n.Runner.run},{"../body/Body":1,"../body/Composite":2,"../body/World":3,"../collision/Contact":4,"../collision/Detector":5,"../collision/Grid":6,"../collision/Pair":7,"../collision/Pairs":8,"../collision/Query":9,"../collision/Resolver":10,"../collision/SAT":11,"../constraint/Constraint":12,"../constraint/MouseConstraint":13,"../core/Common":14,"../core/Engine":15,"../core/Events":16,"../core/Metrics":17,"../core/Mouse":18,"../core/Runner":19,"../core/Sleeping":20,"../factory/Bodies":21,"../factory/Composites":22,"../geometry/Axes":23,"../geometry/Bounds":24,"../geometry/Svg":25,"../geometry/Vector":26,"../geometry/Vertices":27,"../render/Render":29,"../render/RenderPixi":30}],29:[function(e,t,o){var n,i,r,s,a,l,c={};t.exports=c;n=e("../core/Common");i=e("../body/Composite");r=e("../geometry/Bounds");s=e("../core/Events");a=e("../collision/Grid");l=e("../geometry/Vector");!function(){var e,t,o,d;c.create=function(t){var o={controller:c,element:null,canvas:null,mouse:null,options:{width:800,height:600,pixelRatio:1,background:"#fafafa",wireframeBackground:"#222",hasBounds:!!t.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},i=n.extend(o,t);if(i.canvas){i.canvas.width=i.options.width||i.canvas.width;i.canvas.height=i.options.height||i.canvas.height}i.canvas=i.canvas||e(i.options.width,i.options.height);i.context=i.canvas.getContext("2d");i.textures={};i.bounds=i.bounds||{min:{x:0,y:0},max:{x:i.canvas.width,y:i.canvas.height}};1!==i.options.pixelRatio&&c.setPixelRatio(i,i.options.pixelRatio);n.isElement(i.element)?i.element.appendChild(i.canvas):n.log("Render.create: options.element was undefined, render.canvas was created but not appended","warn");return i};c.setPixelRatio=function(e,o){var n=e.options,i=e.canvas;"auto"===o&&(o=t(i));n.pixelRatio=o;i.setAttribute("data-pixel-ratio",o);i.width=n.width*o;i.height=n.height*o;i.style.width=n.width+"px";i.style.height=n.height+"px";e.context.scale(o,o)};c.world=function(e){var t,o,n,u,p,f,y,m,g,v,x,h=e.render,b=e.world,S=h.canvas,C=h.context,w=h.options,A=i.allBodies(b),B=i.allConstraints(b),P=w.wireframes?w.wireframeBackground:w.background,M=[],k=[],I={timestamp:e.timing.timestamp};s.trigger(h,"beforeRender",I);h.currentBackground!==P&&d(h,P);C.globalCompositeOperation="source-in";C.fillStyle="transparent";C.fillRect(0,0,S.width,S.height);C.globalCompositeOperation="source-over";if(w.hasBounds){o=h.bounds.max.x-h.bounds.min.x,n=h.bounds.max.y-h.bounds.min.y,u=o/w.width,p=n/w.height;for(t=0;t<A.length;t++){f=A[t];r.overlaps(f.bounds,h.bounds)&&M.push(f)}for(t=0;t<B.length;t++){y=B[t],m=y.bodyA,g=y.bodyB,v=y.pointA,x=y.pointB;m&&(v=l.add(m.position,y.pointA));g&&(x=l.add(g.position,y.pointB));v&&x&&(r.contains(h.bounds,v)||r.contains(h.bounds,x))&&k.push(y)}C.scale(1/u,1/p);C.translate(-h.bounds.min.x,-h.bounds.min.y)}else{k=B;M=A}if(!w.wireframes||e.enableSleeping&&w.showSleeping)c.bodies(e,M,C);else{w.showConvexHulls&&c.bodyConvexHulls(e,M,C);c.bodyWireframes(e,M,C)}w.showBounds&&c.bodyBounds(e,M,C);(w.showAxes||w.showAngleIndicator)&&c.bodyAxes(e,M,C);w.showPositions&&c.bodyPositions(e,M,C);w.showVelocity&&c.bodyVelocity(e,M,C);w.showIds&&c.bodyIds(e,M,C);w.showSeparations&&c.separations(e,e.pairs.list,C);w.showCollisions&&c.collisions(e,e.pairs.list,C);w.showVertexNumbers&&c.vertexNumbers(e,M,C);w.showMousePosition&&c.mousePosition(e,h.mouse,C);c.constraints(k,C);w.showBroadphase&&e.broadphase.controller===a&&c.grid(e,e.broadphase,C);w.showDebug&&c.debug(e,C);w.hasBounds&&C.setTransform(w.pixelRatio,0,0,w.pixelRatio,0,0);s.trigger(h,"afterRender",I)};c.debug=function(e,t){var o,n,r,s=t,a=e.world,l=e.render,c=e.metrics,d=l.options,u=(i.allBodies(a),"    ");if(e.timing.timestamp-(l.debugTimestamp||0)>=500){o="";c.timing&&(o+="fps: "+Math.round(c.timing.fps)+u);l.debugString=o;l.debugTimestamp=e.timing.timestamp}if(l.debugString){s.font="12px Arial";d.wireframes?s.fillStyle="rgba(255,255,255,0.5)":s.fillStyle="rgba(0,0,0,0.5)";n=l.debugString.split("\n");for(r=0;r<n.length;r++)s.fillText(n[r],50,50+18*r)}};c.constraints=function(e,t){var o,n,i,r,s=t;for(o=0;o<e.length;o++){n=e[o];if(n.render.visible&&n.pointA&&n.pointB){i=n.bodyA,r=n.bodyB;if(i){s.beginPath();s.moveTo(i.position.x+n.pointA.x,i.position.y+n.pointA.y)}else{s.beginPath();s.moveTo(n.pointA.x,n.pointA.y)}r?s.lineTo(r.position.x+n.pointB.x,r.position.y+n.pointB.y):s.lineTo(n.pointB.x,n.pointB.y);s.lineWidth=n.render.lineWidth;s.strokeStyle=n.render.strokeStyle;s.stroke()}}};c.bodyShadows=function(e,t,o){var n,i,r,s,a,l,c=o,d=e.render;for(n=0;n<t.length;n++){i=t[n];if(i.render.visible){if(i.circleRadius){c.beginPath();c.arc(i.position.x,i.position.y,i.circleRadius,0,2*Math.PI);c.closePath()}else{c.beginPath();c.moveTo(i.vertices[0].x,i.vertices[0].y);for(r=1;r<i.vertices.length;r++)c.lineTo(i.vertices[r].x,i.vertices[r].y);c.closePath()}s=i.position.x-.5*d.options.width,a=i.position.y-.2*d.options.height,l=Math.abs(s)+Math.abs(a);c.shadowColor="rgba(0,0,0,0.15)";c.shadowOffsetX=.05*s;c.shadowOffsetY=.05*a;c.shadowBlur=1+12*Math.min(1,l/1e3);c.fill();c.shadowColor=null;c.shadowOffsetX=null;c.shadowOffsetY=null;c.shadowBlur=null}}};c.bodies=function(e,t,n){var i,r,s,a,l,c,d,u=n,p=e.render,f=p.options,y=f.showInternalEdges||!f.wireframes;for(s=0;s<t.length;s++){i=t[s];if(i.render.visible)for(a=i.parts.length>1?1:0;a<i.parts.length;a++){r=i.parts[a];if(r.render.visible){f.showSleeping&&i.isSleeping?u.globalAlpha=.5*r.render.opacity:1!==r.render.opacity&&(u.globalAlpha=r.render.opacity);if(r.render.sprite&&r.render.sprite.texture&&!f.wireframes){l=r.render.sprite,c=o(p,l.texture);u.translate(r.position.x,r.position.y);u.rotate(r.angle);u.drawImage(c,c.width*-l.xOffset*l.xScale,c.height*-l.yOffset*l.yScale,c.width*l.xScale,c.height*l.yScale);u.rotate(-r.angle);u.translate(-r.position.x,-r.position.y)}else{if(r.circleRadius){u.beginPath();u.arc(r.position.x,r.position.y,r.circleRadius,0,2*Math.PI);
}else{u.beginPath();u.moveTo(r.vertices[0].x,r.vertices[0].y);for(d=1;d<r.vertices.length;d++){!r.vertices[d-1].isInternal||y?u.lineTo(r.vertices[d].x,r.vertices[d].y):u.moveTo(r.vertices[d].x,r.vertices[d].y);r.vertices[d].isInternal&&!y&&u.moveTo(r.vertices[(d+1)%r.vertices.length].x,r.vertices[(d+1)%r.vertices.length].y)}u.lineTo(r.vertices[0].x,r.vertices[0].y);u.closePath()}if(f.wireframes){u.lineWidth=1;u.strokeStyle="#bbb"}else{u.fillStyle=r.render.fillStyle;u.lineWidth=r.render.lineWidth;u.strokeStyle=r.render.strokeStyle;u.fill()}u.stroke()}u.globalAlpha=1}}}};c.bodyWireframes=function(e,t,o){var n,i,r,s,a,l=o,c=e.render.options.showInternalEdges;l.beginPath();for(r=0;r<t.length;r++){n=t[r];if(n.render.visible)for(a=n.parts.length>1?1:0;a<n.parts.length;a++){i=n.parts[a];l.moveTo(i.vertices[0].x,i.vertices[0].y);for(s=1;s<i.vertices.length;s++){!i.vertices[s-1].isInternal||c?l.lineTo(i.vertices[s].x,i.vertices[s].y):l.moveTo(i.vertices[s].x,i.vertices[s].y);i.vertices[s].isInternal&&!c&&l.moveTo(i.vertices[(s+1)%i.vertices.length].x,i.vertices[(s+1)%i.vertices.length].y)}l.lineTo(i.vertices[0].x,i.vertices[0].y)}}l.lineWidth=1;l.strokeStyle="#bbb";l.stroke()};c.bodyConvexHulls=function(e,t,o){var n,i,r,s=o;s.beginPath();for(i=0;i<t.length;i++){n=t[i];if(n.render.visible&&1!==n.parts.length){s.moveTo(n.vertices[0].x,n.vertices[0].y);for(r=1;r<n.vertices.length;r++)s.lineTo(n.vertices[r].x,n.vertices[r].y);s.lineTo(n.vertices[0].x,n.vertices[0].y)}}s.lineWidth=1;s.strokeStyle="rgba(255,255,255,0.2)";s.stroke()};c.vertexNumbers=function(e,t,o){var n,i,r,s,a,l=o;for(n=0;n<t.length;n++){s=t[n].parts;for(r=s.length>1?1:0;r<s.length;r++){a=s[r];for(i=0;i<a.vertices.length;i++){l.fillStyle="rgba(255,255,255,0.2)";l.fillText(n+"_"+i,a.position.x+.8*(a.vertices[i].x-a.position.x),a.position.y+.8*(a.vertices[i].y-a.position.y))}}}};c.mousePosition=function(e,t,o){var n=o;n.fillStyle="rgba(255,255,255,0.8)";n.fillText(t.position.x+"  "+t.position.y,t.position.x+5,t.position.y-5)};c.bodyBounds=function(e,t,o){var n,i,r,s,a,l=o,c=e.render,d=c.options;l.beginPath();for(n=0;n<t.length;n++){i=t[n];if(i.render.visible){r=t[n].parts;for(s=r.length>1?1:0;s<r.length;s++){a=r[s];l.rect(a.bounds.min.x,a.bounds.min.y,a.bounds.max.x-a.bounds.min.x,a.bounds.max.y-a.bounds.min.y)}}}d.wireframes?l.strokeStyle="rgba(255,255,255,0.08)":l.strokeStyle="rgba(0,0,0,0.1)";l.lineWidth=1;l.stroke()};c.bodyAxes=function(e,t,o){var n,i,r,s,a,l,c,d=o,u=e.render,p=u.options;d.beginPath();for(i=0;i<t.length;i++){a=t[i],l=a.parts;if(a.render.visible)if(p.showAxes)for(r=l.length>1?1:0;r<l.length;r++){n=l[r];for(s=0;s<n.axes.length;s++){c=n.axes[s];d.moveTo(n.position.x,n.position.y);d.lineTo(n.position.x+20*c.x,n.position.y+20*c.y)}}else for(r=l.length>1?1:0;r<l.length;r++){n=l[r];for(s=0;s<n.axes.length;s++){d.moveTo(n.position.x,n.position.y);d.lineTo((n.vertices[0].x+n.vertices[n.vertices.length-1].x)/2,(n.vertices[0].y+n.vertices[n.vertices.length-1].y)/2)}}}if(p.wireframes)d.strokeStyle="indianred";else{d.strokeStyle="rgba(0,0,0,0.8)";d.globalCompositeOperation="overlay"}d.lineWidth=1;d.stroke();d.globalCompositeOperation="source-over"};c.bodyPositions=function(e,t,o){var n,i,r,s,a=o,l=e.render,c=l.options;a.beginPath();for(r=0;r<t.length;r++){n=t[r];if(n.render.visible)for(s=0;s<n.parts.length;s++){i=n.parts[s];a.arc(i.position.x,i.position.y,3,0,2*Math.PI,!1);a.closePath()}}c.wireframes?a.fillStyle="indianred":a.fillStyle="rgba(0,0,0,0.5)";a.fill();a.beginPath();for(r=0;r<t.length;r++){n=t[r];if(n.render.visible){a.arc(n.positionPrev.x,n.positionPrev.y,2,0,2*Math.PI,!1);a.closePath()}}a.fillStyle="rgba(255,165,0,0.8)";a.fill()};c.bodyVelocity=function(e,t,o){var n,i,r=o;r.beginPath();for(n=0;n<t.length;n++){i=t[n];if(i.render.visible){r.moveTo(i.position.x,i.position.y);r.lineTo(i.position.x+2*(i.position.x-i.positionPrev.x),i.position.y+2*(i.position.y-i.positionPrev.y))}}r.lineWidth=3;r.strokeStyle="cornflowerblue";r.stroke()};c.bodyIds=function(e,t,o){var n,i,r,s,a=o;for(n=0;n<t.length;n++)if(t[n].render.visible){r=t[n].parts;for(i=r.length>1?1:0;i<r.length;i++){s=r[i];a.font="12px Arial";a.fillStyle="rgba(255,255,255,0.5)";a.fillText(s.id,s.position.x+10,s.position.y-10)}}};c.collisions=function(e,t,o){var n,i,r,s,a,l,c,d,u=o,p=e.render.options;u.beginPath();for(r=0;r<t.length;r++){n=t[r];if(n.isActive){i=n.collision;for(s=0;s<n.activeContacts.length;s++){a=n.activeContacts[s],l=a.vertex;u.rect(l.x-1.5,l.y-1.5,3.5,3.5)}}}p.wireframes?u.fillStyle="rgba(255,255,255,0.7)":u.fillStyle="orange";u.fill();u.beginPath();for(r=0;r<t.length;r++){n=t[r];if(n.isActive){i=n.collision;if(n.activeContacts.length>0){c=n.activeContacts[0].vertex.x,d=n.activeContacts[0].vertex.y;if(2===n.activeContacts.length){c=(n.activeContacts[0].vertex.x+n.activeContacts[1].vertex.x)/2;d=(n.activeContacts[0].vertex.y+n.activeContacts[1].vertex.y)/2}i.bodyB===i.supports[0].body||i.bodyA.isStatic===!0?u.moveTo(c-8*i.normal.x,d-8*i.normal.y):u.moveTo(c+8*i.normal.x,d+8*i.normal.y);u.lineTo(c,d)}}}p.wireframes?u.strokeStyle="rgba(255,165,0,0.7)":u.strokeStyle="orange";u.lineWidth=1;u.stroke()};c.separations=function(e,t,o){var n,i,r,s,a,l,c=o,d=e.render.options;c.beginPath();for(a=0;a<t.length;a++){n=t[a];if(n.isActive){i=n.collision;r=i.bodyA;s=i.bodyB;l=1;s.isStatic||r.isStatic||(l=.5);s.isStatic&&(l=0);c.moveTo(s.position.x,s.position.y);c.lineTo(s.position.x-i.penetration.x*l,s.position.y-i.penetration.y*l);l=1;s.isStatic||r.isStatic||(l=.5);r.isStatic&&(l=0);c.moveTo(r.position.x,r.position.y);c.lineTo(r.position.x+i.penetration.x*l,r.position.y+i.penetration.y*l)}}d.wireframes?c.strokeStyle="rgba(255,165,0,0.5)":c.strokeStyle="orange";c.stroke()};c.grid=function(e,t,o){var i,r,s,a,l=o,c=e.render.options;c.wireframes?l.strokeStyle="rgba(255,180,0,0.1)":l.strokeStyle="rgba(255,180,0,0.5)";l.beginPath();i=n.keys(t.buckets);for(r=0;r<i.length;r++){s=i[r];if(!(t.buckets[s].length<2)){a=s.split(",");l.rect(.5+parseInt(a[0],10)*t.bucketWidth,.5+parseInt(a[1],10)*t.bucketHeight,t.bucketWidth,t.bucketHeight)}}l.lineWidth=1;l.stroke()};c.inspector=function(e,t){var o,n,i,r,s,a,l,c,d=e.engine,u=e.selected,p=d.render,f=p.options;if(f.hasBounds){n=p.bounds.max.x-p.bounds.min.x,i=p.bounds.max.y-p.bounds.min.y,r=n/p.options.width,s=i/p.options.height;t.scale(1/r,1/s);t.translate(-p.bounds.min.x,-p.bounds.min.y)}for(a=0;a<u.length;a++){l=u[a].data;t.translate(.5,.5);t.lineWidth=1;t.strokeStyle="rgba(255,165,0,0.9)";t.setLineDash([1,2]);switch(l.type){case"body":o=l.bounds;t.beginPath();t.rect(Math.floor(o.min.x-3),Math.floor(o.min.y-3),Math.floor(o.max.x-o.min.x+6),Math.floor(o.max.y-o.min.y+6));t.closePath();t.stroke();break;case"constraint":c=l.pointA;l.bodyA&&(c=l.pointB);t.beginPath();t.arc(c.x,c.y,10,0,2*Math.PI);t.closePath();t.stroke()}t.setLineDash([]);t.translate(-.5,-.5)}if(null!==e.selectStart){t.translate(.5,.5);t.lineWidth=1;t.strokeStyle="rgba(255,165,0,0.6)";t.fillStyle="rgba(255,165,0,0.1)";o=e.selectBounds;t.beginPath();t.rect(Math.floor(o.min.x),Math.floor(o.min.y),Math.floor(o.max.x-o.min.x),Math.floor(o.max.y-o.min.y));t.closePath();t.stroke();t.fill();t.translate(-.5,-.5)}f.hasBounds&&t.setTransform(1,0,0,1,0,0)};e=function(e,t){var o=document.createElement("canvas");o.width=e;o.height=t;o.oncontextmenu=function(){return!1};o.onselectstart=function(){return!1};return o};t=function(e){var t=e.getContext("2d"),o=window.devicePixelRatio||1,n=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return o/n};o=function(e,t){var o=e.textures[t];if(o)return o;o=e.textures[t]=new Image;o.src=t;return o};d=function(e,t){var o=t;/(jpg|gif|png)$/.test(t)&&(o="url("+t+")");e.canvas.style.background=o;e.canvas.style.backgroundSize="contain";e.currentBackground=t}}()},{"../body/Composite":2,"../collision/Grid":6,"../core/Common":14,"../core/Events":16,"../geometry/Bounds":24,"../geometry/Vector":26}],30:[function(e,t,o){var n,i,r={};t.exports=r;n=e("../body/Composite");i=e("../core/Common");!function(){var e,t,o;r.create=function(e){var t={controller:r,element:null,canvas:null,renderer:null,container:null,spriteContainer:null,pixiOptions:null,options:{width:800,height:600,background:"#fafafa",wireframeBackground:"#222",hasBounds:!1,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1}},o=i.extend(t,e),n=!o.options.wireframes&&"transparent"===o.options.background;o.pixiOptions=o.pixiOptions||{view:o.canvas,transparent:n,antialias:!0,backgroundColor:e.background};o.renderer=o.renderer||new PIXI.WebGLRenderer(o.options.width,o.options.height,o.pixiOptions);o.container=o.container||new PIXI.Container;o.spriteContainer=o.spriteContainer||new PIXI.Container;o.canvas=o.canvas||o.renderer.view;o.bounds=o.bounds||{min:{x:0,y:0},max:{x:o.options.width,y:o.options.height}};o.textures={};o.sprites={};o.primitives={};o.container.addChild(o.spriteContainer);i.isElement(o.element)?o.element.appendChild(o.canvas):i.log('No "render.element" passed, "render.canvas" was not inserted into document.',"warn");o.canvas.oncontextmenu=function(){return!1};o.canvas.onselectstart=function(){return!1};return o};r.clear=function(e){for(var t,o=e.container,n=e.spriteContainer;o.children[0];)o.removeChild(o.children[0]);for(;n.children[0];)n.removeChild(n.children[0]);t=e.sprites["bg-0"];e.textures={};e.sprites={};e.primitives={};e.sprites["bg-0"]=t;t&&o.addChildAt(t,0);e.container.addChild(e.spriteContainer);e.currentBackground=null;o.scale.set(1,1);o.position.set(0,0)};r.setBackground=function(e,t){var n,r,s,a;if(e.currentBackground!==t){n=t.indexOf&&-1!==t.indexOf("#"),r=e.sprites["bg-0"];if(n){s=i.colorToNumber(t);e.renderer.backgroundColor=s;r&&e.container.removeChild(r)}else if(!r){a=o(e,t);r=e.sprites["bg-0"]=new PIXI.Sprite(a);r.position.x=0;r.position.y=0;e.container.addChildAt(r,0)}e.currentBackground=t}};r.world=function(e){var t,o,i,s,a,l,c,d,u,p,f,y=e.render,m=e.world,g=y.renderer,v=y.container,x=y.options,h=n.allBodies(m),b=n.allConstraints(m),S=[];x.wireframes?r.setBackground(y,x.wireframeBackground):r.setBackground(y,x.background);o=y.bounds.max.x-y.bounds.min.x,i=y.bounds.max.y-y.bounds.min.y,s=o/y.options.width,a=i/y.options.height;if(x.hasBounds){for(t=0;t<h.length;t++){l=h[t];l.render.sprite.visible=Bounds.overlaps(l.bounds,y.bounds)}for(t=0;t<b.length;t++){c=b[t],d=c.bodyA,u=c.bodyB,p=c.pointA,f=c.pointB;d&&(p=Vector.add(d.position,c.pointA));u&&(f=Vector.add(u.position,c.pointB));p&&f&&(Bounds.contains(y.bounds,p)||Bounds.contains(y.bounds,f))&&S.push(c)}v.scale.set(1/s,1/a);v.position.set(-y.bounds.min.x*(1/s),-y.bounds.min.y*(1/a))}else S=b;for(t=0;t<h.length;t++)r.body(e,h[t]);for(t=0;t<S.length;t++)r.constraint(e,S[t]);g.render(v)};r.constraint=function(e,t){var o=e.render,n=t.bodyA,r=t.bodyB,s=t.pointA,a=t.pointB,l=o.container,c=t.render,d="c-"+t.id,u=o.primitives[d];u||(u=o.primitives[d]=new PIXI.Graphics);if(c.visible&&t.pointA&&t.pointB){-1===i.indexOf(l.children,u)&&l.addChild(u);u.clear();u.beginFill(0,0);u.lineStyle(c.lineWidth,i.colorToNumber(c.strokeStyle),1);n?u.moveTo(n.position.x+s.x,n.position.y+s.y):u.moveTo(s.x,s.y);r?u.lineTo(r.position.x+a.x,r.position.y+a.y):u.lineTo(a.x,a.y);u.endFill()}else u.clear()};r.body=function(o,n){var r,s,a,l,c,d,u=o.render,p=n.render;if(p.visible)if(p.sprite&&p.sprite.texture){r="b-"+n.id,s=u.sprites[r],a=u.spriteContainer;s||(s=u.sprites[r]=e(u,n));-1===i.indexOf(a.children,s)&&a.addChild(s);s.position.x=n.position.x;s.position.y=n.position.y;s.rotation=n.angle;s.scale.x=p.sprite.xScale||1;s.scale.y=p.sprite.yScale||1}else{l="b-"+n.id,c=u.primitives[l],d=u.container;if(!c){c=u.primitives[l]=t(u,n);c.initialAngle=n.angle}-1===i.indexOf(d.children,c)&&d.addChild(c);c.position.x=n.position.x;c.position.y=n.position.y;c.rotation=n.angle-c.initialAngle}};e=function(e,t){var n=t.render,i=n.sprite.texture,r=o(e,i),s=new PIXI.Sprite(r);s.anchor.x=t.render.sprite.xOffset;s.anchor.y=t.render.sprite.yOffset;return s};t=function(e,t){var o,n,r,s=t.render,a=e.options,l=new PIXI.Graphics,c=i.colorToNumber(s.fillStyle),d=i.colorToNumber(s.strokeStyle),u=i.colorToNumber(s.strokeStyle),p=i.colorToNumber("#bbb"),f=i.colorToNumber("#CD5C5C");l.clear();for(n=t.parts.length>1?1:0;n<t.parts.length;n++){o=t.parts[n];if(a.wireframes){l.beginFill(0,0);l.lineStyle(1,p,1)}else{l.beginFill(c,1);l.lineStyle(s.lineWidth,d,1)}l.moveTo(o.vertices[0].x-t.position.x,o.vertices[0].y-t.position.y);for(r=1;r<o.vertices.length;r++)l.lineTo(o.vertices[r].x-t.position.x,o.vertices[r].y-t.position.y);l.lineTo(o.vertices[0].x-t.position.x,o.vertices[0].y-t.position.y);l.endFill();if(a.showAngleIndicator||a.showAxes){l.beginFill(0,0);a.wireframes?l.lineStyle(1,f,1):l.lineStyle(1,u);l.moveTo(o.position.x-t.position.x,o.position.y-t.position.y);l.lineTo((o.vertices[0].x+o.vertices[o.vertices.length-1].x)/2-t.position.x,(o.vertices[0].y+o.vertices[o.vertices.length-1].y)/2-t.position.y);l.endFill()}}return l};o=function(e,t){var o=e.textures[t];o||(o=e.textures[t]=PIXI.Texture.fromImage(t));return o}}()},{"../body/Composite":2,"../core/Common":14}]},{},[28])(28)});
var Browser=laya.utils.Browser,Composite=Matter.Composite,Events=Matter.Events,Bounds=Matter.Bounds,Common=Matter.Common,Vertices=Matter.Vertices,Vector=Matter.Vector,Sleeping=Matter.Sleeping,Axes=Matter.Axes,Body=Matter.Body,SAT=Matter.SAT,Contact=Matter.Contact,Pair=Matter.Pair,Detector=Matter.Detector,Grid=Matter.Grid,LayaRender={};!function(){function e(e){var t=e.container;n=new Laya.Sprite;i=new Laya.Sprite;e.spriteContainer=n;e.graphicsContainer=i;t.addChild(n);t.addChild(i);o=i.graphics}function t(e){var t=e.options.background;7==t.length&&"#"==t[0]?n.graphics.drawRect(0,0,e.options.width,e.options.height,t):n.loadImage(t)}function r(){var e;e=0==Laya.stage.useHDRendering?1:1/Browser.pixelRatio;Laya.Render.canvas.source.setAttribute("data-pixel-ratio",e)}var o,n,i;LayaRender.create=function(o){var n={controller:LayaRender,element:null,canvas:null,mouse:null,options:{width:800,height:600,pixelRatio:1,background:"#fafafa",wireframeBackground:"#222",hasBounds:!!o.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},i=Common.extend(n,o);i.canvas=laya.renders.Render.canvas.source;i.context=laya.renders.Render.context.ctx;i.textures={};i.bounds=i.bounds||{min:{x:0,y:0},max:{x:Laya.stage.width,y:Laya.stage.height}};e(i);t(i);r();return i};LayaRender.world=function(e){var t,r,n,i,a,s,d,p,l,c,h,u=e.render,y=e.world,v=u.options,w=Composite.allConstraints(y),f=Composite.allBodies(y),g=[];if(v.hasBounds){r=u.bounds.max.x-u.bounds.min.x,n=u.bounds.max.y-u.bounds.min.y,i=r/v.width,a=n/v.height;for(t=0;t<f.length;t++){s=f[t];s.render.sprite.visible=Bounds.overlaps(s.bounds,u.bounds)}for(t=0;t<w.length;t++){d=w[t],p=d.bodyA,l=d.bodyB,c=d.pointA,h=d.pointB;p&&(c=Vector.add(p.position,d.pointA));l&&(h=Vector.add(l.position,d.pointB));c&&h&&(Bounds.contains(u.bounds,c)||Bounds.contains(u.bounds,h))&&g.push(d)}}else g=w;o.clear();for(t=0;t<f.length;t++)LayaRender.body(e,f[t]);for(t=0;t<g.length;t++)LayaRender.constraint(e,g[t])};LayaRender.body=function(e,t){var r,i,a,s,d,p,l=e.render,c=t.render,h=c.sprite,u=t._display;if(c.visible){u&&(u.visible=!0);if(u){if(!t._isInitSprite){u=t._display;u.pivot(h.xOffset,h.yOffset);u.pos(-9999,-9999);n.addChild(u);t._isInitSprite=!0}u.scale(h.xScale,h.yScale);u.pos(t.position.x,t.position.y);u.rotation=180*t.angle/Math.PI}else{r=l.options;for(k=t.parts.length>1?1:0;k<t.parts.length;k++){part=t.parts[k];if(part.render.visible){i=r.wireframes?null:part.render.fillStyle;a=part.render.lineWidth;s=part.render.strokeStyle;if(part.circleRadius)o.drawCircle(part.position.x,part.position.y,part.circleRadius,i,s,a);else{d=[];d.push(part.vertices[0].x,part.vertices[0].y);for(p=1;p<part.vertices.length;p++){!part.vertices[p-1].isInternal||showInternalEdges?d.push(part.vertices[p].x,part.vertices[p].y):d.push(part.vertices[p].x,part.vertices[p].y);part.vertices[p].isInternal&&!showInternalEdges&&d.push(part.vertices[(p+1)%part.vertices.length].x,part.vertices[(p+1)%part.vertices.length].y)}o.drawPoly(0,0,d,i,s,a)}}}}}else u&&(u.visible=!1)};LayaRender.constraint=function(e,t){var r,n,i,a,s,d;if(t.render.visible&&t.pointA&&t.pointB){s=t.bodyA,d=t.bodyB;if(s){r=s.position.x+t.pointA.x;n=s.position.y+t.pointA.y}else{r=t.pointA.x;n=t.pointA.y}if(d){i=d.position.x+t.pointB.x;a=d.position.y+t.pointB.y}else{i=t.pointB.x;a=t.pointB.y}o.drawLine(r,n,i,a,t.render.strokeStyle,t.render.lineWidth)}}}();
var CLASS$=Laya["class"],STATICATTR$=Laya["static"],View=laya.ui.View,Dialog=laya.ui.Dialog,end_pageUI=function(e){function t(){this.btn_restart;this.plane;this.lab_score;this.lab_bestScore;t.__super.call(this)}CLASS$(t,"game.ui.test.end_pageUI",e);var i=t.prototype;i.createChildren=function(){laya.ui.Component.prototype.createChildren.call(this);this.createView(t.uiView)};STATICATTR$(t,["uiView",function(){return this.uiView={type:"View",child:[{props:{x:0,y:0,skin:"UI/UIbg.png",sizeGrid:"5,5,5,5",width:800,height:480},type:"Image"},{props:{x:400,y:90,skin:"UI/textGameOver.png",pivotX:206,pivotY:39},type:"Image"},{props:{x:282,y:310,skin:"UI/btn_Small.png",label:"重新开始",width:216,height:58,"var":"btn_restart",stateNum:"1",labelFont:"宋体",labelSize:28,labelColors:"#FF0000",labelBold:!0},type:"Button"},{props:{x:223,y:149,skin:"UI/medalBronze.png","var":"plane"},type:"Image"},{props:{x:367,y:150,text:"label",width:170,height:55,align:"center",bold:!0,color:"#ff0000",font:"宋体",fontSize:120,"var":"lab_score"},type:"Label"},{props:{x:648,y:16,text:"label",width:128,height:40,"var":"lab_bestScore",align:"right",bold:!0,color:"#ff0000",fontSize:20,font:"宋体"},type:"Label"}],props:{width:800,height:480}}}]);return t}(View);
