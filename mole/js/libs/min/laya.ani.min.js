!function(t,i,e){var a=(e.un,e.uns,e["static"]),s=e["class"],n=e.getset,r=e.__newvec,h=laya.utils.Browser,l=laya.utils.Byte,o=laya.webgl.utils.CONST3D2D,u=(laya.events.Event,laya.events.EventDispatcher),_=laya.display.Graphics,p=laya.utils.Handler,c=laya.webgl.utils.IndexBuffer2D,d=laya.net.Loader,f=laya.maths.MathUtil,m=laya.maths.Matrix,y=laya.renders.Render,g=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.shader.Shader),x=laya.display.Sprite,v=laya.utils.Stat,D=laya.resource.Texture,I=laya.net.URL,A=laya.webgl.shader.d2.value.Value2D,T=laya.webgl.utils.VertexBuffer2D,b=(laya.webgl.WebGLContext,function(){function t(){}return s(t,"laya.ani.AnimationState"),t.stopped=0,t.paused=1,t.playing=2,t}(),function(){function t(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._spineSprite=null}s(t,"laya.ani.bone.BoneSlot");var i=t.prototype;return i.showSlotData=function(t){this.currSlotData=t,this.displayIndex=this.srcDisplayIndex,this.currDisplayData=null,this.currTexture=null},i.showDisplayByName=function(t){this.showDisplayByIndex(this.currSlotData.getDisplayByName(t))},i.showDisplayByIndex=function(t){if(this.currSlotData&&t>-1&&t<this.currSlotData.displayArr.length){if(this.displayIndex=t,this.currDisplayData=this.currSlotData.displayArr[t],this.currDisplayData){var i=this.currDisplayData.name;if(this.currTexture=this.templet.getTexture(i),this.currTexture)switch(this.currDisplayData.type){case 0:this.currDisplayData.uvs&&(this.currTexture=new D(this.currTexture.bitmap,this.currDisplayData.uvs));break;case 1:case 2:null==this._spineSprite&&(this._spineSprite=new U)}}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null},i.replaceSkin=function(t){this._diyTexture=t},i.setParentMatrix=function(t){this._parentMatrix=t},i.draw=function(t,i,e,a){if(void 0===a&&(a=!1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData){var s=this.currTexture;switch(this._diyTexture&&(s=this._diyTexture),this.currDisplayData.type){case 0:if(t){var n=this.getDisplayMatrix();if(this._parentMatrix&&n){m.mul(n,this._parentMatrix,m.TEMP);var r;a?(null==this._resultMatrix&&(this._resultMatrix=new m),r=this._resultMatrix):r=new m,m.TEMP.copyTo(r),t.drawTexture(s,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,r)}}break;case 1:if(this._spineSprite){null==this._spineSprite.parent&&e.addChild(this._spineSprite);var h=[],l=[],o=1,u=1,_=1,p=1;if(null==this.currDisplayData.bones){for(var c=0,d=0;c<this.currDisplayData.weights.length&&d<this.currDisplayData.uvs.length;){var f=this.currDisplayData.weights[c++],y=this.currDisplayData.weights[c++];h.push(f,y,this.currDisplayData.uvs[d++],this.currDisplayData.uvs[d++],o,u,_,p)}var g=this.currDisplayData.triangles.length/3;for(c=0;g>c;c++)l.push(this.currDisplayData.triangles[3*c]),l.push(this.currDisplayData.triangles[3*c+1]),l.push(this.currDisplayData.triangles[3*c+2]);this._spineSprite.init(this.currTexture,h,l);var x=this.getDisplayMatrix();if(this._parentMatrix&&x){m.mul(x,this._parentMatrix,m.TEMP);var v;a?(null==this._resultMatrix&&(this._resultMatrix=new m),v=this._resultMatrix):v=new m,m.TEMP.copyTo(v),this._spineSprite.transform=v}}else this.skinMesh(i)}break;case 2:null==this._spineSprite.parent&&e.addChild(this._spineSprite),this.skinMesh(i)}}},i.skinMesh=function(t){if(this._spineSprite){var i,e=this.currDisplayData.bones,a=this.currDisplayData.uvs,s=this.currDisplayData.weights,n=this.currDisplayData.triangles,r=[],h=[],l=0,o=0,u=0,_=NaN,p=NaN,c=0,d=0,f=[],m=0,y=0,g=0,x=1,v=1,D=1,I=1;for(m=0,g=e.length;g>m;){for(u=e[m++]+m,l=0,o=0;u>m;m++)i=t[e[m]],_=s[c],p=s[c+1],d=s[c+2],l+=(_*i.a+p*i.c+i.tx)*d,o+=(_*i.b+p*i.d+i.ty)*d,c+=3;f.push(l,o)}for(m=0,y=0;m<f.length&&y<a.length;)l=f[m++],o=f[m++],r.push(l,o,a[y++],a[y++],x,v,D,I);for(m=0,g=n.length;g>m;m++)h.push(n[m]);this._spineSprite.init(this.currTexture,r,h)}},i.drawBonePoint=function(t){t&&this._parentMatrix&&t.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},i.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},i.getMatrix=function(){return this._resultMatrix},i.copy=function(){var i=new t;return i.type="copy",i.name=this.name,i.attachmentName=this.attachmentName,i.srcDisplayIndex=this.srcDisplayIndex,i.parent=this.parent,i.displayIndex=this.displayIndex,i.templet=this.templet,i.currSlotData=this.currSlotData,i.currTexture=this.currTexture,i.currDisplayData=this.currDisplayData,i},t}()),C=function(){function t(){this.name=null,this.slotArr=[]}return s(t,"laya.ani.bone.SkinData"),t}(),F=function(){function t(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null}return s(t,"laya.ani.bone.SkinSlotDisplayData"),t}(),S=function(){function t(){this.name=null,this.displayArr=[]}s(t,"laya.ani.bone.SlotData");var i=t.prototype;return i.getDisplayByName=function(t){for(var i,e=0,a=this.displayArr.length;a>e;e++)if(i=this.displayArr[e],i.attachmentName==t)return e;return-1},t}(),M=function(){function t(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.mMatrix=null}s(t,"laya.ani.bone.Transform");var i=t.prototype;return i.initData=function(t){void 0!=t.x&&(this.x=t.x),void 0!=t.y&&(this.y=t.y),void 0!=t.skX&&(this.skX=t.skX),void 0!=t.skY&&(this.skY=t.skY),void 0!=t.scX&&(this.scX=t.scX),void 0!=t.scY&&(this.scY=t.scY)},i.getMatrix=function(){var t;if(t=this.mMatrix?this.mMatrix:this.mMatrix=new m,t.a=Math.cos(this.skY),0!=this.skX||0!=this.skY){var i=this.skX*Math.PI/180,e=Math.cos(i),a=Math.sin(i);t.setTo(this.scX*e,this.scX*a,this.scY*-a,this.scY*e,this.x,this.y)}else t.setTo(this.scX,this.skX,this.skY,this.scY,this.x,this.y);return t},t}(),N=function(t){function i(t){this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._duration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startPlayLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this.playbackRate=1,this.isCache=!0,this.returnToZeroStopped=!0,i.__super.call(this),void 0===t&&(t=60),this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._duration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startPlayLoopCount=-1,this._cacheFrameRate=t,this._cacheFrameRateInterval=1e3/this._cacheFrameRate}s(i,"laya.ani.AnimationPlayer",t);var e=i.prototype;return e.play=function(t,i,e){void 0===t&&(t=0),void 0===i&&(i=1),void 0===e&&(e=1.7976931348623157e308),this._currentTime=0,this._elapsedPlaybackTime=0,this.playbackRate=i,this._duration=e,this._paused=!1,this._currentAnimationClipIndex=t,this._currentKeyframeIndex=0,this._startPlayLoopCount=v.loopCount,this.event("played")},e.stop=function(t){void 0===t&&(t=!0),t?(this._currentAnimationClipIndex=this._currentKeyframeIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},e.update=function(t){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var i=0;this._startPlayLoopCount!==v.loopCount&&(i=t*this.playbackRate,this._elapsedPlaybackTime+=i);var e=this._templet.getAniDuration(this._currentAnimationClipIndex);if(0!==this._duration&&this._elapsedPlaybackTime>=this._duration||0===this._duration&&this._elapsedPlaybackTime>=e)return this._currentAnimationClipIndex=this._currentKeyframeIndex=-1,void this.event("stopped");if(i+=this._currentTime,e>0){for(;i>=e;){if(this._stopWhenCircleFinish)return this._currentAnimationClipIndex=this._currentKeyframeIndex=-1,this._stopWhenCircleFinish=!1,void this.event("stopped");i-=e}this.currentTime=i}else{if(this._stopWhenCircleFinish)return this._currentAnimationClipIndex=this._currentKeyframeIndex=-1,this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0}}},n(0,e,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),n(0,e,"templet",function(){return this._templet},function(t){0===!this.State&&this.stop(!0),this._templet=t}),n(0,e,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),n(0,e,"cacheFrameRate",function(){return this._cacheFrameRate}),n(0,e,"currentFrameTime",function(){return this._currentFrameTime}),n(0,e,"currentTime",function(){return this._currentTime},function(t){this._currentTime=t,this._currentKeyframeIndex=Math.floor(this._currentTime%this._templet.getAniDuration(this._currentAnimationClipIndex)/this._cacheFrameRateInterval),this._currentFrameTime=this._currentKeyframeIndex*this._cacheFrameRateInterval}),n(0,e,"State",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),n(0,e,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),n(0,e,"paused",function(){return this._paused},function(t){this._paused=t,t&&this.event("paused")}),i}(u),w=function(t){function i(){this._aniMap={},this.unfixedLastAniIndex=-1,this._loaded=!1,this._animationDatasCache=[],i.__super.call(this),this._anis=new Array}s(i,"laya.ani.KeyframesAniTemplet",t);var e=i.prototype;return e.parse=function(t,e){var a=0,s=0,n=0,r=0,h=0,o=new l(t);this._aniVersion=o.readUTFString();var u,_=(o.readUTFString(),o.readUTFString().split("\n")),p=o.getUint8(),c=o.getUint32(),d=o.getUint32();c>0&&(u=t.slice(c,d));var f=new l(u);for(d>0&&(this._publicExtData=t.slice(d,t.byteLength)),this._useParent=!!o.getUint8(),this._anis.length=p,a=0;p>a;a++){var m=this._anis[a]={};m.nodes=new Array;var y=m.name=_[o.getUint16()];this._aniMap[y]=a,m.bone3DMap={},m.playTime=o.getFloat32();var g=m.nodes.length=o.getUint8();for(m.totalKeyframesLength=0,s=0;g>s;s++){var x=m.nodes[s]={};x.childs=[];var v=o.getInt16();v>=0&&(x.name=_[v],m.bone3DMap[x.name]=s),x.keyFrame=new Array,x.parentIndex=o.getInt16(),-1==x.parentIndex?x.parent=null:x.parent=m.nodes[x.parentIndex];var D=!!o.getUint8(),I=o.getUint32();f.pos=I;var A=x.keyframeWidth=f.getUint16();if(m.totalKeyframesLength+=A,D)for(x.interpolationMethod=[],x.interpolationMethod.length=A,n=0;A>n;n++)x.interpolationMethod[n]=i.interpolation[f.getUint8()];null!=x.parent&&x.parent.childs.push(x);var T=o.getUint16();T>0&&(x.extenData=t.slice(o.pos,o.pos+T),o.pos+=T);var b=o.getUint16();x.keyFrame.length=b;var C=0;for(n=0,r=b;r>n;n++){var F=x.keyFrame[n]={};for(F.duration=o.getFloat32(),F.startTime=C,F.data=new Float32Array(A),F.dData=new Float32Array(A),F.nextData=new Float32Array(A),h=0;A>h;h++)F.data[h]=o.getFloat32(),F.data[h]>-1e-8&&F.data[h]<1e-8&&(F.data[h]=0);C+=F.duration}x.playTime=m.playTime,this._calculateKeyFrame(x,b,A),this._calculateKeyFrameIndex(x,e)}}this._loaded=!0,this.event("loaded",this)},e._calculateKeyFrame=function(t,i,e){var a=t.keyFrame;a[i]=a[0];for(var s=0;i>s;s++)for(var n=a[s],r=0;e>r;r++)n.dData[r]=0===n.duration?0:(a[s+1].data[r]-n.data[r])/n.duration,n.nextData[r]=a[s+1].data[r];a.length--},e._calculateKeyFrameIndex=function(t,i){var e=1e3/i;t.frameCount=Math.floor(t.playTime/e),t.fullFrame=new Uint16Array(t.frameCount+1);for(var a=-1,s=0,n=t.keyFrame.length;n>s;s++){var r=t.keyFrame[s],h=r.startTime,l=h+r.duration+e;do{for(var o=Math.floor(h/e+.5),u=a+1;o>u;u++)t.fullFrame[u]=s;a=o,t.fullFrame[o]=s,h+=e}while(l>=h)}},e.getAnimationCount=function(){return this._anis.length},e.getAnimation=function(t){return this._anis[t]},e.getAniDuration=function(t){return this._anis[t].playTime},e.getNodes=function(t){return this._anis[t].nodes},e.getNodeIndexWithName=function(t,i){return this._anis[t].bone3DMap[i]},e.getNodeCount=function(t){return this._anis[t].nodes.length},e.getTotalkeyframesLength=function(t){return this._anis[t].totalKeyframesLength},e.getPublicExtData=function(){return this._publicExtData},e.getAnimationDataWithCache=function(t,i,e){var a=t[i];return a?a[e]:null},e.setAnimationDataWithCache=function(t,i,e,a){var s=t[i];s||(s=t[i]=[]),s[e]=a},e.getOriginalData=function(t,i,e,a){for(var s=this._anis[t],n=s.nodes,r=0,h=0,l=n.length,o=0;l>h;h++){var u,_=n[h];u=_.keyFrame[_.fullFrame[e]],_.dataOffset=o;var p=a-u.startTime;for(r=0;r<_.keyframeWidth;)r+=_.interpolationMethod[r](_,r,i,o+r,u.data,p,u.dData,u.duration,u.nextData);o+=_.keyframeWidth}},e.getNodesCurrentFrameIndex=function(t,i){var e=this._anis[t],a=e.nodes;t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(a.length),this.unfixedCurrentTimes=new Float32Array(a.length),this.unfixedLastAniIndex=t);for(var s=0,n=a.length;n>s;s++){var r=a[s];for(i<this.unfixedCurrentTimes[s]&&(this.unfixedCurrentFrameIndexes[s]=0),this.unfixedCurrentTimes[s]=i;this.unfixedCurrentFrameIndexes[s]<r.keyFrame.length&&!(r.keyFrame[this.unfixedCurrentFrameIndexes[s]].startTime>this.unfixedCurrentTimes[s]);)this.unfixedCurrentFrameIndexes[s]++;this.unfixedCurrentFrameIndexes[s]--}return this.unfixedCurrentFrameIndexes},e.getOriginalDataUnfixedRate=function(t,i,e){var a=this._anis[t],s=a.nodes;t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(s.length),this.unfixedCurrentTimes=new Float32Array(s.length),this.unfixedKeyframes=r(s.length),this.unfixedLastAniIndex=t);for(var n=0,h=0,l=s.length,o=0;l>h;h++){var u=s[h];for(e<this.unfixedCurrentTimes[h]&&(this.unfixedCurrentFrameIndexes[h]=0),this.unfixedCurrentTimes[h]=e;this.unfixedCurrentFrameIndexes[h]<u.keyFrame.length&&!(u.keyFrame[this.unfixedCurrentFrameIndexes[h]].startTime>this.unfixedCurrentTimes[h]);)this.unfixedKeyframes[h]=u.keyFrame[this.unfixedCurrentFrameIndexes[h]],this.unfixedCurrentFrameIndexes[h]++;var _=this.unfixedKeyframes[h];u.dataOffset=o;var p=e-_.startTime;for(n=0;n<u.keyframeWidth;)n+=u.interpolationMethod[n](u,n,i,o+n,_.data,p,_.dData,_.duration,_.nextData);o+=u.keyframeWidth}},n(0,e,"loaded",function(){return this._loaded}),i._LinearInterpolation_0=function(t,i,e,a,s,n,r,h,l){return e[a]=s[i]+n*r[i],1},i._QuaternionInterpolation_1=function(t,i,e,a,s,n,r,h,l){var o=0===h?0:n/h;return f.slerpQuaternionArray(s,i,l,i,o,e,a),4},i._AngleInterpolation_2=function(t,i,e,a,s,n,r,h,l){return 0},i._RadiansInterpolation_3=function(t,i,e,a,s,n,r,h,l){return 0},i._Matrix4x4Interpolation_4=function(t,i,e,a,s,n,r,h,l){for(var o=0;16>o;o++,i++)e[a+o]=s[i]+n*r[i];return 16},i._NoInterpolation_5=function(t,i,e,a,s,n,r,h,l){return e[a]=s[i],1},i._uniqueIDCounter=1,i.interpolation=[i._LinearInterpolation_0,i._QuaternionInterpolation_1,i._AngleInterpolation_2,i._RadiansInterpolation_3,i._Matrix4x4Interpolation_4,i._NoInterpolation_5],i.LAYA_ANIMATION_VISION="LAYAANIMATION:1.0.1",i}(u),k=function(t){function i(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.url=null,this.yReverseMatrix=null,this._rate=60,this.textureDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,i.__super.call(this)}s(i,"laya.ani.bone.Templet",t);var a=i.prototype;return a.loadAni=function(t){this._skBufferUrl=t,e.loader.load(t,p.create(this,this.onComplete),null,"arraybuffer")},a.onComplete=function(){var t=d.getRes(this._skBufferUrl);this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,t)},a.parseData=function(t,i,e){void 0===e&&(e=60),this._mainTexture=t,this._rate=e,this.parse(i,e)},a.buildArmature=function(t){return void 0===t&&(t=0),new L(this,t)},a.parse=function(i,e){t.prototype.parse.call(this,i,e),this._loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},a._parseTexturePath=function(){var t=0;this._loadList=[];var i,a=new l(this.getPublicExtData()),s=0,n=0,r=0,h=0,o=0,u=0,_=0,c=0,d=0,f=a.getUint8(),m=a.readUTFString(),y=m.split("\n");for(t=0;f>t;t++)"LAYAANIMATION:1.0.0"==this._aniVersion?m=y[t]:"LAYAANIMATION:1.0.1"==this._aniVersion&&(i=this._path+y[2*t],m=y[2*t+1]),s=a.getFloat32(),n=a.getFloat32(),r=a.getFloat32(),h=a.getFloat32(),d=a.getFloat32(),o=isNaN(d)?0:d,d=a.getFloat32(),u=isNaN(d)?0:d,d=a.getFloat32(),_=isNaN(d)?r:d,d=a.getFloat32(),c=isNaN(d)?h:d,-1==this._loadList.indexOf(i)&&this._loadList.push(i);e.loader.load(this._loadList,p.create(this,this._textureComplete))},a._textureComplete=function(){for(var t,i=0,e=this._loadList.length;e>i;i++)t=this._loadList[i],this._textureDic[t]=d.getRes(t);this._parsePublicExtData()},a._parsePublicExtData=function(){var t=0,i=0,e=0,a=0,s=0;for(t=0,s=this.getAnimationCount();s>t;t++)this._graphicsCache.push([]);var n,r,h=new l(this.getPublicExtData()),o=0,u=0,_=0,p=0,c=0,d=0,f=0,y=0,g=0,x=h.getUint8(),v=h.readUTFString(),I=v.split("\n");for(t=0;x>t;t++)n=this._mainTexture,"LAYAANIMATION:1.0.0"==this._aniVersion?v=I[t]:"LAYAANIMATION:1.0.1"==this._aniVersion&&(r=this._path+I[2*t],v=I[2*t+1],null==this._mainTexture&&(n=this._textureDic[r])),o=h.getFloat32(),u=h.getFloat32(),_=h.getFloat32(),p=h.getFloat32(),g=h.getFloat32(),c=isNaN(g)?0:g,g=h.getFloat32(),d=isNaN(g)?0:g,g=h.getFloat32(),f=isNaN(g)?_:g,g=h.getFloat32(),y=isNaN(g)?p:g,this.subTextureDic[v]=D.create(n,o,u,_,p,-c,-d,f,y);var A=h.getUint16(),T=h.getUint16(),N=Math.floor(T/A),w=this.srcBoneMatrixArr;for(t=0;N>t;t++){var k=new M;k.scX=h.getFloat32(),k.skX=h.getFloat32(),k.skY=h.getFloat32(),k.scY=h.getFloat32(),k.x=h.getFloat32(),k.y=h.getFloat32(),w.push(k)}var B,L,U=h.getInt16();for(t=0;U>t;t++)B=new b,B.name=h.readUTFString(),B.parent=h.readUTFString(),"LAYAANIMATION:1.0.1"==this._aniVersion&&(B.attachmentName=h.readUTFString()),B.srcDisplayIndex=B.displayIndex=h.getInt16(),B.templet=this,this.boneSlotDic[B.name]=B,L=this.bindBoneBoneSlotDic[B.parent],null==L&&(this.bindBoneBoneSlotDic[B.parent]=L=[]),L.push(B),this.boneSlotArray.push(B);var P,O,R,Y=h.readUTFString(),E=Y.split("\n"),V=0,W=h.getUint8(),X=0,K=0,G=0,z=0,H=0,Q=0,$=0;for(t=0;W>t;t++){for(P=new C,P.name=E[V++],X=h.getUint8(),i=0;X>i;i++){for(O=new S,O.name=E[V++],B=this.boneSlotDic[O.name],K=h.getUint8(),e=0;K>e;e++)if(R=new F,R.name=E[V++],"LAYAANIMATION:1.0.1"==this._aniVersion&&(R.attachmentName=E[V++]),R.transform=new M,R.transform.scX=h.getFloat32(),R.transform.skX=h.getFloat32(),R.transform.skY=h.getFloat32(),R.transform.scY=h.getFloat32(),R.transform.x=h.getFloat32(),R.transform.y=h.getFloat32(),O.displayArr.push(R),"LAYAANIMATION:1.0.0"==this._aniVersion)n=this.getTexture(R.name),n?(R.width=n.sourceWidth,R.height=n.sourceHeight):(R.width=0,R.height=0);else if("LAYAANIMATION:1.0.1"==this._aniVersion)switch(R.width=h.getFloat32(),R.height=h.getFloat32(),R.type=h.getUint8(),R.type){case 0:case 1:case 2:if(G=h.getUint16(),G>0)for(R.bones=[],a=0;G>a;a++){var Z=h.getUint16();R.bones.push(Z)}if(z=h.getUint16(),z>0)for(R.uvs=[],a=0;z>a;a++)R.uvs.push(h.getFloat32());if(H=h.getUint16(),H>0)for(R.weights=[],a=0;H>a;a++)R.weights.push(h.getFloat32());if(Q=h.getUint16(),Q>0)for(R.triangles=[],a=0;Q>a;a++)R.triangles.push(h.getUint16());if($=h.getUint16(),$>0)for(R.vertices=[],a=0;$>a;a++)R.vertices.push(h.getFloat32())}P.slotArr.push(O)}this.skinDic[P.name]=P,this.skinDataArray.push(P)}if("LAYAANIMATION:1.0.1"==this._aniVersion){var q=h.getUint8();1==q&&(this.yReverseMatrix=new m(1,0,0,-1,0,0))}this.showSkinByIndex(this.boneSlotDic,0),this.event("complete",this)},a.getTexture=function(t){return this.subTextureDic[t]},a.showSkinByIndex=function(t,i){if(!(0>i&&i>=this.skinDataArray.length)){var e,a,s=0,n=0,r=this.skinDataArray[i];if(r)for(s=0,n=r.slotArr.length;n>s;s++)a=r.slotArr[s],a&&(e=t[a.name],e&&(e.showSlotData(a),"null"!=e.attachmentName?e.showDisplayByName(e.attachmentName):e.showDisplayByIndex(e.displayIndex)))}},a.showSkinByName=function(t,i){var e,a,s=0,n=0,r=this.skinDic[i];if(r)for(s=0,n=r.slotArr.length;n>s;s++)a=r.slotArr[s],a&&(e=t[a.name],e&&(e.showSlotData(a),"null"!=e.attachmentName?e.showDisplayByName(e.attachmentName):e.showDisplayByIndex(e.displayIndex)))},a.getGrahicsDataWithCache=function(t,i){return this._graphicsCache[t][i]},a.setGrahicsDataWithCache=function(t,i,e){this._graphicsCache[t][i]=e},a.destroy=function(){this.url&&delete i.TEMPLET_DICTIONARY[this.url]},a.getAniNameByIndex=function(t){var i=this.getAnimation(t);return i?i.name:null},n(0,a,"rate",function(){return this._rate}),i.TEMPLET_DICTIONARY=null,i}(w),B=function(t){function i(){this.texcoord=null,i.__super.call(this,0,0);var t=8*o.BYTES_PE;this.position=[2,5126,!1,t,0],this.texcoord=[2,5126,!1,t,2*o.BYTES_PE],this.color=[4,5126,!1,t,4*o.BYTES_PE]}return s(i,"laya.ani.bone.shader.aniShaderValue",t),i}(A),L=function(t){function i(t,e){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,i.__super.call(this),this._tempTransform=new M,void 0===e&&(e=0),t&&this.init(t,e)}s(i,"laya.ani.bone.Skeleton",t);var a=i.prototype;return a.init=function(t,i){if(void 0===i&&(i=0),1==i){this._graphicsCache=[];for(var e=0,a=t.getAnimationCount();a>e;e++)this._graphicsCache.push([])}this._yReverseMatrix=t.yReverseMatrix,this._aniMode=i,this._templet=t,this._player=new N(t.rate),this._player.templet=t,this._player.play(),this._parseSrcBoneMatrix(),this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},a.load=function(t,i,a){void 0===a&&(a=0),this._aniPath=t,this._complete=i,this._loadAniMode=a,this._texturePath=t.replace(".sk",".png").replace(".bin",".png"),e.loader.load([{url:t,type:"arraybuffer"},{url:this._texturePath,type:"image"}],p.create(this,this._onLoaded))},a._onLoaded=function(){var t=d.getRes(this._texturePath),i=d.getRes(this._aniPath);if(null!=t&&null!=i){null==k.TEMPLET_DICTIONARY&&(k.TEMPLET_DICTIONARY={});var e;e=k.TEMPLET_DICTIONARY[this._aniPath],e?e.isParseFail?this._parseFail():this._parseComplete():(e=new k,e.url=this._aniPath,k.TEMPLET_DICTIONARY[this._aniPath]=e,e.on("complete",this,this._parseComplete),e.on("error",this,this._parseFail),e.parseData(t,i,60))}},a._parseComplete=function(){var t=k.TEMPLET_DICTIONARY[this._aniPath];t&&(this.init(t,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},a._parseFail=function(){console.log("[Error]:"+this._aniPath+"解析失败")},a._onPlay=function(){this.event("played")},a._onStop=function(){this.event("stopped")},a._onPause=function(){this.event("paused")},a._parseSrcBoneMatrix=function(){var t=0,i=0;for(i=this._templet.srcBoneMatrixArr.length,t=0;i>t;t++)this._boneMatrixArray.push(new m);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var e,a,s=this._templet.boneSlotArray;for(t=0,i=s.length;i>t;t++)e=s[t],a=this._bindBoneBoneSlotDic[e.parent],null==a&&(this._bindBoneBoneSlotDic[e.parent]=a=[]),this._boneSlotDic[e.name]=e=e.copy(),a.push(e),this._boneSlotArray.push(e)}},a._update=function(t){if(void 0===t&&(t=!0),!(this._pause||t&&this._indexControl)){var i=e.timer.currTimer;if(t&&this._player.update(i-this._lastTime),this._lastTime=i,this._aniClipIndex=this._player.currentAnimationClipIndex,this._clipIndex=this._player.currentKeyframeIndex,-1!=this._aniClipIndex){var a;if(0==this._aniMode){if(a=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics=a)}else if(1==this._aniMode&&(a=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex)))return void(this.graphics=a);this._createGraphics()}}},a._createGraphics=function(){var t=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._clipIndex,this._player.currentFrameTime);var i,e,a,s,n,r,h=0,l=0,o=0,u=0,p=this._templet.srcBoneMatrixArr.length;for(l=0;p>l;l++){e=this._boneMatrixArray[l],r=this._templet.srcBoneMatrixArr[l],this._tempTransform.scX=r.scX*this._curOriginalData[h++],this._tempTransform.skX=r.skX+this._curOriginalData[h++],this._tempTransform.skY=r.skY+this._curOriginalData[h++],this._tempTransform.scY=r.scY*this._curOriginalData[h++],this._tempTransform.x=r.x+this._curOriginalData[h++],this._tempTransform.y=r.y+this._curOriginalData[h++],n=this._tempTransform.getMatrix();var c=t[l];if(-1!=c.parentIndex?(i=this._boneMatrixArray[c.parentIndex],m.mul(n,i,e)):this._yReverseMatrix?m.mul(n,this._yReverseMatrix,e):n.copyTo(e),s=this._bindBoneBoneSlotDic[c.name])for(o=0,u=s.length;u>o;o++)a=s[o],a&&a.setParentMatrix(e)}for(var d,f={},y={};l<t.length;l++)d=t[l],f[d.name]=this._curOriginalData[h++],y[d.name]=this._curOriginalData[h++],this._curOriginalData[h++],this._curOriginalData[h++],this._curOriginalData[h++],this._curOriginalData[h++];var g;0==this._aniMode||1==this._aniMode?this.graphics=new _:this.graphics.clear(),g=this.graphics;var x=NaN,v=NaN;for(l=0,u=this._boneSlotArray.length;u>l;l++)a=this._boneSlotArray[l],x=f[a.name],v=y[a.name],isNaN(v)||(g.save(),g.alpha(v)),isNaN(x)||a.showDisplayByIndex(x),a.draw(g,this._boneMatrixArray,this,2==this._aniMode),isNaN(v)||g.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,this._clipIndex,g):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,this._clipIndex,g)},a.getAnimNum=function(){return this._templet.getAnimationCount()},a.getAniNameByIndex=function(t){return this._templet.getAniNameByIndex(t)},a.getSlotByName=function(t){return this._boneSlotDic[t]},a.showSkinByName=function(t){this._templet.showSkinByName(this._boneSlotDic,t),this._clearCache()},a.showSkinByIndex=function(t){this._templet.showSkinByIndex(this._boneSlotDic,t),this._clearCache()},a.showSlotSkinByIndex=function(t,i){if(0!=this._aniMode){var e=this.getSlotByName(t);e&&e.showDisplayByIndex(i),this._clearCache()}},a.setSlotSkin=function(t,i){if(0!=this._aniMode){var e=this.getSlotByName(t);e&&e.replaceSkin(i),this._clearCache()}},a._clearCache=function(){if(1==this._aniMode)for(var t=0,i=this._graphicsCache.length;i>t;t++)this._graphicsCache[t].length=0},a.play=function(t,i,a){void 0===a&&(a=!0),this._indexControl=!1;var s=-1,n=NaN;if(n=i?Number.MAX_VALUE:0,"string"==typeof t)for(var r=0,l=this._templet.getAnimationCount();l>r;r++){var o=this._templet.getAnimation(r);if(o&&t==o.name){s=r;break}}else s=t;s>-1&&s<this.getAnimNum()&&(a||this._pause||this._currAniIndex!=s)&&(this._currAniIndex=s,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(s)),this._player.play(s,1,n),this._templet.showSkinByIndex(this._boneSlotDic,0),this._pause&&(this._pause=!1,this._lastTime=h.now(),e.stage.frameLoop(1,this,this._update,null,!0)))},a.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),e.timer.clear(this,this._update))},a.playbackRate=function(t){this._player&&(this._player.playbackRate=t)},a.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),e.timer.clear(this,this._update))},a.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=h.now(),e.stage.frameLoop(1,this,this._update,null,!0))},a._getGrahicsDataWithCache=function(t,i){return this._graphicsCache[t][i]},a._setGrahicsDataWithCache=function(t,i,e){this._graphicsCache[t][i]=e},a.destroy=function(i){void 0===i&&(i=!0),t.prototype.destroy.call(this,i),this._templet=null,this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,e.timer.clear(this,this._update)},n(0,a,"index",function(){return this._index},function(t){this.player&&(this._index=t,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))}),n(0,a,"player",function(){return this._player}),n(0,a,"url",function(){return this._aniPath},function(t){this.load(t)}),n(0,a,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total}),i}(x),U=function(t){function i(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mShaderValue=null,i.__super.call(this)}s(i,"laya.ani.bone.SkinSprite",t);var e=i.prototype;return e.init=function(t,i,e){this.mVBBuffer=T.create(),this.mIBBuffer=c.create(),this.mIBData=new Uint16Array;var a,s;if(i)a=i;else{a=[];var n=t.width,r=t.height,h=1,l=.1,o=.1,u=1;a.push(0,0,0,0,h,l,o,u),a.push(n,0,1,0,h,l,o,u),a.push(n,r,1,1,h,l,o,u),a.push(0,r,0,1,h,l,o,u)}e?s=e:(s=[],s.push(0,1,3,3,1,2)),this.mEleNum=s.length,this.mVBData=new Float32Array(a),this.mIBData=new Uint16Array(s),this.mVBBuffer.append(this.mVBData),this.mIBBuffer.append(this.mIBData),this.mShaderValue=new B,this.mShaderValue.textureHost=t,this._renderType|=512},e.customRender=function(t,i,e){y.isWebGL&&t.ctx.setIBVB(i,e,this.mIBBuffer,this.mVBBuffer,this.mEleNum,null,P.shader,this.mShaderValue,0,0)},i}(x),P=(function(t){function i(t){this._start=0,this._Pos=0,this._data=null,this._curIndex=0,this._preIndex=0,this._playIndex=0,this._playing=!1,this._ended=!0,this._count=0,this._ids=null,this._idOfSprite=null,this._parentMovieClip=null,this._movieClipList=null,this._labels=null,this.basePath=null,this.interval=30,this.loop=!1,i.__super.call(this),this._ids={},this._idOfSprite=[],this._reset(),this._playing=!1,this._parentMovieClip=t,t?(this._movieClipList=t._movieClipList,this._movieClipList.push(this)):(this._movieClipList=[this],this.on("display",this,this._$3__onDisplay),this.on("undisplay",this,this._$3__onDisplay))}s(i,"laya.ani.swf.MovieClip",t);var a=i.prototype;return a.destroy=function(i){void 0===i&&(i=!0),this._clear(),t.prototype.destroy.call(this,i)},a._$3__onDisplay=function(){this._displayedInStage?e.timer.loop(this.interval,this,this.updates,null,!0):e.timer.clear(this,this.updates)},a.updates=function(){if(!this._parentMovieClip){var t=0,i=0;for(i=this._movieClipList.length,t=0;i>t;t++)this._movieClipList[t]&&this._movieClipList[t]._update()}},a.addLabel=function(t,i){this._labels||(this._labels={}),this._labels[i]=t},a.removeLabel=function(t){if(t){if(!this._labels)for(var i in this._labels)if(this._labels[i]===t){delete this._labels[i];break}}else this._labels=null},a._update=function(){if(this._data&&this._playing){if(this._playIndex++,this._playIndex>=this._count){if(!this.loop)return this._playIndex--,void this.stop();this._playIndex=0}this._parse(this._playIndex),this._labels&&this._labels[this._playIndex]&&this.event("label",this._labels[this._playIndex])}},a.stop=function(){this._playing=!1},a.gotoAndStop=function(t){this.index=t,this.stop()},a._clear=function(){if(this.stop(),this._idOfSprite.length=0,!this._parentMovieClip){e.timer.clear(this,this.updates);var t=0,i=0;for(i=this._movieClipList.length,t=0;i>t;t++)this._movieClipList[t]!=this&&this._movieClipList[t].clear();this._movieClipList.length=0}this.removeChildren(),this.graphics=null,this._parentMovieClip=null},a.play=function(t,i){void 0===t&&(t=0),void 0===i&&(i=!0),this.loop=i,this._playing=!0,this._data&&this._displayFrame(t)},a._displayFrame=function(t){
void 0===t&&(t=-1),-1!=t&&(this._curIndex>t&&this._reset(),this._parse(t))},a._reset=function(t){void 0===t&&(t=!0),t&&1!=this._curIndex&&this.removeChildren(),this._preIndex=this._curIndex=-1,this._Pos=this._start},a._parse=function(t){var e,a,s,n=0,r=0,h=0,l=0,o=!1,u=this._idOfSprite,_=this._data;for(this._ended&&this._reset(),_.pos=this._Pos,this._ended=!1,this._playIndex=t,this._curIndex>t&&t<this._preIndex&&(this._reset(!0),_.pos=this._Pos);this._curIndex<=t&&!this._ended;)switch(r=_.getUint16()){case 12:if(n=_.getUint16(),h=this._ids[_.getUint16()],this._Pos=_.pos,_.pos=h,0==(l=_.getUint8())){var p=_.getUint16();if(a=u[n],!a){a=u[n]=new x;var c=new x;c.loadImage(this.basePath+p+".png"),a.addChild(c),c.size(_.getFloat32(),_.getFloat32());var d=_._getMatrix();c.transform=d}a.alpha=1}else 1==l&&(e=u[n],e||(u[n]=e=new i(this),e.interval=this.interval,e._ids=this._ids,e.basePath=this.basePath,e._setData(_,h),e._initState(),e.play(0)),e.alpha=1);_.pos=this._Pos;break;case 3:this.addChild(u[_.getUint16()]).zOrder=_.getUint16(),o=!0;break;case 4:u[_.getUint16()].removeSelf();break;case 5:u[_.getUint16()][i._ValueList[_.getUint16()]]=_.getFloat32();break;case 6:u[_.getUint16()].visible=_.getUint8()>0;break;case 7:a=u[_.getUint16()];var f=a.transform||m.create();f.setTo(_.getFloat32(),_.getFloat32(),_.getFloat32(),_.getFloat32(),_.getFloat32(),_.getFloat32()),a.transform=f;break;case 8:u[_.getUint16()].setPos(_.getFloat32(),_.getFloat32());break;case 9:u[_.getUint16()].setSize(_.getFloat32(),_.getFloat32());break;case 10:u[_.getUint16()].alpha=_.getFloat32();break;case 11:u[_.getUint16()].setScale(_.getFloat32(),_.getFloat32());break;case 98:s=_.getString(),this.event(s),"stop"==s&&this.stop();break;case 99:this._curIndex=_.getUint16(),o&&this.updateZOrder();break;case 100:this._count=this._curIndex+1,this._ended=!0,this._playing&&(this.event("enterframe"),this.event("end"),this.event("complete")),this._reset(!1)}this._playing&&!this._ended&&this.event("enterframe"),this._Pos=_.pos},a._setData=function(t,i){this._data=t,this._start=i+3},a.load=function(t){t=I.formatURL(t),this.basePath=t.split(".swf")[0]+"/image/",this.stop(),this._clear(),this._movieClipList=[this];var i=d.getRes(t);i?this._initData(i):e.loader.load(t,p.create(this,this._onLoaded),null,"arraybuffer")},a._onLoaded=function(t){this._initData(t)},a._initState=function(){this._reset(),this._ended=!1;var t=this._playing;for(this._playing=!1,this._curIndex=0;!this._ended;)this._parse(++this._curIndex);this._playing=t},a._initData=function(t){this._data=new l(t);var i=0,a=this._data.getUint16();for(i=0;a>i;i++)this._ids[this._data.getInt16()]=this._data.getInt32();this.interval=1e3/this._data.getUint16(),this._setData(this._data,this._ids[32767]),this._initState(),this.play(0),this.event("loaded"),this._parentMovieClip||e.timer.loop(this.interval,this,this.updates,null,!0)},n(0,a,"index",function(){return this._playIndex},function(t){this._playIndex=t,this._data&&this._displayFrame(this._playIndex),this._labels&&this._labels[t]&&this.event("label",this._labels[t])}),n(0,a,"url",null,function(t){this.load(t)}),n(0,a,"count",function(){return this._count}),n(0,a,"playing",function(){return this._playing}),i._ValueList=["x","y","width","height","scaleX","scaleY","rotation","alpha"],i}(x),function(t){function i(){var t="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform mat4 mmat;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*vec4(position.x,position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_texcoord = texcoord;  \n}",e="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\nvoid main() {\n	vec4 t_color = texture2D(texture, v_texcoord);\n	gl_FragColor = t_color.rgba * v_color.rgba;\n}";i.__super.call(this,t,e,"SpineShader")}return s(i,"laya.ani.bone.shader.SkinAniShader",t),a(i,["shader",function(){return this.shader=new i}]),i}(g))}(window,document,Laya);